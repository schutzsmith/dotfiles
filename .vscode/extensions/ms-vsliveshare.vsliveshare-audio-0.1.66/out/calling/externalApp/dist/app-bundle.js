!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.callStarted=0]="callStarted",e[e.muteChanged=1]="muteChanged",e[e.participantChanged=2]="participantChanged",e[e.participantsChanged=3]="participantsChanged"}(t.CallChangedType||(t.CallChangedType={})),function(e){e.getCallInfo="getCallInfo",e.getCurrentParticipants="getCurrentParticipants",e.getDominantSpeakers="getDominantSpeakers",e.endCall="endCall",e.enumerateDevices="enumerateDevices",e.initializeStackEvent="initializeStackEvent",e.isMuted="isMuted",e.loadSlimCore="loadSlimCore",e.muteOrUnmute="muteOrUnmute",e.selectDevices="selectDevices",e.getSelectedDevices="getSelectedDevices",e.startOrJoinCall="startOrJoinCall"}(r=t.RequestType||(t.RequestType={})),function(e){e.callChanged="callChanged",e.electronAppReady="electronAppReady",e.trace="trace"}(i=t.NotificationType||(t.NotificationType={})),function(e){e[e.error=0]="error",e[e.info=1]="info",e[e.warning=2]="warning"}(t.TraceType||(t.TraceType={}));t.AppEvents=class{constructor(e){this.jsonRPCProxy=e}get isDisposed(){return this.jsonRPCProxy.isDisposed}on(e,t){this.jsonRPCProxy.on(e,t)}sendRequest(e){return this.jsonRPCProxy.sendRequest(e)}sendNotification(e){return this.jsonRPCProxy.sendNotification(e)}dispose(){this.jsonRPCProxy.dispose()}};t.CallChanged=class{constructor(e,t,n){this.changeType=e,this.callParticipant=t,this.callInfo=n,this.eventType=i.callChanged}};t.GetCallInfo=class{constructor(){this.eventType=r.getCallInfo}};t.GetCurrentParticipants=class{constructor(){this.eventType=r.getCurrentParticipants}};t.GetDominantSpeakers=class{constructor(){this.eventType=r.getDominantSpeakers}};t.ElectronAppReady=class{constructor(){this.eventType=i.electronAppReady}};t.EndCall=class{constructor(){this.eventType=r.endCall}};t.EnumerateDevices=class{constructor(){this.eventType=r.enumerateDevices}};t.InitializeStackEvent=class{constructor(e,t){this.skypeToken=e,this.displayName=t,this.eventType=r.initializeStackEvent}};t.IsMuted=class{constructor(){this.eventType=r.isMuted}};t.LoadSlimCore=class{constructor(){this.eventType=r.loadSlimCore}};t.MuteOrUnmute=class{constructor(e,t){this.isMute=e,this.participant=t,this.eventType=r.muteOrUnmute}};t.SelectDevices=class{constructor(e){this.selectedDevices=e,this.eventType=r.selectDevices}};t.GetSelectedDevices=class{constructor(){this.eventType=r.getSelectedDevices}};t.StartOrJoinCall=class{constructor(e){this.groupContext=e,this.eventType=r.startOrJoinCall}};t.Trace=class{constructor(e,t){this.traceType=e,this.message=t,this.eventType=i.trace,"string"!=typeof t&&(this.message="")}}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);class i{error(e){console.error(e);const t=this.getAppEvents();if(!t)return;const n=new r.Trace(r.TraceType.error,e);t.sendNotification(n)}info(e){console.log(e);const t=this.getAppEvents();if(!t)return;const n=new r.Trace(r.TraceType.info,e);t.sendNotification(n)}warn(e){console.warn(e);const t=this.getAppEvents();if(!t)return;const n=new r.Trace(r.TraceType.warning,e);t.sendNotification(n)}getAppEvents(){return window.appEvents}}t.ProxyTraceSource=i,t.proxyTraceSource=new i},,function(e,t){e.exports=require("os")},function(e,t,n){"use strict";
/*!
 *  AufLog.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function r(e,t){var n=0;return e.replace(/%[dixs%]/g,function(e){var r=0;if("%"!==e[r++])return"";var i=e[r++];return"%"===i?"%":"s"===i?t[n++]:"d"===i||"i"===i?t[n++]:"x"===i?t[n++].toString(16):e})}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=r,t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(e,t)}},,function(e,t,n){"use strict";
/*!
 *  LogFactory.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(5);function s(e){if(null===e)return-1;for(var t=0,n=e.length-1;n>=0;n--)t=37*t+e.charCodeAt(n)|0;var r="__auf_literal:";for(n=r.length-1;n>=0;n--)t=37*t+r.charCodeAt(n)|0;return t}!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(o||(o={}));var l,c=function(){function e(e,t){this._level=a.LogLevel.Debug4,this._threshold=255,this._safe=o.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?o.Inherited_Safe:o.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===o.Safe||this._safe===o.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){l.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Trace,s(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Debug6,s(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Debug5,s(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Debug4,s(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Debug3,s(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Debug2,s(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Debug1,s(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Warning,s(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Error,s(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.Fatal,s(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.log.apply(l,[this,a.LogLevel.MetaData,s(e),e].concat(t))},e}(),u=function(){function e(){}return e.instance=function(){return l},e.levelToString=function(e){return e<=a.LogLevel.Trace?"TRACE":e<=a.LogLevel.Debug6?"DEBUG6":e<=a.LogLevel.Debug5?"DEBUG5":e<=a.LogLevel.Debug4?"DEBUG4":e<=a.LogLevel.Debug3?"DEBUG3":e<=a.LogLevel.Debug2?"DEBUG2":e<=a.LogLevel.Debug1?"DEBUG1":e<=a.LogLevel.Warning?"WARN":e<=a.LogLevel.Error?"ERROR":e<=a.LogLevel.Fatal?"FATAL":(a.LogLevel.MetaData,"META")},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();function d(e,t){for(var n=t.name();n.length>0;){if(e[n])return e[n];var r=n.lastIndexOf(".");n=r<0?"":n.substr(0,r)}return e[""]?e[""]:a.LogLevel.Debug4}function p(e,t){var n=255;return t.forEach(function(t){var r=255;t.appender.levels()?r=Math.min(r,d(t.appender.levels(),e)):t.appender.receiveAll()||(r=Math.min(r,e.level())),n=Math.min(n,r)}),n}u._levelFromString={TRACE:a.LogLevel.Trace,DEBUG6:a.LogLevel.Debug6,DEBUG5:a.LogLevel.Debug5,DEBUG4:a.LogLevel.Debug4,DEBUG3:a.LogLevel.Debug3,DEBUG2:a.LogLevel.Debug2,DEBUG1:a.LogLevel.Debug1,WARN:a.LogLevel.Warning,ERROR:a.LogLevel.Error,FATAL:a.LogLevel.Fatal,META:a.LogLevel.MetaData},t.LogFactory=u;var h=function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new c("",null),t}return i(t,e),t.prototype.toHex=function(e){return(4294967296+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var n=this._nextId++;return t&a.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:n}):this._appenders.push({appender:e,handle:n}),this.recalcComponentThresholds(),n},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,n,r){for(var i=[],o=4;o<arguments.length;o++)i[o-4]=arguments[o];try{if(e.isEnabled(t)){var a={timestamp:(new Date).getTime(),component:e,level:t};this._appenders.forEach(function(o){(function(e,t,n){return!!e.appender.receiveAll()||(e.appender.levels()?n>=d(e.appender.levels(),t):n>=t.level())})(o,e,t)&&o.appender.log(a,n,r,i)})}}catch(e){var s=u.instance().component("RootToolsManager.LogFactoryErrors");u.instance().declareComponentSafe("RootToolsManager.LogFactoryErrors",!0);var l="object"==typeof i&&void 0!==i.length?i.length:"undefined";s.error("LogFactory logging failed %s: %s stack: %s args type: %s args_len: %s",e.name,e.message,e.stack,typeof i,l)}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var n in this._components)this.parent(n).name()===e&&t.push(this._components[n]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new c(e,this.parent(e));this._components[e]=t;var n=p(t,this._appenders);return t._setThreshold(n),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){e.safety()!==o.Inherited_Safe&&e.safety()!==o.Inherited_Unsafe||(e.setSafety(t),n.setSafetyRecursive(e.name(),t))})},t.prototype.declareComponentSafe=function(e,t){var n=this.component(e);-1!==this._componentBlacklist.indexOf(n.name())?n.setSafety(o.Blacklisted_Unsafe):n.setSafety(t?o.Safe:o.Unsafe),this.setSafetyRecursive(e,t?o.Inherited_Safe:o.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var n=this;this.children(e).forEach(function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),n.setExtendedInfoRecursive(e.name(),t))})},t.prototype.declareComponentExtendedInfo=function(e,t){var n=this.component(e);n.setExtendedInfo(t),this.setExtendedInfoRecursive(n.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],n=p(t,this._appenders);t._setThreshold(n)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var n in this._components){(o=this._components[n])._setLevel(t);var r=p(o,this._appenders);o._setThreshold(r)}else{var i=e.name()+".";e._setLevel(t);r=p(e,this._appenders);for(var n in e._setThreshold(r),this._components){var o;if((o=this._components[n]).name().substr(0,i.length)===i){o._setLevel(t);var a=p(o,this._appenders);o._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var n=this._components[t];-1!==this._componentBlacklist.indexOf(n.name())&&n.setSafety(o.Blacklisted_Unsafe)}},t}(u);l=new h},function(e,t){e.exports=require("crypto")},,,,,function(e,t,n){(function(e){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var i,o=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",l="__lodash_hash_undefined__",c=500,u="__lodash_placeholder__",d=1,p=2,h=4,f=1,g=2,_=1,m=2,v=4,y=8,C=16,S=32,I=64,P=128,T=256,b=512,O=30,E="...",R=800,A=16,w=1,D=2,L=1/0,k=9007199254740991,M=1.7976931348623157e308,N=NaN,F=4294967295,j=F-1,V=F>>>1,x=[["ary",P],["bind",_],["bindKey",m],["curry",y],["curryRight",C],["flip",b],["partial",S],["partialRight",I],["rearg",T]],H="[object Arguments]",U="[object Array]",B="[object AsyncFunction]",q="[object Boolean]",G="[object Date]",W="[object DOMException]",K="[object Error]",z="[object Function]",J="[object GeneratorFunction]",Q="[object Map]",$="[object Number]",Y="[object Null]",Z="[object Object]",X="[object Proxy]",ee="[object RegExp]",te="[object Set]",ne="[object String]",re="[object Symbol]",ie="[object Undefined]",oe="[object WeakMap]",ae="[object WeakSet]",se="[object ArrayBuffer]",le="[object DataView]",ce="[object Float32Array]",ue="[object Float64Array]",de="[object Int8Array]",pe="[object Int16Array]",he="[object Int32Array]",fe="[object Uint8Array]",ge="[object Uint8ClampedArray]",_e="[object Uint16Array]",me="[object Uint32Array]",ve=/\b__p \+= '';/g,ye=/\b(__p \+=) '' \+/g,Ce=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Se=/&(?:amp|lt|gt|quot|#39);/g,Ie=/[&<>"']/g,Pe=RegExp(Se.source),Te=RegExp(Ie.source),be=/<%-([\s\S]+?)%>/g,Oe=/<%([\s\S]+?)%>/g,Ee=/<%=([\s\S]+?)%>/g,Re=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ae=/^\w*$/,we=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,De=/[\\^$.*+?()[\]{}|]/g,Le=RegExp(De.source),ke=/^\s+|\s+$/g,Me=/^\s+/,Ne=/\s+$/,Fe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,je=/\{\n\/\* \[wrapped with (.+)\] \*/,Ve=/,? & /,xe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,He=/\\(\\)?/g,Ue=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Be=/\w*$/,qe=/^[-+]0x[0-9a-f]+$/i,Ge=/^0b[01]+$/i,We=/^\[object .+?Constructor\]$/,Ke=/^0o[0-7]+$/i,ze=/^(?:0|[1-9]\d*)$/,Je=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qe=/($^)/,$e=/['\n\r\u2028\u2029\\]/g,Ye="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ze="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xe="[\\ud800-\\udfff]",et="["+Ze+"]",tt="["+Ye+"]",nt="\\d+",rt="[\\u2700-\\u27bf]",it="[a-z\\xdf-\\xf6\\xf8-\\xff]",ot="[^\\ud800-\\udfff"+Ze+nt+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",at="\\ud83c[\\udffb-\\udfff]",st="[^\\ud800-\\udfff]",lt="(?:\\ud83c[\\udde6-\\uddff]){2}",ct="[\\ud800-\\udbff][\\udc00-\\udfff]",ut="[A-Z\\xc0-\\xd6\\xd8-\\xde]",dt="(?:"+it+"|"+ot+")",pt="(?:"+ut+"|"+ot+")",ht="(?:"+tt+"|"+at+")"+"?",ft="[\\ufe0e\\ufe0f]?"+ht+("(?:\\u200d(?:"+[st,lt,ct].join("|")+")[\\ufe0e\\ufe0f]?"+ht+")*"),gt="(?:"+[rt,lt,ct].join("|")+")"+ft,_t="(?:"+[st+tt+"?",tt,lt,ct,Xe].join("|")+")",mt=RegExp("['’]","g"),vt=RegExp(tt,"g"),yt=RegExp(at+"(?="+at+")|"+_t+ft,"g"),Ct=RegExp([ut+"?"+it+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[et,ut,"$"].join("|")+")",pt+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[et,ut+dt,"$"].join("|")+")",ut+"?"+dt+"+(?:['’](?:d|ll|m|re|s|t|ve))?",ut+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",nt,gt].join("|"),"g"),St=RegExp("[\\u200d\\ud800-\\udfff"+Ye+"\\ufe0e\\ufe0f]"),It=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Pt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Tt=-1,bt={};bt[ce]=bt[ue]=bt[de]=bt[pe]=bt[he]=bt[fe]=bt[ge]=bt[_e]=bt[me]=!0,bt[H]=bt[U]=bt[se]=bt[q]=bt[le]=bt[G]=bt[K]=bt[z]=bt[Q]=bt[$]=bt[Z]=bt[ee]=bt[te]=bt[ne]=bt[oe]=!1;var Ot={};Ot[H]=Ot[U]=Ot[se]=Ot[le]=Ot[q]=Ot[G]=Ot[ce]=Ot[ue]=Ot[de]=Ot[pe]=Ot[he]=Ot[Q]=Ot[$]=Ot[Z]=Ot[ee]=Ot[te]=Ot[ne]=Ot[re]=Ot[fe]=Ot[ge]=Ot[_e]=Ot[me]=!0,Ot[K]=Ot[z]=Ot[oe]=!1;var Et={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Rt=parseFloat,At=parseInt,wt="object"==typeof global&&global&&global.Object===Object&&global,Dt="object"==typeof self&&self&&self.Object===Object&&self,Lt=wt||Dt||Function("return this")(),kt=t&&!t.nodeType&&t,Mt=kt&&"object"==typeof e&&e&&!e.nodeType&&e,Nt=Mt&&Mt.exports===kt,Ft=Nt&&wt.process,jt=function(){try{var e=Mt&&Mt.require&&Mt.require("util").types;return e||Ft&&Ft.binding&&Ft.binding("util")}catch(e){}}(),Vt=jt&&jt.isArrayBuffer,xt=jt&&jt.isDate,Ht=jt&&jt.isMap,Ut=jt&&jt.isRegExp,Bt=jt&&jt.isSet,qt=jt&&jt.isTypedArray;function Gt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Wt(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function Kt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function zt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Jt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Qt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function $t(e,t){return!!(null==e?0:e.length)&&sn(e,t,0)>-1}function Yt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Zt(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Xt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function en(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function tn(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function nn(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var rn=dn("length");function on(e,t,n){var r;return n(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function an(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function sn(e,t,n){return t==t?function(e,t,n){var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):an(e,cn,n)}function ln(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function cn(e){return e!=e}function un(e,t){var n=null==e?0:e.length;return n?fn(e,t)/n:N}function dn(e){return function(t){return null==t?i:t[e]}}function pn(e){return function(t){return null==e?i:e[t]}}function hn(e,t,n,r,i){return i(e,function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)}),n}function fn(e,t){for(var n,r=-1,o=e.length;++r<o;){var a=t(e[r]);a!==i&&(n=n===i?a:n+a)}return n}function gn(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function _n(e){return function(t){return e(t)}}function mn(e,t){return Zt(t,function(t){return e[t]})}function vn(e,t){return e.has(t)}function yn(e,t){for(var n=-1,r=e.length;++n<r&&sn(t,e[n],0)>-1;);return n}function Cn(e,t){for(var n=e.length;n--&&sn(t,e[n],0)>-1;);return n}var Sn=pn({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),In=pn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Pn(e){return"\\"+Et[e]}function Tn(e){return St.test(e)}function bn(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function On(e,t){return function(n){return e(t(n))}}function En(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n];a!==t&&a!==u||(e[n]=u,o[i++]=n)}return o}function Rn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function An(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function wn(e){return Tn(e)?function(e){var t=yt.lastIndex=0;for(;yt.test(e);)++t;return t}(e):rn(e)}function Dn(e){return Tn(e)?function(e){return e.match(yt)||[]}(e):function(e){return e.split("")}(e)}var Ln=pn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var kn=function e(t){var n,r=(t=null==t?Lt:kn.defaults(Lt.Object(),t,kn.pick(Lt,Pt))).Array,Ye=t.Date,Ze=t.Error,Xe=t.Function,et=t.Math,tt=t.Object,nt=t.RegExp,rt=t.String,it=t.TypeError,ot=r.prototype,at=Xe.prototype,st=tt.prototype,lt=t["__core-js_shared__"],ct=at.toString,ut=st.hasOwnProperty,dt=0,pt=(n=/[^.]+$/.exec(lt&&lt.keys&&lt.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",ht=st.toString,ft=ct.call(tt),gt=Lt._,_t=nt("^"+ct.call(ut).replace(De,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=Nt?t.Buffer:i,St=t.Symbol,Et=t.Uint8Array,wt=yt?yt.allocUnsafe:i,Dt=On(tt.getPrototypeOf,tt),kt=tt.create,Mt=st.propertyIsEnumerable,Ft=ot.splice,jt=St?St.isConcatSpreadable:i,rn=St?St.iterator:i,pn=St?St.toStringTag:i,Mn=function(){try{var e=xo(tt,"defineProperty");return e({},"",{}),e}catch(e){}}(),Nn=t.clearTimeout!==Lt.clearTimeout&&t.clearTimeout,Fn=Ye&&Ye.now!==Lt.Date.now&&Ye.now,jn=t.setTimeout!==Lt.setTimeout&&t.setTimeout,Vn=et.ceil,xn=et.floor,Hn=tt.getOwnPropertySymbols,Un=yt?yt.isBuffer:i,Bn=t.isFinite,qn=ot.join,Gn=On(tt.keys,tt),Wn=et.max,Kn=et.min,zn=Ye.now,Jn=t.parseInt,Qn=et.random,$n=ot.reverse,Yn=xo(t,"DataView"),Zn=xo(t,"Map"),Xn=xo(t,"Promise"),er=xo(t,"Set"),tr=xo(t,"WeakMap"),nr=xo(tt,"create"),rr=tr&&new tr,ir={},or=da(Yn),ar=da(Zn),sr=da(Xn),lr=da(er),cr=da(tr),ur=St?St.prototype:i,dr=ur?ur.valueOf:i,pr=ur?ur.toString:i;function hr(e){if(Rs(e)&&!ms(e)&&!(e instanceof mr)){if(e instanceof _r)return e;if(ut.call(e,"__wrapped__"))return pa(e)}return new _r(e)}var fr=function(){function e(){}return function(t){if(!Es(t))return{};if(kt)return kt(t);e.prototype=t;var n=new e;return e.prototype=i,n}}();function gr(){}function _r(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function mr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=F,this.__views__=[]}function vr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function yr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Cr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Sr(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Cr;++t<n;)this.add(e[t])}function Ir(e){var t=this.__data__=new yr(e);this.size=t.size}function Pr(e,t){var n=ms(e),r=!n&&_s(e),i=!n&&!r&&Ss(e),o=!n&&!r&&!i&&Fs(e),a=n||r||i||o,s=a?gn(e.length,rt):[],l=s.length;for(var c in e)!t&&!ut.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ko(c,l))||s.push(c);return s}function Tr(e){var t=e.length;return t?e[Si(0,t-1)]:i}function br(e,t){return la(no(e),Mr(t,0,e.length))}function Or(e){return la(no(e))}function Er(e,t,n){(n===i||hs(e[t],n))&&(n!==i||t in e)||Lr(e,t,n)}function Rr(e,t,n){var r=e[t];ut.call(e,t)&&hs(r,n)&&(n!==i||t in e)||Lr(e,t,n)}function Ar(e,t){for(var n=e.length;n--;)if(hs(e[n][0],t))return n;return-1}function wr(e,t,n,r){return xr(e,function(e,i,o){t(r,e,n(e),o)}),r}function Dr(e,t){return e&&ro(t,il(t),e)}function Lr(e,t,n){"__proto__"==t&&Mn?Mn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function kr(e,t){for(var n=-1,o=t.length,a=r(o),s=null==e;++n<o;)a[n]=s?i:Xs(e,t[n]);return a}function Mr(e,t,n){return e==e&&(n!==i&&(e=e<=n?e:n),t!==i&&(e=e>=t?e:t)),e}function Nr(e,t,n,r,o,a){var s,l=t&d,c=t&p,u=t&h;if(n&&(s=o?n(e,r,o,a):n(e)),s!==i)return s;if(!Es(e))return e;var f=ms(e);if(f){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ut.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return no(e,s)}else{var g=Bo(e),_=g==z||g==J;if(Ss(e))return $i(e,l);if(g==Z||g==H||_&&!o){if(s=c||_?{}:Go(e),!l)return c?function(e,t){return ro(e,Uo(e),t)}(e,function(e,t){return e&&ro(t,ol(t),e)}(s,e)):function(e,t){return ro(e,Ho(e),t)}(e,Dr(s,e))}else{if(!Ot[g])return o?e:{};s=function(e,t,n){var r,i=e.constructor;switch(t){case se:return Yi(e);case q:case G:return new i(+e);case le:return function(e,t){var n=t?Yi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case ce:case ue:case de:case pe:case he:case fe:case ge:case _e:case me:return Zi(e,n);case Q:return new i;case $:case ne:return new i(e);case ee:return function(e){var t=new e.constructor(e.source,Be.exec(e));return t.lastIndex=e.lastIndex,t}(e);case te:return new i;case re:return r=e,dr?tt(dr.call(r)):{}}}(e,g,l)}}a||(a=new Ir);var m=a.get(e);if(m)return m;if(a.set(e,s),ks(e))return e.forEach(function(r){s.add(Nr(r,t,n,r,e,a))}),s;if(As(e))return e.forEach(function(r,i){s.set(i,Nr(r,t,n,i,e,a))}),s;var v=f?i:(u?c?Lo:Do:c?ol:il)(e);return Kt(v||e,function(r,i){v&&(r=e[i=r]),Rr(s,i,Nr(r,t,n,i,e,a))}),s}function Fr(e,t,n){var r=n.length;if(null==e)return!r;for(e=tt(e);r--;){var o=n[r],a=t[o],s=e[o];if(s===i&&!(o in e)||!a(s))return!1}return!0}function jr(e,t,n){if("function"!=typeof e)throw new it(s);return ia(function(){e.apply(i,n)},t)}function Vr(e,t,n,r){var i=-1,a=$t,s=!0,l=e.length,c=[],u=t.length;if(!l)return c;n&&(t=Zt(t,_n(n))),r?(a=Yt,s=!1):t.length>=o&&(a=vn,s=!1,t=new Sr(t));e:for(;++i<l;){var d=e[i],p=null==n?d:n(d);if(d=r||0!==d?d:0,s&&p==p){for(var h=u;h--;)if(t[h]===p)continue e;c.push(d)}else a(t,p,r)||c.push(d)}return c}hr.templateSettings={escape:be,evaluate:Oe,interpolate:Ee,variable:"",imports:{_:hr}},hr.prototype=gr.prototype,hr.prototype.constructor=hr,_r.prototype=fr(gr.prototype),_r.prototype.constructor=_r,mr.prototype=fr(gr.prototype),mr.prototype.constructor=mr,vr.prototype.clear=function(){this.__data__=nr?nr(null):{},this.size=0},vr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},vr.prototype.get=function(e){var t=this.__data__;if(nr){var n=t[e];return n===l?i:n}return ut.call(t,e)?t[e]:i},vr.prototype.has=function(e){var t=this.__data__;return nr?t[e]!==i:ut.call(t,e)},vr.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=nr&&t===i?l:t,this},yr.prototype.clear=function(){this.__data__=[],this.size=0},yr.prototype.delete=function(e){var t=this.__data__,n=Ar(t,e);return!(n<0||(n==t.length-1?t.pop():Ft.call(t,n,1),--this.size,0))},yr.prototype.get=function(e){var t=this.__data__,n=Ar(t,e);return n<0?i:t[n][1]},yr.prototype.has=function(e){return Ar(this.__data__,e)>-1},yr.prototype.set=function(e,t){var n=this.__data__,r=Ar(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Cr.prototype.clear=function(){this.size=0,this.__data__={hash:new vr,map:new(Zn||yr),string:new vr}},Cr.prototype.delete=function(e){var t=jo(this,e).delete(e);return this.size-=t?1:0,t},Cr.prototype.get=function(e){return jo(this,e).get(e)},Cr.prototype.has=function(e){return jo(this,e).has(e)},Cr.prototype.set=function(e,t){var n=jo(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Sr.prototype.add=Sr.prototype.push=function(e){return this.__data__.set(e,l),this},Sr.prototype.has=function(e){return this.__data__.has(e)},Ir.prototype.clear=function(){this.__data__=new yr,this.size=0},Ir.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ir.prototype.get=function(e){return this.__data__.get(e)},Ir.prototype.has=function(e){return this.__data__.has(e)},Ir.prototype.set=function(e,t){var n=this.__data__;if(n instanceof yr){var r=n.__data__;if(!Zn||r.length<o-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Cr(r)}return n.set(e,t),this.size=n.size,this};var xr=ao(zr),Hr=ao(Jr,!0);function Ur(e,t){var n=!0;return xr(e,function(e,r,i){return n=!!t(e,r,i)}),n}function Br(e,t,n){for(var r=-1,o=e.length;++r<o;){var a=e[r],s=t(a);if(null!=s&&(l===i?s==s&&!Ns(s):n(s,l)))var l=s,c=a}return c}function qr(e,t){var n=[];return xr(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function Gr(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=Wo),i||(i=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?Gr(s,t-1,n,r,i):Xt(i,s):r||(i[i.length]=s)}return i}var Wr=so(),Kr=so(!0);function zr(e,t){return e&&Wr(e,t,il)}function Jr(e,t){return e&&Kr(e,t,il)}function Qr(e,t){return Qt(t,function(t){return Ts(e[t])})}function $r(e,t){for(var n=0,r=(t=Ki(t,e)).length;null!=e&&n<r;)e=e[ua(t[n++])];return n&&n==r?e:i}function Yr(e,t,n){var r=t(e);return ms(e)?r:Xt(r,n(e))}function Zr(e){return null==e?e===i?ie:Y:pn&&pn in tt(e)?function(e){var t=ut.call(e,pn),n=e[pn];try{e[pn]=i;var r=!0}catch(e){}var o=ht.call(e);return r&&(t?e[pn]=n:delete e[pn]),o}(e):function(e){return ht.call(e)}(e)}function Xr(e,t){return e>t}function ei(e,t){return null!=e&&ut.call(e,t)}function ti(e,t){return null!=e&&t in tt(e)}function ni(e,t,n){for(var o=n?Yt:$t,a=e[0].length,s=e.length,l=s,c=r(s),u=1/0,d=[];l--;){var p=e[l];l&&t&&(p=Zt(p,_n(t))),u=Kn(p.length,u),c[l]=!n&&(t||a>=120&&p.length>=120)?new Sr(l&&p):i}p=e[0];var h=-1,f=c[0];e:for(;++h<a&&d.length<u;){var g=p[h],_=t?t(g):g;if(g=n||0!==g?g:0,!(f?vn(f,_):o(d,_,n))){for(l=s;--l;){var m=c[l];if(!(m?vn(m,_):o(e[l],_,n)))continue e}f&&f.push(_),d.push(g)}}return d}function ri(e,t,n){var r=null==(e=ta(e,t=Ki(t,e)))?e:e[ua(Pa(t))];return null==r?i:Gt(r,e,n)}function ii(e){return Rs(e)&&Zr(e)==H}function oi(e,t,n,r,o){return e===t||(null==e||null==t||!Rs(e)&&!Rs(t)?e!=e&&t!=t:function(e,t,n,r,o,a){var s=ms(e),l=ms(t),c=s?U:Bo(e),u=l?U:Bo(t),d=(c=c==H?Z:c)==Z,p=(u=u==H?Z:u)==Z,h=c==u;if(h&&Ss(e)){if(!Ss(t))return!1;s=!0,d=!1}if(h&&!d)return a||(a=new Ir),s||Fs(e)?Ao(e,t,n,r,o,a):function(e,t,n,r,i,o,a){switch(n){case le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case se:return!(e.byteLength!=t.byteLength||!o(new Et(e),new Et(t)));case q:case G:case $:return hs(+e,+t);case K:return e.name==t.name&&e.message==t.message;case ee:case ne:return e==t+"";case Q:var s=bn;case te:var l=r&f;if(s||(s=Rn),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=g,a.set(e,t);var u=Ao(s(e),s(t),r,i,o,a);return a.delete(e),u;case re:if(dr)return dr.call(e)==dr.call(t)}return!1}(e,t,c,n,r,o,a);if(!(n&f)){var _=d&&ut.call(e,"__wrapped__"),m=p&&ut.call(t,"__wrapped__");if(_||m){var v=_?e.value():e,y=m?t.value():t;return a||(a=new Ir),o(v,y,n,r,a)}}return!!h&&(a||(a=new Ir),function(e,t,n,r,o,a){var s=n&f,l=Do(e),c=l.length,u=Do(t).length;if(c!=u&&!s)return!1;for(var d=c;d--;){var p=l[d];if(!(s?p in t:ut.call(t,p)))return!1}var h=a.get(e);if(h&&a.get(t))return h==t;var g=!0;a.set(e,t),a.set(t,e);for(var _=s;++d<c;){p=l[d];var m=e[p],v=t[p];if(r)var y=s?r(v,m,p,t,e,a):r(m,v,p,e,t,a);if(!(y===i?m===v||o(m,v,n,r,a):y)){g=!1;break}_||(_="constructor"==p)}if(g&&!_){var C=e.constructor,S=t.constructor;C!=S&&"constructor"in e&&"constructor"in t&&!("function"==typeof C&&C instanceof C&&"function"==typeof S&&S instanceof S)&&(g=!1)}return a.delete(e),a.delete(t),g}(e,t,n,r,o,a))}(e,t,n,r,oi,o))}function ai(e,t,n,r){var o=n.length,a=o,s=!r;if(null==e)return!a;for(e=tt(e);o--;){var l=n[o];if(s&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<a;){var c=(l=n[o])[0],u=e[c],d=l[1];if(s&&l[2]){if(u===i&&!(c in e))return!1}else{var p=new Ir;if(r)var h=r(u,d,c,e,t,p);if(!(h===i?oi(d,u,f|g,r,p):h))return!1}}return!0}function si(e){return!(!Es(e)||(t=e,pt&&pt in t))&&(Ts(e)?_t:We).test(da(e));var t}function li(e){return"function"==typeof e?e:null==e?wl:"object"==typeof e?ms(e)?fi(e[0],e[1]):hi(e):xl(e)}function ci(e){if(!Yo(e))return Gn(e);var t=[];for(var n in tt(e))ut.call(e,n)&&"constructor"!=n&&t.push(n);return t}function ui(e){if(!Es(e))return function(e){var t=[];if(null!=e)for(var n in tt(e))t.push(n);return t}(e);var t=Yo(e),n=[];for(var r in e)("constructor"!=r||!t&&ut.call(e,r))&&n.push(r);return n}function di(e,t){return e<t}function pi(e,t){var n=-1,i=ys(e)?r(e.length):[];return xr(e,function(e,r,o){i[++n]=t(e,r,o)}),i}function hi(e){var t=Vo(e);return 1==t.length&&t[0][2]?Xo(t[0][0],t[0][1]):function(n){return n===e||ai(n,e,t)}}function fi(e,t){return Jo(e)&&Zo(t)?Xo(ua(e),t):function(n){var r=Xs(n,e);return r===i&&r===t?el(n,e):oi(t,r,f|g)}}function gi(e,t,n,r,o){e!==t&&Wr(t,function(a,s){if(Es(a))o||(o=new Ir),function(e,t,n,r,o,a,s){var l=na(e,n),c=na(t,n),u=s.get(c);if(u)Er(e,n,u);else{var d=a?a(l,c,n+"",e,t,s):i,p=d===i;if(p){var h=ms(c),f=!h&&Ss(c),g=!h&&!f&&Fs(c);d=c,h||f||g?ms(l)?d=l:Cs(l)?d=no(l):f?(p=!1,d=$i(c,!0)):g?(p=!1,d=Zi(c,!0)):d=[]:Ds(c)||_s(c)?(d=l,_s(l)?d=Gs(l):Es(l)&&!Ts(l)||(d=Go(c))):p=!1}p&&(s.set(c,d),o(d,c,r,a,s),s.delete(c)),Er(e,n,d)}}(e,t,s,n,gi,r,o);else{var l=r?r(na(e,s),a,s+"",e,t,o):i;l===i&&(l=a),Er(e,s,l)}},ol)}function _i(e,t){var n=e.length;if(n)return Ko(t+=t<0?n:0,n)?e[t]:i}function mi(e,t,n){var r=-1;return t=Zt(t.length?t:[wl],_n(Fo())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(pi(e,function(e,n,i){return{criteria:Zt(t,function(t){return t(e)}),index:++r,value:e}}),function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var l=Xi(i[r],o[r]);if(l){if(r>=s)return l;var c=n[r];return l*("desc"==c?-1:1)}}return e.index-t.index}(e,t,n)})}function vi(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=$r(e,a);n(s,a)&&Oi(o,Ki(a,e),s)}return o}function yi(e,t,n,r){var i=r?ln:sn,o=-1,a=t.length,s=e;for(e===t&&(t=no(t)),n&&(s=Zt(e,_n(n)));++o<a;)for(var l=0,c=t[o],u=n?n(c):c;(l=i(s,u,l,r))>-1;)s!==e&&Ft.call(s,l,1),Ft.call(e,l,1);return e}function Ci(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;Ko(i)?Ft.call(e,i,1):Vi(e,i)}}return e}function Si(e,t){return e+xn(Qn()*(t-e+1))}function Ii(e,t){var n="";if(!e||t<1||t>k)return n;do{t%2&&(n+=e),(t=xn(t/2))&&(e+=e)}while(t);return n}function Pi(e,t){return oa(ea(e,t,wl),e+"")}function Ti(e){return Tr(hl(e))}function bi(e,t){var n=hl(e);return la(n,Mr(t,0,n.length))}function Oi(e,t,n,r){if(!Es(e))return e;for(var o=-1,a=(t=Ki(t,e)).length,s=a-1,l=e;null!=l&&++o<a;){var c=ua(t[o]),u=n;if(o!=s){var d=l[c];(u=r?r(d,c,l):i)===i&&(u=Es(d)?d:Ko(t[o+1])?[]:{})}Rr(l,c,u),l=l[c]}return e}var Ei=rr?function(e,t){return rr.set(e,t),e}:wl,Ri=Mn?function(e,t){return Mn(e,"toString",{configurable:!0,enumerable:!1,value:El(t),writable:!0})}:wl;function Ai(e){return la(hl(e))}function wi(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var a=r(o);++i<o;)a[i]=e[i+t];return a}function Di(e,t){var n;return xr(e,function(e,r,i){return!(n=t(e,r,i))}),!!n}function Li(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=V){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!Ns(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return ki(e,t,wl,n)}function ki(e,t,n,r){t=n(t);for(var o=0,a=null==e?0:e.length,s=t!=t,l=null===t,c=Ns(t),u=t===i;o<a;){var d=xn((o+a)/2),p=n(e[d]),h=p!==i,f=null===p,g=p==p,_=Ns(p);if(s)var m=r||g;else m=u?g&&(r||h):l?g&&h&&(r||!f):c?g&&h&&!f&&(r||!_):!f&&!_&&(r?p<=t:p<t);m?o=d+1:a=d}return Kn(a,j)}function Mi(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!hs(s,l)){var l=s;o[i++]=0===a?0:a}}return o}function Ni(e){return"number"==typeof e?e:Ns(e)?N:+e}function Fi(e){if("string"==typeof e)return e;if(ms(e))return Zt(e,Fi)+"";if(Ns(e))return pr?pr.call(e):"";var t=e+"";return"0"==t&&1/e==-L?"-0":t}function ji(e,t,n){var r=-1,i=$t,a=e.length,s=!0,l=[],c=l;if(n)s=!1,i=Yt;else if(a>=o){var u=t?null:Po(e);if(u)return Rn(u);s=!1,i=vn,c=new Sr}else c=t?[]:l;e:for(;++r<a;){var d=e[r],p=t?t(d):d;if(d=n||0!==d?d:0,s&&p==p){for(var h=c.length;h--;)if(c[h]===p)continue e;t&&c.push(p),l.push(d)}else i(c,p,n)||(c!==l&&c.push(p),l.push(d))}return l}function Vi(e,t){return null==(e=ta(e,t=Ki(t,e)))||delete e[ua(Pa(t))]}function xi(e,t,n,r){return Oi(e,t,n($r(e,t)),r)}function Hi(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?wi(e,r?0:o,r?o+1:i):wi(e,r?o+1:0,r?i:o)}function Ui(e,t){var n=e;return n instanceof mr&&(n=n.value()),en(t,function(e,t){return t.func.apply(t.thisArg,Xt([e],t.args))},n)}function Bi(e,t,n){var i=e.length;if(i<2)return i?ji(e[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=e[o],l=-1;++l<i;)l!=o&&(a[o]=Vr(a[o]||s,e[l],t,n));return ji(Gr(a,1),t,n)}function qi(e,t,n){for(var r=-1,o=e.length,a=t.length,s={};++r<o;){var l=r<a?t[r]:i;n(s,e[r],l)}return s}function Gi(e){return Cs(e)?e:[]}function Wi(e){return"function"==typeof e?e:wl}function Ki(e,t){return ms(e)?e:Jo(e,t)?[e]:ca(Ws(e))}var zi=Pi;function Ji(e,t,n){var r=e.length;return n=n===i?r:n,!t&&n>=r?e:wi(e,t,n)}var Qi=Nn||function(e){return Lt.clearTimeout(e)};function $i(e,t){if(t)return e.slice();var n=e.length,r=wt?wt(n):new e.constructor(n);return e.copy(r),r}function Yi(e){var t=new e.constructor(e.byteLength);return new Et(t).set(new Et(e)),t}function Zi(e,t){var n=t?Yi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Xi(e,t){if(e!==t){var n=e!==i,r=null===e,o=e==e,a=Ns(e),s=t!==i,l=null===t,c=t==t,u=Ns(t);if(!l&&!u&&!a&&e>t||a&&s&&c&&!l&&!u||r&&s&&c||!n&&c||!o)return 1;if(!r&&!a&&!u&&e<t||u&&n&&o&&!r&&!a||l&&n&&o||!s&&o||!c)return-1}return 0}function eo(e,t,n,i){for(var o=-1,a=e.length,s=n.length,l=-1,c=t.length,u=Wn(a-s,0),d=r(c+u),p=!i;++l<c;)d[l]=t[l];for(;++o<s;)(p||o<a)&&(d[n[o]]=e[o]);for(;u--;)d[l++]=e[o++];return d}function to(e,t,n,i){for(var o=-1,a=e.length,s=-1,l=n.length,c=-1,u=t.length,d=Wn(a-l,0),p=r(d+u),h=!i;++o<d;)p[o]=e[o];for(var f=o;++c<u;)p[f+c]=t[c];for(;++s<l;)(h||o<a)&&(p[f+n[s]]=e[o++]);return p}function no(e,t){var n=-1,i=e.length;for(t||(t=r(i));++n<i;)t[n]=e[n];return t}function ro(e,t,n,r){var o=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var l=t[a],c=r?r(n[l],e[l],l,n,e):i;c===i&&(c=e[l]),o?Lr(n,l,c):Rr(n,l,c)}return n}function io(e,t){return function(n,r){var i=ms(n)?Wt:wr,o=t?t():{};return i(n,e,Fo(r,2),o)}}function oo(e){return Pi(function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:i,s=o>2?n[2]:i;for(a=e.length>3&&"function"==typeof a?(o--,a):i,s&&zo(n[0],n[1],s)&&(a=o<3?i:a,o=1),t=tt(t);++r<o;){var l=n[r];l&&e(t,l,r,a)}return t})}function ao(e,t){return function(n,r){if(null==n)return n;if(!ys(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=tt(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function so(e){return function(t,n,r){for(var i=-1,o=tt(t),a=r(t),s=a.length;s--;){var l=a[e?s:++i];if(!1===n(o[l],l,o))break}return t}}function lo(e){return function(t){var n=Tn(t=Ws(t))?Dn(t):i,r=n?n[0]:t.charAt(0),o=n?Ji(n,1).join(""):t.slice(1);return r[e]()+o}}function co(e){return function(t){return en(Tl(_l(t).replace(mt,"")),e,"")}}function uo(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=fr(e.prototype),r=e.apply(n,t);return Es(r)?r:n}}function po(e){return function(t,n,r){var o=tt(t);if(!ys(t)){var a=Fo(n,3);t=il(t),n=function(e){return a(o[e],e,o)}}var s=e(t,n,r);return s>-1?o[a?t[s]:s]:i}}function ho(e){return wo(function(t){var n=t.length,r=n,o=_r.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new it(s);if(o&&!l&&"wrapper"==Mo(a))var l=new _r([],!0)}for(r=l?r:n;++r<n;){var c=Mo(a=t[r]),u="wrapper"==c?ko(a):i;l=u&&Qo(u[0])&&u[1]==(P|y|S|T)&&!u[4].length&&1==u[9]?l[Mo(u[0])].apply(l,u[3]):1==a.length&&Qo(a)?l[c]():l.thru(a)}return function(){var e=arguments,r=e[0];if(l&&1==e.length&&ms(r))return l.plant(r).value();for(var i=0,o=n?t[i].apply(this,e):r;++i<n;)o=t[i].call(this,o);return o}})}function fo(e,t,n,o,a,s,l,c,u,d){var p=t&P,h=t&_,f=t&m,g=t&(y|C),v=t&b,S=f?i:uo(e);return function _(){for(var m=arguments.length,y=r(m),C=m;C--;)y[C]=arguments[C];if(g)var I=No(_),P=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(y,I);if(o&&(y=eo(y,o,a,g)),s&&(y=to(y,s,l,g)),m-=P,g&&m<d){var T=En(y,I);return So(e,t,fo,_.placeholder,n,y,T,c,u,d-m)}var b=h?n:this,O=f?b[e]:e;return m=y.length,c?y=function(e,t){for(var n=e.length,r=Kn(t.length,n),o=no(e);r--;){var a=t[r];e[r]=Ko(a,n)?o[a]:i}return e}(y,c):v&&m>1&&y.reverse(),p&&u<m&&(y.length=u),this&&this!==Lt&&this instanceof _&&(O=S||uo(O)),O.apply(b,y)}}function go(e,t){return function(n,r){return function(e,t,n,r){return zr(e,function(e,i,o){t(r,n(e),i,o)}),r}(n,e,t(r),{})}}function _o(e,t){return function(n,r){var o;if(n===i&&r===i)return t;if(n!==i&&(o=n),r!==i){if(o===i)return r;"string"==typeof n||"string"==typeof r?(n=Fi(n),r=Fi(r)):(n=Ni(n),r=Ni(r)),o=e(n,r)}return o}}function mo(e){return wo(function(t){return t=Zt(t,_n(Fo())),Pi(function(n){var r=this;return e(t,function(e){return Gt(e,r,n)})})})}function vo(e,t){var n=(t=t===i?" ":Fi(t)).length;if(n<2)return n?Ii(t,e):t;var r=Ii(t,Vn(e/wn(t)));return Tn(t)?Ji(Dn(r),0,e).join(""):r.slice(0,e)}function yo(e){return function(t,n,o){return o&&"number"!=typeof o&&zo(t,n,o)&&(n=o=i),t=Hs(t),n===i?(n=t,t=0):n=Hs(n),function(e,t,n,i){for(var o=-1,a=Wn(Vn((t-e)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=e,e+=n;return s}(t,n,o=o===i?t<n?1:-1:Hs(o),e)}}function Co(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=qs(t),n=qs(n)),e(t,n)}}function So(e,t,n,r,o,a,s,l,c,u){var d=t&y;t|=d?S:I,(t&=~(d?I:S))&v||(t&=~(_|m));var p=[e,t,o,d?a:i,d?s:i,d?i:a,d?i:s,l,c,u],h=n.apply(i,p);return Qo(e)&&ra(h,p),h.placeholder=r,aa(h,e,t)}function Io(e){var t=et[e];return function(e,n){if(e=qs(e),n=null==n?0:Kn(Us(n),292)){var r=(Ws(e)+"e").split("e");return+((r=(Ws(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Po=er&&1/Rn(new er([,-0]))[1]==L?function(e){return new er(e)}:Nl;function To(e){return function(t){var n=Bo(t);return n==Q?bn(t):n==te?An(t):function(e,t){return Zt(t,function(t){return[t,e[t]]})}(t,e(t))}}function bo(e,t,n,o,a,l,c,d){var p=t&m;if(!p&&"function"!=typeof e)throw new it(s);var h=o?o.length:0;if(h||(t&=~(S|I),o=a=i),c=c===i?c:Wn(Us(c),0),d=d===i?d:Us(d),h-=a?a.length:0,t&I){var f=o,g=a;o=a=i}var b=p?i:ko(e),O=[e,t,n,o,a,f,g,l,c,d];if(b&&function(e,t){var n=e[1],r=t[1],i=n|r,o=i<(_|m|P),a=r==P&&n==y||r==P&&n==T&&e[7].length<=t[8]||r==(P|T)&&t[7].length<=t[8]&&n==y;if(!o&&!a)return e;r&_&&(e[2]=t[2],i|=n&_?0:v);var s=t[3];if(s){var l=e[3];e[3]=l?eo(l,s,t[4]):s,e[4]=l?En(e[3],u):t[4]}(s=t[5])&&(l=e[5],e[5]=l?to(l,s,t[6]):s,e[6]=l?En(e[5],u):t[6]),(s=t[7])&&(e[7]=s),r&P&&(e[8]=null==e[8]?t[8]:Kn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(O,b),e=O[0],t=O[1],n=O[2],o=O[3],a=O[4],!(d=O[9]=O[9]===i?p?0:e.length:Wn(O[9]-h,0))&&t&(y|C)&&(t&=~(y|C)),t&&t!=_)E=t==y||t==C?function(e,t,n){var o=uo(e);return function a(){for(var s=arguments.length,l=r(s),c=s,u=No(a);c--;)l[c]=arguments[c];var d=s<3&&l[0]!==u&&l[s-1]!==u?[]:En(l,u);return(s-=d.length)<n?So(e,t,fo,a.placeholder,i,l,d,i,i,n-s):Gt(this&&this!==Lt&&this instanceof a?o:e,this,l)}}(e,t,d):t!=S&&t!=(_|S)||a.length?fo.apply(i,O):function(e,t,n,i){var o=t&_,a=uo(e);return function t(){for(var s=-1,l=arguments.length,c=-1,u=i.length,d=r(u+l),p=this&&this!==Lt&&this instanceof t?a:e;++c<u;)d[c]=i[c];for(;l--;)d[c++]=arguments[++s];return Gt(p,o?n:this,d)}}(e,t,n,o);else var E=function(e,t,n){var r=t&_,i=uo(e);return function t(){return(this&&this!==Lt&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,n);return aa((b?Ei:ra)(E,O),e,t)}function Oo(e,t,n,r){return e===i||hs(e,st[n])&&!ut.call(r,n)?t:e}function Eo(e,t,n,r,o,a){return Es(e)&&Es(t)&&(a.set(t,e),gi(e,t,i,Eo,a),a.delete(t)),e}function Ro(e){return Ds(e)?i:e}function Ao(e,t,n,r,o,a){var s=n&f,l=e.length,c=t.length;if(l!=c&&!(s&&c>l))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var d=-1,p=!0,h=n&g?new Sr:i;for(a.set(e,t),a.set(t,e);++d<l;){var _=e[d],m=t[d];if(r)var v=s?r(m,_,d,t,e,a):r(_,m,d,e,t,a);if(v!==i){if(v)continue;p=!1;break}if(h){if(!nn(t,function(e,t){if(!vn(h,t)&&(_===e||o(_,e,n,r,a)))return h.push(t)})){p=!1;break}}else if(_!==m&&!o(_,m,n,r,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function wo(e){return oa(ea(e,i,va),e+"")}function Do(e){return Yr(e,il,Ho)}function Lo(e){return Yr(e,ol,Uo)}var ko=rr?function(e){return rr.get(e)}:Nl;function Mo(e){for(var t=e.name+"",n=ir[t],r=ut.call(ir,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function No(e){return(ut.call(hr,"placeholder")?hr:e).placeholder}function Fo(){var e=hr.iteratee||Dl;return e=e===Dl?li:e,arguments.length?e(arguments[0],arguments[1]):e}function jo(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Vo(e){for(var t=il(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Zo(i)]}return t}function xo(e,t){var n=function(e,t){return null==e?i:e[t]}(e,t);return si(n)?n:i}var Ho=Hn?function(e){return null==e?[]:(e=tt(e),Qt(Hn(e),function(t){return Mt.call(e,t)}))}:Bl,Uo=Hn?function(e){for(var t=[];e;)Xt(t,Ho(e)),e=Dt(e);return t}:Bl,Bo=Zr;function qo(e,t,n){for(var r=-1,i=(t=Ki(t,e)).length,o=!1;++r<i;){var a=ua(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Os(i)&&Ko(a,i)&&(ms(e)||_s(e))}function Go(e){return"function"!=typeof e.constructor||Yo(e)?{}:fr(Dt(e))}function Wo(e){return ms(e)||_s(e)||!!(jt&&e&&e[jt])}function Ko(e,t){var n=typeof e;return!!(t=null==t?k:t)&&("number"==n||"symbol"!=n&&ze.test(e))&&e>-1&&e%1==0&&e<t}function zo(e,t,n){if(!Es(n))return!1;var r=typeof t;return!!("number"==r?ys(n)&&Ko(t,n.length):"string"==r&&t in n)&&hs(n[t],e)}function Jo(e,t){if(ms(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ns(e))||Ae.test(e)||!Re.test(e)||null!=t&&e in tt(t)}function Qo(e){var t=Mo(e),n=hr[t];if("function"!=typeof n||!(t in mr.prototype))return!1;if(e===n)return!0;var r=ko(n);return!!r&&e===r[0]}(Yn&&Bo(new Yn(new ArrayBuffer(1)))!=le||Zn&&Bo(new Zn)!=Q||Xn&&"[object Promise]"!=Bo(Xn.resolve())||er&&Bo(new er)!=te||tr&&Bo(new tr)!=oe)&&(Bo=function(e){var t=Zr(e),n=t==Z?e.constructor:i,r=n?da(n):"";if(r)switch(r){case or:return le;case ar:return Q;case sr:return"[object Promise]";case lr:return te;case cr:return oe}return t});var $o=lt?Ts:ql;function Yo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||st)}function Zo(e){return e==e&&!Es(e)}function Xo(e,t){return function(n){return null!=n&&n[e]===t&&(t!==i||e in tt(n))}}function ea(e,t,n){return t=Wn(t===i?e.length-1:t,0),function(){for(var i=arguments,o=-1,a=Wn(i.length-t,0),s=r(a);++o<a;)s[o]=i[t+o];o=-1;for(var l=r(t+1);++o<t;)l[o]=i[o];return l[t]=n(s),Gt(e,this,l)}}function ta(e,t){return t.length<2?e:$r(e,wi(t,0,-1))}function na(e,t){if("__proto__"!=t)return e[t]}var ra=sa(Ei),ia=jn||function(e,t){return Lt.setTimeout(e,t)},oa=sa(Ri);function aa(e,t,n){var r=t+"";return oa(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(Fe,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Kt(x,function(n){var r="_."+n[0];t&n[1]&&!$t(e,r)&&e.push(r)}),e.sort()}(function(e){var t=e.match(je);return t?t[1].split(Ve):[]}(r),n)))}function sa(e){var t=0,n=0;return function(){var r=zn(),o=A-(r-n);if(n=r,o>0){if(++t>=R)return arguments[0]}else t=0;return e.apply(i,arguments)}}function la(e,t){var n=-1,r=e.length,o=r-1;for(t=t===i?r:t;++n<t;){var a=Si(n,o),s=e[a];e[a]=e[n],e[n]=s}return e.length=t,e}var ca=function(e){var t=ss(e,function(e){return n.size===c&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(we,function(e,n,r,i){t.push(r?i.replace(He,"$1"):n||e)}),t});function ua(e){if("string"==typeof e||Ns(e))return e;var t=e+"";return"0"==t&&1/e==-L?"-0":t}function da(e){if(null!=e){try{return ct.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function pa(e){if(e instanceof mr)return e.clone();var t=new _r(e.__wrapped__,e.__chain__);return t.__actions__=no(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ha=Pi(function(e,t){return Cs(e)?Vr(e,Gr(t,1,Cs,!0)):[]}),fa=Pi(function(e,t){var n=Pa(t);return Cs(n)&&(n=i),Cs(e)?Vr(e,Gr(t,1,Cs,!0),Fo(n,2)):[]}),ga=Pi(function(e,t){var n=Pa(t);return Cs(n)&&(n=i),Cs(e)?Vr(e,Gr(t,1,Cs,!0),i,n):[]});function _a(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Us(n);return i<0&&(i=Wn(r+i,0)),an(e,Fo(t,3),i)}function ma(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r-1;return n!==i&&(o=Us(n),o=n<0?Wn(r+o,0):Kn(o,r-1)),an(e,Fo(t,3),o,!0)}function va(e){return null!=e&&e.length?Gr(e,1):[]}function ya(e){return e&&e.length?e[0]:i}var Ca=Pi(function(e){var t=Zt(e,Gi);return t.length&&t[0]===e[0]?ni(t):[]}),Sa=Pi(function(e){var t=Pa(e),n=Zt(e,Gi);return t===Pa(n)?t=i:n.pop(),n.length&&n[0]===e[0]?ni(n,Fo(t,2)):[]}),Ia=Pi(function(e){var t=Pa(e),n=Zt(e,Gi);return(t="function"==typeof t?t:i)&&n.pop(),n.length&&n[0]===e[0]?ni(n,i,t):[]});function Pa(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Ta=Pi(ba);function ba(e,t){return e&&e.length&&t&&t.length?yi(e,t):e}var Oa=wo(function(e,t){var n=null==e?0:e.length,r=kr(e,t);return Ci(e,Zt(t,function(e){return Ko(e,n)?+e:e}).sort(Xi)),r});function Ea(e){return null==e?e:$n.call(e)}var Ra=Pi(function(e){return ji(Gr(e,1,Cs,!0))}),Aa=Pi(function(e){var t=Pa(e);return Cs(t)&&(t=i),ji(Gr(e,1,Cs,!0),Fo(t,2))}),wa=Pi(function(e){var t=Pa(e);return t="function"==typeof t?t:i,ji(Gr(e,1,Cs,!0),i,t)});function Da(e){if(!e||!e.length)return[];var t=0;return e=Qt(e,function(e){if(Cs(e))return t=Wn(e.length,t),!0}),gn(t,function(t){return Zt(e,dn(t))})}function La(e,t){if(!e||!e.length)return[];var n=Da(e);return null==t?n:Zt(n,function(e){return Gt(t,i,e)})}var ka=Pi(function(e,t){return Cs(e)?Vr(e,t):[]}),Ma=Pi(function(e){return Bi(Qt(e,Cs))}),Na=Pi(function(e){var t=Pa(e);return Cs(t)&&(t=i),Bi(Qt(e,Cs),Fo(t,2))}),Fa=Pi(function(e){var t=Pa(e);return t="function"==typeof t?t:i,Bi(Qt(e,Cs),i,t)}),ja=Pi(Da);var Va=Pi(function(e){var t=e.length,n=t>1?e[t-1]:i;return n="function"==typeof n?(e.pop(),n):i,La(e,n)});function xa(e){var t=hr(e);return t.__chain__=!0,t}function Ha(e,t){return t(e)}var Ua=wo(function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,o=function(t){return kr(t,e)};return!(t>1||this.__actions__.length)&&r instanceof mr&&Ko(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:Ha,args:[o],thisArg:i}),new _r(r,this.__chain__).thru(function(e){return t&&!e.length&&e.push(i),e})):this.thru(o)});var Ba=io(function(e,t,n){ut.call(e,n)?++e[n]:Lr(e,n,1)});var qa=po(_a),Ga=po(ma);function Wa(e,t){return(ms(e)?Kt:xr)(e,Fo(t,3))}function Ka(e,t){return(ms(e)?zt:Hr)(e,Fo(t,3))}var za=io(function(e,t,n){ut.call(e,n)?e[n].push(t):Lr(e,n,[t])});var Ja=Pi(function(e,t,n){var i=-1,o="function"==typeof t,a=ys(e)?r(e.length):[];return xr(e,function(e){a[++i]=o?Gt(t,e,n):ri(e,t,n)}),a}),Qa=io(function(e,t,n){Lr(e,n,t)});function $a(e,t){return(ms(e)?Zt:pi)(e,Fo(t,3))}var Ya=io(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});var Za=Pi(function(e,t){if(null==e)return[];var n=t.length;return n>1&&zo(e,t[0],t[1])?t=[]:n>2&&zo(t[0],t[1],t[2])&&(t=[t[0]]),mi(e,Gr(t,1),[])}),Xa=Fn||function(){return Lt.Date.now()};function es(e,t,n){return t=n?i:t,t=e&&null==t?e.length:t,bo(e,P,i,i,i,i,t)}function ts(e,t){var n;if("function"!=typeof t)throw new it(s);return e=Us(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=i),n}}var ns=Pi(function(e,t,n){var r=_;if(n.length){var i=En(n,No(ns));r|=S}return bo(e,r,t,n,i)}),rs=Pi(function(e,t,n){var r=_|m;if(n.length){var i=En(n,No(rs));r|=S}return bo(t,r,e,n,i)});function is(e,t,n){var r,o,a,l,c,u,d=0,p=!1,h=!1,f=!0;if("function"!=typeof e)throw new it(s);function g(t){var n=r,a=o;return r=o=i,d=t,l=e.apply(a,n)}function _(e){var n=e-u;return u===i||n>=t||n<0||h&&e-d>=a}function m(){var e=Xa();if(_(e))return v(e);c=ia(m,function(e){var n=t-(e-u);return h?Kn(n,a-(e-d)):n}(e))}function v(e){return c=i,f&&r?g(e):(r=o=i,l)}function y(){var e=Xa(),n=_(e);if(r=arguments,o=this,u=e,n){if(c===i)return function(e){return d=e,c=ia(m,t),p?g(e):l}(u);if(h)return c=ia(m,t),g(u)}return c===i&&(c=ia(m,t)),l}return t=qs(t)||0,Es(n)&&(p=!!n.leading,a=(h="maxWait"in n)?Wn(qs(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),y.cancel=function(){c!==i&&Qi(c),d=0,r=u=o=c=i},y.flush=function(){return c===i?l:v(Xa())},y}var os=Pi(function(e,t){return jr(e,1,t)}),as=Pi(function(e,t,n){return jr(e,qs(t)||0,n)});function ss(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new it(s);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(ss.Cache||Cr),n}function ls(e){if("function"!=typeof e)throw new it(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}ss.Cache=Cr;var cs=zi(function(e,t){var n=(t=1==t.length&&ms(t[0])?Zt(t[0],_n(Fo())):Zt(Gr(t,1),_n(Fo()))).length;return Pi(function(r){for(var i=-1,o=Kn(r.length,n);++i<o;)r[i]=t[i].call(this,r[i]);return Gt(e,this,r)})}),us=Pi(function(e,t){var n=En(t,No(us));return bo(e,S,i,t,n)}),ds=Pi(function(e,t){var n=En(t,No(ds));return bo(e,I,i,t,n)}),ps=wo(function(e,t){return bo(e,T,i,i,i,t)});function hs(e,t){return e===t||e!=e&&t!=t}var fs=Co(Xr),gs=Co(function(e,t){return e>=t}),_s=ii(function(){return arguments}())?ii:function(e){return Rs(e)&&ut.call(e,"callee")&&!Mt.call(e,"callee")},ms=r.isArray,vs=Vt?_n(Vt):function(e){return Rs(e)&&Zr(e)==se};function ys(e){return null!=e&&Os(e.length)&&!Ts(e)}function Cs(e){return Rs(e)&&ys(e)}var Ss=Un||ql,Is=xt?_n(xt):function(e){return Rs(e)&&Zr(e)==G};function Ps(e){if(!Rs(e))return!1;var t=Zr(e);return t==K||t==W||"string"==typeof e.message&&"string"==typeof e.name&&!Ds(e)}function Ts(e){if(!Es(e))return!1;var t=Zr(e);return t==z||t==J||t==B||t==X}function bs(e){return"number"==typeof e&&e==Us(e)}function Os(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}function Es(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Rs(e){return null!=e&&"object"==typeof e}var As=Ht?_n(Ht):function(e){return Rs(e)&&Bo(e)==Q};function ws(e){return"number"==typeof e||Rs(e)&&Zr(e)==$}function Ds(e){if(!Rs(e)||Zr(e)!=Z)return!1;var t=Dt(e);if(null===t)return!0;var n=ut.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ct.call(n)==ft}var Ls=Ut?_n(Ut):function(e){return Rs(e)&&Zr(e)==ee};var ks=Bt?_n(Bt):function(e){return Rs(e)&&Bo(e)==te};function Ms(e){return"string"==typeof e||!ms(e)&&Rs(e)&&Zr(e)==ne}function Ns(e){return"symbol"==typeof e||Rs(e)&&Zr(e)==re}var Fs=qt?_n(qt):function(e){return Rs(e)&&Os(e.length)&&!!bt[Zr(e)]};var js=Co(di),Vs=Co(function(e,t){return e<=t});function xs(e){if(!e)return[];if(ys(e))return Ms(e)?Dn(e):no(e);if(rn&&e[rn])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[rn]());var t=Bo(e);return(t==Q?bn:t==te?Rn:hl)(e)}function Hs(e){return e?(e=qs(e))===L||e===-L?(e<0?-1:1)*M:e==e?e:0:0===e?e:0}function Us(e){var t=Hs(e),n=t%1;return t==t?n?t-n:t:0}function Bs(e){return e?Mr(Us(e),0,F):0}function qs(e){if("number"==typeof e)return e;if(Ns(e))return N;if(Es(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Es(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ke,"");var n=Ge.test(e);return n||Ke.test(e)?At(e.slice(2),n?2:8):qe.test(e)?N:+e}function Gs(e){return ro(e,ol(e))}function Ws(e){return null==e?"":Fi(e)}var Ks=oo(function(e,t){if(Yo(t)||ys(t))ro(t,il(t),e);else for(var n in t)ut.call(t,n)&&Rr(e,n,t[n])}),zs=oo(function(e,t){ro(t,ol(t),e)}),Js=oo(function(e,t,n,r){ro(t,ol(t),e,r)}),Qs=oo(function(e,t,n,r){ro(t,il(t),e,r)}),$s=wo(kr);var Ys=Pi(function(e,t){e=tt(e);var n=-1,r=t.length,o=r>2?t[2]:i;for(o&&zo(t[0],t[1],o)&&(r=1);++n<r;)for(var a=t[n],s=ol(a),l=-1,c=s.length;++l<c;){var u=s[l],d=e[u];(d===i||hs(d,st[u])&&!ut.call(e,u))&&(e[u]=a[u])}return e}),Zs=Pi(function(e){return e.push(i,Eo),Gt(sl,i,e)});function Xs(e,t,n){var r=null==e?i:$r(e,t);return r===i?n:r}function el(e,t){return null!=e&&qo(e,t,ti)}var tl=go(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ht.call(t)),e[t]=n},El(wl)),nl=go(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ht.call(t)),ut.call(e,t)?e[t].push(n):e[t]=[n]},Fo),rl=Pi(ri);function il(e){return ys(e)?Pr(e):ci(e)}function ol(e){return ys(e)?Pr(e,!0):ui(e)}var al=oo(function(e,t,n){gi(e,t,n)}),sl=oo(function(e,t,n,r){gi(e,t,n,r)}),ll=wo(function(e,t){var n={};if(null==e)return n;var r=!1;t=Zt(t,function(t){return t=Ki(t,e),r||(r=t.length>1),t}),ro(e,Lo(e),n),r&&(n=Nr(n,d|p|h,Ro));for(var i=t.length;i--;)Vi(n,t[i]);return n});var cl=wo(function(e,t){return null==e?{}:function(e,t){return vi(e,t,function(t,n){return el(e,n)})}(e,t)});function ul(e,t){if(null==e)return{};var n=Zt(Lo(e),function(e){return[e]});return t=Fo(t),vi(e,n,function(e,n){return t(e,n[0])})}var dl=To(il),pl=To(ol);function hl(e){return null==e?[]:mn(e,il(e))}var fl=co(function(e,t,n){return t=t.toLowerCase(),e+(n?gl(t):t)});function gl(e){return Pl(Ws(e).toLowerCase())}function _l(e){return(e=Ws(e))&&e.replace(Je,Sn).replace(vt,"")}var ml=co(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),vl=co(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),yl=lo("toLowerCase");var Cl=co(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});var Sl=co(function(e,t,n){return e+(n?" ":"")+Pl(t)});var Il=co(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Pl=lo("toUpperCase");function Tl(e,t,n){return e=Ws(e),(t=n?i:t)===i?function(e){return It.test(e)}(e)?function(e){return e.match(Ct)||[]}(e):function(e){return e.match(xe)||[]}(e):e.match(t)||[]}var bl=Pi(function(e,t){try{return Gt(e,i,t)}catch(e){return Ps(e)?e:new Ze(e)}}),Ol=wo(function(e,t){return Kt(t,function(t){t=ua(t),Lr(e,t,ns(e[t],e))}),e});function El(e){return function(){return e}}var Rl=ho(),Al=ho(!0);function wl(e){return e}function Dl(e){return li("function"==typeof e?e:Nr(e,d))}var Ll=Pi(function(e,t){return function(n){return ri(n,e,t)}}),kl=Pi(function(e,t){return function(n){return ri(e,n,t)}});function Ml(e,t,n){var r=il(t),i=Qr(t,r);null!=n||Es(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=Qr(t,il(t)));var o=!(Es(n)&&"chain"in n&&!n.chain),a=Ts(e);return Kt(i,function(n){var r=t[n];e[n]=r,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__);return(n.__actions__=no(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Xt([this.value()],arguments))})}),e}function Nl(){}var Fl=mo(Zt),jl=mo(Jt),Vl=mo(nn);function xl(e){return Jo(e)?dn(ua(e)):function(e){return function(t){return $r(t,e)}}(e)}var Hl=yo(),Ul=yo(!0);function Bl(){return[]}function ql(){return!1}var Gl=_o(function(e,t){return e+t},0),Wl=Io("ceil"),Kl=_o(function(e,t){return e/t},1),zl=Io("floor");var Jl,Ql=_o(function(e,t){return e*t},1),$l=Io("round"),Yl=_o(function(e,t){return e-t},0);return hr.after=function(e,t){if("function"!=typeof t)throw new it(s);return e=Us(e),function(){if(--e<1)return t.apply(this,arguments)}},hr.ary=es,hr.assign=Ks,hr.assignIn=zs,hr.assignInWith=Js,hr.assignWith=Qs,hr.at=$s,hr.before=ts,hr.bind=ns,hr.bindAll=Ol,hr.bindKey=rs,hr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return ms(e)?e:[e]},hr.chain=xa,hr.chunk=function(e,t,n){t=(n?zo(e,t,n):t===i)?1:Wn(Us(t),0);var o=null==e?0:e.length;if(!o||t<1)return[];for(var a=0,s=0,l=r(Vn(o/t));a<o;)l[s++]=wi(e,a,a+=t);return l},hr.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},hr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Xt(ms(n)?no(n):[n],Gr(t,1))},hr.cond=function(e){var t=null==e?0:e.length,n=Fo();return e=t?Zt(e,function(e){if("function"!=typeof e[1])throw new it(s);return[n(e[0]),e[1]]}):[],Pi(function(n){for(var r=-1;++r<t;){var i=e[r];if(Gt(i[0],this,n))return Gt(i[1],this,n)}})},hr.conforms=function(e){return function(e){var t=il(e);return function(n){return Fr(n,e,t)}}(Nr(e,d))},hr.constant=El,hr.countBy=Ba,hr.create=function(e,t){var n=fr(e);return null==t?n:Dr(n,t)},hr.curry=function e(t,n,r){var o=bo(t,y,i,i,i,i,i,n=r?i:n);return o.placeholder=e.placeholder,o},hr.curryRight=function e(t,n,r){var o=bo(t,C,i,i,i,i,i,n=r?i:n);return o.placeholder=e.placeholder,o},hr.debounce=is,hr.defaults=Ys,hr.defaultsDeep=Zs,hr.defer=os,hr.delay=as,hr.difference=ha,hr.differenceBy=fa,hr.differenceWith=ga,hr.drop=function(e,t,n){var r=null==e?0:e.length;return r?wi(e,(t=n||t===i?1:Us(t))<0?0:t,r):[]},hr.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?wi(e,0,(t=r-(t=n||t===i?1:Us(t)))<0?0:t):[]},hr.dropRightWhile=function(e,t){return e&&e.length?Hi(e,Fo(t,3),!0,!0):[]},hr.dropWhile=function(e,t){return e&&e.length?Hi(e,Fo(t,3),!0):[]},hr.fill=function(e,t,n,r){var o=null==e?0:e.length;return o?(n&&"number"!=typeof n&&zo(e,t,n)&&(n=0,r=o),function(e,t,n,r){var o=e.length;for((n=Us(n))<0&&(n=-n>o?0:o+n),(r=r===i||r>o?o:Us(r))<0&&(r+=o),r=n>r?0:Bs(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},hr.filter=function(e,t){return(ms(e)?Qt:qr)(e,Fo(t,3))},hr.flatMap=function(e,t){return Gr($a(e,t),1)},hr.flatMapDeep=function(e,t){return Gr($a(e,t),L)},hr.flatMapDepth=function(e,t,n){return n=n===i?1:Us(n),Gr($a(e,t),n)},hr.flatten=va,hr.flattenDeep=function(e){return null!=e&&e.length?Gr(e,L):[]},hr.flattenDepth=function(e,t){return null!=e&&e.length?Gr(e,t=t===i?1:Us(t)):[]},hr.flip=function(e){return bo(e,b)},hr.flow=Rl,hr.flowRight=Al,hr.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},hr.functions=function(e){return null==e?[]:Qr(e,il(e))},hr.functionsIn=function(e){return null==e?[]:Qr(e,ol(e))},hr.groupBy=za,hr.initial=function(e){return null!=e&&e.length?wi(e,0,-1):[]},hr.intersection=Ca,hr.intersectionBy=Sa,hr.intersectionWith=Ia,hr.invert=tl,hr.invertBy=nl,hr.invokeMap=Ja,hr.iteratee=Dl,hr.keyBy=Qa,hr.keys=il,hr.keysIn=ol,hr.map=$a,hr.mapKeys=function(e,t){var n={};return t=Fo(t,3),zr(e,function(e,r,i){Lr(n,t(e,r,i),e)}),n},hr.mapValues=function(e,t){var n={};return t=Fo(t,3),zr(e,function(e,r,i){Lr(n,r,t(e,r,i))}),n},hr.matches=function(e){return hi(Nr(e,d))},hr.matchesProperty=function(e,t){return fi(e,Nr(t,d))},hr.memoize=ss,hr.merge=al,hr.mergeWith=sl,hr.method=Ll,hr.methodOf=kl,hr.mixin=Ml,hr.negate=ls,hr.nthArg=function(e){return e=Us(e),Pi(function(t){return _i(t,e)})},hr.omit=ll,hr.omitBy=function(e,t){return ul(e,ls(Fo(t)))},hr.once=function(e){return ts(2,e)},hr.orderBy=function(e,t,n,r){return null==e?[]:(ms(t)||(t=null==t?[]:[t]),ms(n=r?i:n)||(n=null==n?[]:[n]),mi(e,t,n))},hr.over=Fl,hr.overArgs=cs,hr.overEvery=jl,hr.overSome=Vl,hr.partial=us,hr.partialRight=ds,hr.partition=Ya,hr.pick=cl,hr.pickBy=ul,hr.property=xl,hr.propertyOf=function(e){return function(t){return null==e?i:$r(e,t)}},hr.pull=Ta,hr.pullAll=ba,hr.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?yi(e,t,Fo(n,2)):e},hr.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?yi(e,t,i,n):e},hr.pullAt=Oa,hr.range=Hl,hr.rangeRight=Ul,hr.rearg=ps,hr.reject=function(e,t){return(ms(e)?Qt:qr)(e,ls(Fo(t,3)))},hr.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=Fo(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return Ci(e,i),n},hr.rest=function(e,t){if("function"!=typeof e)throw new it(s);return Pi(e,t=t===i?t:Us(t))},hr.reverse=Ea,hr.sampleSize=function(e,t,n){return t=(n?zo(e,t,n):t===i)?1:Us(t),(ms(e)?br:bi)(e,t)},hr.set=function(e,t,n){return null==e?e:Oi(e,t,n)},hr.setWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:Oi(e,t,n,r)},hr.shuffle=function(e){return(ms(e)?Or:Ai)(e)},hr.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&zo(e,t,n)?(t=0,n=r):(t=null==t?0:Us(t),n=n===i?r:Us(n)),wi(e,t,n)):[]},hr.sortBy=Za,hr.sortedUniq=function(e){return e&&e.length?Mi(e):[]},hr.sortedUniqBy=function(e,t){return e&&e.length?Mi(e,Fo(t,2)):[]},hr.split=function(e,t,n){return n&&"number"!=typeof n&&zo(e,t,n)&&(t=n=i),(n=n===i?F:n>>>0)?(e=Ws(e))&&("string"==typeof t||null!=t&&!Ls(t))&&!(t=Fi(t))&&Tn(e)?Ji(Dn(e),0,n):e.split(t,n):[]},hr.spread=function(e,t){if("function"!=typeof e)throw new it(s);return t=null==t?0:Wn(Us(t),0),Pi(function(n){var r=n[t],i=Ji(n,0,t);return r&&Xt(i,r),Gt(e,this,i)})},hr.tail=function(e){var t=null==e?0:e.length;return t?wi(e,1,t):[]},hr.take=function(e,t,n){return e&&e.length?wi(e,0,(t=n||t===i?1:Us(t))<0?0:t):[]},hr.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?wi(e,(t=r-(t=n||t===i?1:Us(t)))<0?0:t,r):[]},hr.takeRightWhile=function(e,t){return e&&e.length?Hi(e,Fo(t,3),!1,!0):[]},hr.takeWhile=function(e,t){return e&&e.length?Hi(e,Fo(t,3)):[]},hr.tap=function(e,t){return t(e),e},hr.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new it(s);return Es(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),is(e,t,{leading:r,maxWait:t,trailing:i})},hr.thru=Ha,hr.toArray=xs,hr.toPairs=dl,hr.toPairsIn=pl,hr.toPath=function(e){return ms(e)?Zt(e,ua):Ns(e)?[e]:no(ca(Ws(e)))},hr.toPlainObject=Gs,hr.transform=function(e,t,n){var r=ms(e),i=r||Ss(e)||Fs(e);if(t=Fo(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:Es(e)&&Ts(o)?fr(Dt(e)):{}}return(i?Kt:zr)(e,function(e,r,i){return t(n,e,r,i)}),n},hr.unary=function(e){return es(e,1)},hr.union=Ra,hr.unionBy=Aa,hr.unionWith=wa,hr.uniq=function(e){return e&&e.length?ji(e):[]},hr.uniqBy=function(e,t){return e&&e.length?ji(e,Fo(t,2)):[]},hr.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?ji(e,i,t):[]},hr.unset=function(e,t){return null==e||Vi(e,t)},hr.unzip=Da,hr.unzipWith=La,hr.update=function(e,t,n){return null==e?e:xi(e,t,Wi(n))},hr.updateWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:xi(e,t,Wi(n),r)},hr.values=hl,hr.valuesIn=function(e){return null==e?[]:mn(e,ol(e))},hr.without=ka,hr.words=Tl,hr.wrap=function(e,t){return us(Wi(t),e)},hr.xor=Ma,hr.xorBy=Na,hr.xorWith=Fa,hr.zip=ja,hr.zipObject=function(e,t){return qi(e||[],t||[],Rr)},hr.zipObjectDeep=function(e,t){return qi(e||[],t||[],Oi)},hr.zipWith=Va,hr.entries=dl,hr.entriesIn=pl,hr.extend=zs,hr.extendWith=Js,Ml(hr,hr),hr.add=Gl,hr.attempt=bl,hr.camelCase=fl,hr.capitalize=gl,hr.ceil=Wl,hr.clamp=function(e,t,n){return n===i&&(n=t,t=i),n!==i&&(n=(n=qs(n))==n?n:0),t!==i&&(t=(t=qs(t))==t?t:0),Mr(qs(e),t,n)},hr.clone=function(e){return Nr(e,h)},hr.cloneDeep=function(e){return Nr(e,d|h)},hr.cloneDeepWith=function(e,t){return Nr(e,d|h,t="function"==typeof t?t:i)},hr.cloneWith=function(e,t){return Nr(e,h,t="function"==typeof t?t:i)},hr.conformsTo=function(e,t){return null==t||Fr(e,t,il(t))},hr.deburr=_l,hr.defaultTo=function(e,t){return null==e||e!=e?t:e},hr.divide=Kl,hr.endsWith=function(e,t,n){e=Ws(e),t=Fi(t);var r=e.length,o=n=n===i?r:Mr(Us(n),0,r);return(n-=t.length)>=0&&e.slice(n,o)==t},hr.eq=hs,hr.escape=function(e){return(e=Ws(e))&&Te.test(e)?e.replace(Ie,In):e},hr.escapeRegExp=function(e){return(e=Ws(e))&&Le.test(e)?e.replace(De,"\\$&"):e},hr.every=function(e,t,n){var r=ms(e)?Jt:Ur;return n&&zo(e,t,n)&&(t=i),r(e,Fo(t,3))},hr.find=qa,hr.findIndex=_a,hr.findKey=function(e,t){return on(e,Fo(t,3),zr)},hr.findLast=Ga,hr.findLastIndex=ma,hr.findLastKey=function(e,t){return on(e,Fo(t,3),Jr)},hr.floor=zl,hr.forEach=Wa,hr.forEachRight=Ka,hr.forIn=function(e,t){return null==e?e:Wr(e,Fo(t,3),ol)},hr.forInRight=function(e,t){return null==e?e:Kr(e,Fo(t,3),ol)},hr.forOwn=function(e,t){return e&&zr(e,Fo(t,3))},hr.forOwnRight=function(e,t){return e&&Jr(e,Fo(t,3))},hr.get=Xs,hr.gt=fs,hr.gte=gs,hr.has=function(e,t){return null!=e&&qo(e,t,ei)},hr.hasIn=el,hr.head=ya,hr.identity=wl,hr.includes=function(e,t,n,r){e=ys(e)?e:hl(e),n=n&&!r?Us(n):0;var i=e.length;return n<0&&(n=Wn(i+n,0)),Ms(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&sn(e,t,n)>-1},hr.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Us(n);return i<0&&(i=Wn(r+i,0)),sn(e,t,i)},hr.inRange=function(e,t,n){return t=Hs(t),n===i?(n=t,t=0):n=Hs(n),function(e,t,n){return e>=Kn(t,n)&&e<Wn(t,n)}(e=qs(e),t,n)},hr.invoke=rl,hr.isArguments=_s,hr.isArray=ms,hr.isArrayBuffer=vs,hr.isArrayLike=ys,hr.isArrayLikeObject=Cs,hr.isBoolean=function(e){return!0===e||!1===e||Rs(e)&&Zr(e)==q},hr.isBuffer=Ss,hr.isDate=Is,hr.isElement=function(e){return Rs(e)&&1===e.nodeType&&!Ds(e)},hr.isEmpty=function(e){if(null==e)return!0;if(ys(e)&&(ms(e)||"string"==typeof e||"function"==typeof e.splice||Ss(e)||Fs(e)||_s(e)))return!e.length;var t=Bo(e);if(t==Q||t==te)return!e.size;if(Yo(e))return!ci(e).length;for(var n in e)if(ut.call(e,n))return!1;return!0},hr.isEqual=function(e,t){return oi(e,t)},hr.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:i)?n(e,t):i;return r===i?oi(e,t,i,n):!!r},hr.isError=Ps,hr.isFinite=function(e){return"number"==typeof e&&Bn(e)},hr.isFunction=Ts,hr.isInteger=bs,hr.isLength=Os,hr.isMap=As,hr.isMatch=function(e,t){return e===t||ai(e,t,Vo(t))},hr.isMatchWith=function(e,t,n){return n="function"==typeof n?n:i,ai(e,t,Vo(t),n)},hr.isNaN=function(e){return ws(e)&&e!=+e},hr.isNative=function(e){if($o(e))throw new Ze(a);return si(e)},hr.isNil=function(e){return null==e},hr.isNull=function(e){return null===e},hr.isNumber=ws,hr.isObject=Es,hr.isObjectLike=Rs,hr.isPlainObject=Ds,hr.isRegExp=Ls,hr.isSafeInteger=function(e){return bs(e)&&e>=-k&&e<=k},hr.isSet=ks,hr.isString=Ms,hr.isSymbol=Ns,hr.isTypedArray=Fs,hr.isUndefined=function(e){return e===i},hr.isWeakMap=function(e){return Rs(e)&&Bo(e)==oe},hr.isWeakSet=function(e){return Rs(e)&&Zr(e)==ae},hr.join=function(e,t){return null==e?"":qn.call(e,t)},hr.kebabCase=ml,hr.last=Pa,hr.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r;return n!==i&&(o=(o=Us(n))<0?Wn(r+o,0):Kn(o,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,o):an(e,cn,o,!0)},hr.lowerCase=vl,hr.lowerFirst=yl,hr.lt=js,hr.lte=Vs,hr.max=function(e){return e&&e.length?Br(e,wl,Xr):i},hr.maxBy=function(e,t){return e&&e.length?Br(e,Fo(t,2),Xr):i},hr.mean=function(e){return un(e,wl)},hr.meanBy=function(e,t){return un(e,Fo(t,2))},hr.min=function(e){return e&&e.length?Br(e,wl,di):i},hr.minBy=function(e,t){return e&&e.length?Br(e,Fo(t,2),di):i},hr.stubArray=Bl,hr.stubFalse=ql,hr.stubObject=function(){return{}},hr.stubString=function(){return""},hr.stubTrue=function(){return!0},hr.multiply=Ql,hr.nth=function(e,t){return e&&e.length?_i(e,Us(t)):i},hr.noConflict=function(){return Lt._===this&&(Lt._=gt),this},hr.noop=Nl,hr.now=Xa,hr.pad=function(e,t,n){e=Ws(e);var r=(t=Us(t))?wn(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return vo(xn(i),n)+e+vo(Vn(i),n)},hr.padEnd=function(e,t,n){e=Ws(e);var r=(t=Us(t))?wn(e):0;return t&&r<t?e+vo(t-r,n):e},hr.padStart=function(e,t,n){e=Ws(e);var r=(t=Us(t))?wn(e):0;return t&&r<t?vo(t-r,n)+e:e},hr.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Jn(Ws(e).replace(Me,""),t||0)},hr.random=function(e,t,n){if(n&&"boolean"!=typeof n&&zo(e,t,n)&&(t=n=i),n===i&&("boolean"==typeof t?(n=t,t=i):"boolean"==typeof e&&(n=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Hs(e),t===i?(t=e,e=0):t=Hs(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var o=Qn();return Kn(e+o*(t-e+Rt("1e-"+((o+"").length-1))),t)}return Si(e,t)},hr.reduce=function(e,t,n){var r=ms(e)?en:hn,i=arguments.length<3;return r(e,Fo(t,4),n,i,xr)},hr.reduceRight=function(e,t,n){var r=ms(e)?tn:hn,i=arguments.length<3;return r(e,Fo(t,4),n,i,Hr)},hr.repeat=function(e,t,n){return t=(n?zo(e,t,n):t===i)?1:Us(t),Ii(Ws(e),t)},hr.replace=function(){var e=arguments,t=Ws(e[0]);return e.length<3?t:t.replace(e[1],e[2])},hr.result=function(e,t,n){var r=-1,o=(t=Ki(t,e)).length;for(o||(o=1,e=i);++r<o;){var a=null==e?i:e[ua(t[r])];a===i&&(r=o,a=n),e=Ts(a)?a.call(e):a}return e},hr.round=$l,hr.runInContext=e,hr.sample=function(e){return(ms(e)?Tr:Ti)(e)},hr.size=function(e){if(null==e)return 0;if(ys(e))return Ms(e)?wn(e):e.length;var t=Bo(e);return t==Q||t==te?e.size:ci(e).length},hr.snakeCase=Cl,hr.some=function(e,t,n){var r=ms(e)?nn:Di;return n&&zo(e,t,n)&&(t=i),r(e,Fo(t,3))},hr.sortedIndex=function(e,t){return Li(e,t)},hr.sortedIndexBy=function(e,t,n){return ki(e,t,Fo(n,2))},hr.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=Li(e,t);if(r<n&&hs(e[r],t))return r}return-1},hr.sortedLastIndex=function(e,t){return Li(e,t,!0)},hr.sortedLastIndexBy=function(e,t,n){return ki(e,t,Fo(n,2),!0)},hr.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=Li(e,t,!0)-1;if(hs(e[n],t))return n}return-1},hr.startCase=Sl,hr.startsWith=function(e,t,n){return e=Ws(e),n=null==n?0:Mr(Us(n),0,e.length),t=Fi(t),e.slice(n,n+t.length)==t},hr.subtract=Yl,hr.sum=function(e){return e&&e.length?fn(e,wl):0},hr.sumBy=function(e,t){return e&&e.length?fn(e,Fo(t,2)):0},hr.template=function(e,t,n){var r=hr.templateSettings;n&&zo(e,t,n)&&(t=i),e=Ws(e),t=Js({},t,r,Oo);var o,a,s=Js({},t.imports,r.imports,Oo),l=il(s),c=mn(s,l),u=0,d=t.interpolate||Qe,p="__p += '",h=nt((t.escape||Qe).source+"|"+d.source+"|"+(d===Ee?Ue:Qe).source+"|"+(t.evaluate||Qe).source+"|$","g"),f="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Tt+"]")+"\n";e.replace(h,function(t,n,r,i,s,l){return r||(r=i),p+=e.slice(u,l).replace($e,Pn),n&&(o=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+t.length,t}),p+="';\n";var g=t.variable;g||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(ve,""):p).replace(ye,"$1").replace(Ce,"$1;"),p="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var _=bl(function(){return Xe(l,f+"return "+p).apply(i,c)});if(_.source=p,Ps(_))throw _;return _},hr.times=function(e,t){if((e=Us(e))<1||e>k)return[];var n=F,r=Kn(e,F);t=Fo(t),e-=F;for(var i=gn(r,t);++n<e;)t(n);return i},hr.toFinite=Hs,hr.toInteger=Us,hr.toLength=Bs,hr.toLower=function(e){return Ws(e).toLowerCase()},hr.toNumber=qs,hr.toSafeInteger=function(e){return e?Mr(Us(e),-k,k):0===e?e:0},hr.toString=Ws,hr.toUpper=function(e){return Ws(e).toUpperCase()},hr.trim=function(e,t,n){if((e=Ws(e))&&(n||t===i))return e.replace(ke,"");if(!e||!(t=Fi(t)))return e;var r=Dn(e),o=Dn(t);return Ji(r,yn(r,o),Cn(r,o)+1).join("")},hr.trimEnd=function(e,t,n){if((e=Ws(e))&&(n||t===i))return e.replace(Ne,"");if(!e||!(t=Fi(t)))return e;var r=Dn(e);return Ji(r,0,Cn(r,Dn(t))+1).join("")},hr.trimStart=function(e,t,n){if((e=Ws(e))&&(n||t===i))return e.replace(Me,"");if(!e||!(t=Fi(t)))return e;var r=Dn(e);return Ji(r,yn(r,Dn(t))).join("")},hr.truncate=function(e,t){var n=O,r=E;if(Es(t)){var o="separator"in t?t.separator:o;n="length"in t?Us(t.length):n,r="omission"in t?Fi(t.omission):r}var a=(e=Ws(e)).length;if(Tn(e)){var s=Dn(e);a=s.length}if(n>=a)return e;var l=n-wn(r);if(l<1)return r;var c=s?Ji(s,0,l).join(""):e.slice(0,l);if(o===i)return c+r;if(s&&(l+=c.length-l),Ls(o)){if(e.slice(l).search(o)){var u,d=c;for(o.global||(o=nt(o.source,Ws(Be.exec(o))+"g")),o.lastIndex=0;u=o.exec(d);)var p=u.index;c=c.slice(0,p===i?l:p)}}else if(e.indexOf(Fi(o),l)!=l){var h=c.lastIndexOf(o);h>-1&&(c=c.slice(0,h))}return c+r},hr.unescape=function(e){return(e=Ws(e))&&Pe.test(e)?e.replace(Se,Ln):e},hr.uniqueId=function(e){var t=++dt;return Ws(e)+t},hr.upperCase=Il,hr.upperFirst=Pl,hr.each=Wa,hr.eachRight=Ka,hr.first=ya,Ml(hr,(Jl={},zr(hr,function(e,t){ut.call(hr.prototype,t)||(Jl[t]=e)}),Jl),{chain:!1}),hr.VERSION="4.17.11",Kt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){hr[e].placeholder=hr}),Kt(["drop","take"],function(e,t){mr.prototype[e]=function(n){n=n===i?1:Wn(Us(n),0);var r=this.__filtered__&&!t?new mr(this):this.clone();return r.__filtered__?r.__takeCount__=Kn(n,r.__takeCount__):r.__views__.push({size:Kn(n,F),type:e+(r.__dir__<0?"Right":"")}),r},mr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),Kt(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n==w||3==n;mr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Fo(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}}),Kt(["head","last"],function(e,t){var n="take"+(t?"Right":"");mr.prototype[e]=function(){return this[n](1).value()[0]}}),Kt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");mr.prototype[e]=function(){return this.__filtered__?new mr(this):this[n](1)}}),mr.prototype.compact=function(){return this.filter(wl)},mr.prototype.find=function(e){return this.filter(e).head()},mr.prototype.findLast=function(e){return this.reverse().find(e)},mr.prototype.invokeMap=Pi(function(e,t){return"function"==typeof e?new mr(this):this.map(function(n){return ri(n,e,t)})}),mr.prototype.reject=function(e){return this.filter(ls(Fo(e)))},mr.prototype.slice=function(e,t){e=Us(e);var n=this;return n.__filtered__&&(e>0||t<0)?new mr(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==i&&(n=(t=Us(t))<0?n.dropRight(-t):n.take(t-e)),n)},mr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},mr.prototype.toArray=function(){return this.take(F)},zr(mr.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),o=hr[r?"take"+("last"==t?"Right":""):t],a=r||/^find/.test(t);o&&(hr.prototype[t]=function(){var t=this.__wrapped__,s=r?[1]:arguments,l=t instanceof mr,c=s[0],u=l||ms(t),d=function(e){var t=o.apply(hr,Xt([e],s));return r&&p?t[0]:t};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var p=this.__chain__,h=!!this.__actions__.length,f=a&&!p,g=l&&!h;if(!a&&u){t=g?t:new mr(this);var _=e.apply(t,s);return _.__actions__.push({func:Ha,args:[d],thisArg:i}),new _r(_,p)}return f&&g?e.apply(this,s):(_=this.thru(d),f?r?_.value()[0]:_.value():_)})}),Kt(["pop","push","shift","sort","splice","unshift"],function(e){var t=ot[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);hr.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(ms(i)?i:[],e)}return this[n](function(n){return t.apply(ms(n)?n:[],e)})}}),zr(mr.prototype,function(e,t){var n=hr[t];if(n){var r=n.name+"";(ir[r]||(ir[r]=[])).push({name:t,func:n})}}),ir[fo(i,m).name]=[{name:"wrapper",func:i}],mr.prototype.clone=function(){var e=new mr(this.__wrapped__);return e.__actions__=no(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=no(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=no(this.__views__),e},mr.prototype.reverse=function(){if(this.__filtered__){var e=new mr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},mr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=ms(e),r=t<0,i=n?e.length:0,o=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=Kn(t,e+a);break;case"takeRight":e=Wn(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,l=s-a,c=r?s:a-1,u=this.__iteratees__,d=u.length,p=0,h=Kn(l,this.__takeCount__);if(!n||!r&&i==l&&h==l)return Ui(e,this.__actions__);var f=[];e:for(;l--&&p<h;){for(var g=-1,_=e[c+=t];++g<d;){var m=u[g],v=m.iteratee,y=m.type,C=v(_);if(y==D)_=C;else if(!C){if(y==w)continue e;break e}}f[p++]=_}return f},hr.prototype.at=Ua,hr.prototype.chain=function(){return xa(this)},hr.prototype.commit=function(){return new _r(this.value(),this.__chain__)},hr.prototype.next=function(){this.__values__===i&&(this.__values__=xs(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},hr.prototype.plant=function(e){for(var t,n=this;n instanceof gr;){var r=pa(n);r.__index__=0,r.__values__=i,t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t},hr.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof mr){var t=e;return this.__actions__.length&&(t=new mr(this)),(t=t.reverse()).__actions__.push({func:Ha,args:[Ea],thisArg:i}),new _r(t,this.__chain__)}return this.thru(Ea)},hr.prototype.toJSON=hr.prototype.valueOf=hr.prototype.value=function(){return Ui(this.__wrapped__,this.__actions__)},hr.prototype.first=hr.prototype.head,rn&&(hr.prototype[rn]=function(){return this}),hr}();Lt._=kn,(r=function(){return kn}.call(t,n,t,e))===i||(e.exports=r)}).call(this)}).call(this,n(22)(e))},function(e,t,n){"use strict";
/*!
 *  Appenders.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(5),s=n(7),l=function(){function e(e){this._formatter=e||new d}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();function c(e){return(4294967296+e).toString(16).substr(-8)}function u(e,t){return(1e12+e).toString(10).substr(-t)}t.AbstractLogAppender=l,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(o=t.SLF_Flags||(t.SLF_Flags={}));var d=function(){function e(e){void 0===e&&(e=4294967295),this._flags=e}return e.prototype.format=function(e,t,n,r){var i="";if(this._flags&o.FullDate)i+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&o.Timestamp){var l=new Date(e.timestamp);i+=u(l.getHours(),2)+":"+u(l.getMinutes(),2)+":"+u(l.getSeconds(),2)+"."+u(l.getMilliseconds(),2)+" "}return this._flags&o.LogId&&(i+="[#"+c(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&o.Level&&(i+="["+s.LogFactory.levelToString(e.level)+"] "),this._flags&o.Component&&(i+="["+e.component.name()+"] "),n||""===n?i+a.vsprintf(n,r):i+c(t)+": "+r.join(" ")},e}();t.StandardLogFormatter=d;var p=console,h=console.log||function(){},f=console.info||h,g=console.warn||f,_=console.error||g,m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.log=function(e,t,n,r){r=r.slice(0);var i=e.level<=a.LogLevel.Debug3?h:e.level<=a.LogLevel.Debug1?f:e.level<=a.LogLevel.Warning?g:_;if(-1===t){var o=this.formatter().format(e,t,"",[]);"string"==typeof r[0]&&(o+=r.shift()),i.apply(p,[o].concat(r))}else{for(var s=void 0,l=[];s=n.match(/\s*%@\s*$/);)n=n.substr(0,n.length-s[0].length),l.unshift(r.pop());o=this.formatter().format(e,t,n,r);i.apply(p,[o].concat(l))}},t}(l);t.ConsoleAppender=m;var v=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,n,r){this._chained.log(e,t,n,r)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=v;var y=function(e){function t(t,n){var r=e.call(this,t)||this;return r._levels=n,r}return i(t,e),t.prototype.levels=function(){return this._levels},t}(v);t.wrapAppenderWithLogLevels=function(e,t){return new y(e,t)}},function(e,t,n){var r=n(8);e.exports=function(){return r.randomBytes(16)}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(18),o=n(0),a=n(2),s=new i.ElectronApp,l=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: loadSlimCore"),yield s.loadSlimCore()}),c=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: initalizeStack"),yield s.initialize(e.skypeToken,e.displayName)}),u=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: startOrJoinCall"),yield s.connectToCall(e.groupContext)}),d=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: endCall"),yield s.endAndCleanUpCurrentCall()}),p=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: enumerateDevices"),yield s.enumerateDevices()}),h=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: selectedDevices"),s.getSelectedDevices()}),f=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: selectDevices"),s.selectDevices(e.selectedDevices)}),g=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: muteOrUnmute"),s.muteOrUnmute(e.isMute,e.participant)}),_=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: currentParticipants"),yield s.getCurrentParticipants()}),m=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: dominantSpeakers"),yield s.getDominantSpeakers()}),v=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: isMuted"),s.isMuted()}),y=e=>r(this,void 0,void 0,function*(){return a.proxyTraceSource.info("Request: callInfo"),s.getCallInfo()});window.onload=()=>r(this,void 0,void 0,function*(){const e=window.appEvents;e.on(o.RequestType.getCallInfo,y),e.on(o.RequestType.getCurrentParticipants,_),e.on(o.RequestType.getDominantSpeakers,m),e.on(o.RequestType.endCall,d),e.on(o.RequestType.enumerateDevices,p),e.on(o.RequestType.initializeStackEvent,c),e.on(o.RequestType.isMuted,v),e.on(o.RequestType.loadSlimCore,l),e.on(o.RequestType.muteOrUnmute,g),e.on(o.RequestType.selectDevices,f),e.on(o.RequestType.getSelectedDevices,h),e.on(o.RequestType.startOrJoinCall,u),s.callChangedEventEmitter.on(o.NotificationType.callChanged,t=>{e.sendNotification(t)}),yield e.sendNotification(new o.ElectronAppReady)}),window.onbeforeunload=()=>{s.dispose()}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(19),o=n(13),a=n(34),s=n(0),l=n(35),c=n(2);t.ElectronApp=class{constructor(){this.currentCallParticipants={},this.callChangedEventEmitter=new l}loadSlimCore(){return r(this,void 0,void 0,function*(){try{c.proxyTraceSource.info("[ElectronApp] loadSlimCore"),this.stackProvider=new i.ElectronStackProvider,this.callingStack=yield this.stackProvider.build(),this.config=this.stackProvider.config,c.proxyTraceSource.info("[ElectronApp] loaded slimcore")}catch(e){throw c.proxyTraceSource.error(`[ElectronApp] failed to load slimcore: ${e}`),e}})}initialize(e,t){return r(this,void 0,void 0,function*(){return c.proxyTraceSource.info("[ElectronApp] create callRegistry"),this.callRegistry=this.callingStack.getCallRegistry(),c.proxyTraceSource.info("[ElectronApp] init callRegistry"),yield this.callRegistry.init({displayName:t,id:e.skypeId,tokenProvider:()=>(c.proxyTraceSource.info("[ElectronApp] return token"),Promise.resolve(e.skypeToken))}),c.proxyTraceSource.info("[ElectronApp] get DeviceManager"),this.deviceManager=this.callingStack.getDeviceManager(),c.proxyTraceSource.info("[ElectronApp] done"),new Promise((e,t)=>{setTimeout(()=>e(),1500)})})}endAndCleanUpCurrentCall(){return r(this,void 0,void 0,function*(){if(this.currentCall)try{yield this.currentCall.stop()}finally{this.dispose()}})}enumerateDevices(){return r(this,void 0,void 0,function*(){if(!this.deviceManager)return[];const e=yield this.deviceManager.enumerateDevicesAsync();return c.proxyTraceSource.info(`[ElectronApp] finished enumerating devices: ${e}`),e})}getSelectedDevices(){if(this.deviceManager)return this.deviceManager.getSelectedDevices()}getCurrentParticipants(){return this.currentCallParticipants?o.map(this.currentCallParticipants,e=>({displayName:e.displayName,id:e.id,isServerMuted:e.isServerMuted,voiceLevel:e.voiceLevel})):[]}getDominantSpeakers(){return this.currentCall?o.map(this.currentCall.dominantSpeakerInfo.speakerList,e=>{const t=this.currentCallParticipants[e];return{displayName:t.displayName,id:t.id,isServerMuted:t.isServerMuted,voiceLevel:t.voiceLevel}}):[]}selectDevices(e){if(this.deviceManager)return this.deviceManager.selectDevices(e)}isMuted(){return!this.callWrapper||this.callWrapper.isMuted()}connectToCall(e){return r(this,void 0,void 0,function*(){if(this.currentCall)return c.proxyTraceSource.warn("[ElectronApp] Already connected to a call"),this.endAndCleanUpCurrentCall().then(()=>Promise.reject(new Error("Already connected to a call. Ending current call. Please retry audio join")));try{c.proxyTraceSource.info(`[ElectronApp] Connecting to call with group context: ${e}`);const t=this.callRegistry.createCall(e);t.init({threadId:e,mediaPeerType:2}),t.on("participantAdded",()=>r(this,void 0,void 0,function*(){c.proxyTraceSource.info("[ElectronApp] participantAdded"),o.forEach(t.participants,e=>r(this,void 0,void 0,function*(){if(!(e.id in this.currentCallParticipants)){this.currentCallParticipants[e.id]=e;const t=new s.CallChanged(s.CallChangedType.participantsChanged);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}}))})),t.on("participantRemoved",()=>{c.proxyTraceSource.info("[ElectronApp] participantRemoved");const e={};o.forEach(t.participants,t=>{e[t.id]=t});let n=[];o.forEach(Object.keys(this.currentCallParticipants),t=>{t in e||n.push(this.currentCallParticipants[t])}),o.forEach(n,e=>{delete this.currentCallParticipants[e.id];const t=new s.CallChanged(s.CallChangedType.participantsChanged);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}),n=null}),t.on("serverMutedChanged",e=>{c.proxyTraceSource.info(`[ElectronApp] serverMutedChanged: ${e}`);const t=new s.CallChanged(s.CallChangedType.muteChanged,null);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}),t.on("participantUpdated",e=>{c.proxyTraceSource.info("[ElectronApp] participantUpdated");const t={displayName:e.displayName,id:e.id,isServerMuted:e.isServerMuted,voiceLevel:e.voiceLevel},n=new s.CallChanged(s.CallChangedType.participantChanged,t);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,n)}),t.on("callStateChanged",()=>{switch(c.proxyTraceSource.info(`[ElectronApp] callStateChanged: ${t.state}`),t.state){case 3:{c.proxyTraceSource.info("[ElectronApp] callStateChanged: connected to call");const e={threadId:t.threadId,callId:t.callId,state:t.state},n=new s.CallChanged(s.CallChangedType.callStarted,null,e);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,n)}break;default:return}}),this.currentCall=t,yield t.start({screenshareDirection:0}),this.callWrapper=new a.default(t)}catch(e){throw c.proxyTraceSource.error(`[ElectronApp] error while connecting to call: ${e.message}`),e}})}muteOrUnmute(e,t){return r(this,void 0,void 0,function*(){if(!this.currentCall)return;let n;if(!t)return e?yield this.currentCall.mute():yield this.currentCall.unmute();const r=o.find(this.currentCallParticipants,e=>e.id===t.id);if(!r)return;const i=(n=o.filter(this.currentCallParticipants,e=>e.isServerMuted)).indexOf(r);e&&i<0?n.push(r):!e&&i>=0&&n.splice(i,1),yield this.currentCall.muteParticipants(1,n)})}getCallInfo(){if(this.callWrapper)return this.callWrapper.getCallInfo()}dispose(){this.callWrapper&&(this.callWrapper.dispose(),this.callWrapper=null),this.stackProvider&&(this.stackProvider.dispose(),this.stackProvider=null),this.callingStack=null,this.callRegistry=null,this.currentCall=null,this.deviceManager=null,this.config=null,this.currentCallParticipants={}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(20),i=n(1),o=n(4),a=n(21),s=n(27),l=n(2);class c{createChild(e,t){return this}log(...e){l.proxyTraceSource.info(`[AppLogger] log: ${e}`)}debug(...e){l.proxyTraceSource.info(`[AppLogger] debug: ${e}`)}info(...e){l.proxyTraceSource.info(`[AppLogger] info: ${e}`)}warn(...e){l.proxyTraceSource.warn(`[AppLogger] warn: ${e}`)}error(...e){l.proxyTraceSource.error(`[AppLogger] error: ${e}`)}}class u{onDisplaysChanged(e){return{dispose:()=>{}}}showSharingIndicator(e){}hideSharingIndicator(){}getControlInjector(){return{setInjectorConfig:e=>Promise.resolve(),injectRawInput:(e,t)=>Promise.resolve(),setInjectionRect:e=>Promise.resolve(),allowSingleController:e=>Promise.resolve(),setAvatar:(e,t)=>Promise.resolve(),dispose:()=>{}}}}t.ElectronStackProvider=class{build(){const e=s.PLATFORMS[`${window.process.platform}-${window.process.arch}`];if(l.proxyTraceSource.info(`[ElectronStackProvider] PlatformId: ${e}`),!e)throw new Error(`Platform ${window.process.platform}-${window.process.arch} not supported`);const t=i.join(o.tmpdir(),"VSFeedbackVSRTCLogs");r.existsSync(t)||r.mkdirSync(t),l.proxyTraceSource.info(`[ElectronStackProvider] temp slimcore directory: ${t}`);const n={dataPath:t,mediaLogsPath:t,logFileName:"logger",version:`${e}/${s.getNormalizedVersion()}//`,isEncrypted:!1};return l.proxyTraceSource.info("[ElectronStackProvider] creating slimcore instance"),this.slimCoreInstance=global.SlimCore.createSlimCoreInstance(n),l.proxyTraceSource.info(this.slimCoreInstance),this.config={appHooks:new u,logger:new c,settings:{enableDXVA:!1,autoStopLocalVideo:!1},slimCoreInstance:this.slimCoreInstance},a.slimCoreElectronStackFactory.build(this.config)}dispose(){this.slimCoreInstance&&(this.slimCoreInstance.dispose(),this.slimCoreInstance=null),global.SlimCore=null,global.Enums=null}}},function(e,t){e.exports=require("fs")},function(e,t,n){var r;"undefined"!=typeof self&&self,r=function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=38)}([function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s,l=n(3),c=n(21);if(l.defaults(window,{SlimCore:{}}),l.defaults(SlimCore,{Enums:{}}),p()){var u=window.SlimCoreRT.SlimCore.Enums;a=u,s=SlimCore.Enums,Object.keys(a).forEach(function(e){!function(e,t,n){n[e]={},Object.keys(t).forEach(function(r){n[e][r]=t[r]})}(e,a[e],s)}),o=SlimCore.Enums,Object.keys(o).forEach(function(e){var t;t=o[e],Object.keys(t).forEach(function(e){!function(e,t){var n,r=(n=t)[0].toUpperCase()+n.substr(1);if(r!==t){var i=e[t];e[i]=r,delete e[t],e[r]=i}}(t,e)})})}Proxy&&(SlimCore.Enums=new Proxy(SlimCore.Enums,{get:function(e,t){return t in e?e[t]:{}}}));var d=SlimCore.Enums;function p(){return!!(window.SlimCoreRT&&window.SlimCoreRT.SlimCore&&window.SlimCoreRT.SlimCore.Enums)}t.MRI_SKYPE_PREFIX="8:",t.MRI_ALIAS_PREFIX=";aliases=",t.MRI_SIP_PREFIX="2:",t.isSlimCoreRTModuleAvailable=p;var h,f=[d.VideoStatus.Available,d.VideoStatus.Starting,d.VideoStatus.Running];function g(e,t,n,r,i){try{return e.getIntProperty(n,r)}catch(e){return t.logFailure("getIntProperty failed: "+e),i}}t.wrap=function(e,t){return void 0===t&&(t={}),t.enableNativeHandle&&"handle"in e?e:l.assign(e,{handle:function(t,n,r){var i=n?function(e,t){return function(n){(function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0})(n,t)&&e(n)}}(r,n):r;return e.addListener(t,i),{dispose:function(){e.removeListener(t,i)}}}})},function(e){e[e.Electron=1]="Electron",e[e.Uwp=2]="Uwp"}(h=t.PlatformType||(t.PlatformType={})),t.forgetAndLog=function(e,t,n){return e?e.catch(function(e){t.logFailure("Promise execution failed: "+n+": "+e)}):(t.logFailure("Undefined promise @ "+(new Error).stack),Promise.resolve())},t.getStrProperty=function(e,t,n,r,i){try{return e.getStrProperty(n,r)}catch(e){return t.logFailure("getStrProperty failed for objectId="+n+", propertyKey="+r+": "+e),i}},t.getIntProperty=g,t.hasFeature=function(e){return e in d.Feature};var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.fire=function(){this.raiseEvents(function(e){return e()})},t}(c.EventSourceImpl);function m(e){return new Promise(function(t,n){var r,i=!1,o=null,a=0,s=function(e){i=!0,o&&(o.dispose(),o=null),a&&(clearTimeout(a),a=0),r&&r.dispose(),e?n(e):t()},l=function(t){i||(e.logger.info("waitForVideoObjectState["+e.videoObjectId+"] state changed -> "+t+" ("+d.VideoStatus[t]+")"),v(t,e.resolveStates)?s():e.rejectStates&&v(t,e.rejectStates)&&s("waitForVideoObjectState["+e.videoObjectId+"] rejecting state "+t+" ("+d.VideoStatus[t]+")"))};e.timeout&&(a=setTimeout(function(){if(!i){e.logger.info("waitForVideoObjectState["+e.videoObjectId+"] timeout. Checking state again.");var t=g(e.slimcoreObject,e.logger,e.videoObjectId,d.Property.VideoStatus);v(t,e.resolveStates)?s():e.rejectStates&&v(t,e.rejectStates)?s("waitForVideoObjectState["+e.videoObjectId+"] rejecting state "+t):s("waitForVideoObjectState["+e.videoObjectId+"] timeout.")}},e.timeout)),e.cancelEvent&&(r=e.cancelEvent.subscribe(function(){e.logger.info("waitForVideoObjectState["+e.videoObjectId+"] canceled."),s("waitForVideoObjectState["+e.videoObjectId+"] canceled.")})),o=e.slimcoreInstance.handle("object-property-changed",{objectId:e.videoObjectId,propKey:d.Property.VideoStatus},function(e){return l(e.value)});var c=g(e.slimcoreObject,e.logger,e.videoObjectId,d.Property.VideoStatus);l(c)})}function v(e,t){return-1!==t.indexOf(e)}t.VideoStateCancelEvent=_,t.waitForVideoObjectState=m,t.isVideoInState=v,t.videoObjectTimeout=function(e){return e.platform===h.Uwp?5e3:500},t.waitForVideoObjectToBeAvailable=function(e,t,n,r,i,o){return m({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,resolveStates:f,rejectStates:[],timeout:i,cancelEvent:o})},t.waitForVideoObjectToBeRunning=function(e,t,n,r,i,o){return m({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,resolveStates:[d.VideoStatus.Running],rejectStates:[d.VideoStatus.Stopping],timeout:i,cancelEvent:o})},t.waitForVideoObjectToBeStopped=function(e,t,n,r,i,o){return m({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,resolveStates:[d.VideoStatus.NotStarted,d.VideoStatus.Available,d.VideoStatus.NotAvailable],rejectStates:[],timeout:i,cancelEvent:o})},t.isVideoAvailable=function(e){return v(e,f)};var y=/;aliases=.*$/i;t.stripMriAliases=function(e){return e?e.replace(y,""):e},t.bufferToString=function(e){return String.fromCharCode.apply(null,e)},t.stringToBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},t.mapMediaTypeStringToMediaType=function(e){switch(e){case"audio":return 0;case"video":return 1;case"panoramic-video":return 2;case"applicationsharing-video":return 3;case"data":return 4;default:return}},t.mapToEmptyStrIfFalsy=function(e){return e||""},t.hasCreateDataSource=function(e){return!(!e.createDataSource&&!SlimCore.createDataSource)},t.hasCreateDataSink=function(e){return!(!e.createDataSink&&!SlimCore.createDataSink)},t.createDataSource=function(e,t){return e.createDataSource?e.createDataSource(t):SlimCore.createDataSource(t)},t.createDataSink=function(e,t){return e.createDataSink?e.createDataSink(t):SlimCore.createDataSink(t)},t.convertImageData=function(e){if(e.isImage)return e;var t=e.data,n=new Uint8ClampedArray(t.buffer,t.byteOffset,t.byteLength);return new ImageData(n,e.width,e.height)},t.convertEndpointScope=function(e){switch(e){case 0:return d.RemoveEndpointScope.RemoveEndpointScopeSpecified;case 1:return d.RemoveEndpointScope.RemoveEndpointScopeOther;default:return}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(39),a=n(0),s=function(e){function t(t,n,r){var i=e.call(this)||this;return i._logger=t,i._settings=n,i._slimcoreInstance=r,i._disposables=[],i._objectPropertyChangedHandlers=new Map,i}return i(t,e),t.prototype.dispose=function(t){this._logger.info("dispose"),this._disposables.forEach(function(e){return e.dispose(t)}),this._disposables=[],this._objectPropertyChangedHandlers.clear(),e.prototype.dispose.call(this)},t.prototype._registerDisposable=function(e){e?this._disposables.push(e):this._logger.error("Attempt to register null disposable, ignoring")},t.prototype._getProperties=function(e,t,n,r){if(e.getProperties&&this._settings.enableNativeGetProperties)return e.getProperties(t,n,r);for(var i={},o=0,s=Object.keys(n);o<s.length;o++){var l=n[d=s[o]];i[d]=a.getStrProperty(e,this._logger,l.objectId||t,l.propKey,l.fallback)}for(var c=0,u=Object.keys(r);c<u.length;c++){var d;l=r[d=u[c]];i[d]=a.getIntProperty(e,this._logger,l.objectId||t,l.propKey,l.fallback)}return i},t.prototype._getStrProperty=function(e,t,n,r){return a.getStrProperty(e,this._logger,t,n,r)},t.prototype._getIntProperty=function(e,t,n,r){return a.getIntProperty(e,this._logger,t,n,r)},t.prototype._onObjectPropertyChanged=function(e,t,n){var r=this;this._objectPropertyChangedHandlers.has(e)||(this._objectPropertyChangedHandlers.set(e,new Map),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectId:e},function(e){return r._onObjectPropertyChangedCallback(e)}))),this._objectPropertyChangedHandlers.get(e).set(t,n)},t.prototype._onObjectPropertyChangedCallback=function(e){var t=this._objectPropertyChangedHandlers.get(e.objectId);if(t){var n=t.get(e.propKey);if(this._settings.enableSlimCoreEventsCounting){var r=SlimCore.Enums.Property[e.propKey]||e.propKey,i=SlimCore.Enums.ObjectType[e.objectType]||e.objectType;this._logger.debug("_onObjectPropertyChangedCallback - objectId: "+e.objectId+", objectType: "+i+", propKey: "+r+", value: "+e.value+", handler: "+!!n)}n&&n.call(this,e)}},t.prototype.raiseChanged=function(){try{e.prototype.raiseChanged.call(this)}catch(e){this._logger.error("Change handling error: "+e)}},t.prototype._raiseEventImpl=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];try{e.prototype._raiseEventImpl.apply(this,[t].concat(n))}catch(e){this._logger.error("Event '"+t+"' handling error: "+e)}},t}(o.default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return Math.floor(4294967296*Math.random()).toString(16)}},function(t,n){t.exports=e},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.asap=function(e){return new Promise(function(t){t(e())})};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(Error);t.TimeoutError=o;var a=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){this.timeoutId=setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId)},e}();t.Timer=a,t.defer=function(){var e,t;return{promise:new Promise(function(n,r){e=n,t=r}),resolve:e,reject:t}},t.timedDefer=function(e,t){var n,r;void 0===t&&(t="deferred timed out after "+e+"ms");var i=new a(function(){return r(new o(t))}),s=new Promise(function(e,t){n=function(t){i.stop(),e(t)},r=function(e){i.stop(),t(e)}});return i.start(e),{promise:s,resolve:n,reject:r}},t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);function i(e){return"string"==typeof e?r.pii.Mri(e):r.pii.Omit(e)}t.scrubMriOrOmit=i,t.scrubMriOrOmitList=function(e){return e.forEach(i)},t.mriOrId=function(e){return e&&r.pii.Mri(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","endpointId","phrase","subCode","reason"];t.getPIISafeObject=function(e){try{return JSON.parse(JSON.stringify(e,r,4))}catch(e){return{error:"failed to parse object"}}},t.getPrintableObject=function(e,t){if(void 0===t&&(t=!1),e instanceof Error)return e.toString();if(e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=function(e){try{return e.split("\n")[0]}catch(e){return"invalid stack"}}(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,r,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return"failed to get error information:"+(e&&"function"==typeof e.toString&&e.toString())}},t.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(e){return"failed to stringify obj"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.CALL_ENDED="CallEnded",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.JOIN_PREHEATED_CALL="JoinPreheatedCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.RECONNECT="Reconnect",e.RENEGOTIATE="Renegotiate",e.RENEGOTIATE_OUTGOING="RenegotiateOutgoing",e.RENEGOTIATE_INCOMING="RenegotiateIncoming",e.COMPLETE_NEGOTIATION_FAILED="CompleteNegotiationFailed",e.UPDATE_LOCAL_MEDIA_STATUS="UpdateLocalMediaStatus",e.SET_MEDIA_MODALITIES="SetMediaModalities",e.SET_VIDEO_CONTAINER="SetVideoContainer",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.START_PREVIEW_VIDEO="StartPreviewVideo",e.START_LOCAL_VIDEO="StartLocalVideo",e.STOP_PREVIEW_VIDEO="StopPreviewVideo",e.STOP_LOCAL_VIDEO="StopLocalVideo",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.SET_LOCAL_VIDEO="SetLocalVideo",e.SET_VIDEO_EFFECTS="SetVideoEffects",e.GET_VIDEO_EFFECTS_CAPABILITIES="GetVideoEffectsCapabilities",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.CALL_TRANSFER_IN_PROGRESS="CallTransferInProgress",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.ON_TRANSFER_REQUESTED="OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="OnTransferRequestedInvalid",e.ON_INCOMING_CALL_REPLACEMENT="onIncomingCallReplacement",e.GET_CALL_REPLACEMENT_DETAILS="GetCallReplacementDetails",e.GET_TECHNICAL_INFORMATION_JSON="GetTechnicalInformationJson",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.START_DATA_CHANNEL="StartDataChannel",e.STOP_DATA_CHANNEL="StopDataChannel",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.UPDATE_MEETING_ROLE="UpdateMeetingRole",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.ASSIMILATE="Assimilate",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.SET_CALL_STATE="SetCallState",e.SET_TRANSFER_STATE="SetTransferState",e.SET_PARK_STATE="SetParkState",e.SET_MUTED="SetMuted",e.SET_MUTED_SPEAKER="SetMutedSpeaker",e.SET_SCREEN_SHARING="SetScreenSharing",e.SET_CALL_ORIGIN="SetCallOrigin",e.CONNECT_CALL="ConnectCall",e.WAIT_FOR_ANSWER="WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="SignalingStateChanged",e.CALL_TERMINATION_INFO="CallTerminationInfo",e.MEDIA_WHITELISTING_ISSUE_DETECTED="MediaWhiteListingIssueDetected",e.LWJ_FALLBACK="LwjFallback",e.CALL_ESCALATED_TO_CONFERENCE="CallEscalatedToConference",e.WEB_ON_OFFER="WebOnOffer",e.WEB_ON_ANSWER="WebOnAnswer",e.WEB_ON_RETARGET_SUCCESS="WebRetargetSuccess",e.WEB_ON_RETARGET_FAILURE="WebRetargetFailure",e.WEB_ON_ESCALATION_SUCCESS="WebOnEscalationSuccess",e.WEB_ON_ESCALATION_FAILURE="WebOnEscalationFailure",e.CALL_USES_MIXER="CallUsesMixer",e.ESCALATION_IN_PROGRESS="EscalationInProgress",e.ESCALATION_COMPLETED="EscalationCompleted",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="ElectronWaitForRinging",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.ELECTRON_START_SCREEN_SHARING="ElectronStartScreenSharing",e.ELECTRON_SLIMCORE_READY="ElectronSlimcoreReady",e.ELECTRON_DATA_CHANNEL_CREATED="ElectronDataChannelCreated",e.ELECTRON_ATTACH_SLIMCORE_CALL="ElectronAttachSlimcoreCall",e.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="ElectronAttachSlimcoreCallFailed",e.ELECTRON_CALL_IS_ACTIVE_CHANGED="ElectronCallIsActiveChanged"}(t.CALL_OPERATIONS||(t.CALL_OPERATIONS={})),function(e){e.AUDIO_QUALITY_CHANGED="AudioQualityChanged",e.SESSION_ERROR="SessionError",e.NEGOTIATION_REQUIRED="NegotiationRequired",e.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",e.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",e.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",e.NEGOTIATION_COMPLETION="NegotiationCompletion",e.AUDIO_STATE_CHANGED="AudioStateChanged",e.INCOMPATIBLE_OFFER="IncompatibleOffer",e.NEW_OFFER_FAILED="NewOfferFailed"}(t.MEDIA_EVENT||(t.MEDIA_EVENT={})),function(e){e.SET_PARTICIPANT_STATE="SetParticipantState",e.SET_PARTICIPANT_STATE_INVALID="SetParticipantStateInvalid",e.UPDATE_PARTICIPANT_STREAM="UpdateParticipantStream",e.UPDATE_LOCAL_PARTICIPANT_STREAM="UpdateLocalParticipantStream",e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.PARTICIPANT_JOINED="ParticipantJoined",e.PARTICIPANT_UPDATED="ParticipantUpdated",e.ADMIT_PARTICIPANT="AdmitParticipant",e.SELF_PARTICIPANT_UPDATED="SelfParticipantUpdated",e.CALL_ME_BACK="CallMeBack",e.ELECTRON_ATTACH_SLIMCORE_PARTICIPANT_FAILED="ElectronAttachSlimcoreParticipantFailed"}(t.PARTICIPANT_OPERATIONS||(t.PARTICIPANT_OPERATIONS={})),function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState",e.SET_CONTENT_SHARING_STATUS="SetContentSharingStatus"}(t.CONTENT_SHARING_OPERATIONS||(t.CONTENT_SHARING_OPERATIONS={})),t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=SlimCore.Enums;function i(e){switch(e){case r.ParticipantFailureReason.NoFailure:case r.ParticipantFailureReason.HostEndedConf:case r.ParticipantFailureReason.AnsweredElsewhere:return 0;case r.ParticipantFailureReason.RecipientUserNotFound:case r.ParticipantFailureReason.RecipientNotOnline:case r.ParticipantFailureReason.PstnCouldNotConnectToSkypeProxy:case r.ParticipantFailureReason.CallNotificationDeliveryFailure:return 4;case r.ParticipantFailureReason.RecipientBlocked:return 5;case r.ParticipantFailureReason.CallerNotFriend:case r.ParticipantFailureReason.CallerNotAuthorized:return 6;case r.ParticipantFailureReason.ConfParticipantCountLimitReached:return 46;case r.ParticipantFailureReason.ConfLobbyParticipantCountLimitReached:return 59;case r.ParticipantFailureReason.PstnNoSkypeoutSubscription:return 7;case r.ParticipantFailureReason.CallNotFound:return 8;case r.ParticipantFailureReason.PstnNetworkError:case r.ParticipantFailureReason.PstnInternetConnectionLost:case r.ParticipantFailureReason.TrouterError:case r.ParticipantFailureReason.GeneralNetworkError:return 9;case r.ParticipantFailureReason.MediaDroppedError:case r.ParticipantFailureReason.SoundRecordingError:case r.ParticipantFailureReason.SoundPlaybackError:return 10;case r.ParticipantFailureReason.PstnInsufficientFunds:return 12;case r.ParticipantFailureReason.PstnCreditExpired:return 26;case r.ParticipantFailureReason.PstnCreditExpiredButEnough:return 27;case r.ParticipantFailureReason.MiscError:case r.ParticipantFailureReason.PstnMiscError:return 11;case r.ParticipantFailureReason.PstnSkypeoutAccountBlocked:return 13;case r.ParticipantFailureReason.PstnBlockedByUs:return 15;case r.ParticipantFailureReason.PstnBlockedRegulatoryIndia:return 16;case r.ParticipantFailureReason.PstnInvalidNumber:return 17;case r.ParticipantFailureReason.PstnNumberForbidden:return 18;case r.ParticipantFailureReason.PstnCallTimedOut:return 2;case r.ParticipantFailureReason.PstnBusy:return 19;case r.ParticipantFailureReason.PstnCallTerminated:return 20;case r.ParticipantFailureReason.PstnNumberUnavailable:return 21;case r.ParticipantFailureReason.PstnCallRejected:return 3;case r.ParticipantFailureReason.PstnEmergencyCallDenied:return 22;case r.ParticipantFailureReason.PstnNoSubscriptionCover:return 25;case r.ParticipantFailureReason.EnterprisePstnForbidden:return 30;case r.ParticipantFailureReason.EnterprisePstnInternalError:return 28;case r.ParticipantFailureReason.EnterprisePstnUnavailable:return 29;case r.ParticipantFailureReason.EnterprisePstnInvalidNumber:return 31;case r.ParticipantFailureReason.EnterprisePstnMiscError:return 32;case r.ParticipantFailureReason.Kicked:return 33;case r.ParticipantFailureReason.NetworkRequestTimeoutError:return 34;case r.ParticipantFailureReason.CallDoesNotExist:return 35;case r.ParticipantFailureReason.MediaSetupFailure:return 36;case r.ParticipantFailureReason.ServiceUnavailable:return 37;case r.ParticipantFailureReason.SignalingError:return 38;case r.ParticipantFailureReason.ConversationEstablishmentFailed:return 39;case r.ParticipantFailureReason.TemporarilyUnavailable:return 40;case r.ParticipantFailureReason.NetworkCannotConnectError:return 41;case r.ParticipantFailureReason.NoSignalingFromPeer:return 42;case r.ParticipantFailureReason.AnonymousJoinDisabledByPolicy:return 53;case r.ParticipantFailureReason.NoLobbyForBroadcastJoin:return 54;case r.ParticipantFailureReason.NotAllowedDueToInformationBarrier:return 55;case r.ParticipantFailureReason.BroadcastLimitReached:return 56;case r.ParticipantFailureReason.B2bJoinDisabledByPolicy:return 57;case r.ParticipantFailureReason.LocationBasedRoutingError:return 58;case r.ParticipantFailureReason.Forbidden:return 52;default:return 11}}t.convertVideoEffectType=function(e){switch(e){case 0:return r.VideoEffectType.Off;case 1:return r.VideoEffectType.BackgroundBlurDefault;case 2:return r.VideoEffectType.BackgroundBlurLight;case 4:return r.VideoEffectType.BackgroundBlurExperimental_1;case 8:return r.VideoEffectType.BackgroundBlurExperimental_2;case 16:return r.VideoEffectType.WhiteboardZoom;case 32:return r.VideoEffectType.WhiteboardCleanup;case 48:return r.VideoEffectType.WhiteboardZoomAndCleanup;default:return r.VideoEffectType.Off}},t.convertStatusAndFailureReasonToParticipantReason=function(e,t){switch(e){case r.CallStatus.Busy:return 19;case r.CallStatus.CallTimedOut:return 9;case r.CallStatus.Cancelled:return 23;case r.CallStatus.Dropped:return 10;case r.CallStatus.Refused:return 3;case r.CallStatus.Missed:return 2;case r.CallStatus.Failed:return i(t);default:return 0}},t.convertFailureReasonToParticipantReason=i},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},u=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var d=n(12),p=n(3),h=n(4),f=n(9),g=n(23),_=n(24),m=n(25),v=n(5),y=n(41),C=n(0),S=n(1),I=n(26),P=n(43),T=n(45),b=n(10),O=n(29),E=n(31),R=n(18),A=n(16),w=n(15),D=n(46),L=SlimCore.Enums,k=n(2),M=n(8),N=((i={})[0]=[1,2,11,8,6,9,10],i[1]=[2,6,7,10],i[2]=[1,3,6,7,9,10],i[11]=[12,1,2,6,7],i[3]=[4,5,6,7,10],i[12]=[2,6,7],i[6]=[7],i[7]=[],i[8]=[1,2,11,6,7,10],i[4]=[6,7,3,5,10],i[5]=[6,7,3,4,10],i[9]=[3,6,7,10],i[10]=[3,6,7,9,4,5],i),F=function(e){function t(t,n,r,i,o,a,s,l,c,u,d,h){var g,_=e.call(this,t.createChild(function(){var e=(_.endpointId||"").substr(0,8),t=(_.participantId||"").substr(0,8);return"Electron["+_.slimcoreCallId+":"+_.callId+"]["+e+"]["+t+"]["+_.state+"]"}),n,r)||this;_._slimcoreCallHandler=i,_._deviceManager=o,_._appHooks=a,_.threadId=s,_.callId=l,_.currentUserSkypeIdentity=c,_.participantId=u,_._telemetryService=d,_.participants=[],_.participantMap={},_.isMuted=!1,_.isSpeakerMuted=!1,_.isServerMuted=!1,_.isVideoOn=!1,_.isScreenSharingOn=!1,_.dominantSpeakerInfo={speakerList:[],timestamp:null},_.callStartedAt=null,_.callHeldAt=null,_.failureType=2,_.slimcoreCallId=0,_.isHostless=!0,_.callType=-1,_.isIncomingOneOnOneVideoCall=!1,_.contentSharingSessions=[],_.screenSharingControl=null,_.dataChannelAdapter=null,_.mediaStreams=((g={})[0]=[],g[1]=[],g),_._streamContextMap={},_._isAudioStreamConnected=!1,_._wasAudioStreamConnected=!1,_._callGotConnected=!1,_._enableGroupCallMeetupGeneration=!1,_._mediaPeerType=0,_._dataChannel=null,_._dataChannelUsers=[],_._isRelayWhiteListingIssue=!1,_._isOptimizedSpeakerEventingEnabled=!1,_._callIsSetupComplete=!1,_._transferState=0,_._parkState=0,_.tsCallingTelemetryReported=!1,_._videoRequestedOnWhileConnecting=!1,_._videoRequestedOffWhileConnecting=!1,_._callStartTime=(new Date).getTime(),_._state=0,_.isServerMuteUnmuteEnabled=function(){return!!_.endpoints&&p.some(_.endpoints.endpointDetails,function(e){return _.endpointId===e.endpointId&&(e.capabilities&&"enabled"===e.capabilities.serverMuteUnmute)})},_.isMuteDisabled=function(){return _.isMuted},_.isUnMuteDisabled=function(){return 1===_.callType?!_.isMuted:2===_.callType&&(_.isServerMuteUnmuteEnabled()?!_.isServerMuted&&!_.isMuted:!_.isMuted)},_.cleanUp=function(e){return _._logger.info("["+e+"][cleanup]start"),_._getCallEndOperation().then(function(){_._callOperationHandler.rejectPendingOperations(61),_._participantOperationHandler.rejectPendingOperations(47),_._callTelemetry.setTerminationState(_.state),_._callTelemetry.setTerminationReason(_.terminatedReason),_._reportTsCallingTelemetry(!_._callIsSetupComplete)}),_._cleanCallResources(e)},_._getCallEndOperation=function(){return _._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.STOP_CALL)?_._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.STOP_CALL):_._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.REJECT)?_._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.REJECT):Promise.resolve()},_._getFirstParticipantFailureReason=function(e){try{if(_.participants.length){var t=p.head(_.participants).getIntProperty(L.Property.ParticipantFailureReason);return e.info("participantFailureReason="+t),t}return void e.logFailure("no participants , can't query for participantFailureReason")}catch(e){return void _._logger.logFailure("participantFailureReason="+M.getPrintableObject(e))}},_._setTransferState=function(e,t){_.transferState!==e&&(_._logger.info("Transfer: state set: "+e),_._transferState=e,_._callTelemetry.recordEvent(f.CALL_OPERATIONS.SET_TRANSFER_STATE,{state:e},t),_.raiseChanged())},_._setParkState=function(e,t){_.parkState!==e&&(_._logger.info("Park: state set: "+e),_._parkState=e,_._callTelemetry.recordEvent(f.CALL_OPERATIONS.SET_PARK_STATE,{state:e},t),_.raiseChanged())},_._logger.info("constructor"),_.terminatedReason=0,_._setupCallTelemetry(),_._setParticipantId(_.participantId),_._setThreadId(_.threadId),_._setCallId(_.callId),_._setCallOrigin(0),_._setMessageId(h);try{_._setEndpointId(_._slimcoreInstance.getRegistrationId(_.currentUserSkypeIdentity.id))}catch(e){_._logger.warn("getRegistrationId is missing!")}return _.screenSharingControl=new D.default(_._logger,_._settings,_._slimcoreInstance,_.callId,_._appHooks.getControlInjector()),_.raiseRenderedAtViewer=_.raiseRenderedAtViewer.bind(_),_.screenSharingControl.setRaiseRenderedAtViewer(_.raiseRenderedAtViewer),_.dataChannelAdapter=new T.default(_._logger,_._slimcoreInstance),_._dataChannelUsers=[_.screenSharingControl,_.dataChannelAdapter],_._callOperationHandler=new m.default(_._logger,_._callTelemetry),_._participantOperationHandler=new m.default(_._logger,_._callTelemetry),_._slimcoreAttachedPromise=_._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.ELECTRON_SLIMCORE_READY),_._dataChannelCreatedPromise=_._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.ELECTRON_DATA_CHANNEL_CREATED),_._streamContextMap[0]=new A.SlimCoreElectronRemoteStreamContext(_._logger),_._streamContextMap[1]=new A.SlimCoreElectronRemoteStreamContext(_._logger),_}return o(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transferState",{get:function(){return this._transferState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parkState",{get:function(){return this._parkState},enumerable:!0,configurable:!0}),t.prototype.init=function(e){this._setMessageId(e.messageId),e.threadId&&this._setThreadId(e.threadId),this._meetingInfo=e.meetingInfo,this._enableGroupCallMeetupGeneration=!!e.enableGroupCallMeetupGeneration,e.transferContext&&(this._transferContext=e.transferContext.context,1===e.transferContext.transferType?this._setCallOrigin(2):0===e.transferContext.transferType&&this._setCallOrigin(1)),this._endpointMetadata=e.endpointMetadata,this.onBehalfOfMri=e.onBehalfOf,this._emergencyContent=e.emergencyContent,this._mediaPeerType=e.mediaPeerType,this.broadcastMeeting&&(this.broadcastMeeting.context=e.broadcastContext),this.raiseChanged()},t.prototype.join=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){var r;return u(this,function(i){return this.callerMri=C.stripMriAliases(e.groupCallInitiator),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.JOIN),t.muteFlags&&(r={muteMicrophone:!!(1&t.muteFlags),muteSpeaker:!!(2&t.muteFlags)},this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.JOIN_CALL,r,n)),this._callTelemetry.setPreheatFlags(t.preheatFlags),[2,this._joinOrStartCall({audioDirection:t.audioDirection,videoDirection:void 0!==t.videoDirection?t.videoDirection:t.withVideo?4:1,screenshareDirection:t.screenshareDirection,datachannelDirection:t.datachannelDirection,muteFlags:t.muteFlags,conversationUrl:e.conversationUrl,preheatFlags:t.preheatFlags,label:t.label,conversationType:e.conversationType,enableLightWeightMeeting:!1,maxVideoChannels:t.maxVideoChannels,negotiationTag:t.negotiationTag,scenario:C.mapToEmptyStrIfFalsy(t.scenario)},n)]})})},t.prototype.start=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r,i,o=this;return u(this,function(a){return n=this._logger.createFnLogger(f.CALL_OPERATIONS.START_CALL,t),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),e.muteFlags&&(r={muteMicrophone:!!(1&e.muteFlags),muteSpeaker:!!(2&e.muteFlags)},this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.START_CALL,r,t)),this._callTelemetry.setPreheatFlags(e.preheatFlags),this._transferContext?(n.info("Transfer: Starting transfered call."),this._transferContext.newCallObjectId?(this._setCallType(1),i=e.withVideo||4===e.videoDirection,[2,this._callOperationHandler.execute(function(){return o._startTransferTargetCall(o._transferContext.newCallObjectId,i,t)},f.CALL_OPERATIONS.START_TRANSFER_TARGET_CALL)]):[2,Promise.reject(new Error("Transfer: Transfered context is invalid. Missing callObjectId or newCallObjectId"))]):(e.withVideo&&(e.videoDirection=4),[2,this._joinOrStartCall({audioDirection:e.audioDirection,videoDirection:e.videoDirection,screenshareDirection:e.screenshareDirection,datachannelDirection:e.datachannelDirection,ringOthers:e.ringOthers,preheatFlags:e.preheatFlags,label:e.label,conversationType:e.isCast?"cast":"",enableLightWeightMeeting:!1,callKey:e.callKey,encryptedKey:e.encryptedKey,connectionType:e.connectionType,maxVideoChannels:e.maxVideoChannels,routingFlags:e.routingFlags,muteFlags:e.muteFlags,negotiationTag:e.negotiationTag,scenario:C.mapToEmptyStrIfFalsy(e.scenario)},t)])})})},t.prototype.startCallToVoicemail=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(n){return this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),[2,this._joinOrStartCall({callToVoicemail:!0,voicemailResourcePath:e.voicemailResourcePath,voicemailItemId:e.voicemailItemId},t)]})})},t.prototype.startCallWithNudge=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){var r;return u(this,function(i){return r=this._logger.createFnLogger(f.CALL_OPERATIONS.START_CALL_WITH_NUDGE,n),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),p.isEmpty(e)?(r.logFailure("No participants provided to nudge"),[2,Promise.reject(new Error("No participants provided to nudge"))]):[2,this._joinOrStartCall({audioDirection:t.audioDirection,videoDirection:void 0!==t.videoDirection?t.videoDirection:t.withVideo?4:1,screenshareDirection:t.screenshareDirection,datachannelDirection:t.datachannelDirection,ringOthers:!1,label:t.label,conversationType:t.isCast?"cast":"",enableLightWeightMeeting:!1,callKey:t.callKey,encryptedKey:t.encryptedKey,connectionType:t.connectionType,participantsToNudge:e,invitationType:L.InvitationType.Nudge,negotiationTag:t.negotiationTag,scenario:C.mapToEmptyStrIfFalsy(t.scenario)},n)]})})},t.prototype.startAndUnpark=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=k.default()),c(this,void 0,void 0,function(){var i,o;return u(this,function(a){return i=this._logger.createFnLogger(f.CALL_OPERATIONS.START_CALL_AND_UNPARK,r),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this._setCallType(1),n.withVideo&&(n.videoDirection=4),o=0===e?f.UNPARK_CODE.PARK:1===e?f.UNPARK_CODE.SHARED_LINE:f.UNPARK_CODE.SERVER_HOLD,this.addParticipant("4:"+o,void 0,r).catch(function(e){return i.logFailure("Failed to add participant to unparked call="+e)}),[2,this._joinOrStartCall({audioDirection:n.audioDirection,videoDirection:n.videoDirection,screenshareDirection:n.screenshareDirection,datachannelDirection:n.datachannelDirection,ringOthers:n.ringOthers,label:n.label,conversationType:n.isCast?"cast":"",enableLightWeightMeeting:!1,callKey:n.callKey,encryptedKey:n.encryptedKey,connectionType:n.connectionType,maxVideoChannels:n.maxVideoChannels,routingFlags:n.routingFlags,muteFlags:n.muteFlags,parkContext:e,pickupCode:t,scenario:C.mapToEmptyStrIfFalsy(n.scenario)},r)]})})},t.prototype.joinCallWithoutCallModality=function(e,n,r){return void 0===r&&(r=k.default()),c(this,void 0,void 0,function(){var i,o,a;return u(this,function(s){return(i=this._logger.createFnLogger(f.CALL_OPERATIONS.SUBSCRIBE,r)).info("joinCallWithoutCallModality: "+e.conversationUrl),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.SUBSCRIBE),0!==this.state?(i.logFailure("Trying to start a call that has already been acted on"),[2,Promise.reject(new Error("Trying to start a call that has already been acted on"))]):(o=this._getSlimCoreCallProperties({audioDirection:L.MediaDirection.Disabled,videoDirection:L.MediaDirection.Disabled,screenshareDirection:L.MediaDirection.Disabled,datachannelDirection:L.MediaDirection.Disabled,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:!1,isGoLive:!n.ringOthers,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:C.mapToEmptyStrIfFalsy(this.threadId),messageId:C.mapToEmptyStrIfFalsy(this.messageId),subject:C.mapToEmptyStrIfFalsy(n.label),conversationType:C.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:C.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:C.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:C.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:!1,emergencyContent:C.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:"",encryptedKey:"",invitationType:L.InvitationType.None,connectionType:L.ConnectionType.AllSupported,maxVideoChannels:void 0!==n.maxVideoChannels?n.maxVideoChannels:0,muteFlags:n.muteFlags,negotiationTag:C.mapToEmptyStrIfFalsy(n.negotiationTag),routingFlags:n.routingFlags,scenario:C.mapToEmptyStrIfFalsy(n.scenario)}),a=this._slimcoreCallHandler.subscribe(JSON.stringify({conversationUrl:e.conversationUrl,conversationId:this.callId,conversationType:e.conversationType}),o),this._setCallState(8,r),this.attachSlimCoreCallObject(a,r,!0),this._assertSlimcoreObjectId(this.slimcoreCallId,"joinCallWithoutCallModality"),C.hasFeature(L.Feature.ObservingStateSupported)?[2,this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.SUBSCRIBE,void 0,r)]:[2,Promise.resolve()])})})},t.prototype._assertSlimcoreObjectId=function(e,t){if(0===e)throw new Error(t+" Failed. Slimcore returned objectId of 0")},t.prototype.joinPreheatedCall=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r=this;return u(this,function(i){return n=this._logger.createFnLogger(f.CALL_OPERATIONS.JOIN_PREHEATED_CALL,t),11!==this.state&&12!==this.state?(n.logFailure("Trying to join a call that is not in preheating state"),[2,Promise.reject(new Error("Trying to join a call that is not in preheating state"))]):(1==(1&e.muteFlags)&&(n.info("isMuted set to true in joinPreheatedCall"),this.isMuted=!0),2==(2&e.muteFlags)&&(n.info("isSpeakerMuted set to true in joinPreheatedCall"),this.isSpeakerMuted=!0),this._setCallState(2,t),[2,this._slimcoreAttachedPromise.then(function(){return r._slimcoreCallHandler.joinPreheatedCall(r.slimcoreCallId,t,e.muteFlags)}).catch(function(e){throw r.stopInternal(t),n.logFailure(e),e})])})})},t.prototype.setVideoContainer=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){return u(this,function(r){return this._localVideoContainer=e,t&&(this._localVideoOptions=t),e?this.isVideoOn?[2,this.startVideoSafe(n)]:[2,Promise.resolve()]:[2,this.stopVideo(n)]})})},t.prototype.startVideoSafe=function(e){var t=this;return this.startVideo(e).catch(function(n){t._logger.createFnLogger(f.CALL_OPERATIONS.START_VIDEO,e).logFailure(n)})},t.prototype.startVideo=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r,i=this;return u(this,function(o){switch(o.label){case 0:return n=this._logger.createFnLogger(f.CALL_OPERATIONS.START_VIDEO,t),this.callStateCanToggleVideo()?[3,2]:(n.info("startVideo called but call is not in togglable state - starting preview only, video will start once available"),this._videoRequestedOnWhileConnecting=!0,this._videoRequestedOffWhileConnecting=!1,[4,this._startPreviewVideo(t)]);case 1:return o.sent(),this._setVideoOn(!0,t),[2];case 2:return r=Promise.resolve().then(function(){return Promise.all([i._startPreviewVideo(t),i._startLocalVideo(e,t)])}).then(function(){return i._setVideoOn(!0,t)}),[2,this._callOperationHandler.registerPromise(f.CALL_OPERATIONS.START_VIDEO,r).catch(function(n){throw i._callTelemetry.updateOperationData(f.CALL_OPERATIONS.START_VIDEO,{error:M.getPIISafeObject(n)},t),i._logger.logFailure(n),i.stopVideo(e,t),n})]}})})},t.prototype.stopVideo=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r,i,o=this;return u(this,function(a){return n=this._logger.createFnLogger(f.CALL_OPERATIONS.STOP_VIDEO,t),this.callStateCanToggleVideo()?(r=function(){o._localVideo&&(o._localVideo.dispose(t),o._localVideo=null),o._localVideoPreview&&(o._localVideoPreview.dispose(t),o._localVideoPreview=null),o._setVideoOn(!1,t)},i=Promise.resolve().then(function(){return c(o,void 0,void 0,function(){return u(this,function(r){switch(r.label){case 0:return this._localVideoPreview?[4,C.forgetAndLog(this._localVideoPreview.stop(t),n,"stopVideo: stopping localVideoPreview failed")]:[3,2];case 1:r.sent(),r.label=2;case 2:return this._localVideo?[4,C.forgetAndLog(this._localVideo.stop(t,e),n,"stopVideo: stopping localVideo failed")]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})}),[2,this._callOperationHandler.registerPromise(f.CALL_OPERATIONS.STOP_VIDEO,i).then(r,function(e){o._callTelemetry.updateOperationData(f.CALL_OPERATIONS.STOP_VIDEO,{error:M.getPIISafeObject(e)},t),n.logFailure(e),r()})]):(this._videoRequestedOnWhileConnecting?(n.info("stopVideo called but call is not in togglable state - video will stop once available"),this._videoRequestedOffWhileConnecting=!0):n.info("stopVideo called but call is not in togglable state - enabling video was not requested anyway, so ignoring"),[2,Promise.resolve()])})})},Object.defineProperty(t.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!0,configurable:!0}),t.prototype._setEndpointId=function(e){this._endpointId=e,this._callTelemetry.setEndpointId(e)},t.prototype._setFailureType=function(e){this._callTelemetry.setFailureType(e),this.failureType=e},t.prototype._setThreadId=function(e){this._logger.info("Set threadId:"+e),this.threadId=e,this._callTelemetry.setThreadId(e)},t.prototype._setMessageId=function(e){this._logger.info("Set messageId:"+e),this.messageId=e,this._callTelemetry.setMesageId(e)},t.prototype._setCallType=function(e){this._logger.info("Set callType:"+e),this.callType=e,this._callTelemetry.setCallType(e)},t.prototype._setCallOrigin=function(e){this._logger.info("Set origin:"+e),this._origin=e,this._callTelemetry.setCallOrigin(e)},t.prototype._setIsCast=function(e){this._logger.info("Set isCast:"+e),this.isCast=e,this._callTelemetry.setIsCast(e)},t.prototype._startPreviewVideo=function(e){var t=this,n=this._logger.createFnLogger("startPreviewVideo",e);return this._localVideoContainer?this._localVideoPreview&&this._localVideoPreview.isRendering?(n.logFailure("_startPreviewVideo skipping because it is already started"),Promise.resolve()):Promise.resolve().then(function(){return t.disposeLocalVideoRenderer()}).then(function(){return t._localVideoPreview=new R.default(t._logger,t._settings,t._slimcoreInstance,t._localVideoContainer,t._deviceManager,L.VideoType.Video,t._localVideoOptions),t._localVideoPreview.startVideoAsync(e)}):(n.logFailure("_startPreviewVideo can not start without container"),Promise.resolve())},t.prototype._startLocalVideo=function(e,t){var n=this;return this._localVideo||(this._localVideo=new E.default(this._logger,this._settings,this._slimcoreInstance,this,this.slimcoreCallId,this._slimcoreCallHandler,this._deviceManager),this._localVideo.changed(function(){return n._localVideoChanged()})),this._localVideo.start(t,e)},t.prototype.setVideoEffects=function(e){return c(this,void 0,void 0,function(){var t=this;return u(this,function(n){return this._localVideo?[2,this._localVideo.setVideoEffects(b.convertVideoEffectType(e))]:[2,Promise.resolve().then(function(){t._slimcoreInstance.setDefaultStartingVideoEffects?t._slimcoreInstance.setDefaultStartingVideoEffects(b.convertVideoEffectType(e)):t._logger.warn("setDefaultStartingVideoEffects is not available")}).catch(function(e){throw t._logger.error("Failed to set Video Effects, Error = "+e),e})]})})},t.prototype.getVideoEffectsCapability=function(){return c(this,void 0,void 0,function(){return u(this,function(e){return this._localVideo?[2,this._localVideo.getVideoEffectsCapability()]:[2,Promise.reject(new Error("Cannot query effects when there is no local video"))]})})},t.prototype.dumpVideoSourceImages=function(){return c(this,void 0,void 0,function(){return u(this,function(e){return this._localVideo?[2,this._localVideo.dumpVideoSourceImages()]:[2,Promise.reject(new Error("Cannot dump video effects debug images when there is no local video"))]})})},t.prototype.startScreenSharing=function(e,t,n,r){return void 0===r&&(r=k.default()),c(this,void 0,void 0,function(){var i,o=this;return u(this,function(a){return this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForViewer(),i=Promise.resolve().then(function(){o._localScreenShareStream||(o._localScreenShareStream=new O.default(o._logger,o._settings,o._slimcoreInstance,o.slimcoreCallId,o._slimcoreCallHandler,o._deviceManager,o._appHooks,o.screenSharingControl),o._localScreenShareStream.changed(function(){return o._onLocalScreenShareStreamChanged(r)}),o._localScreenShareStream.on("sharingSourceLost",function(){return o._onLocalScreenShareSourceLost()}),o._localScreenShareStream.on("windowClosed",function(){return o.stopScreenSharing(!1,n,r)}),o._localScreenShareStream.on("scraperEvent",function(e){return o._onScraperEvent(e)}))}).then(function(){return o._localScreenShareStream.start(r,e,t,n)}),[2,this._callOperationHandler.registerPromise(f.CALL_OPERATIONS.ELECTRON_START_SCREEN_SHARING,i)]})})},t.prototype.changeCropRegion=function(e){this._localScreenShareStream&&this._localScreenShareStream.changeCropRegion(e)},t.prototype._onLocalScreenShareSourceLost=function(){this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForSharer(),this._localScreenShareStream.isStreaming&&this.event("sharingDropped").raise()},t.prototype._onScraperEvent=function(e){var t={event:e.event,data:e.data};this.event("scraperEvent").raise(t)},t.prototype.raiseRenderedAtViewer=function(e){this.event("sharingRenderedAtViewer").raise(e)},t.prototype._onLocalScreenShareStreamChanged=function(e){this._localScreenShareStream.isStreaming?(!this.isScreenSharingOn&&this._dataChannel&&this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&(this.screenSharingControl.initControlForSharer(),this._dataChannel.start()),this._setScreenSharingOn(!0,e)):this._localScreenShareStream.isAvailable||(this.isScreenSharingOn&&this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForSharer(),this._setScreenSharingOn(!1,e))},t.prototype.stopScreenSharing=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){var e,r,i,o=this;return u(this,function(a){return e=this._logger.createFnLogger(f.CALL_OPERATIONS.STOP_SCREEN_SHARING,n),r=function(){o._localScreenShareStream&&(o._localScreenShareStream.dispose(n),o._localScreenShareStream=null),o._setScreenSharingOn(!1,n),o.screenSharingControl&&o.screenSharingControl.isScreenSharingControlEnabled()&&o.screenSharingControl.shutdownControlForSharer()},i=Promise.resolve().then(function(){return c(o,void 0,void 0,function(){return u(this,function(r){switch(r.label){case 0:return this._localScreenShareStream?[4,C.forgetAndLog(this._localScreenShareStream.stop(n,t),e,"stopScreenSharing: stopping screen sharing failed")]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}),[2,this._callOperationHandler.registerPromise(f.CALL_OPERATIONS.ELECTRON_START_SCREEN_SHARING,i).then(r,function(t){throw e.logFailure(t),r(),t})]})})},t.prototype.startDataChannel=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.start(e)]}})})},t.prototype.stopDataChannel=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.stop(e)]}})})},t.prototype.shareSystemSound=function(e){return c(this,void 0,void 0,function(){var t=this;return u(this,function(n){return this._logger.info("shareSystemSound: "+e),[2,Promise.resolve().then(function(){t._slimcoreCallHandler.callShareSystemSound(t.slimcoreCallId,e)})]})})},t.prototype.transferCall=function(e){return this._logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)},t.prototype.callBlindTransfer=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n;return u(this,function(r){return n={transferTarget:e,transferStatusSuccessList:[L.CallStatus.Transferring,L.CallStatus.Transferred]},[2,this._transferCall(n,t)]})})},t.prototype.callSafeTransfer=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n;return u(this,function(r){return n={transferTarget:e,transferStatusSuccessList:[L.CallStatus.Transferred]},[2,this._transferCall(n,t)]})})},t.prototype.callConsultativeTransfer=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n;return u(this,function(r){return n={targetCallId:e.slimcoreCallId,transferStatusSuccessList:[L.CallStatus.Transferred]},[2,this._transferCall(n,t)]})})},t.prototype._transferCall=function(e,t){return c(this,void 0,void 0,function(){var n;return u(this,function(r){switch(r.label){case 0:return this._logger.createFnLogger("Transfer",t).info("start"),this._setTransferState(1,t),n=this._waitForTransferSuccessOrFailure(e.transferStatusSuccessList,0,t),[4,this._slimcoreAttachedPromise];case 1:if(r.sent(),e.transferTarget)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget);else{if(!e.targetCallId)return[2,Promise.reject(new Error("Either transferTarget/transfereeCallId should be present"))];this._slimcoreCallHandler.startConsultativeCallTransfer(e.targetCallId,this.slimcoreCallId)}return[2,n]}})})},t.prototype.park=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r,i=this;return u(this,function(o){switch(o.label){case 0:return n={context:e,parkStatusSuccessList:[L.CallStatus.Parked]},this._setParkState(1,t),this._parkCompletePromise=this._waitForTransferSuccessOrFailure(n.parkStatusSuccessList,1,t),(r=this.mapParkContext(n.context))===L.ParkContext.Invalid?[2,Promise.reject(32)]:[4,this._slimcoreAttachedPromise];case 1:return o.sent(),this._slimcoreCallHandler.startCallPark(this.slimcoreCallId,r),[2,this._parkCompletePromise.then(function(){try{var e=i.getStrProperty(L.Property.CallParkPickupCode);return i._serverHoldLocation=i.getStrProperty(L.Property.CallServerHoldLocation),Promise.resolve(e)}catch(e){return Promise.reject(32)}})]}})})},t.prototype.getServerHoldLocation=function(){return c(this,void 0,void 0,function(){var e=this;return u(this,function(t){return[2,this._parkCompletePromise.then(function(){return e._logger.info("getServerHoldLocation="+e._serverHoldLocation),Promise.resolve(e._serverHoldLocation)})]})})},t.prototype.mapParkContext=function(e){switch(e){case 0:return L.ParkContext.Team;case 1:return L.ParkContext.Sharedline;case 2:return L.ParkContext.Serverhold;default:return L.ParkContext.Invalid}},t.prototype._waitForTransferSuccessOrFailure=function(e,n,r){var i=this,o=this._logger.createFnLogger("WaitForTransfer",r);o.info("successStatusList="+e+", type="+n);var a=this._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS,void 0,r),s=0===n?L.Property.CallTransferStatus:L.Property.CallParkStatus,l=0===n?L.Property.CallTransferFailureReason:L.Property.CallParkFailureReason,c=this._slimcoreInstance.handle("object-property-changed",{objectId:this.slimcoreCallId,propKey:s},function(n){return function(n){if(o.info("status changed: "+n+" ("+L.CallStatus[n]+")"),-1!==e.indexOf(n)||n===L.CallStatus.Failed)if(c&&(c.dispose(),c=null),-1!==e.indexOf(n))i._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS,1);else{var a=i.getIntProperty(l);i._callTelemetry.updateOperationData(f.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS,{error:M.getPIISafeObject(a)},r),o.logFailure(a);var s=t.convertParticipantReasonToTerminatedReason(b.convertFailureReasonToParticipantReason(a));o.logFailure(s),i._callOperationHandler.rejectOperation(f.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS,s)}}(n.value)});return a},t.prototype.mute=function(e){return void 0===e&&(e=k.default()),c(this,void 0,void 0,function(){return u(this,function(t){return this.isMuteDisabled()?[2,Promise.reject(new Error("Cannot mute when already locally muted"))]:[2,this._muteUnmute(!0,e)]})})},t.prototype.unmute=function(e){return void 0===e&&(e=k.default()),c(this,void 0,void 0,function(){return u(this,function(t){return this.isUnMuteDisabled()?[2,Promise.reject(new Error("Cannot unmute when already locally and server unmuted"))]:[2,this._muteUnmute(!1,e)]})})},t.prototype.muteSpeaker=function(e){return void 0===e&&(e=k.default()),c(this,void 0,void 0,function(){return u(this,function(t){return this.isSpeakerMuted?[2,Promise.reject(new Error("Cannot mute speaker when already muted"))]:[2,this._muteUnmuteSpeaker(!0,e)]})})},t.prototype.unmuteSpeaker=function(e){return void 0===e&&(e=k.default()),c(this,void 0,void 0,function(){return u(this,function(t){return this.isSpeakerMuted?[2,this._muteUnmuteSpeaker(!1,e)]:[2,Promise.reject(new Error("Cannot unmute speaker when already unmuted"))]})})},t.prototype.muteParticipants=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){return u(this,function(r){return[2,this._muteParticipants(e,t,n)]})})},t.prototype.hold=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(n){return[2,this._holdUnhold(!0,t,e)]})})},t.prototype.unhold=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(n){return[2,this._holdUnhold(!1,t,e)]})})},t.prototype.updateEndpointMetadata=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(n){return 3!==this.state?(this._logger.warn("Trying to updateEndpointMetadata in a call which is not connected, callId = "+this.callId),[2,Promise.reject(new Error("cannot updateEndpointMetadata in a call which is not connected"))]):(this._endpointMetadata=e,[2,this._updateEndpointMetadata(this._endpointMetadata,t)])})})},t.prototype.sendDtmfTone=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(n){return this._logger.info("DTMF tone <omitted>"),[2,this._sendDtmfTone(e,t)]})})},t.prototype.setAudioUsageMode=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){return u(this,function(n){return[2,this._setAudioUsageMode(e,t)]})})},t.prototype.getTechnicalInformationJson=function(){return c(this,void 0,void 0,function(){var e=this;return u(this,function(t){return[2,Promise.resolve().then(function(){try{return e._slimcoreCallHandler.callGetTechnicalInformationJson(e.slimcoreCallId)}catch(t){throw e._logger.error("Error in callGetTechnicalInformationJson callId: "+e.callId+", error: "+t),t}})]})})},t.prototype.startAudio=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n;return u(this,function(r){return n=this._logger.createFnLogger(f.CALL_OPERATIONS.START_AUDIO,t),3!==this.state?(n.logFailure("cannot startAudio when call is not connected"),[2,Promise.reject(60)]):(this._slimcoreCallHandler.callStartAudio(this.slimcoreCallId,e),[2,this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.START_AUDIO,void 0,t)])})})},t.prototype.stopAudio=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n;return u(this,function(r){return n=this._logger.createFnLogger(f.CALL_OPERATIONS.STOP_AUDIO,t),3!==this.state?(n.logFailure("cannot stopAudio when call is not connected"),[2,Promise.reject(60)]):(this._slimcoreCallHandler.callStopAudio(this.slimcoreCallId,e),[2,this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.STOP_AUDIO,void 0,t)])})})},t.prototype.assimilate=function(e,t,n,r){return void 0===r&&(r=k.default()),c(this,void 0,void 0,function(){return u(this,function(i){return this._logger.createFnLogger(f.CALL_OPERATIONS.ASSIMILATE,r).info("assimilate: "+e.callId+" threadId: "+t+", messageId: "+n+", causeId: "+r),this._slimcoreCallHandler.callAssimilate(this.slimcoreCallId,e.slimcoreCallId,t,n),[2,Promise.resolve({code:0})]})})},t.prototype._onMediaNegotiationStatusChanged=function(e){var t=k.default();if(this._logger.createFnLogger("onMediaNegotiationStatusChanged",t).info("_onMediaNegotiationStatusChanged modalityType: "+e.modalityType+"\n            mediaNegotiationStatusCode: "+e.mediaNegotiationStatusCode),e.modalityType===L.ModalityType.Audio){var n=this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.START_AUDIO)?f.CALL_OPERATIONS.START_AUDIO:f.CALL_OPERATIONS.STOP_AUDIO;this._callOperationHandler.hasPendingOperation(n)&&(e.mediaNegotiationStatusCode===L.MediaNegotiationStatusCode.Succeeded?this._callOperationHandler.resolveOperation(n,e.mediaNegotiationStatusCode,void 0,t):this._callOperationHandler.rejectOperation(n,e.mediaNegotiationStatusCode,void 0,t))}},t.prototype.stop=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=k.default());var n=this._logger.createFnLogger(f.CALL_OPERATIONS.STOP_CALL,t);return 6===this.state?(n.logFailure("Trying to stop a call which is already Disconnecting, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnecting state"))):7===this.state?(n.logFailure("Trying to stop a call which is already Disconnected, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnected state"))):this.stopInternal(t,void 0,e)},t.prototype.reject=function(e){return void 0===e&&(e=k.default()),1!==this.state?Promise.reject(60):this.stopInternal(e)},t.prototype.stopInternal=function(e,t,n){var r=this;void 0===t&&(t=0),void 0===n&&(n=!1);var i=this._logger.createFnLogger("stopInternal",e);return 6===this.state?(i.info("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise):7===this.state?(i.info("Trying to stop a call which is already Disconnected"),this.disconnectingPromise):(this._setCallState(6,e,t),this.disconnectingPromise=Promise.resolve().then(function(){return i.info("Leaving from call"),r._leaveSlimCoreCall(n,e)}).catch(function(t){throw r._callTelemetry.updateOperationData(f.CALL_OPERATIONS.STOP_CALL,{error:M.getPIISafeObject(t)},e),i.logFailure(t),r._setCallState(7,e,t),t}),this.disconnectingPromise)},t.prototype._leaveSlimCoreCall=function(e,t){var n=this,r=this._logger.createFnLogger("leaveSlimCoreCall",t);if(r.info("forEveryone: "+e),0===this.slimcoreCallId)return r.logFailure("slimcoreCallId == 0"),Promise.reject(46);var i=this._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.CALL_ENDED);return Promise.resolve().then(function(){e?n._slimcoreCallHandler.endCallForAll(n.slimcoreCallId):n._slimcoreCallHandler.leaveCall(n.slimcoreCallId)}).then(function(){return r.info("Waiting for SlimCore to end call")}).then(function(){return i}).then(function(){r.info("SlimCore ended the call")},function(e){return r.logFailure("Error in leaveSlimCoreCall().. ignoring, error = "+M.getPrintableObject(e)+", reason = 25"),Promise.reject(25)})},t.prototype.acknowledge=function(e,n){var r=this;void 0===n&&(n=k.default());var i=this._logger.createFnLogger(f.CALL_OPERATIONS.ACKNOWLEDGE,n);if(0!==this.state&&8!==this.state)return Promise.reject(new Error("Trying to acknowledge a call that has already been acted on"));this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLEE);var o={callId:e.convoCallId,callerId:e.callerId,launchTime:e.launchTime.toString(),pushReceivedTime:e.pushReceivedTime.toString(),registrationId:e.registrationId,participantId:e.participantId},a=this._slimcoreInstance.handlePushNotification({eventType:e.body.evt,servicePayload:e.body.gp,correlationIdsJson:JSON.stringify(o),callKey:e.callKey,connectionType:t.convertConnectionType(e.connectionType),accountIdentity:this.currentUserSkypeIdentity.id}),s=[],l=this._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_HANDLE_PUSH,void 0,n);s.push(this._slimcoreInstance.handle("push-handling-complete",{token:a},function(e){if(e.token===a)if(i.info("HandlePushNotification: Received event for token: "+e.token+" result: "+e.result),e.result===L.PushHandlingResult.CallSetupSucceeded)i.logSuccess("HandlePushNotification: Succeeded"),r._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_HANDLE_PUSH,{code:1,success:!0},void 0,n).catch(function(e){i.logFailure("HandlePushNotification: Failed "+e)});else if(e.result===L.PushHandlingResult.CallSetupProgress)i.info("HandlePushNotification: In progress, keep waiting...");else{var o="HandlePushNotification: Failed "+e.result;i.logFailure(o),r._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_HANDLE_PUSH,t.convertPushHandlingResult(e.result),void 0,n).catch(function(e){i.logFailure("HandlePushNotification: Failed "+e)})}else i.logFailure("HandlePushNotification: Received unexpected token "+e.token+" (expected "+a+")")}));var c=this._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_RINGING);s.push(this._slimcoreInstance.handle("object-property-changed",{objectType:L.ObjectType.Call},function(e){var t=r._getStrProperty(r._slimcoreCallHandler,e.objectId,L.Property.CallName),o=r._getIntProperty(r._slimcoreCallHandler,e.objectId,L.Property.CallStatus);t===r.callId?o===L.CallStatus.RingingIn&&(r.attachSlimCoreCallObject(e.objectId,n),r._assertSlimcoreObjectId(r.slimcoreCallId,"acknowledge"),r._fillIncomingCallProperties(),r._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_RINGING)&&r._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_RINGING,void 0,void 0,n).then(function(){i.logSuccess("Reached ringing/active state for call pending acknowledgement")},function(e){i.logFailure("Reached ringing/active state for call pending acknowledgement "+e)}),r.raiseChanged()):i.info("Ignoring SlimCore event for incorrect call "+e.objectId+"/"+t)}));var u=function(){return p.each(s,function(e){return e.dispose()})},d=function(e){r._callOperationHandler.maybeRejectOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_RINGING,e,void 0,n),r._callOperationHandler.maybeRejectOperation(f.CALL_OPERATIONS.ELECTRON_WAIT_FOR_HANDLE_PUSH,e,void 0,n)};return l.then(function(e){return e.success?c.then(function(){return r._setCallState(1,n),e}):(d(e),e)}).then(function(e){return i.logSuccess("Acknowledge done"),u(),e},function(e){throw i.logFailure(e),u(),d(e),e})},t.prototype.accept=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r,i;return u(this,function(o){switch(o.label){case 0:(n=this._logger.createFnLogger(f.CALL_OPERATIONS.ACCEPT,t)).info("accept, answerMediaType: "+e.answerMediaType+",\n                            withVideo: "+e.withVideo+",\n                            muted: "+e.muted),e.muted&&n.logFailure("Accepting call muted is not implemented"),this._setCallState(2,t),r=this._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.CONNECT_CALL,void 0,t),o.label=1;case 1:return o.trys.push([1,5,,6]),this._acceptCall(e,t),this._updateCallType(this.getIntProperty(L.Property.CallIsConference),t),1!==e.answerMediaType?[3,3]:(n.info("Call has been answered - turning on video"),[4,this.startVideoSafe(t)]);case 2:o.sent(),o.label=3;case 3:return[4,r];case 4:return o.sent(),this._setCallState(3,t),[3,6];case 5:throw i=o.sent(),this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.ACCEPT,{error:M.getPIISafeObject(i)},t),this.stopInternal(t),this._logger.error("Error in accept(), callId = "+this.callId+", error = "+i),i;case 6:return[2]}})})},t.prototype._acceptCall=function(e,n){try{e.withVideo&&(e.answerMediaType=1),this._slimcoreCallHandler.acceptCall(this.slimcoreCallId,t.toAnswerMediaType(e.answerMediaType))}catch(t){this._logger.info("acceptCall is missing from the slimcore electron module: "+t),1===e.answerMediaType&&(e.withVideo=!0),this._slimcoreCallHandler.answerCall(this.slimcoreCallId,e.withVideo)}},t.prototype.reconnect=function(){return Promise.reject(new Error("Retargeting is not supported"))},t.prototype.provideCallQualityFeedback=function(e,t,n,r){var i=this;return this._logger.info("provideCallQualityFeedback"),Promise.resolve().then(function(){try{i._slimcoreCallHandler.provideCallQualityFeedback(i.callId,i.participantId,e,t,n,r)}catch(e){throw i._logger.error("Error in provideCallQualityFeedback callId: "+i.callId+", error: "+e),e}})},t.prototype._onCallOriginChanged=function(e){e===L.OriginType.Transfer?this._setCallOrigin(1):e===L.OriginType.Park?this._setCallOrigin(2):e===L.OriginType.Unspecified?this._setCallOrigin(0):this._logger.info("Unknown origin")},t.prototype._onCallMutedUnmuted=function(e){var t=10===this.state;this._logger.info("onCallMutedUnmuted current: "+this.isMuted+" new: "+e),this._logger.info("onCallMutedUnmuted isServerMuted: "+this.isServerMuted+" inLobby: "+t),this.isServerMuted&&!t||e||(this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNMUTE)),e&&(this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNMUTE)),this.isMuted!==e&&(this._logger.info("isMuted set to "+e+" in _onCallMutedUnmuted"),this.isMuted=e,this._logger.info("onCallMutedUnmuted isMuted: "+this.isMuted),this.raiseChanged())},t.prototype._onCallMutedUnmutedSpeaker=function(e,t){void 0===t&&(t=k.default()),this._logger.createFnLogger("onCallMutedUnmutedSpeaker",t).info("current: "+this.isSpeakerMuted+" new: "+e),e?this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.MUTE_SPEAKER,void 0,void 0,t):this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNMUTE_SPEAKER,void 0,void 0,t),this._setMutedSpeaker(e,t)},t.prototype._onCallIsServerMuted=function(e,t){void 0===t&&(t=k.default()),this._logger.info("_onCallIsServerMuted "+e),e!==this.isServerMuted&&(this.isServerMuted=e,this._callTelemetry.recordEvent(f.PARTICIPANT_OPERATIONS.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted},t),this.event("serverMutedChanged").raise(e),this.raiseChanged())},t.prototype._getCallParticipantMriMap=function(){for(var e={},t=this._slimcoreCallHandler.callGetParticipants(this.slimcoreCallId)||[],n={},r=0,i=t;r<i.length;r++){var o=i[r];n[o]={objectId:o,propKey:L.Property.ParticipantMriIdentity}}for(var a=this._getProperties(this._slimcoreCallHandler,0,n,{}),s=0,l=t;s<l.length;s++){var c=l[s],u=a[c];u&&(e[u]=c)}return e},t.prototype._getParticipantsData=function(e){for(var t={},n={},r={},i=function(e,t){return e+"_"+t},o=0,a=e;o<a.length;o++){for(var s=a[o],l=0,c=Object.keys(I.participantStrProps);l<c.length;l++){var u=c[l];t[i(s.objectId,u)]={objectId:s.objectId,propKey:I.participantStrProps[u].propKey,fallback:I.participantStrProps[u].fallback}}for(var d=0,p=Object.keys(I.participantIntProps);d<p.length;d++){u=p[d];n[i(s.objectId,u)]={objectId:s.objectId,propKey:I.participantIntProps[u].propKey,fallback:I.participantIntProps[u].fallback}}r[s.objectId]=s.mri}var h={};if(e.length)for(var f=this._getProperties(this._slimcoreCallHandler,0,t,n),g=0,_=Object.keys(f);g<_.length;g++){var m=_[g],v=m.split("_"),y=v[0],C=v[1];h[y]||(h[y]={objectId:Number(y),mri:r[y],props:{}}),h[y].props[C]=f[m]}for(var S=[],P=0,T=Object.keys(h);P<T.length;P++){y=T[P];S.push(h[y])}return S},t.prototype._callGetParticipantsData=function(e,t){var n=this._getCallParticipantMriMap(),r=[],i=[];this._logger.info("["+t+"]onParticipantJoinedOrRemoved # of participants in roster="+n.length);e.forEach(function(e){var t;t=e,n.hasOwnProperty(t.mri)?!function(e){return e.objectId}(e)?(r.push(e),delete n[e.objectId]):function(e){return e.objectId===n[e.mri]}(e)||i.push(e):i.push(e)}),Object.keys(n).forEach(function(e){return r.push({mri:e,objectId:n[e]})});return{newParticipantsData:this._settings.enableParticipantsGetPropsAggregation?this._getParticipantsData(r):r,participantsToRemove:i}},t.prototype._onParticipantJoinedOrRemoved=function(e){var t=this,n=this._callGetParticipantsData(this.participants.map(function(e){return{objectId:e.slimcoreObjectId,mri:e.id}}),e),r=n.newParticipantsData;n.participantsToRemove.forEach(function(n){return t._handleParticipantRemoved(n.mri,e,t.participantMap[n.mri].stateReason)}),Object.keys(r).forEach(function(n){return t._handleParticipantJoined(r[n],e)})},t.prototype._updateDominantSpeakerList=function(){var e=this;if(this._isOptimizedSpeakerEventingEnabled)return{fullOrderMatches:!0,topSpeakerMatches:!1};var t=p.map(p.sortBy(p.map(p.filter(this.participants,function(e){return 3===e.state}),function(t){return{mri:t.id,rank:t.dominantSpeakerRank?t.dominantSpeakerRank:e.participants.length+1}}),"rank"),function(e){return e.mri}),n=p.isEqual(this.dominantSpeakerInfo.speakerList,t),r=n;return r||(r=!p.isEmpty(this.dominantSpeakerInfo.speakerList)&&!p.isEmpty(t)&&p.head(this.dominantSpeakerInfo.speakerList)===p.head(t)),this.dominantSpeakerInfo={speakerList:t,timestamp:new Date},n||this._logger.info("_updateDominantSpeakerList: "+this.dominantSpeakerInfo.speakerList.length),{fullOrderMatches:n,topSpeakerMatches:r}},t.prototype._handleParticipantRemoved=function(e,t,n){void 0===n&&(n=0);var r=this._logger.createFnLogger("handleParticipantRemoved",t);r.info("reason="+n),this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.handleParticipantRemoved(e);var i=this._removeParticipantEntry(e);i?(i.setState(4,t,n),this._participantOperationHandler.maybeRejectOperation(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n,e),this._participantOperationHandler.maybeResolveOperation(f.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,e),i.rejectAdmitParticipantDeferred(n),i.dispose(),this._updateDominantSpeakerList(),this.event("participantRemoved").raise(i),this.raiseChangedDeferred()):r.logFailure("unable to remove participant")},t.prototype._handleParticipantJoined=function(e,t){var n=this;this._logger.debug("["+t+"]handleParticipantJoined: "+v.scrubMriOrOmit(e.mri));var r=this._getOrCreateParticipant(e.mri,t,e.objectId,e);if(I.default.isParticipantActive(r.state)&&this._participantOperationHandler.hasPendingOperation(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)){this._participantOperationHandler.resolveOperation(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,r,e.mri),this._callTelemetry.recordOperationSuccess(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,null,e.mri);this._callTelemetry.recordOperationSuccess(f.PARTICIPANT_OPERATIONS.PARTICIPANT_JOINED,g.getEndpointInformationForTelemetry(function(e){return e&&e.endpoints&&e.endpoints.endpointDetails||[]}(r)),e.mri,t)}this._handleParticipantJoinedDefer||(this._handleParticipantJoinedDefer=p.defer(function(){delete n._handleParticipantJoinedDefer,n._updateDominantSpeakerList().fullOrderMatches||n.raiseChangedDeferred()}))},t.prototype._admitParticipantToSlimCoreElectronCall=function(e){var t=[e];return this._slimcoreCallHandler.admitParticipants(this.slimcoreCallId,t),Promise.resolve()},t.prototype.admitParticipant=function(e,t){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var n,r,i,o;return u(this,function(a){return(n=this._logger.createFnLogger(f.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,t)).info("participantId = "+v.scrubMriOrOmit(e)),0===this.slimcoreCallId?[2,Promise.reject(8)]:7!==(r=this._getOrCreateParticipant(e,t)).state?[2,Promise.reject(43)]:(i=h.defer(),o=this._admitParticipantToSlimCoreElectronCall(e).then(function(){return r.addAdmitParticipantDeferred(i)}).then(function(){return i.promise}).then(function(){return n.logSuccess("admitted")}).catch(function(e){return n.logFailure(e),Promise.reject(e)}),this.raiseChanged(),[2,o])})})},t.prototype._addParticipantToSlimCoreElectronCall=function(e,t,n,r){this._logger.info("addParticipantToSlimCoreElectronCall: participantId = "+v.scrubMriOrOmit(e)+" threadId = "+t+" messageId = "+n+" participantInvitationData = "+v.scrubMriOrOmit(r));var i=this._slimcoreCallHandler.addParticipant(this.slimcoreCallId,e,C.mapToEmptyStrIfFalsy(t),C.mapToEmptyStrIfFalsy(n),C.mapToEmptyStrIfFalsy(r));return 0===i?Promise.reject(new Error("AddParticipant call to slimcore failed")):Promise.resolve(i)},t.prototype.generateAliasedMri=function(e,t){var n=e;return t&&(n+=C.MRI_ALIAS_PREFIX+C.MRI_SIP_PREFIX+t),n},t.prototype.callMeBack=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){var r,i,o,a=this;return u(this,function(s){return(r=this._logger.createFnLogger(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n)).info("callMeBack: participantMri = "+v.scrubMriOrOmit(e)+" assertedMri = "+v.scrubMriOrOmit(t)),0===this.slimcoreCallId?(r.logFailure("call is not initialized yet"),[2,Promise.reject(new Error("call is not initialized yet"))]):(i=this._participantOperationHandler.waitForOperation(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),o=this.generateAliasedMri(C.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri),[2,Promise.resolve().then(function(){return a._slimcoreCallHandler.callMeBack(a.slimcoreCallId,e,t||o),i}).catch(function(t){throw a._callTelemetry.updateOperationData(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,{error:M.getPIISafeObject(t)},n,e),a._participantOperationHandler.rejectOperation(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,1,e,n),r.logFailure("Error in callMeBack(), callId = "+a.callId+", error = "+t),t})])})})},t.prototype.nudgeParticipants=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=k.default()),c(this,void 0,void 0,function(){var i,o,a,s=this;return u(this,function(l){if((i=this._logger.createFnLogger(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,r)).info("nudgeParticipants: context = "+e),2!==this.state&&3!==this.state)return[2,Promise.reject(48)];if(0===this.slimcoreCallId)return[2,Promise.reject(new Error("call is not initialized yet"))];if(n.sipUri)return[2,Promise.reject(new Error("sipUri not supported yet"))];if(n.participantInvitationData)try{o=JSON.stringify(n.participantInvitationData)}catch(e){return i.logFailure(e),[2,Promise.reject(e)]}return i.info("nudgeParticipants: context = "+e+" threadId = "+n.threadId+" messageId = "+n.messageId+" participantInvitationData = "+v.scrubMriOrOmit(o)),a=this._participantOperationHandler.waitForOperation(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e),[2,Promise.resolve().then(function(){return s._slimcoreCallHandler.nudgeParticipants(s.slimcoreCallId,t,C.mapToEmptyStrIfFalsy(e),C.mapToEmptyStrIfFalsy(n.threadId),C.mapToEmptyStrIfFalsy(n.messageId),C.mapToEmptyStrIfFalsy(o)),a}).catch(function(t){throw s._callTelemetry.updateOperationData(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,{error:M.getPIISafeObject(t)},r,e),s._participantOperationHandler.rejectOperation(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,38,e,r),i.logFailure("Error in NudgeParticipants(), callId = "+s.callId+", context = "+e+", error = "+t),t})]})})},t.prototype.updateMeetingRoles=function(e,t,n){return void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){var r,i,o=this;return u(this,function(a){return(r=this._logger.createFnLogger(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n)).info("updateMeetingRole: participants = "+v.scrubMriOrOmitList(e)+", role = "+t),2!==this.state&&3!==this.state||!C.hasFeature(L.Feature.StructuredMeetings)?[2,Promise.reject({code:y.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:y.CONSTANTS.SUB_CODE.ACTION_NOT_ALLOWED,phrase:"ActionNotAllowed"})]:(i=this._participantOperationHandler.waitForOperation(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n),[2,this._slimcoreAttachedPromise.then(function(){return o._slimcoreCallHandler.updateMeetingRoles(o.slimcoreCallId,e,t,n),i}).catch(function(e){throw r.logFailure("Error in UpdateMeetingRoles(), callId = "+o.callId+", error = "+e),o._callTelemetry.updateOperationData(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,{error:M.getPIISafeObject(e)},n),o._participantOperationHandler.rejectOperation(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,38,n,n),e})])})})},t.prototype.addParticipant=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=k.default()),c(this,void 0,void 0,function(){var r,i,o,a,s,l=this;return u(this,function(c){if(r=this._logger.createFnLogger(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n),t.sipUri&&r.logFailure("sipUri not supported yet"),t.participantInvitationData)try{i=JSON.stringify(t.participantInvitationData)}catch(e){throw r.logFailure(e),e}return r.info("participantId = "+v.scrubMriOrOmit(e)+" threadId = "+t.threadId+" messageId = "+t.messageId+" participantInvitationData = "+v.scrubMriOrOmit(i)),o=this._getOrCreateParticipant(e,n),0===this.slimcoreCallId?[2,Promise.resolve(o)]:-1===[0,4].indexOf(o.state)?[2,Promise.resolve(o)]:(a=this._participantOperationHandler.waitForOperation(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o.id),s=this._slimcoreAttachedPromise.then(function(){return l._addParticipantToCall(o,n)}).then(function(){return l._addParticipantToSlimCoreElectronCall(o.id,t.threadId,t.messageId,i)}).then(function(e){return o.attachSlimcoreObjectId(e,n)}).catch(function(t){return l._callTelemetry.updateOperationData(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:M.getPIISafeObject(t)},n,e),r.logFailure(t),Promise.reject(1)}).then(function(){return a}).then(function(){return o}).catch(function(t){return r.logFailure(t),l._handleParticipantRemoved(e,n,t),Promise.reject(t)}),this.raiseChanged(),[2,s])})})},t.prototype.removeParticipant=function(e,t,n,r){return void 0===t&&(t=k.default()),c(this,void 0,void 0,function(){var i,o,a,s,l,c=this;return u(this,function(u){return(i=this._logger.createFnLogger(f.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,t)).info("removeParticipant: participantId = "+v.scrubMriOrOmit(e)+", endpointScope ="+r),this.participantMap.hasOwnProperty(e)&&(o=this.participantMap[e]),o&&(i.info("removeParticipant: current participant state: "+o.state),0===o.state||4===o.state)?(i.logFailure("Participant in invalid state, None or Disconnected"),[2,Promise.reject(new Error("Participant already in disconnected state"))]):(a=C.convertEndpointScope(r),r&&!a?(this._logger.error("Slimcore mapping for endpointScope failed: "+r+" => "+a),[2,Promise.reject(60)]):(s=h.defer(),l=this._slimcoreAttachedPromise.then(function(){o?(c._assertSlimcoreObjectId(o.slimcoreObjectId,"removeParticipant"),c._slimcoreCallHandler.removeParticipant(o.slimcoreObjectId,a),o.addRemoveParticipantDeferred(s)):(c._assertSlimcoreObjectId(c.slimcoreCallId,"removeParticipantByMri"),c._slimcoreCallHandler.removeParticipantByMri(c.slimcoreCallId,e,n,a),s.resolve())}).then(function(){return C.hasFeature(L.Feature.AttendeeBlackList)||s.resolve(),s.promise}).then(function(){return i.logSuccess("removed")}).catch(function(e){return i.logFailure(e),Promise.reject(e)}),this.raiseChanged(),[2,l]))})})},t.prototype._startTransferTargetCall=function(e,t,n){var r=this;return this._logger.info("Transfer: _startTransferTargetCall",e),Promise.resolve().then(function(){r.attachSlimCoreCallObject(e,n),r._assertSlimcoreObjectId(r.slimcoreCallId,"_startTransferTargetCall"),r._slimcoreCallHandler.startTransferTargetCall(e,t,r.threadId,r.messageId)})},t.prototype._getSlimCoreCallProperties=function(e){if(this._logger.info("_getSlimCoreCallProperties"),!C.isSlimCoreRTModuleAvailable())return e;try{var t=new window.SlimCoreRT.SlimCore.CallProperties;return t.audioDirection=e.audioDirection,t.videoDirection=e.videoDirection,t.screenshareDirection=e.screenshareDirection,t.datachannelDirection=e.datachannelDirection,t.muteFlags=e.muteFlags,t.mediaPeerType=e.mediaPeerType,t.isVideoEnabled=e.isVideoEnabled,t.isGoLive=e.isGoLive,t.isHostless=e.isHostless,t.participantLegId=e.participantLegId,t.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration,t.threadId=e.threadId,t.messageId=e.messageId,t.subject=e.subject,t.conversationType=e.conversationType,t.meetingInfo=e.meetingInfo,t.endpointMetadata=e.endpointMetadata,t.onBehalfOf=e.onBehalfOf,t.enableLightWeightMeeting=e.enableLightWeightMeeting,t.emergencyContent=e.emergencyContent,t.broadcastContext=e.broadcastContext,t.callKey=e.callKey,t.encryptedKey=e.encryptedKey,t.invitationType=e.invitationType,t.connectionType=e.connectionType,t.maxVideoChannels=e.maxVideoChannels,t.negotiationTag=e.negotiationTag,t.routingFlags=e.routingFlags,t.scenario=e.scenario,t.preheatFlags=e.preheatFlags,this._logger.info("_getSlimCoreCallProperties created RT CallProperties"),t}catch(e){this._logger.info("_getSlimCoreCallProperties failed, reverting back to property bag ",e)}return e},t.prototype._isEnterpriseMultiParty=function(e){return 5===e||10===e},t.prototype._joinOrStartSlimCoreCall=function(e,n){var r=this,i=this._logger.createFnLogger("joinOrStartSlimCoreCall",n),o=0,a=!e.ringOthers;if(e.conversationUrl||e.isExistingCallInObservingState){i.info("options: "+JSON.stringify(e));var s=this._getSlimCoreCallProperties({audioDirection:void 0!==e.audioDirection?t.toMediaDirection(e.audioDirection):L.MediaDirection.Bidirectional,videoDirection:void 0!==e.videoDirection?t.toMediaDirection(e.videoDirection):L.MediaDirection.ReceiveFromPeer,screenshareDirection:void 0!==e.screenshareDirection?t.toMediaDirection(e.screenshareDirection):this._isEnterpriseMultiParty(this._mediaPeerType)?L.MediaDirection.ReceiveFromPeer:L.MediaDirection.Disabled,datachannelDirection:void 0!==e.datachannelDirection?t.toMediaDirection(e.datachannelDirection):L.MediaDirection.Disabled,muteFlags:e.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===e.videoDirection,isGoLive:a,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:C.mapToEmptyStrIfFalsy(this.threadId),messageId:C.mapToEmptyStrIfFalsy(this.messageId),subject:C.mapToEmptyStrIfFalsy(e.label),conversationType:C.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:C.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:C.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:C.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:e.enableLightWeightMeeting,emergencyContent:C.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:e.callKey,encryptedKey:e.encryptedKey,invitationType:L.InvitationType.None,connectionType:t.convertConnectionType(e.connectionType),maxVideoChannels:void 0!==e.maxVideoChannels?e.maxVideoChannels:0,negotiationTag:C.mapToEmptyStrIfFalsy(e.negotiationTag),routingFlags:e.routingFlags,scenario:C.mapToEmptyStrIfFalsy(e.scenario),preheatFlags:e.preheatFlags});o=this._slimcoreCallHandler.joinCall(JSON.stringify({conversationUrl:e.conversationUrl,conversationId:this.callId,conversationType:e.conversationType}),s),this._assertSlimcoreObjectId(o,"JoinCall"),i.logSuccess("slimcoreCallHandler.JoinCall()")}else if(e.callToVoicemail){if(i.info("Calling slimcoreCallHandler.PlaceCallToVoicemail"),1!==this.participants.length)throw new Error("PlaceCallToVoicemail Failed. Participant size should be one");this._addParticipantToCall(this.participants[0],n),o=this._slimcoreCallHandler.placeCallToVoicemail(this.callId,t.convertToSlimCoreMediaPeerType(this._mediaPeerType),this.participants[0].id,{threadId:this.threadId,voicemailResourcePath:e.voicemailResourcePath,voicemailItemId:e.voicemailItemId}),this._assertSlimcoreObjectId(o,"PlaceCallToVoicemail"),i.logSuccess("slimcoreCallHandler.PlaceCallToVoicemail()")}else if(void 0!==e.parkContext&&void 0!==e.pickupCode){var l=this.mapParkContext(e.parkContext);this._setCallType(1);s=this._getSlimCoreCallProperties({audioDirection:void 0!==e.audioDirection?t.toMediaDirection(e.audioDirection):L.MediaDirection.Bidirectional,videoDirection:void 0!==e.videoDirection?t.toMediaDirection(e.videoDirection):L.MediaDirection.ReceiveFromPeer,screenshareDirection:L.MediaDirection.Disabled,datachannelDirection:void 0!==e.datachannelDirection?t.toMediaDirection(e.datachannelDirection):L.MediaDirection.Disabled,muteFlags:e.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===e.videoDirection,isGoLive:a,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:C.mapToEmptyStrIfFalsy(this.threadId),messageId:C.mapToEmptyStrIfFalsy(this.messageId),subject:C.mapToEmptyStrIfFalsy(e.label),conversationType:C.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:C.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:C.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:C.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:e.enableLightWeightMeeting,emergencyContent:C.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:e.callKey,encryptedKey:e.encryptedKey,connectionType:t.convertConnectionType(e.connectionType),invitationType:e.invitationType,maxVideoChannels:void 0!==e.maxVideoChannels?e.maxVideoChannels:0,routingFlags:e.routingFlags,negotiationTag:C.mapToEmptyStrIfFalsy(e.negotiationTag),scenario:C.mapToEmptyStrIfFalsy(e.scenario)});o=this._slimcoreCallHandler.startCallUnpark(this.callId,s,l,e.pickupCode),this._assertSlimcoreObjectId(o,"StartCallUnpark"),i.logSuccess("slimcoreCallHandler.StartCallUnpark()")}else{i.info("Calling slimcoreCallHandler.PlaceCall");var c=[];e.invitationType===L.InvitationType.Nudge&&e.participantsToNudge?c=e.participantsToNudge:this.participants.forEach(function(e){r._addParticipantToCall(e,n),c.push(e.id)});var u=!!this.threadId||1!==c.length;this._setCallType(u?2:1);s=this._getSlimCoreCallProperties({audioDirection:void 0!==e.audioDirection?t.toMediaDirection(e.audioDirection):L.MediaDirection.Bidirectional,videoDirection:void 0!==e.videoDirection?t.toMediaDirection(e.videoDirection):L.MediaDirection.ReceiveFromPeer,screenshareDirection:void 0!==e.screenshareDirection?t.toMediaDirection(e.screenshareDirection):2===this.callType&&this._isEnterpriseMultiParty(this._mediaPeerType)?L.MediaDirection.ReceiveFromPeer:L.MediaDirection.Disabled,datachannelDirection:void 0!==e.datachannelDirection?t.toMediaDirection(e.datachannelDirection):L.MediaDirection.Disabled,muteFlags:e.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===e.videoDirection,isGoLive:a,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:C.mapToEmptyStrIfFalsy(this.threadId),messageId:C.mapToEmptyStrIfFalsy(this.messageId),subject:C.mapToEmptyStrIfFalsy(e.label),conversationType:C.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:C.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:C.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:C.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:e.enableLightWeightMeeting,emergencyContent:C.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:e.callKey,encryptedKey:e.encryptedKey,connectionType:t.convertConnectionType(e.connectionType),invitationType:e.invitationType,maxVideoChannels:void 0!==e.maxVideoChannels?e.maxVideoChannels:0,routingFlags:e.routingFlags,negotiationTag:C.mapToEmptyStrIfFalsy(e.negotiationTag),scenario:C.mapToEmptyStrIfFalsy(e.scenario),preheatFlags:e.preheatFlags});o=this._slimcoreCallHandler.placeCall(this.callId,c,s),this._assertSlimcoreObjectId(o,"PlaceCall"),i.logSuccess("slimcoreCallHandler.PlaceCall()")}this.attachSlimCoreCallObject(o,n),this._assertSlimcoreObjectId(this.slimcoreCallId,"_joinOrStartSlimCoreCall")},t.prototype._fillIncomingCallProperties=function(){var e=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{callQueueInfo:{propKey:L.Property.CallQueueInfo},callerMri:{propKey:L.Property.CallerMriIdentity},transferorMri:{propKey:L.Property.CallTransferorMri},transferorDisplayName:{propKey:L.Property.CallTransferorDisplayName},transferorType:{propKey:L.Property.CallTransferorType},onBehalfOfMri:{propKey:L.Property.CallOnBehalfOfMri},incomingCallType:{propKey:L.Property.CallIncomingType},consultativeTransferCallId:{propKey:L.Property.CallConsultativeTransferCallId}},{isIncomingOneOnOneVideoCall:{propKey:L.Property.CallIsIncomingOneOnOneVideoCall}});this.callerMri=C.stripMriAliases(e.callerMri),this.transferorMri=C.stripMriAliases(e.transferorMri),this.transferorDisplayName=e.transferorDisplayName,this.transferorType=e.transferorType,this.onBehalfOfMri=C.stripMriAliases(e.onBehalfOfMri),this.callQueueInfo=e.callQueueInfo&&JSON.parse(e.callQueueInfo),this.incomingCallType=e.incomingCallType,this._setConsultativeCallId(this.consultativeCallId),this.isIncomingOneOnOneVideoCall=!!e.isIncomingOneOnOneVideoCall},t.prototype._onCallPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreCallId,e,t)},t.prototype.attachSlimCoreCallObject=function(e,t,n){var r=this;void 0===n&&(n=!1);var i=this._logger.createFnLogger("attachSlimCoreCallObject",t),o=this.slimcoreCallId;if(this.slimcoreCallId===e)return this._callTelemetry.recordEvent(f.CALL_OPERATIONS.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED,{slimCoreCallObjectId:e,reason:"Call already attached to a SlimCore object"},t),void i.logFailure("Call already attached to a SlimCore object");0!==this.slimcoreCallId&&i.info("Call already attached to a different SlimCore object, attaching to new object"),i.info("new slimCoreCallObjectId="+e),this.slimcoreCallId=e;try{this._isOptimizedSpeakerEventingEnabled=this._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","enableOptimizedSpeakerChangeEvents",!1)}catch(e){i.logFailure("Assuming optimized speaker event feature is disabled via ECS."),i.logFailure(e)}this._slimCoreElectronRemoteManager=new w.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this.slimcoreCallId,this.mediaStreams,this._streamContextMap,n),this._slimCoreElectronRemoteManager.changed(function(){return r.raiseChanged()}),this._onCallPropertyChanged(L.Property.CallOrigin,function(e){return r._onCallOriginChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallStatus,function(e){return r._onCallStatusChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallTransferStatus,function(e){return r._onCallTransferStatusChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallParkStatus,function(e){return r._onCallParkStatusChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallIsMuted,function(e){return r._onCallMutedUnmuted(!!e.value)}),this._onCallPropertyChanged(L.Property.CallIsMutedSpeaker,function(e){return r._onCallMutedUnmutedSpeaker(!!e.value)}),this._onCallPropertyChanged(L.Property.CallIsServerMuted,function(e){return r._onCallIsServerMuted(!!e.value)}),this._onCallPropertyChanged(L.Property.CallActiveMembers,function(e){return r._onParticipantJoinedOrRemovedDeferred()}),this._onCallPropertyChanged(L.Property.CallThreadId,function(e){return r._onThreadIdChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallMessageId,function(e){return r._onMessageIdChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallEndpointDetails,function(e){return r._updateEndpointDetails(e.value)}),this._onCallPropertyChanged(L.Property.SelfParticipantRole,function(e){return r._onSelfParticipantRoleChanged(e.value)}),this._onCallPropertyChanged(L.Property.SelfParticipantTenantId,function(e){return r._onSelfParticipantTenantIdChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallMeetingDetails,function(e){return r._updateMeetingDetails(e.value)}),this._onCallPropertyChanged(L.Property.CallMemberCountChanged,function(e){return r._onParticipantJoinedOrRemovedDeferred()}),this._onCallPropertyChanged(L.Property.CallIsConference,function(e){return r._updateCallType(e.value,t)}),this._onCallPropertyChanged(L.Property.CallIsHostless,function(e){return r._updateIsHostless(e.value)}),this._onCallPropertyChanged(L.Property.CallForwardingDestinationType,function(e){return r._updateForwardingDestinationType(e.value)}),this._onCallPropertyChanged(L.Property.CallOptimalRemoteVideoCount,function(e){return r._onCallOptimalVideoCountChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallName,function(e){return r._onCallIdChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallDataChannelObjectId,function(e){return r._updateDataChannel(e.value)}),this._onCallPropertyChanged(L.Property.CallBroadcastMetadata,function(e){return r._onBroadcastMetadataChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallProgressStatus,function(e){return r._onCallProgressStatusChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallEndDiagnosticsCode,function(e){return r._onDiagnosticsCodeChanged(e.value)}),this._onCallPropertyChanged(L.Property.CallInvitationData,function(e){return r._updateCallInvitationData(e.value)}),this._onCallPropertyChanged(L.Property.SelfMeetingRole,function(e){return r._updateMeetingRole(e.value)}),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{propKey:L.Property.ContentSharingStatus},function(e){return r._onContentSharingChanged()})),this._registerDisposable(this._slimcoreCallHandler.handle("audio-stream-state-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onAudioStreamStateChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("transfer-requested",{callObjectId:this.slimcoreCallId},function(e){return r._onTransferRequested(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("callmeback-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onCallMeBackOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("unmuteself-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onUnmuteOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("media-negotiation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onMediaNegotiationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("nudge-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onNudgeParticipantOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("update-meeting-roles-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onUpdateMeetingRoleOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("mute-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onMuteParticipantOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("active-speaker-list-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onActiveSpeakerListChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("dominant-speaker-list-changed",{callObjectId:this.slimcoreCallId},function(e){return r._onDominantSpeakerListChanged(e)})),this._registerDisposable(this._slimcoreInstance.handle("quality-changed",void 0,function(e){return r._onQualityChanged(e)}));var a=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{callId:{propKey:L.Property.CallName},threadId:{propKey:L.Property.CallThreadId},messageId:{propKey:L.Property.CallMessageId},meetingDetails:{propKey:L.Property.CallMeetingDetails},tenantId:{propKey:L.Property.SelfParticipantTenantId},role:{propKey:L.Property.SelfParticipantRole},broadcastMetadata:{propKey:L.Property.CallBroadcastMetadata},invitationData:{propKey:L.Property.CallInvitationData},meetingRole:{propKey:L.Property.SelfMeetingRole}},{status:{propKey:L.Property.CallStatus},isConference:{propKey:L.Property.CallIsConference},isServerMuted:{propKey:L.Property.CallIsServerMuted}});this._updateCallType(a.isConference,t),this._onCallIdChanged(a.callId),this._onThreadIdChanged(a.threadId),this._onMessageIdChanged(a.messageId),this._onCallStatusChanged(a.status,t),this._updateMeetingDetails(a.meetingDetails),this._onSelfParticipantTenantIdChanged(a.tenantId),this._onSelfParticipantRoleChanged(a.role),this._onCallIsServerMuted(!!a.isServerMuted),this._onBroadcastMetadataChanged(a.broadcastMetadata),this._updateCallInvitationData(a.invitationData),this._updateMeetingRole(a.meetingRole),this._callTelemetry.recordEvent(f.CALL_OPERATIONS.ELECTRON_ATTACH_SLIMCORE_CALL,{slimCoreCallObjectId:e,oldSlimcoreCallId:o,callId:a.callId,threadId:a.threadId,messageId:a.messageId,role:a.role},t),this._onParticipantJoinedOrRemoved(t),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.ELECTRON_SLIMCORE_READY)},t.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._slimcoreCallHandler,this.slimcoreCallId,e,C.mapToEmptyStrIfFalsy(t))},t.prototype.getIntProperty=function(e,t,n){return this._getIntProperty(this._slimcoreCallHandler,n||this.slimcoreCallId,e,t)},t.prototype._updateCallInvitationData=function(e){try{e&&(this.invitationData=JSON.parse(e),this._logger.info("_updateCallInvitationData updated: "+(this.invitationData.length>0)),this.raiseChanged())}catch(t){this._logger.info("Failed to parse invitation data. Error: "+t+", diagnosticsCode: "+e)}},t.prototype._updateCallType=function(e,t){var n=this._logger.createFnLogger("updateCallType",t,"current="+this.callType),r=0===e?1:1===e?2:-1;2!==this.callType||1!==r?(n.info("newValue: "+r),r!==this.callType&&(2===r&&this._callTelemetry.recordEvent(f.CALL_OPERATIONS.CALL_ESCALATED_TO_CONFERENCE,void 0,t),this._setCallType(r),this.raiseChanged())):n.logFailure("De-escalating to P2P not allowed!")},t.prototype._updateForwardingDestinationType=function(e){e!==this.forwardingDestinationType&&(this.forwardingDestinationType=e,this.raiseChanged())},t.prototype._setupCallTelemetry=function(){this._callTelemetry=new g.default(this._logger,this._callStartTime);try{this._callTelemetry.setStackConfig({ConversationServiceUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/ConversationServiceUrl"),UdpTransportUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UdpTransportUrl"),KeyDistributionUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/KeyDistributionUrl"),PotentialCallRequestUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/PotentialCallRequestUrl"),UploadLogUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UploadLogUrl"),UdpEnabled:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UdpEnabled"),SlimCoreVersion:SlimCore.getVersion()})}catch(e){this._logger.info("Failed to log stack config")}},t.prototype._updateDataChannel=function(e){if(this._logger.info("_updateDataChannel()"),e){this._dataChannel&&this._dataChannel.dispose();var t=void 0;try{t=this._slimcoreInstance.getDataChannel(e)}catch(e){return this._logger.error("failed to get data channel: "+e),void this._callOperationHandler.maybeRejectOperation(f.CALL_OPERATIONS.ELECTRON_DATA_CHANNEL_CREATED)}this._dataChannel=new d.default(this._logger,this._settings,this._slimcoreInstance,this,this._slimcoreCallHandler,t,this._dataChannelUsers,e),this._dataChannel.setAdapterSourceSinkCallback(this.dataChannelAdapter.setInternalSourceSink),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.ELECTRON_DATA_CHANNEL_CREATED),this._logger.info("Data channel set")}},t.prototype.mapDataChannelSourceIdToParticipant=function(e){var t=null;return(t=1===this.callType?this.participants[0]:p.find(this.participants,function(t){return t.hasSourceId(4,e)}))&&t.id?this._logger.info("ParticipantId: "+v.scrubMriOrOmit(t.id)+" to SourceId: "+e):this._logger.warn("No Participant found for SourceId: "+e),t},t.prototype._onAudioStreamStateChanged=function(e){this.event("mediaStreamStateChanged").raise(),e.direction===SlimCore.Enums.MediaDirection.ReceiveFromPeer&&(this.isAudioStreamConnected=e.streamState===SlimCore.Enums.MediaStreamState.StreamInactive||e.streamState===SlimCore.Enums.MediaStreamState.StreamActive),e.streamState===SlimCore.Enums.MediaStreamState.StreamFail&&this.event("mediaConnectionFailed").raise()},t.prototype._onTransferRequested=function(e){var t=this;this._logger.info("Transfer: _onTransferRequested",e);var n,r=this.getIntProperty(L.Property.CallOrigin,L.OriginType.Unspecified,e.targetCallObjectId);r===L.OriginType.Park?n=1:r===L.OriginType.Transfer?n=0:this._logger.info("Unkown transfer type based on new call origin");var i={transferorMri:e.transferorMri,targetMri:e.transferTargetMri,transferType:n,context:{newCallObjectId:e.targetCallObjectId}};this.event("transferRequested").raise({transferContext:i,onCompleted:function(e){t._logger.debug("Transfer: transferCompleted called: "+e),1!==e&&t._slimcoreCallHandler.leaveCall(i.context.newCallObjectId)}})},t.prototype._onCallMeBackOperationStatusChanged=function(e){var t=this,n=k.default();if(e.failureReason!==L.ParticipantFailureReason.NoFailure){var r=e.failureReason,i=b.convertFailureReasonToParticipantReason(r);this._callTelemetry.updateOperationData(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,{error:M.getPIISafeObject(r)},n,e.participantMri),this._participantOperationHandler.rejectOperation(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,i,e.participantMri,n).catch(function(n){t._logger.error("CallMeBack operation failed for ",v.scrubMriOrOmit(e.participantMri),n)})}},t.prototype._onUnmuteOperationStatusChanged=function(e){var n=k.default();if(this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.UNMUTE)&&e.operationResult!==L.OperationResultCode.None)if(this._logger.info("_onUnmuteOperationStatusChanged operationResult: eventData.operationResult"),e.operationResult!==L.OperationResultCode.Success){var r=e.failureReason,i=t.convertParticipantReasonToTerminatedReason(b.convertFailureReasonToParticipantReason(e.failureReason));this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.UNMUTE,{error:M.getPIISafeObject(r)},n),this._callOperationHandler.rejectOperation(f.CALL_OPERATIONS.UNMUTE,i,void 0,n)}else this._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.UNMUTE)},t.prototype._onNudgeParticipantOperationStatusChanged=function(e){var t=k.default();if(this._participantOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e.context)){var n=e.failureReason,r=b.convertFailureReasonToParticipantReason(n);e.failureReason!==L.ParticipantFailureReason.NoFailure?(this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,{error:M.getPIISafeObject(n)},t,e.context),this._participantOperationHandler.rejectOperation(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,r,e.context,t)):this._participantOperationHandler.resolveOperation(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS,r,e.context,t)}},t.prototype._onUpdateMeetingRoleOperationStatusChanged=function(e){if(this._participantOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE)){var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0!==t.code||0!==t.subCode?(this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,{error:M.getPIISafeObject(t)},e.causeId),this._participantOperationHandler.rejectOperation(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId)):this._participantOperationHandler.resolveOperation(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId)}},t.prototype._onMuteParticipantOperationStatusChanged=function(e){if(this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.MUTE_PARTICIPANTS)){var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0!==t.code||0!==t.subCode?(this._callTelemetry.updateOperationData(f.CALL_OPERATIONS.MUTE_PARTICIPANTS,{error:M.getPIISafeObject(t)},e.causeId),this._callOperationHandler.rejectOperation(f.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId)):this._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId)}},t.prototype._onActiveSpeakerListChanged=function(e){for(var t={},n=0,r=e.activeSpeakers?Array.from(e.activeSpeakers):[];n<r.length;n++){t[r[n]]=1}for(var i=0,o=this.participants;i<o.length;i++){var a=o[i];a.setVoiceLevel(t[a.id]||0)}this._logger.debug("_onActiveSpeakerListChanged: number of active speakers "+Object.keys(t).length)},t.prototype._onDiagnosticsCodeChanged=function(e){this._logger.info("_onDiagnosticsCodeChanged diagnosticsCode: "+e);try{this.callEndDiagnosticsInfo=JSON.parse(e),this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}},t.prototype._onDominantSpeakerListChanged=function(e){this.dominantSpeakerInfo.speakerList=e.dominantSpeakers?Array.from(e.dominantSpeakers):[],this._logger.info("_onDominantSpeakerListChanged: number of dominant speakers "+this.dominantSpeakerInfo.speakerList.length),this.raiseChanged()},t.prototype._updateCallLegIdChanged=function(e){this.participantId!==e&&(this._logger.info("updateCallLegIdChanged: new value is "+e),this._setParticipantId(e),this.event("callLegIdChanged").raise(e),this.raiseChanged())},t.prototype._updateIsHostless=function(e){var t=1===e;this.isHostless!==t&&(this._logger.info("_updateIsHostless: new value is "+t),this.isHostless=t,this.raiseChanged())},t.prototype._onCallOptimalVideoCountChanged=function(e){this._logger.info("_onCallOptimalVideoCountChanged "+e),e!==this.optimalVideoCount&&(this.optimalVideoCount=e,this.raiseChanged())},t.prototype._onCallIdChanged=function(e){this._logger.info("_onCallIdChanged "+e),e!==this.callId&&(this._setCallId(e),this.event("callIdChanged").raise(this.callId),this.raiseChanged())},t.prototype._setCallId=function(e){this.callId=e,this._callTelemetry.setCallId(this.callId)},t.prototype._setParticipantId=function(e){this.participantId=e,this._callTelemetry.setParticipantId(this.participantId)},t.prototype._setConsultativeCallId=function(e){this.consultativeCallId=e,this._callTelemetry.setConsultativeCallId(this.consultativeCallId)},t.prototype._onCallTransferStatusChanged=function(e){var t=k.default();this._logger.info("["+t+"]onCallTransferStatusChanged status: "+e+" ("+L.CallStatus[e]+")"),this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS)&&(e===L.CallStatus.Transferring?this._setTransferState(2,t):e===L.CallStatus.Transferred?this._setTransferState(3,t):e===L.CallStatus.Failed&&this._setTransferState(4,t))},t.prototype._onCallParkStatusChanged=function(e){var t=k.default();this._logger.info("["+t+"]_onCallParkStatusChanged status: "+e+" ("+L.CallStatus[e]+")"),this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.CALL_TRANSFER_IN_PROGRESS)&&(e===L.CallStatus.Parking?this._setParkState(2,t):e===L.CallStatus.Parked?this._setParkState(3,t):e===L.CallStatus.Failed&&this._setParkState(4,t))},t.prototype._onCallStatusChanged=function(e,n){var r=this;void 0===n&&(n=k.default());var i=this._logger.createFnLogger("onCallStatusChanged",n);if(i.info("new status="+e+", mapped to=("+L.CallStatus[e]+")"),this._updateCallLegIdChanged(this.getStrProperty(L.Property.CallLegId)),this._callTelemetry.recordEvent(f.CALL_OPERATIONS.SIGNALING_STATE_CHANGED,{status:e,statusToEnum:L.CallStatus[e]},n),t.isCallConnecting(e))this._setCallState(2,n);else if(t.isCallPreheating(e))i.info("status=Preheating"),this._setCallState(11,n);else if(t.isCallEarlyMedia(e))i.info("status=EarlyMedia"),this._setCallState(9,n);else if(t.isCallRinging(e))i.info("status=Ringing"),this.participants.forEach(function(e){return e.setState(2,n)}),this._updateCallType(this.getIntProperty(L.Property.CallIsConference),n);else if(t.isCallInLobby(e))this._callIsSetupComplete=!0,i.info("status=InLobby"),this._setCallState(10,n),this.participants.forEach(function(e){return e.setState(7,n)}),this._updateCallType(this.getIntProperty(L.Property.CallIsConference),n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNHOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.CONNECT_CALL,void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isCallPreheated(e))i.info("status=Preheated"),this._setCallState(12,n),this._updateIsHostless(this.getIntProperty(L.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(L.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(L.Property.CallEndpointDetails)),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.CONNECT_CALL,void 0,void 0,n);else if(t.isCallConnected(e))this._callIsSetupComplete=!0,i.info("status=Connected"),this._setCallState(3,n),this._updateIsHostless(this.getIntProperty(L.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(L.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(L.Property.CallEndpointDetails)),this._onCallMutedUnmuted(!!this.getIntProperty(L.Property.CallIsMuted)),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNHOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.CONNECT_CALL,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.JOIN_PREHEATED_CALL,void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isObserving(e))this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,n);else if(e===L.CallStatus.LocalHold)i.info("status=LocalHold"),this._setCallState(4,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNHOLD,void 0,void 0,n);else if(e===L.CallStatus.RemoteHold)i.info("status=RemoteHold"),this._setCallState(5,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.UNHOLD,void 0,void 0,n);else if(t.isCallTerminated(e)){var o=t.convertStatusToTerminatedReason(e),a=o;i.info("status=Terminated, reason="+o);var s=this.getIntProperty(L.Property.CallFailureReason),l=this.getIntProperty(L.Property.CallIsConference),c=this._getFirstParticipantFailureReason(i);if(e!==L.CallStatus.Failed&&e!==L.CallStatus.Dropped&&s!==L.ParticipantFailureReason.CallNotFound||(a=this._getTerminatedReason(s,o)),8===this.state&&(this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.START_CALL)||this._callOperationHandler.hasPendingOperation(f.CALL_OPERATIONS.JOIN_CALL)))return this._callOperationHandler.maybeRejectOperation(f.CALL_OPERATIONS.SUBSCRIBE,a,void 0,n),void i.info("Subscribe failed, there is pending start/join operation, ignore call end message");this._callTelemetry.recordEvent(f.CALL_OPERATIONS.CALL_TERMINATION_INFO,{terminatedReasonFromStatus:o,slimcoreCallFailureReason:s,firstParticipantFailureReason:c,finalReason:a,slimcoreCallType:l},n),i.info("status=Terminated, statusToReason="+o+", slimcoreCallFailureReason="+s+", finalReason="+a),this._callOperationHandler.maybeRejectOperation(f.CALL_OPERATIONS.CONNECT_CALL,a,void 0,n),this._callOperationHandler.maybeResolveOperation(f.CALL_OPERATIONS.CALL_ENDED,a,void 0,n),this._setCallState(7,n,a),this.participants.forEach(function(e){return e.setState(4,n)}),this._updateDominantSpeakerList(),this.disconnectingPromise=this.cleanUp(n).catch(function(e){i.logFailure("Error when cleaning up the call, callId = "+r.callId+", error = "+e)})}this.raiseChanged()},t.prototype._reportTsCallingTelemetry=function(e){if(!this.tsCallingTelemetryReported){var t=e?"skypecosi_concore_native_ts_calling_call_setup_session":"skypecosi_concore_native_ts_calling_in_call_session";this._callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this._telemetryService&&this._telemetryService.sendEvent(t,this._callTelemetry.getEvent()),e?this._callTelemetry.switchToInCallTelemetry():this.tsCallingTelemetryReported=!0}},t.prototype._getTerminatedReason=function(e,n){if(this._isRelayWhiteListingIssue)return 53;if(!p.isUndefined(e)&&e!==L.ParticipantFailureReason.NoFailure)return t.convertParticipantReasonToTerminatedReason(b.convertFailureReasonToParticipantReason(e));if(this.participants.length){var r=p.head(this.participants).getIntProperty(L.Property.ParticipantFailureReason);return t.convertParticipantReasonToTerminatedReason(b.convertFailureReasonToParticipantReason(r))}return n||0},t.prototype._addParticipantToCall=function(e,t){e.setState(1,t),this._logger.info("["+t+"]starting adding participant to call, participantId = "+v.scrubMriOrOmit(e.id))},t.prototype._joinOrStartCall=function(e,t){return c(this,void 0,void 0,function(){var n,r;return u(this,function(i){switch(i.label){case 0:if(n=this._logger.createFnLogger("joinOrStartCall",t),0!==this.state&&8!==this.state)throw new Error("Trying to start a call that has already been acted on");this._setIsCast("cast"===e.conversationType),this.label=e.label,this.raiseChanged(),1==(1&e.muteFlags)&&(n.info("isMuted set to true in _joinOrStartCall"),this.isMuted=!0),2==(2&e.muteFlags)&&(n.info("isSpeakerMuted set to true in _joinOrStartCall"),this.isSpeakerMuted=!0),e.isExistingCallInObservingState=8===this.state,1==(1&e.preheatFlags)?(n.info("Call set to preheating in _joinOrStartCall"),this._setCallState(11,t)):(n.info("Call set to connecting in _joinOrStartCall"),this._setCallState(2,t)),r=this._callOperationHandler.createPendingOperation(f.CALL_OPERATIONS.CONNECT_CALL,void 0,t);try{this._joinOrStartSlimCoreCall(e,t)}catch(e){throw this.stopInternal(t),n.logFailure(e),e}return 4!==e.videoDirection?[3,2]:(n.info("Call has been started; turning on video"),[4,this.startVideoSafe(t)]);case 1:i.sent(),i.label=2;case 2:return[2,r]}})})},t.prototype._localVideoChanged=function(){var e=this._localVideo&&!this._localVideo.isAvailable&&!this._localVideo.isPaused&&!1!==this._settings.autoStopLocalVideo&&!this._localVideo.isStoppingOrNotStarted,t=6===this.state||7===this.state;e&&!t&&this.stopVideo()},t.prototype.disposeLocalVideoRenderer=function(e){return void 0===e&&(e=k.default()),c(this,void 0,void 0,function(){var t,n;return u(this,function(r){switch(r.label){case 0:if((t=this._logger.createFnLogger("disposeLocalVideoRenderer",e)).info("DisposeLocalVideoRenderer called"),!this._localVideoPreview)return[3,5];r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this._localVideoPreview.stop(e)];case 2:return r.sent(),[3,5];case 3:return n=r.sent(),t.logFailure(n),[3,5];case 4:return this._localVideoPreview&&this._localVideoPreview.dispose(e),this._localVideoPreview=null,[7];case 5:return[2]}})})},t.prototype._muteUnmute=function(e,t){var n,r=this,i=this._logger.createFnLogger("muteUnmute",t);return i.info("muteUnmute, value = "+e+" isMuted = "+this.isMuted+" isServerMuted = "+this.isServerMuted),n=e?this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.MUTE):this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.UNMUTE),this._slimcoreAttachedPromise.then(function(){return r._slimcoreCallHandler.callMute(r.slimcoreCallId,e)}).then(function(){return n}).catch(function(e){throw i.logFailure(e),e})},t.prototype._muteUnmuteSpeaker=function(e,t){var n,r=this,i=this._logger.createFnLogger("muteUnmuteSpeaker",t);return i.info("muteUnmuteSpeaker, value = "+e+" isSpeakerMuted = "+this.isSpeakerMuted),n=e?this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.MUTE_SPEAKER):this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.UNMUTE_SPEAKER),this._slimcoreAttachedPromise.then(function(){return r._slimcoreCallHandler.callMuteSpeaker(r.slimcoreCallId,e)}).then(function(){return n}).then(function(){return r._setMutedSpeaker(e,t)}).catch(function(e){throw i.logFailure(e),e})},t.prototype._muteParticipants=function(e,n,r){var i=this,o=t.convertMuteScope(e),a=this._logger.createFnLogger("muteParticipants",r);if(void 0===o)return a.logFailure("Unrecognized "+e),Promise.reject(new Error("Unrecognized muteScope"));var s=[];n.forEach(function(e){s.push(e.id)});var l=this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.MUTE_PARTICIPANTS,r);return this._slimcoreAttachedPromise.then(function(){return i._slimcoreCallHandler.callMuteParticipants(i.slimcoreCallId,o,s),C.hasFeature(L.Feature.AttendeeBlackList)?l:i._callOperationHandler.resolveOperation(f.CALL_OPERATIONS.MUTE_PARTICIPANTS,null,r,r).then()}).catch(function(e){throw a.logFailure("mute participants failed with "+e),e})},t.prototype._holdUnhold=function(e,t,n){return c(this,void 0,void 0,function(){var r,i,o,a;return u(this,function(s){switch(s.label){case 0:if(r=4===this.state,(i=this._logger.createFnLogger("holdUnhold",t)).info("_holdUnhold, value: "+e+" currentState: "+r),r===e)return[2,Promise.resolve()];s.label=1;case 1:return s.trys.push([1,12,,13]),[4,this._slimcoreAttachedPromise];case 2:return s.sent(),this._slimcoreCallHandler.callHold(this.slimcoreCallId,e,n),e?[4,this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.HOLD)]:[3,5];case 3:return s.sent(),[4,this.disposeLocalVideoRenderer(t)];case 4:return s.sent(),[3,11];case 5:return[4,this._callOperationHandler.waitForOperation(f.CALL_OPERATIONS.UNHOLD)];case 6:if(s.sent(),!this.isVideoOn)return[3,11];s.label=7;case 7:return s.trys.push([7,9,,11]),[4,this._startPreviewVideo(t)];case 8:return s.sent(),[3,11];case 9:return o=s.sent(),i.logFailure(o),[4,this.stopVideo(t)];case 10:return s.sent(),[3,11];case 11:return[3,13];case 12:throw a=s.sent(),i.logFailure(a),a;case 13:return[2]}})})},t.prototype._updateEndpointMetadata=function(e,t){var n=this,r=this._logger.createFnLogger("updateEndpointMetadata",t);return this._slimcoreAttachedPromise.then(function(){return n._slimcoreCallHandler.callUpdateEndpointMetadata(n.slimcoreCallId,n._endpointMetadata)}).catch(function(e){throw r.logFailure(e),e})},t.prototype._sendDtmfTone=function(e,n){var r=this,i=this._logger.createFnLogger("sendDtmfTone",n);return this._slimcoreAttachedPromise.then(function(){var n=t.convertToSlimCoreDtmfTone(e);if(void 0===n)throw i.logFailure("Unrecognized dtmfTone"),new Error("Unrecognized dtmfTone");try{r._slimcoreCallHandler.callSendDtmf(r.slimcoreCallId,n)}catch(e){throw i.logFailure(e),e}})},t.prototype.setMaxVideoChannels=function(e,t){var n=this;void 0===t&&(t=k.default());var r=this._logger.createFnLogger("setMaxVideoChannels",t);return r.info("setMaxVideoChannels: "+e),this._slimcoreAttachedPromise.then(function(){n._slimcoreCallHandler.callSetMaxVideoChannels(n.slimcoreCallId,e)}).catch(function(e){throw r.logFailure(e),e})},t.prototype._setAudioUsageMode=function(e,n){var r=this,i=this._logger.createFnLogger("setAudioUsageMode",n);return this._slimcoreAttachedPromise.then(function(){var n=t.convertToSlimCoreAudioUsageMode(e);if(void 0===n)throw new Error("Unrecognized audioUsageMode");r._slimcoreCallHandler.callSetAudioUsageMode(r.slimcoreCallId,n)}).catch(function(e){throw i.logFailure(e),e})},t.prototype._getOrCreateParticipant=function(e,t,n,r){var i,o=this,a=8===this.state;if(this.participantMap.hasOwnProperty(e)){var s=this.participantMap[e];return n&&s.attachSlimcoreObjectId(n,t,a,r),s}return this._logger.info("getOrCreateParticipant: creating new participant "+v.scrubMriOrOmit(e)+" "+n),(i=new I.default(this._logger,this._settings,this._slimcoreInstance,e,this._slimcoreCallHandler,this._streamContextMap,n,this._callTelemetry,a,r)).changed(function(){return o._participantChangedCallback(i)}),this._addParticipantEntry(i),this._monitorCallStart(),this.event("participantAdded").raise(i),this.raiseChangedDeferred(),i},t.prototype._participantChangedCallback=function(e){var t=this;p.each(e.streams[1],function(n){t._localScreenShareStream&&n.isAvailable&&(C.forgetAndLog(t.stopScreenSharing(!0),t._logger,"ParticipantChanged: Cleaning up local screenshare because remote screenshare is running"),t.event("sharingStolen").raise()),t.screenSharingControl&&t.screenSharingControl.isScreenSharingControlEnabled()&&(n.isActive()&&3===t.state?t.screenSharingControl.initControlForViewer(e):t.screenSharingControl.shutdownControlForViewer(e))}),this._updateDominantSpeakerListDeferred(),this.event("participantUpdated").raise(e),this.raiseChangedDeferred()},t.prototype.setCallStateNotified=function(e){this._setCallState(1,e),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLEE)},t.prototype._setCallState=function(e,n,r){if(this.state!==e){var i=this._logger.createFnLogger("setCallState",n);i.info("currentState="+this.state+", newState="+e+", terminatedReason="+this.terminatedReason),N[this.state].indexOf(e)>=0?(this.state=e,this._callTelemetry.recordEvent(f.CALL_OPERATIONS.SET_CALL_STATE,{state:e,reason:r},n),3===e?(this._callGotConnected=!0,this.callHeldAt=null):5!==e&&4!==e||this.callHeldAt?7===e&&(this.terminatedReason=r,this._setFailureType(t.convertTerminatedReasonToFailureType(r,this._callGotConnected,this._wasAudioStreamConnected)),this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.handleCallDisconnected()):this.callHeldAt=new Date,i.logSuccess("changed to "+e+", terminatedReason: "+this.terminatedReason+", failureType="+this.failureType),this._startInitialVideoIfReady(n),this._monitorCallStart(),this.event("callStateChanged").raise(),this.raiseChanged()):this._logger.warn("invalid state transition")}},t.prototype._setVideoOn=function(e,t){this.isVideoOn!==e&&(this.isVideoOn=e,this._callTelemetry.recordEvent(f.CALL_OPERATIONS.SET_LOCAL_VIDEO,{value:e},t),this.raiseChanged())},t.prototype._setScreenSharingOn=function(e,t){this.isScreenSharingOn!==e&&(this.isScreenSharingOn=e,this._callTelemetry.recordEvent(f.CALL_OPERATIONS.SET_SCREEN_SHARING,{value:e},t),this.raiseChanged()),this.event("userActivityChanged").raise()},t.prototype._setMutedSpeaker=function(e,t){this.isSpeakerMuted!==e&&(this.isSpeakerMuted=e,this._callTelemetry.recordEvent(f.CALL_OPERATIONS.SET_MUTED_SPEAKER,{value:e},t),this.raiseChanged())},t.prototype._monitorCallStart=function(){3===this.state&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},t.prototype._addParticipantEntry=function(e){this.participantMap[e.id]=e,this.participants.push(e)},t.prototype._removeParticipantEntry=function(e){if(!this.participantMap.hasOwnProperty(e))return null;var t=this.participantMap[e];return delete this.participantMap[e],p.pull(this.participants,t),t&&this.raiseChanged(),t},t.prototype._onThreadIdChanged=function(e){e&&this.threadId!==e&&(this.threadId=e,this.raiseChanged())},t.prototype._onMessageIdChanged=function(e){e&&this.messageId!==e&&(this.messageId=e,this.raiseChanged())},t.prototype._onSelfParticipantRoleChanged=function(e){e!==this.role&&(this._logger.info("Role for self is set to "+e),this.role=e,this.raiseChanged())},t.prototype._updateMeetingRole=function(e){e!==this.meetingRole&&(this.meetingRole=e,this._logger.info("_updateMeetingRole: "+this.meetingRole),this.event("meetingRoleUpdated").raise(this.meetingRole),this.raiseChanged())},t.prototype._onSelfParticipantTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId for self is set to "+e),this.tenantId=e,this.raiseChanged())},t.prototype._updateEndpointDetails=function(e){var t=this,n=k.default();if(this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this.endpoints.endpointDetails.forEach(function(e){e.originalId&&t._participantOperationHandler.resolveOperation(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK,null,e.originalId,n).catch(function(e){t._logger.error("["+n+"]Failed to update call me back participant "+e)})})}catch(t){this._logger.info("["+n+"]Failed to parse raw endpoint details. Error: "+t+", EndpointDetails: "+e)}this.raiseChanged()}},t.prototype._updateMeetingDetails=function(e){if(this._rawMeetingDetails!==e)try{!e||p.isEmpty(e)?this.meetingDetails=null:this.meetingDetails=JSON.parse(e),this._rawMeetingDetails=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw meeting details. Error: "+t+", MeetingDetails: "+e)}},t.prototype._onBroadcastMetadataChanged=function(e){if(e)try{this.broadcastMetadata=JSON.parse(e),this._logger.info("broadcast metadata updated"),this.broadcastMeeting&&this.broadcastMeeting.metadataChanged(e),this.raiseChanged()}catch(e){this._logger.info("broadcast metadata invalid, failed to parse")}},t.prototype._onCallProgressStatusChanged=function(e){e!==this._callProgressStatus&&(this._callProgressStatus=e,this.callProgressStatus=e,this.event("callProgressStatusChanged").raise(e))},t.prototype._getParticipantByObjectId=function(e){return p.find(this.participants,function(t){return t.slimcoreObjectId===e})},t.prototype._onQualityChanged=function(e){if(this._logger.info("onQualityChanged: oid="+e.objectId+", mtype="+e.mediaType+", otype="+e.objectType+", type="+e.type+", value="+e.value),!(e.mediaType!==L.MediaType.Audio&&e.mediaType!==L.MediaType.Video||e.objectType===L.ObjectType.Call&&e.objectId!==this.slimcoreCallId)){var n={type:t.convertQualityEventType(e.type),value:t.convertQualityLevel(e.value),mediaType:t.convertMediaType(e.mediaType),isLocalSource:e.objectType===L.ObjectType.Call};if(e.objectType===L.ObjectType.Participant){var r=this._getParticipantByObjectId(e.objectId);if(!r)return;n.id=r.id}n.type&&n.value&&(e.mediaType===L.MediaType.Audio&&e.type===L.QualityEventType.RelayWhiteListing?(this._isRelayWhiteListingIssue=!0,this.event("mediaConnectionWhitelistingWarning").raise(),this.event("mediaConnectionFailed").raise()):this.event("callQualityChanged").raise(n))}},t.prototype.getContentSharing=function(e){var t=this._slimcoreInstance.getContentSharing(e);return t?C.wrap(t,this._settings):null},t.prototype.createContentSharingSession=function(e,t,n,r){var i=this;return this._slimcoreAttachedPromise.then(function(){var o=i._slimcoreCallHandler.createContentSharing(i.slimcoreCallId,e,t,n,r);if(!o)throw new Error("Failed to create ContentSharing SlimCore object");var a=i.getContentSharing(o);if(!a)throw new Error("Failed to create ContentSharing SlimCore native object");var s=new P.default(i._logger,i._settings,i._slimcoreInstance,i._slimcoreCallHandler,o,a,i._callTelemetry);return i.contentSharingSessions.push(s),i.event("contentSharingChanged").raise(),s})},t.prototype._onContentSharingChanged=function(){var e=this,t=this._slimcoreCallHandler.getContentSharingSessions(this.slimcoreCallId),n=!1;p.remove(t,function(t){return e._getIntProperty(e._slimcoreCallHandler,t,SlimCore.Enums.Property.ContentSharingCallId)!==e.slimcoreCallId});var r=p.remove(this.contentSharingSessions,function(e){return-1===p.indexOf(t,e.slimCoreContentSharingObjectId)});p.forEach(t,function(t){if(!p.find(e.contentSharingSessions,function(e){return e.slimCoreContentSharingObjectId===t})){var r=e.getContentSharing(t);if(r){var i=new P.default(e._logger,e._settings,e._slimcoreInstance,e._slimcoreCallHandler,t,r,e._callTelemetry);e.contentSharingSessions.push(i),e._logger.info("Added new content sharing session with guid "+i.contentSharingGuid),n=!0}}}),r.forEach(function(t){e._logger.info("Removed content sharing session with guid "+t.contentSharingGuid),t.setContentSharingStatus(7),t.dispose()}),(n||r.length)&&this.event("contentSharingChanged").raise()},t.prototype.raiseChangedDeferred=function(){var e=this;this._raiseChangedDefer||(this._raiseChangedDefer=p.defer(function(){delete e._raiseChangedDefer,e.raiseChanged()}))},t.prototype._onParticipantJoinedOrRemovedDeferred=function(e){var t=this;void 0===e&&(e=k.default()),this._onParticipantJoinedOrRemovedDefer||(this._onParticipantJoinedOrRemovedDefer=p.defer(function(){delete t._onParticipantJoinedOrRemovedDefer,t._onParticipantJoinedOrRemoved(e)}))},t.prototype._updateDominantSpeakerListDeferred=function(){var e=this;this._updateDominantSpeakerListDefer||(this._updateDominantSpeakerListDefer=p.defer(function(){delete e._updateDominantSpeakerListDefer,e._updateDominantSpeakerList()}))},t.prototype.callStateCanToggleVideo=function(){return 3===this.state||4===this.state||5===this.state||10===this.state},t.prototype._startInitialVideoIfReady=function(e){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return this.callStateCanToggleVideo()&&this._videoRequestedOnWhileConnecting?(this._logger.info("["+e+"]Call has been started; turning on video"),this._videoRequestedOnWhileConnecting=!1,[4,this.startVideoSafe(e)]):[3,3];case 1:return t.sent(),this._videoRequestedOffWhileConnecting?(this._logger.info("["+e+"]Call has been started and video turned on; turning off video"),this._videoRequestedOffWhileConnecting=!1,[4,this.stopVideo(e)]):[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.convertConnectionType=function(e){switch(e){case 0:return L.ConnectionType.AllSupported;case 1:return L.ConnectionType.NoDirectConnection;default:return L.ConnectionType.AllSupported}},t.convertStatusToTerminatedReason=function(e){switch(e){case L.CallStatus.Failed:return 7;case L.CallStatus.Finished:return 1;case L.CallStatus.Missed:return 9;case L.CallStatus.Refused:return 10;case L.CallStatus.Busy:return 11;case L.CallStatus.Cancelled:case L.CallStatus.Unplaced:return 12;case L.CallStatus.Dropped:return 4;case L.CallStatus.DeniedInLobby:return 55;case L.CallStatus.TimedOutInLobby:return 56;default:return 0}},t.convertParticipantReasonToTerminatedReason=function(e){switch(e){case 0:return 1;case 1:case 5:case 6:case 7:case 43:return 5;case 46:return 59;case 59:return 73;case 2:return 9;case 3:return 10;case 4:return 2;case 8:return 24;case 9:return 3;case 10:return 4;case 12:return 14;case 11:return 0;case 13:return 15;case 14:return 16;case 15:return 17;case 16:return 18;case 17:return 19;case 18:return 20;case 19:return 11;case 20:return 21;case 21:return 22;case 22:return 23;case 25:return 33;case 26:return 36;case 27:return 37;case 30:return 41;case 28:return 39;case 31:return 42;case 29:return 40;case 32:return 43;case 33:return 44;case 34:return 45;case 35:return 46;case 36:return 47;case 37:return 48;case 38:return 49;case 39:return 50;case 40:return 51;case 41:return 52;case 42:return 54;case 47:return 61;case 53:return 66;case 54:return 67;case 55:return 68;case 56:return 69;case 57:return 71;case 58:return 72;default:return 0}},t.convertTerminatedReasonToFailureType=function(e,t,n){switch(e){case 0:case 1:case 9:case 10:case 11:case 12:case 2:case 60:return 2;case 3:case 5:case 6:case 7:case 8:case 14:case 36:case 37:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 44:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 59:case 73:case 66:case 67:case 68:case 69:case 71:case 72:return 0;case 4:return t&&n?1:0;default:return 2}},t.convertToSlimCoreDtmfTone=function(e){switch(e){case 0:return L.DtmfTone.Num0;case 1:return L.DtmfTone.Num1;case 2:return L.DtmfTone.Num2;case 3:return L.DtmfTone.Num3;case 4:return L.DtmfTone.Num4;case 5:return L.DtmfTone.Num5;case 6:return L.DtmfTone.Num6;case 7:return L.DtmfTone.Num7;case 8:return L.DtmfTone.Num8;case 9:return L.DtmfTone.Num9;case 10:return L.DtmfTone.Star;case 11:return L.DtmfTone.Pound;case 12:return L.DtmfTone.A;case 13:return L.DtmfTone.B;case 14:return L.DtmfTone.C;case 15:return L.DtmfTone.D;case 16:return L.DtmfTone.Flash;default:return}},t.convertToSlimCoreAudioUsageMode=function(e){switch(e){case"Default":return L.AudioUsageMode.Default;case"LongrangeSpeaker":return L.AudioUsageMode.LongrangeSpeaker;case"Auditorium":return L.AudioUsageMode.Auditorium;default:return}},t.convertQualityEventType=function(e){switch(e){case L.QualityEventType.NetworkSendQuality:return 1;case L.QualityEventType.NetworkRecvQuality:return 2;case L.QualityEventType.NetworkDelay:return 3;case L.QualityEventType.NetworkBandwidthLow:return 4;case L.QualityEventType.NetworkReconnect:return 5;case L.QualityEventType.NetworkPacketLoss:return 6;case L.QualityEventType.NetworkJitter:return 7;case L.QualityEventType.NetworkRateMatching:return 8;case L.QualityEventType.DeviceCaptureNotFunctioning:return 9;case L.QualityEventType.DeviceRenderNotFunctioning:return 10;case L.QualityEventType.DeviceRenderGlitches:return 11;case L.QualityEventType.DeviceLowSNR:return 12;case L.QualityEventType.DeviceLowSpeechLevel:return 13;case L.QualityEventType.DeviceClipping:return 14;case L.QualityEventType.DeviceEcho:return 15;case L.QualityEventType.PresentationAudioQuality:return 16;case L.QualityEventType.DeviceHalfDuplexAec:return 17;case L.QualityEventType.DeviceMultipleEndpoints:return 18;case L.QualityEventType.DeviceHowling:return 19;case L.QualityEventType.DeviceRenderZeroVolume:return 20;case L.QualityEventType.DeviceRenderMute:return 21;case L.QualityEventType.NetworkSendCatastrophic:return 22;case L.QualityEventType.NetworkRecvCatastrophic:return 23;case L.QualityEventType.CpuInsufficient:return 24;case L.QualityEventType.DeviceCaptureMute:return 25;case L.QualityEventType.DeviceCaptureNotMuteButSilent:return 26;case L.QualityEventType.DeviceSpeakWhileMuted:return 27;case L.QualityEventType.VideoVbssRendered:return 28;case L.QualityEventType.NetworkEthernetInterfaceUsed:return 29;case L.QualityEventType.NetworkWlanInterfaceUsed:return 30;case L.QualityEventType.NetworkWwanInterfaceUsed:return 31;case L.QualityEventType.RelayWhiteListing:return 32;case L.QualityEventType.VideoCapturerDeviceStartFailed:return 33;case L.QualityEventType.VideoCapturerDeviceStartTimedOut:return 34;case L.QualityEventType.VideoCapturerDeviceStartFailureLackSystemRes:return 35;case L.QualityEventType.VideoCapturerDeviceStartFailureMFResConflict:return 36;case L.QualityEventType.ZeroCaptureDevicesEnumerated:return 43;case L.QualityEventType.ZeroRenderDevicesEnumerated:return 44;case L.QualityEventType.NoNetwork:return 37;case L.QualityEventType.NetworkNotWorking:return 38;case L.QualityEventType.DeviceCaptureNotFunctioningAudioSrvNotRunning:return 41;case L.QualityEventType.DeviceRenderNotFunctioningAudioSrvNotRunning:return 42;case L.QualityEventType.DeviceCaptureNotFunctioningDeviceInUse:return 39;case L.QualityEventType.DeviceRenderNotFunctioningDeviceInUse:return 40;case L.QualityEventType.VideoCaptureDeviceFreeze:return 45;case L.QualityEventType.AudioCapturePermissionDenied:return 46;case L.QualityEventType.VideoCapturePermissionDenied:return 47;case L.QualityEventType.VideoCaptureFreezeRecovered:return 48;case L.QualityEventType.DeviceRenderHowling:return 49;case L.QualityEventType.LowFarEndInput:return 50;default:return}},t.convertQualityLevel=function(e){switch(e){case L.QualityLevel.Unknown:return 0;case L.QualityLevel.Good:return 1;case L.QualityLevel.Poor:return 2;case L.QualityLevel.Bad:return 3;default:return}},t.convertMediaType=function(e){switch(e){case L.MediaType.Audio:return 0;case L.MediaType.Video:return 1;case L.MediaType.PanoramicCamera:return 2;case L.MediaType.AppSharing:return 3;case L.MediaType.Data:return 4;default:return}},t.toMediaDirection=function(e){switch(e){case 0:return L.MediaDirection.Disabled;case 3:return L.MediaDirection.Inactive;case 2:return L.MediaDirection.SendToPeer;case 1:return L.MediaDirection.ReceiveFromPeer;case 4:return L.MediaDirection.Bidirectional;default:return L.MediaDirection.Disabled}},t.toAnswerMediaType=function(e){switch(e){case 0:return L.AnswerMediaType.AnswerWithAudioOnly;case 1:return L.AnswerMediaType.AnswerWithAudioVideo;case 2:return L.AnswerMediaType.AnswerWithScreenshareOnly;default:return L.AnswerMediaType.AnswerWithAudioOnly}},t.convertMuteScope=function(e){switch(e){case 0:return L.MuteScope.All;case 1:return L.MuteScope.Specified;default:return}},t.convertToSlimCoreMediaPeerType=function(e){switch(e){case 0:return L.MediaPeerType.ConsumerTwoParty;case 1:return L.MediaPeerType.ConsumerPstn;case 2:return L.MediaPeerType.ConsumerMultiParty;case 3:return L.MediaPeerType.EnterpriseTwoPartyOnlineOnly;case 4:return L.MediaPeerType.EnterpriseTwoPartyHybrid;case 6:return L.MediaPeerType.EnterprisePstnOnlineOnly;case 7:return L.MediaPeerType.EnterprisePstnHybrid;case 5:return L.MediaPeerType.EnterpriseMultiParty;case 8:return L.MediaPeerType.EnterpriseFederated;case 9:return L.MediaPeerType.EnterpriseUnknown;case 10:return L.MediaPeerType.EnterpriseMultiPartyBroadcasting;default:return}},t.convertPushHandlingResult=function(e){switch(e){case L.PushHandlingResult.BadNotificationPayload:return{code:0,fatal:!0};case L.PushHandlingResult.CallSetupSucceeded:return{code:1,success:!0};case L.PushHandlingResult.BadNotificationEventType:return{code:3,fatal:!0};case L.PushHandlingResult.CallSetupSucceededCallAlreadyExists:return{code:4};case L.PushHandlingResult.CallSetupFailedCannotConnect:return{code:5,fatal:!0};case L.PushHandlingResult.CallSetupFailedNoSignaling:return{code:6,fatal:!0};case L.PushHandlingResult.CallSetupFailedConflict:return{code:7};case L.PushHandlingResult.CallSetupFailedPushIgnored:return{code:8};case L.PushHandlingResult.CallSetupFailedAnsweredElsewhere:return{code:9};case L.PushHandlingResult.CallSetupFailedAlreadyEnded:return{code:10};case L.PushHandlingResult.CallSetupProgress:return{code:11,success:!0};case L.PushHandlingResult.CallSetupFailed:case L.PushHandlingResult.CallSetupFailedNoPermission:case L.PushHandlingResult.CallSetupFailedNoCommonCodec:default:return{code:2,fatal:!0}}},Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChanged())},enumerable:!0,configurable:!0}),t.isCallConnected=function(e){return e===L.CallStatus.InProgress},t.isObserving=function(e){return e===L.CallStatus.Observing},t.isCallRinging=function(e){switch(e){case L.CallStatus.RingingOut:case L.CallStatus.RingingIn:return!0;default:return!1}},t.isCallConnecting=function(e){return e===L.CallStatus.Routing},t.isCallEarlyMedia=function(e){return e===L.CallStatus.EarlyMedia},t.isCallInLobby=function(e){return e===L.CallStatus.InLobby},t.isCallPreheating=function(e){return e===L.CallStatus.Preheating},t.isCallPreheated=function(e){return e===L.CallStatus.Preheated},t.isCallTerminated=function(e){switch(e){case L.CallStatus.Missed:case L.CallStatus.Refused:case L.CallStatus.Busy:case L.CallStatus.Cancelled:case L.CallStatus.Finished:case L.CallStatus.Failed:case L.CallStatus.Dropped:case L.CallStatus.DeniedInLobby:case L.CallStatus.TimedOutInLobby:return!0;default:return!1}},t.prototype._cleanCallResources=function(e){return c(this,void 0,void 0,function(){var t,n;return u(this,function(r){switch(r.label){case 0:t=this._logger.createFnLogger("cleanCallResources",e),r.label=1;case 1:return r.trys.push([1,,9,10]),n=p.map(this.participants,function(e){return C.forgetAndLog(e.stopVideos(),t,"cleanCallResources: stopping participant videos failed")}),[4,Promise.all(n)];case 2:return r.sent(),this._localScreenShareStream?[4,C.forgetAndLog(this.stopScreenSharing(!1,e),t,"cleanCallResources: LocalScreenShare stop failed")]:[3,4];case 3:r.sent(),r.label=4;case 4:return this._localVideo?[4,C.forgetAndLog(this._localVideo.stop(e),t,"cleanCallResources: LocalVideo stop failed")]:[3,6];case 5:r.sent(),r.label=6;case 6:return this._localVideoPreview?[4,C.forgetAndLog(this._localVideoPreview.stop(e),t,"cleanCallResources: LocalVideoPreview stop failed")]:[3,8];case 7:r.sent(),r.label=8;case 8:return this.contentSharingSessions.forEach(function(t){t.setContentSharingStatus(7),t.dispose(e)}),this.contentSharingSessions=[],[3,10];case 9:return this.dispose(e),[7];case 10:return[2]}})})},t.prototype.dispose=function(t){var n=this._logger.createFnLogger("dispose",t);n.info("start"),this.subscriptions.length&&n.info(this.subscriptions.length+" subscriptions will be lost"),this._slimCoreElectronRemoteManager&&this._slimCoreElectronRemoteManager.dispose(),this.mediaStreams[0]=[],this.mediaStreams[1]=[],this._localScreenShareStream&&(this._localScreenShareStream.dispose(t),this._localScreenShareStream=null),this._localVideo&&(this._localVideo.dispose(t),this._localVideo=null),this._localVideoPreview&&(this._localVideoPreview.dispose(t),this._localVideoPreview=null),this._localVideoContainer&&(this._localVideoContainer=null),this.screenSharingControl&&(this.screenSharingControl.dispose(),this.screenSharingControl=null),this.dataChannelAdapter&&(this.dataChannelAdapter.dispose(),this.dataChannelAdapter=null),this._dataChannel&&(this._dataChannel.dispose(),this._dataChannel=null),this._dataChannelUsers&&(this._dataChannelUsers=null),this.participants.forEach(function(e){return e.dispose()}),e.prototype.dispose.call(this,t)},t.prototype.testTriggerMediaRelayWhiteListingIssue=function(){throw new Error("testTriggerMediaRelayWhiteListingIssue not implemented in electron call")},t.prototype.testSetCallState=function(e){this._logger.info("Overwriting call state for test purposes: "+this.state+" -> "+e),this.state=e},a([_.callOperation(f.CALL_OPERATIONS.INITIALIZE,{type:_.OPERATION_TYPE.SYNC}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],t.prototype,"init",null),a([_.callOperation(f.CALL_OPERATIONS.JOIN_CALL,{type:_.OPERATION_TYPE.CHAINED}),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"join",null),a([_.callOperation(f.CALL_OPERATIONS.START_CALL,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"start",null),a([_.callOperation(f.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"startCallToVoicemail",null),a([_.callOperation(f.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:_.OPERATION_TYPE.CHAINED}),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Array,Object,Object]),s("design:returntype",Promise)],t.prototype,"startCallWithNudge",null),a([_.callOperation(f.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:_.OPERATION_TYPE.CHAINED}),l(3,_.causeId),s("design:type",Function),s("design:paramtypes",[Number,String,Object,Object]),s("design:returntype",Promise)],t.prototype,"startAndUnpark",null),a([_.callOperation(f.CALL_OPERATIONS.SUBSCRIBE,{type:_.OPERATION_TYPE.CHAINED}),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"joinCallWithoutCallModality",null),a([_.callOperation(f.CALL_OPERATIONS.JOIN_PREHEATED_CALL),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"joinPreheatedCall",null),a([_.callOperation(f.CALL_OPERATIONS.SET_VIDEO_CONTAINER),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],t.prototype,"setVideoContainer",null),a([_.callOperation(f.CALL_OPERATIONS.START_VIDEO),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startVideo",null),a([_.callOperation(f.CALL_OPERATIONS.STOP_VIDEO),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"stopVideo",null),a([_.callOperation(f.CALL_OPERATIONS.START_PREVIEW_VIDEO),l(0,_.causeId),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],t.prototype,"_startPreviewVideo",null),a([_.callOperation(f.CALL_OPERATIONS.START_LOCAL_VIDEO),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],t.prototype,"_startLocalVideo",null),a([_.callOperation(f.CALL_OPERATIONS.SET_VIDEO_EFFECTS),s("design:type",Function),s("design:paramtypes",[Number]),s("design:returntype",Promise)],t.prototype,"setVideoEffects",null),a([_.callOperation(f.CALL_OPERATIONS.GET_VIDEO_EFFECTS_CAPABILITIES),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"getVideoEffectsCapability",null),a([_.callOperation(f.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"dumpVideoSourceImages",null),a([_.callOperation(f.CALL_OPERATIONS.START_SCREEN_SHARING),l(3,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object,String,Object]),s("design:returntype",Promise)],t.prototype,"startScreenSharing",null),a([_.callOperation(f.CALL_OPERATIONS.STOP_SCREEN_SHARING),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Boolean,String,Object]),s("design:returntype",Promise)],t.prototype,"stopScreenSharing",null),a([_.callOperation(f.CALL_OPERATIONS.START_DATA_CHANNEL),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startDataChannel",null),a([_.callOperation(f.CALL_OPERATIONS.STOP_DATA_CHANNEL),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"stopDataChannel",null),a([_.callOperation(f.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS),s("design:type",Function),s("design:paramtypes",[Boolean]),s("design:returntype",Promise)],t.prototype,"shareSystemSound",null),a([_.callOperation(f.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"callBlindTransfer",null),a([_.callOperation(f.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"callSafeTransfer",null),a([_.callOperation(f.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"callConsultativeTransfer",null),a([_.callOperation(f.CALL_OPERATIONS.PARK_CALL,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",Promise)],t.prototype,"park",null),a([_.callOperation(f.CALL_OPERATIONS.MUTE,{waitFor:f.CALL_OPERATIONS.UNMUTE}),l(0,_.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"mute",null),a([_.callOperation(f.CALL_OPERATIONS.UNMUTE,{waitFor:f.CALL_OPERATIONS.MUTE}),l(0,_.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"unmute",null),a([_.callOperation(f.CALL_OPERATIONS.MUTE_SPEAKER,{waitFor:f.CALL_OPERATIONS.UNMUTE_SPEAKER}),l(0,_.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"muteSpeaker",null),a([_.callOperation(f.CALL_OPERATIONS.UNMUTE_SPEAKER,{waitFor:f.CALL_OPERATIONS.MUTE_SPEAKER}),l(0,_.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"unmuteSpeaker",null),a([_.callOperation(f.CALL_OPERATIONS.MUTE_PARTICIPANTS),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Number,Array,Object]),s("design:returntype",Promise)],t.prototype,"muteParticipants",null),a([_.callOperation(f.CALL_OPERATIONS.HOLD,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"hold",null),a([_.callOperation(f.CALL_OPERATIONS.UNHOLD,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"unhold",null),a([_.callOperation(f.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"updateEndpointMetadata",null),a([_.callOperation(f.CALL_OPERATIONS.SEND_DTMF_TONE,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",Promise)],t.prototype,"sendDtmfTone",null),a([_.callOperation(f.CALL_OPERATIONS.SET_AUDIO_USAGE),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"setAudioUsageMode",null),a([_.callOperation(f.CALL_OPERATIONS.START_AUDIO,{waitFor:f.CALL_OPERATIONS.STOP_AUDIO}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"startAudio",null),a([_.callOperation(f.CALL_OPERATIONS.STOP_AUDIO,{waitFor:f.CALL_OPERATIONS.START_AUDIO}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"stopAudio",null),a([_.callOperation(f.CALL_OPERATIONS.ASSIMILATE,{waitFor:f.CALL_OPERATIONS.ASSIMILATE}),l(3,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],t.prototype,"assimilate",null),a([_.callOperation(f.CALL_OPERATIONS.STOP_CALL),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"stop",null),a([_.callOperation(f.CALL_OPERATIONS.REJECT),l(0,_.causeId),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],t.prototype,"reject",null),a([_.callOperation(f.CALL_OPERATIONS.ACKNOWLEDGE,{type:_.OPERATION_TYPE.CHAINED}),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"acknowledge",null),a([_.callOperation(f.CALL_OPERATIONS.ACCEPT),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],t.prototype,"accept",null),a([_.callOperation(f.CALL_OPERATIONS.RECONNECT),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],t.prototype,"reconnect",null),a([_.callOperation(f.CALL_OPERATIONS.ELECTRON_PROVIDE_CQF),s("design:type",Function),s("design:paramtypes",[String,String,Number,String]),s("design:returntype",Promise)],t.prototype,"provideCallQualityFeedback",null),a([_.participantOperation(f.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),l(0,_.operationId),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],t.prototype,"admitParticipant",null),a([_.participantOperation(f.PARTICIPANT_OPERATIONS.CALL_ME_BACK),l(0,_.operationId),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[String,String,Object]),s("design:returntype",Promise)],t.prototype,"callMeBack",null),a([_.participantOperation(f.CALL_OPERATIONS.NUDGE_PARTICIPANTS),l(0,_.operationId),l(3,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Array,Object,Object]),s("design:returntype",Promise)],t.prototype,"nudgeParticipants",null),a([_.participantOperation(f.CALL_OPERATIONS.UPDATE_MEETING_ROLE),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[Array,String,Object]),s("design:returntype",Promise)],t.prototype,"updateMeetingRoles",null),a([_.participantOperation(f.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT),l(0,_.operationId),l(2,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],t.prototype,"addParticipant",null),a([_.participantOperation(f.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),l(0,_.operationId),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[String,Object,String,Number]),s("design:returntype",Promise)],t.prototype,"removeParticipant",null),a([_.callOperation(f.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS),l(1,_.causeId),s("design:type",Function),s("design:paramtypes",[Number,Object]),s("design:returntype",Promise)],t.prototype,"setMaxVideoChannels",null),t}(S.default);t.default=F},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(22),s=n(9),l=n(0),c=n(1),u=SlimCore.Enums;t.DATA_SOURCE_ID_ANY=4294967294;var d=function(e){function t(t,n,r,i,o,s,l,c){var d=e.call(this,t.createChild(function(){return"SlimCoreElectronDataChannel"}),n,r)||this;d._call=i,d._slimcoreCallHandler=o,d._dataChannel=s,d._dataChannelUsers=l,d.id=c,d._dataChannelActive=!1,d._protocolDataSource=null,d._protocolDataSink=null,d._dataChannelAdapterSetInternalSourceSink=null,d._lastDataChannelState=u.DataChannelStatus.Unknown,d._asyncOperationHandler=new a.default(d._logger),d._logger.info("Setting DataChannel on all users");for(var p=0;p<d._dataChannelUsers.length;p++)if(d._dataChannelUsers[p])try{d._dataChannelUsers[p].setDataChannel(d)}catch(e){d._logger.error("Exception calling setDataChannel for i="+p+" error="+e)}return d._hookSlimCorePropertyChangedEvents(),d}return i(t,e),t.prototype.setAdapterSourceSinkCallback=function(e){this._dataChannelAdapterSetInternalSourceSink=e},t.prototype._hookSlimCorePropertyChangedEvents=function(){var e=this;this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectId:this.id,propKey:u.Property.DataChannelStatus},function(t){return e._onDataChannelStatusChanged(t.value)}));var t=this._getIntProperty(this._slimcoreCallHandler,this.id,u.Property.DataChannelStatus);this._onDataChannelStatusChanged(t)},t.prototype.start=function(e){var t=this;return this._dataChannelActive?(this._logger.info("start() called when channel already active"),Promise.resolve()):(this._asyncOperationHandler.hasPendingOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL)?this._logger.info("start promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL),o.asap(function(){return t._startDataChannel(e)})),this._asyncOperationHandler.waitForOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL))},t.prototype.stop=function(e){var t=this;return this._dataChannelActive?(this._asyncOperationHandler.hasPendingOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL)?this._logger.info("stop promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL),o.asap(function(){return t._stopDataChannel(e)})),this._asyncOperationHandler.waitForOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL)):(this._logger.info("stop() called when channel not active"),Promise.resolve())},t.prototype.registerDataSource=function(e){var t=this;return o.asap(function(){return t._dataChannel.registerDataSource(e)})},t.prototype.unregisterDataSource=function(e){var t=this;return o.asap(function(){return t._dataChannel.unregisterDataSource(e)})},t.prototype.registerDataSink=function(e){var t=this;return o.asap(function(){return t._dataChannel.registerDataSink(e)})},t.prototype.unregisterDataSink=function(e){var t=this;return o.asap(function(){return t._dataChannel.unregisterDataSink(e)})},t.prototype._onDataChannelStatusChanged=function(e){if(this._logger.info("Data channel status = "+e),e===u.DataChannelStatus.Active){this._asyncOperationHandler.maybeResolveOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL);try{this._dataChannel.setDataDevices()}catch(e){this._logger.error("setDataDevices threw exception: "+e)}this._dataChannel&&!this._dataChannelActive&&(this._dataChannelActive=!0,this._createAndAttachProtocolDevices(),this._dataChannelAdapterSetInternalSourceSink&&this._dataChannelAdapterSetInternalSourceSink(u.DataDeviceId.Protocol,this._protocolDataSource,this._protocolDataSink),this._logger.info("Data channel ready"))}else e===u.DataChannelStatus.Available&&(this._asyncOperationHandler.maybeResolveOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL),this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._detachAndDeleteProtocolDevices(),this._logger.info("Data channel disposed")));this._lastDataChannelState===u.DataChannelStatus.Starting&&e!==u.DataChannelStatus.Active?this._asyncOperationHandler.maybeRejectOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL):this._lastDataChannelState===u.DataChannelStatus.Stopping&&e!==u.DataChannelStatus.Available&&this._asyncOperationHandler.maybeRejectOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL);for(var n=0;n<this._dataChannelUsers.length;n++)try{this._dataChannelUsers[n].onDataChannelStatusChanged(e)}catch(e){this._logger.error("Exception calling onDataChannelStatusChanged for i="+n+" error="+e)}this._lastDataChannelState!==e&&(this.event("stateChange").raise(t._mapDataChannelStatus(e)),this._lastDataChannelState=e)},t.prototype._updateProtocolDataSource=function(e){this._logger.info("Setting Protocol DataSource on all users");for(var t=0;t<this._dataChannelUsers.length;t++)if(this._dataChannelUsers[t])try{this._dataChannelUsers[t].setProtocolDataSource(e)}catch(e){this._logger.error("Exception calling setProtocolDataSource for i="+t+" error="+e)}},t.prototype._createAndAttachProtocolDevices=function(){var e=this;if(this._logger.info("_createAndAttachProtocolDevices()"),l.hasCreateDataSource(this._slimcoreInstance)&&l.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){if(!this._protocolDataSource){this._protocolDataSource=l.createDataSource(this._slimcoreInstance,u.DataDeviceId.Protocol);try{this._dataChannel.registerDataSource(this._protocolDataSource),this._logger.info("created Protocol data source")}catch(e){this._logger.error("registerDataSource threw exception: "+e)}}if(!this._protocolDataSink){this._protocolDataSink=l.createDataSink(this._slimcoreInstance,u.DataDeviceId.Protocol);try{this._dataChannel.registerDataSink(this._protocolDataSink),this._logger.info("created Protocol data sink")}catch(e){this._logger.error("registerDataSink threw exception: "+e)}}this._protocolDataSink.on("data",function(t){try{var n=JSON.parse(l.bufferToString(t.data));if(1!==n.type){n.type>=e._dataChannelUsers.length&&e._logger.error("Error calling processProtocolMessage i="+n.type+" error=Index out of bounds");try{var r=e._call.mapDataChannelSourceIdToParticipant(t.sourceID),i=void 0;if(r)i=r.getParticipantIdForSourceId(4,t.sourceID);e._dataChannelUsers[n.type].processProtocolMessage(n.message,r,i,t.sourceID)}catch(t){e._logger.error("Error calling processProtocolMessage i="+n.type+" error="+t)}}}catch(t){e._logger.error("Error handling protocol message error="+t)}}),this._updateProtocolDataSource(this._protocolDataSource)}else this._logger.warn("_createAndAttachProtocolDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._detachAndDeleteProtocolDevices=function(){if(this._logger.info("_detachAndDeleteProtocolDevices()"),this._protocolDataSink&&this._protocolDataSink.removeAllListeners("data"),this._dataChannel){if(this._protocolDataSource){try{this._dataChannel.unregisterDataSource(this._protocolDataSource)}catch(e){this._logger.warn("unregisterDataSource threw exception for protocol, call probably ended: "+e)}this._protocolDataSource=null,this._updateProtocolDataSource(null),this._logger.info("deleted Protocol data source")}if(this._protocolDataSink){try{this._dataChannel.unregisterDataSink(this._protocolDataSink)}catch(e){this._logger.warn("unregisterDataSink threw exception for protocol, call probably ended: "+e)}this._protocolDataSink=null,this._logger.info("deleted Protocol data sink")}}else this._logger.warn("_detachAndDeleteProtocolDevices() null dataChannel")},t.prototype._startDataChannel=function(e){if(this._logger.info("_startDataChannel()"),this._dataChannel){try{this._dataChannel.start(e)}catch(e){this._logger.error("_dataChannel.start threw exception: "+e)}this._logger.info("Data channel started")}},t.prototype._stopDataChannel=function(e){if(this._logger.info("_stopDataChannel()"),this._dataChannel){try{this._dataChannel.stop(e)}catch(e){this._logger.error("_dataChannel.stop threw exception: "+e)}this._logger.info("Data channel stopping")}},t._mapDataChannelStatus=function(e){switch(e){case u.DataChannelStatus.Available:return 1;case u.DataChannelStatus.Starting:return 2;case u.DataChannelStatus.Active:return 3;case u.DataChannelStatus.Stopping:return 4;case u.DataChannelStatus.NotStarted:return 5;case u.DataChannelStatus.Unknown:default:return 0}},t.prototype.dispose=function(){this._logger.info("SlimCoreElectronDataChannel.dispose()"),this._detachAndDeleteProtocolDevices(),this._call=null,this._dataChannel&&(this._dataChannel.dispose&&this._dataChannel.dispose(),this._dataChannel=null),e.prototype.dispose.call(this)},t}(c.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTsCallingVersion=function(){return"2019.16.01.3"},t.getOvb=function(){return"587405c759e957ea72533b78a4896d9650fdb985"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e){this._logger=e,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return e.prototype.chainPromise=function(e,t,n,i){var o=this;void 0===n&&(n=r.default()),void 0===i&&(i=!1);var a=Date.now(),s=(("function"==typeof t?t():t)||"").toString();this._actionQueue.push(s),this._logger.info("["+n+"]["+s+"]enqueueing, queue=["+this._actionQueue+"], reset="+i);var l=function(){o._actionQueue=o._actionQueue.filter(function(e){return e!==s})};return i&&this.reset(n),this._promise=this._promise.catch(function(){}).then(function(){var t=Date.now()-a;return o._logger.info("["+n+"]["+s+"]begin, delayMs="+t),e()}),this._promise.then(function(){l();var e=Date.now()-a;o._logger.info("["+n+"]["+s+"]success, durationMs="+e)},function(e){l();var t=Date.now()-a;o._logger.warn("["+n+"]["+s+"]failed="+e+", drationMs="+t)}),this._promise},e.prototype.reset=function(e){this._logger.info("["+e+"] resetting"),this._promise=Promise.resolve(void 0)},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(0),s=n(1),l=n(16),c=SlimCore.Enums,u=n(6),d=function(e){function t(t,n,r,i,o,s,l,u){void 0===u&&(u=!1);var d=e.call(this,t.createChild(function(){return"SlimCoreElectronRemoteStreamManager["+d._slimcoreParticipantObjectId+"]"}),n,r)||this;return d._callHandler=i,d._slimcoreParticipantObjectId=o,d._streams=s,d._streamContextMap=l,d._logger.info("constructor"),a.hasFeature(c.Feature.RemoteVideosCountChanged)||d._registerDisposable(d._slimcoreInstance.handle("object-property-changed",{objectId:d._slimcoreParticipantObjectId,propKey:c.Property.ParticipantVideoCountChanged},function(e){return d._onVideoCountChangedDeferred()})),d._registerDisposable(d._callHandler.handle("remote-videos-count-changed",{participantObjectId:d._slimcoreParticipantObjectId},function(e){return d._onVideoCountChangedDeferred()})),u||d._onVideoCountChangedDeferred(),d}return i(t,e),t.prototype._onVideoCountChangedDeferred=function(){var e=this;this._onVideoCountChangedDefer||(this._onVideoCountChangedDefer=o.defer(function(){delete e._onVideoCountChangedDefer,e._onVideoCountChanged()}))},t.prototype._onVideoCountChanged=function(){var e=this,t=this._callHandler.callGetParticipantVideos(this._slimcoreParticipantObjectId);if(t){var n={};n[c.VideoType.Video]=[],n[c.VideoType.ScreenShare]=[],t.forEach(function(t){var r=e._getIntProperty(e._callHandler,t,c.Property.VideoType),i=e._getIntProperty(e._callHandler,t,c.Property.VideoStatus);r!==c.VideoType.Augmented&&n[r].push({videoObjectId:t,videoType:r,videoStatus:i})}),this._handleVideoCountChanged(c.VideoType.Video,n[c.VideoType.Video]),this._handleVideoCountChanged(c.VideoType.ScreenShare,n[c.VideoType.ScreenShare]),this.raiseChanged()}},t.prototype._handleVideoCountChanged=function(e,n){var r=this,i=t.SlimcoreVideoTypeToStreamType(e),a=this._streams[i],s=o.filter(a,function(e){return!o.some(n,function(t){return t.videoObjectId===e.id})});o.each(s,function(e){r._logger.info("_handleVideoCountChanged: removing stream "+e.id+" (stream type: "+i+")"),o.remove(a,e),e.dispose()}),o.each(n,function(e){if(!o.some(a,function(t){return t.id===e.videoObjectId})){r._logger.info("_handleVideoCountChanged: adding stream "+e.videoObjectId+" (stream type: "+i+")");var t=new l.default(r._logger,r._settings,r._slimcoreInstance,r._slimcoreParticipantObjectId,e.videoObjectId,i,r._callHandler,r._streamContextMap[i]);r._streams[i].push(t),t.changed(function(){return r.raiseChanged()})}})},t.prototype.stopVideos=function(){this._logger.info("stopVideos");var e=function(e){return e.disposeInternal()};return Promise.all(o.flatMap(o.values(this._streams),function(t){return o.map(t,e)})).then(u.noop)},t.prototype.dispose=function(){this._logger.info("dispose"),o.each(o.values(this._streams),function(e){return o.each(e,function(e){return e.dispose()})}),this._streams[0]=[],this._streams[1]=[],e.prototype.dispose.call(this)},t.SlimcoreVideoTypeToStreamType=function(e){switch(e){case c.VideoType.ScreenShare:return 1;case c.VideoType.Video:return 0;default:return}},t}(s.default);t.default=d},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(4),l=n(2),c=n(14),u=n(0),d=n(1),p=n(27),h=SlimCore.Enums,f=function(){return function(e){this.nrRunningStreams=0,this.videoStoppedEvent=new u.VideoStateCancelEvent}}();t.SlimCoreElectronRemoteStreamContext=f;var g=0,_=function(e){function t(t,n,r,i,o,a,s,d){var p=e.call(this,t.createChild(function(){return"RemoteStream("+p._context.nrRunningStreams+")["+p._remoteVideoId+":"+p.rank+":"+p._mediaType+":"+p._videoStatus+"]"}),n,r)||this;p._participantId=i,p.id=o,p.type=a,p._callHandler=s,p._context=d,p._remoteVideoId=0,p._videoStatus=h.VideoStatus.None,p._stateCancelEvent=new u.VideoStateCancelEvent,p._shouldRun=!1,p._isDisposed=!1,p._nrRenderers=0,p._nrOngoingStreamStarts=0,p._msi=0,p._chainedApiPromise=new c.default(t.createChild(function(){return"RemoteStreamChain("+p._context.nrRunningStreams+")"})),p._remoteVideoId=o,p.rank=g++;var f=p._getProperties(p._callHandler,p._remoteVideoId,{endpointId:{propKey:h.Property.VideoEndpointId},participantId:{propKey:h.Property.VideoParticipantLegId},negotiationTag:{propKey:h.Property.VideoNegotiationTag}},{mediaType:{propKey:h.Property.VideoType},videoStatus:{propKey:h.Property.VideoStatus},msi:{propKey:h.Property.VideoRank}});p._mediaType=f.mediaType,p._videoStatus=f.videoStatus;var _=l.default();return p._logger.info("constructor causeId: "+_),p._onVideoObjectPropertyChanged(h.Property.VideoStatus,function(e){return p._onVideoObjectStateChanged(_)}),p._onVideoObjectPropertyChanged(h.Property.VideoNegotiationTag,function(e){return p._onVideoNegotiationTagChanged(e.value)}),p.endpointId=f.endpointId,p.participantId=f.participantId,p._msi=f.msi,p.negotiationTag=f.negotiationTag,p}return i(t,e),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming,negotiationTag:this.negotiationTag,video_status:this._videoStatus,msi:this._msi,shouldRun:this._shouldRun,nrRenderers:this._nrRenderers,isDisposed:this._isDisposed})},Object.defineProperty(t.prototype,"isAvailable",{get:function(){return u.isVideoAvailable(this._videoStatus)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStreaming",{get:function(){return this._videoStatus===h.VideoStatus.Running},enumerable:!0,configurable:!0}),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype.start=function(e,t){return o(this,void 0,void 0,function(){var n,r,i,o,s,c,d,p,h=this;return a(this,function(a){switch(a.label){case 0:n=Date.now(),r=n,i=n,o=l.default(),this._shouldRun=!0,this._nrOngoingStreamStarts++,this._logger.info("start causeId: "+o),a.label=1;case 1:return a.trys.push([1,8,9,10]),[4,u.waitForVideoObjectToBeAvailable(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,0,this._stateCancelEvent)];case 2:return a.sent(),r=Date.now(),[4,this._chainedApiPromise.chainPromise(function(){return h._startVideo(o,e,t)},this._chainActionFn("start"),o)];case 3:s=a.sent(),i=Date.now(),a.label=4;case 4:return a.trys.push([4,6,,7]),this._throwIfDisposed(o,"disposed while in start"),[4,u.waitForVideoObjectToBeRunning(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,0,this._stateCancelEvent)];case 5:return a.sent(),this._updateVideoStatus(o),p=Date.now(),this._logger.info("start causeId: "+o+" successful. duration: "+(p-n)+" ("+(r-n)+"+"+(i-r)+"+"+(p-i)+")"),[2,s];case 6:throw c=a.sent(),s.dispose(),c;case 7:return[3,10];case 8:throw d=a.sent(),p=Date.now(),this._logger.warn("start causeId: "+o+" failed. duration: "+(p-n)+" ("+(r-n)+"+"+(i-r)+"+"+(p-i)+") error: "+d),d;case 9:return this._nrOngoingStreamStarts--,[7];case 10:return[2]}})})},t.prototype.stop=function(){return o(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return e=l.default(),[4,this._stopWithCauseId(this._chainActionFn("stop"),e)];case 1:return t.sent(),[2]}})})},t.prototype.dispose=function(){var e=l.default();this._disposeWithCauseId(this._chainActionFn("dispose"),e)},t.prototype.disposeInternal=function(){return o(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return e=l.default(),[4,this._disposeWithCauseId(this._chainActionFn("disposeInternal"),e)];case 1:return t.sent(),[2]}})})},t.prototype._stopWithCauseId=function(e,t){return o(this,void 0,void 0,function(){var n=this;return a(this,function(r){switch(r.label){case 0:return this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise(function(){return n._stopVideo(t,!1)},e,t)];case 1:return r.sent(),[2]}})})},t.prototype.registerRenderer=function(e){this._nrRenderers++},t.prototype.unregisterRenderer=function(e){if(0==--this._nrRenderers&&0===this._nrOngoingStreamStarts){var t=l.default();this._stopWithCauseId(this._chainActionFn("renderers disposed"),t)}},t.prototype._chainActionFn=function(e){var t=this;return function(){return e+" ["+t._participantId+":"+t._remoteVideoId+":"+t.rank+":"+t._mediaType+":"+t._videoStatus+"]"}},t.prototype._isVideoStatusInStopping=function(){return this._videoStatus===h.VideoStatus.Stopping},t.prototype._updateVideoStatus=function(e){var t=this._getIntProperty(this._callHandler,this._remoteVideoId,h.Property.VideoStatus);this._videoStatus!==t&&(this._logger.info("VideoStateChanged: causeId: "+e+" status: "+this._videoStatus+" -> "+t),this._videoStatus=t,this._isVideoStatusInStopping()&&this._videoWasStopped(e),this.raiseChanged())},t.prototype._disposeWithCauseId=function(e,t){return o(this,void 0,void 0,function(){var n=this;return a(this,function(r){switch(r.label){case 0:return this._isDisposed=!0,this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise(function(){return n._dispose(t)},e,t)];case 1:return r.sent(),[2]}})})},t.prototype._onVideoObjectPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.id,e,t)},t.prototype._onVideoObjectStateChanged=function(e){this._updateVideoStatus(e)},t.prototype._onVideoNegotiationTagChanged=function(e){this.negotiationTag!==e&&(this.negotiationTag=e,this.raiseChanged())},t.prototype._videoWasStopped=function(e){this._stopWithCauseId(this._chainActionFn("discovered video stopped"),e)},t.prototype._isRunning=function(){return!!this._videoBinding},t.prototype._stopVideo=function(e,t){return o(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return this._shouldRun&&!t&&!this._isVideoStatusInStopping()||!this._isRunning()?[3,3]:(this._logger.info("_stopVideo causeId: "+e+" force: "+t+" will stop remote video now"),this._slimcoreInstance.videoStop(this._remoteVideoId),[4,u.forgetAndLog(this._slimcoreInstance.videoReleaseBinding(this._remoteVideoId,this._videoBinding),this._logger,"_stopVideo causeId: "+e+" videoReleaseBinding on remote video failed")]);case 1:return n.sent(),this._videoBinding=null,[4,u.waitForVideoObjectToBeStopped(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger)];case 2:return n.sent(),this._context.nrRunningStreams--,this._logger.info("_stopVideo causeId: "+e+" force: "+t+" remote video is stopped"),this._updateVideoStatus(e),this._context.videoStoppedEvent.fire(),[3,4];case 3:this._logger.info("_stopVideo causeId: "+e+" noop, force: "+t+" should run: "+this._shouldRun+" is running: "+this._isRunning()+" already disposed: "+this._isDisposed),n.label=4;case 4:return[2]}})})},t.prototype._startVideo=function(e,t,n){return o(this,void 0,void 0,function(){var r,i;return a(this,function(o){switch(o.label){case 0:return[4,this._getStartedVideo(e)];case 1:r=o.sent(),o.label=2;case 2:return o.trys.push([2,3,,6]),this._updateVideoStatus(e),this._logger.info("_startVideo causeId: "+e+" create renderer"),[2,new p.default(this._logger,this._settings,null,t,this._mediaType,this._videoBinding,n,this)];case 3:return i=o.sent(),r?[4,u.forgetAndLog(this._stopVideo(e,!0),this._logger,"_startVideo causeId: "+e+" stopping remote video failed while got error while starting video")]:[3,5];case 4:o.sent(),o.label=5;case 5:throw i;case 6:return[2]}})})},t.prototype._dispose=function(t){return o(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,u.forgetAndLog(this._stopVideo(t,!0),this._logger,"_dispose causeId: "+t+" stopping remote video failed")];case 1:return n.sent(),[3,3];case 2:return e.prototype.dispose.call(this),[7];case 3:return[2]}})})},t.prototype._getStartedVideo=function(e){return o(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:if(this._throwIfDisposed(e,"disposed while in _getStartedVideo"),!this._shouldRun)throw new Error("_getStartedVideo causeId: "+e+" failing, should not run any more");return this._isRunning()?[3,5]:(this._logger.info("_getStartedVideo causeId: "+e+" will start remote video now"),t=this._createVideoBindingRenderer(e),this._slimcoreInstance.videoStart(this._remoteVideoId),this._settings.enableRemoteStreamVideoBindingRetry?[4,this._videoCreateBinding(e,this._remoteVideoId,t)]:[3,2]);case 1:return n.sent(),[3,4];case 2:return[4,this._slimcoreInstance.videoCreateBinding(this._remoteVideoId,t)];case 3:n.sent(),n.label=4;case 4:return this._context.nrRunningStreams++,this._videoBinding=t,this._logger.info("_getStartedVideo causeId: "+e+" remote video is started"),[2,!0];case 5:return[2,!1]}})})},t.prototype._throwIfDisposed=function(e,t){if(this._isDisposed)throw new Error("_throwIfDisposed causeId: "+e+" reason: "+t)},t.prototype._createVideoBindingRenderer=function(e){return this._slimcoreInstance.createVideoBindingRenderer?(this._logger.info("_createVideoBindingRenderer causeId: "+e+" createVideoBindingRenderer"),this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!1})):(this._logger.info("_createVideoBindingRenderer causeId: "+e+" old createVideoBindingRenderer"),SlimCore.createVideoBindingRenderer())},t.prototype._videoCreateBinding=function(e,t,n){return o(this,void 0,void 0,function(){var r,i,l,c,d,p,h,f=this;return a(this,function(g){switch(g.label){case 0:r=10,i=200,l=s.defer(),c=this._stateCancelEvent.subscribe(function(){l.reject(new Error("_videoCreateBinding causeId: "+e+" stateCancelEvent got signalled"))}),d=s.defer(),p=this._context.videoStoppedEvent.subscribe(function(){f._logger.info("_videoCreateBinding causeId: "+e+" one of the videos was stopped will wake up for binding retry"),d.resolve()}),g.label=1;case 1:return g.trys.push([1,,3,4]),[4,(h=function(c){return o(f,void 0,void 0,function(){var o;return a(this,function(a){switch(a.label){case 0:if(this._throwIfDisposed(e,"disposed while in _videoCreateBinding on retry attempt: "+c),!u.isVideoAvailable(this._videoStatus))throw new Error("_videoCreateBinding causeId: "+e+" video not available any more on retry attempt: "+c);o=d.promise,d=s.defer(),this._logger.info("_videoCreateBinding causeId: "+e+" try to create video binding from slimcore on retry attempt: "+c),a.label=1;case 1:return a.trys.push([1,3,,6]),[4,this._slimcoreInstance.videoCreateBinding(t,n)];case 2:return a.sent(),[3,6];case 3:if(a.sent(),!(c<r))throw new Error("_videoCreateBinding causeId: "+e+" retry attempt: "+c+" exceed");return[4,Promise.race([o,d.promise,l.promise,s.delay(i)])];case 4:return a.sent(),[4,h(c+1)];case 5:return a.sent(),[3,6];case 6:return[2]}})})})(1)];case 2:return g.sent(),[3,4];case 3:return c.dispose(),p.dispose(),[7];case 4:return[2]}})})},t}(d.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=function(){function e(e){var t=this;this._callingLogger=e,this._maybeLog=function(e){for(var n,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];try{(n=t._callingLogger)[e].apply(n,i)}catch(e){t._callingLogger.info("[failed to log]",r.getPrintableObject(e))}}}return e.prototype.getPrefix=function(e,t){var n="";return t&&(n+="["+t+"]"),e&&(n+="["+e+"]"),n},e.prototype.createChild=function(t,n){return new e(this._callingLogger.createChild(t,n))},e.prototype.createFnLogger=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e(this._callingLogger.createChild(this.getPrefix(t,n)+r.join(""),!1))},e.prototype.logSuccess=function(e){this._maybeLog("info","success="+e+"}")},e.prototype.logFailure=function(e){var t=r.getPrintableObject(e);this._maybeLog("info","failed="+t+"}")},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["log"].concat(e))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["debug"].concat(e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["info"].concat(e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["warn"].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["error"].concat(e))},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),l=n(14),c=n(0),u=n(10),d=n(28),p=SlimCore.Enums,h=0,f=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t.createChild(function(){return"LocalVideoPreview["+c._id+"]["+c._videoType+"]["+c._previewVideoObjectId+"]"}),n,r)||this;return c._currentTarget=i,c._deviceManager=o,c._videoType=a,c._options=s,c._id=h++,c._previewVideoObjectId=0,c._shouldRun=!1,c._logger.info("constructor"),c._chainedApiPromise=new l.default(t.createChild(function(){return"LocalVideoPreview["+c._id+"]["+c._videoType+"]["+c._previewVideoObjectId+"]"})),c._videoType!==p.VideoType.ScreenShare&&c._registerDisposable(c._deviceManager.on("devicesChanged",function(){return c._devicesChanged()})),c}return i(t,e),t.prototype._devicesChanged=function(e){var t=this;void 0===e&&(e=s.default()),this._logger.info("_devicesChanged causeId: "+e),this._chainedApiPromise.chainPromise(function(){return t._swapVideoDevice(e)},"swapVideoDevice",e)},t.prototype.startVideoAsync=function(e){var t=this;return this._logger.info("startVideoAsync causeId: "+e),this._shouldRun=!0,this._chainedApiPromise.chainPromise(function(){return t._startVideo(e)},"startVideoAsync",e)},t.prototype.stop=function(e){var t=this;return this._logger.info("stop causeId: "+e),this._shouldRun=!1,this._chainedApiPromise.chainPromise(function(){return t._stopVideo(e,!1)},"stopVideoAsync",e)},t.prototype.setVideoEffects=function(e,t){var n=this;return this._previewVideoObjectId?this._deviceManager.setVideoEffects(u.convertVideoEffectType(e),this._previewVideoObjectId):(this._logger.warn("setVideoEffects called with _previewVideoObjectId === 0. Setting the default cached effect value instead."),Promise.resolve().then(function(){n._slimcoreInstance.setDefaultStartingVideoEffects?n._slimcoreInstance.setDefaultStartingVideoEffects(u.convertVideoEffectType(e)):n._logger.warn("setDefaultStartingVideoEffects is not available")}).catch(function(e){throw n._logger.error("Failed to set Video Effects for preview, Error = "+e),e}))},t.prototype.getVideoEffectsCapability=function(){return this._previewVideoObjectId?this._deviceManager.getVideoEffectsCapability(this._previewVideoObjectId):Promise.reject(new Error("Cannot query effects when there is no preview video"))},t.prototype.dumpVideoSourceImages=function(){return this._previewVideoObjectId?this._slimcoreInstance.dumpVideoSourceImages(this._previewVideoObjectId):Promise.reject(new Error("Cannot dump video fx debug images when there is no preview video"))},t.prototype.dispose=function(e){var t=this;this._logger.info("dispose causeId: "+e),this._shouldRun=!1,this._chainedApiPromise.chainPromise(function(){return t._dispose(e)},"dispose",e)},t.prototype._isRunning=function(){return 0!==this._previewVideoObjectId&&!!this._videoBinding},t.prototype._dispose=function(t){var n=this;return c.forgetAndLog(this._stopVideo(t,!0),this._logger,"dispose causeId: "+t+" stopping video preview failed").then(function(){n._currentTarget=null,e.prototype.dispose.call(n,t)})},t.prototype._swapVideoDevice=function(e){return o(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this._shouldRun&&this._isRunning()&&this._currentTarget?(t=this._deviceManager.getSelectedCamera())&&this._currentCamera&&t.id!==this._currentCamera.id?(this._logger.info("_swapVideoDevice causeId: "+e+" will change video preview device: "+this._currentCamera.id+" -> "+t.id),[4,this._stopVideo(e,!0)]):[3,3]:[3,4];case 1:return n.sent(),[4,this._startVideo(e)];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:this._logger.info("_swapVideoDevice causeId: "+e+" noop, should run: "+this._shouldRun+" is running: "+this._isRunning()+" has target: "+!!this._currentTarget),n.label=5;case 5:return[2]}})})},t.prototype._startVideo=function(e){return o(this,void 0,void 0,function(){var t,n,r,i,o,s;return a(this,function(a){switch(a.label){case 0:if(!this._shouldRun||this._isRunning()||!this._currentTarget)return[3,4];if(t="",n="",this._videoType!==p.VideoType.ScreenShare){if(!(r=this._deviceManager.getSelectedCamera()))throw new Error("_startVideo causeId: "+e+" no camera selected to start video preview");t=r.label,n=r.id,this._currentCamera=r}return this._logger.info("_startVideo causeId: "+e+" will start video preview now for device name: "+t+" path: "+n),i=this,[4,this._deviceManager.getPreviewVideo(this._videoType,t,n)];case 1:return i._previewVideoObjectId=a.sent(),o=this,[4,this._deviceManager.getRendererBindingManager().acquire(this,this._previewVideoObjectId)];case 2:return o._videoBinding=a.sent(),s=this._options||{scalingMode:1,transparent:!1},[4,this._createVideoRenderer(this._currentTarget,s,!0)];case 3:return a.sent(),[3,5];case 4:this._logger.info("_startVideo causeId: "+e+" noop, should run: "+this._shouldRun+" is running: "+this._isRunning()+" has target: "+!!this._currentTarget),a.label=5;case 5:return[2]}})})},t.prototype._stopVideo=function(e,t){return o(this,void 0,void 0,function(){var n;return a(this,function(r){switch(r.label){case 0:if(this._shouldRun&&!t||!this._isRunning())return[3,2];this._logger.info("_stopVideo causeId: "+e+" force: "+t+" will stop video preview now");try{this._disposeVideoRenderer(e)}catch(t){this._logger.warn("_stopVideo causeId: "+e+" _disposeVideoRenderer error: "+t+" falied @ "+(new Error).stack)}return n=this._deviceManager.getRendererBindingManager().release(this,this._previewVideoObjectId),this._previewVideoObjectId=0,this._videoBinding=null,[4,n];case 1:return r.sent(),[3,3];case 2:this._logger.info("_stopVideo causeId: "+e+" noop, force: "+t+" should run: "+this._shouldRun+" is running: "+this._isRunning()+" has target: "+!!this._currentTarget),r.label=3;case 3:return[2]}})})},t}(d.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._slimcoreInstance=e}return e.prototype.setEcsConfig=function(e){try{return this._slimcoreInstance.setEcsConfig(e.ecsBlob,e.userIdentity,e.etag,!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.prototype.getEcsQueryParameters=function(){try{return Promise.resolve(this._slimcoreInstance.getEcsQueryParameters())}catch(e){return Promise.reject(e)}},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e,t){this._slimcoreInstance=e,this._accountIdentity=t}return e.prototype.getSetup=function(){var e=this;return new Promise(function(t,n){r.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?(e._setup||(e._setup=e._slimcoreInstance.getSetup(e._accountIdentity)),t(e._setup)):n("No Multiuser support")})},e.prototype.setString=function(e,t){var n=this;return this.getSetup().then(function(){return n._setup.setStr(e,t)}).catch(function(){return n._slimcoreInstance.setupSetStr(e,t)})},e.prototype.setNumber=function(e,t){var n=this;return this.getSetup().then(function(){return n._setup.setInt(e,t)}).catch(function(){return n._slimcoreInstance.setupSetInt(e,t)})},e.prototype.getString=function(e){var t=this;return this.getSetup().then(function(){return t._setup.getStr(e)}).catch(function(){return t._slimcoreInstance.setupGetStr(e)})},e.prototype.getNumber=function(e){var t=this;return this.getSetup().then(function(){return t._setup.getInt(e)}).catch(function(){return t._slimcoreInstance.setupGetInt(e)})},e.prototype.delete=function(e){var t=this;return this.getSetup().then(function(){return t._setup.delete(e)}).catch(function(){return t._slimcoreInstance.setupDelete(e)})},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(){function e(){this.subscriptions=[]}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){this.subscriptions.slice().forEach(function(t){return t.eventHandler&&e(t.eventHandler)})},e}();t.EventSourceImpl=i;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;r.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=void 0},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(5),o=n(4),a=n(2),s=n(8),l=function(){function e(e){var t=this;this._disposed=!1,this._logger=e.createChild("[ASYNC]"),this._endOperationDeferred=o.defer(),this._endOperationDeferred.promise.catch(function(e){t._logger.info("Rejected all operations")}),this._deferredOperations={},this._deferredOperationGroups={},this._logger=e}return e.prototype.registerPromise=function(e,t){var n=!1,r=function(){n=!0};t.then(r,r);var i=this._endOperationDeferred.promise.catch(function(t){if(!n)throw new Error("Operation "+e+" did not complete, reason:"+t)});return Promise.race([i,t])},e.prototype.createPendingOperation=function(e,t,n){var s=this;void 0===n&&(n=a.default());var l=o.defer();l.promise.catch(r.noop);var c=this.getOperationInfoForLogging(n,e,t);if(this._logger.info(c+"[creating...]"),this._disposed)return this._logger.info(c+"[create failed, call is disposed]"),Promise.reject(60);if(t){if(this._deferredOperationGroups[e]||(this._deferredOperationGroups[e]={}),this._deferredOperationGroups[e][t])return this._logger.warn(c+" Deferred operation with given name and operation id is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e+"/"+i.scrubMriOrOmit(t)));this._deferredOperationGroups[e][t]={deferred:l,causeId:n}}else{if(this._deferredOperations[e])return this._logger.warn(c+" Deferred operation with given name is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e));this._deferredOperations[e]={deferred:l,causeId:n}}var u=this._endOperationDeferred.promise.catch(function(n){return s.hasPendingOperation(e,t)?Promise.reject(new Error("Operation "+e+" did not complete, reason:"+n)):Promise.resolve(void 0)});return Promise.race([u,l.promise])},e.prototype.hasPendingOperation=function(e,t){return t?!!this._deferredOperationGroups[e]&&!!this._deferredOperationGroups[e][t]:!!this._deferredOperations[e]},e.prototype.waitForOperation=function(e,t,n){return void 0===n&&(n=a.default()),this.hasPendingOperation(e)?this._deferredOperations[e].deferred.promise:this.hasPendingOperation(e,t)?this._deferredOperationGroups[e][t].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+"failed=wait failed, operation not found")},e.prototype.resolveOperation=function(e,t,n,r){if(void 0===r&&(r=a.default()),!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(this.hasPendingOperation(e)){var i=this._deferredOperations[e],o=this._deferredOperations[e].deferred.promise;return this._deferredOperations[e].deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(i.causeId,e,n)+"resolved, result="+(s.getPrintableObject(t)||"void")),delete this._deferredOperations[e],o}if(this.hasPendingOperation(e,n)){o=(i=this._deferredOperationGroups[e][n]).deferred.promise;return i.deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(i.causeId,e,n)+"resolved, result="+(s.getPrintableObject(t)||"void")),delete this._deferredOperationGroups[e][n],o}return Promise.reject(this.getOperationInfoForLogging(r,e,n)+"failed=resolve failed, operation not found")},e.prototype.rejectOperation=function(e,t,n,i){return void 0===i&&(i=a.default()),e?this.hasPendingOperation(e)?((l=(o=this._deferredOperations[e]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(s.getPrintableObject(t)||"void")),delete this._deferredOperations[e],l):this.hasPendingOperation(e,n)?((l=(o=this._deferredOperationGroups[e][n]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(s.getPrintableObject(t)||"void")),delete this._deferredOperationGroups[e][n],l):Promise.reject(this.getOperationInfoForLogging(i,e,n)+"failed=reject failed, operation not found"):Promise.reject("Unable to reject deferred operation with empty name");var o,l},e.prototype.maybeResolveOperation=function(e,t,n,r){var i=this;void 0===r&&(r=a.default());var o=this.getOperationInfoForLogging(r,e,n);this.hasPendingOperation(e,n)?this.resolveOperation(e,t,n,r).catch(function(e){i._logger.info(o+"maybeResolveOperation failed, reason="+s.getPrintableObject(e))}):this._logger.info(o+"maybeResolveOperation ignored, operation does not exist")},e.prototype.maybeRejectOperation=function(e,t,n,i){void 0===i&&(i=a.default());var o=this.getOperationInfoForLogging(i,e,n);this.hasPendingOperation(e,n)?this.rejectOperation(e,t,n,i).catch(r.noop):this._logger.info(o+"maybeRejectOperation ignored, operation does not exist")},e.prototype.rejectPendingOperations=function(e,t){var n=this;void 0===t&&(t=a.default()),this._disposed=!0,this._logger.info("["+t+"]rejectPendingOperations="+e),Object.keys(this._deferredOperations).forEach(function(r){n.maybeRejectOperation(r,e,void 0,t)}),Object.keys(this._deferredOperationGroups).forEach(function(r){Object.keys(n._deferredOperationGroups[r]).forEach(function(i){n.maybeRejectOperation(r,e,i,t)})}),this._deferredOperations={},this._deferredOperationGroups={},this._endOperationDeferred.reject(e)},e.prototype.getOperationInfoForLogging=function(e,t,n){return void 0===n&&(n=""),"["+e+"]["+t+"]"+(n?"["+i.scrubMriOrOmit(n)+"]":"")},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=n(7),a=n(2),s=n(8),l=n(5),c=n(13);!function(e){e.Pending="Pending",e.Success="Success",e.Failure="Failure"}(r||(r={})),function(e){e[e.Event=0]="Event",e[e.Operation=1]="Operation"}(i||(i={}));var u=function(){function e(e,t,n,o,a){this.eventName=e,this.eventStartTime=t,this.type=n,this.causeId=o,this.status=r.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===i.Event&&delete this.status,a&&this.data.push(a)}return e.prototype.recordSuccess=function(e,t){this.recordResult(!0,e,t)},e.prototype.recordFailure=function(e,t){this.recordResult(!1,e,t)},e.prototype.addData=function(e){this.data.push(e)},e.prototype.isPending=function(){return this.status===r.Pending},e.prototype.getEvent=function(){var e,t=this,n={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.prepareData(this.result,!0),causeId:this.causeId,resultCauseId:this.resultCauseId,data:this.data.map(function(e){return t.prepareData(e,!0)}).filter(function(e){return!!e})};return this.type===i.Event&&delete n.status,n.data.length||delete n.data,n.causeId||delete n.causeId,n.resultCauseId||delete n.resultCauseId,n.result||delete n.result,(e={})[this.eventName]=n,e},e.prototype.recordResult=function(e,t,n){this.status=e?r.Success:r.Failure,this.result=this.prepareData(t),this.causeId!==n&&(this.resultCauseId=n),this.duration=(new Date).getTime()-this.eventStartTimestamp},e.prototype.prepareData=function(e,t){void 0===t&&(t=!1);var n=typeof e;if(null==e)return"";if("string"===n)return l.scrubMriOrOmit(e);if("number"===n||"boolean"===n)return String(e);if("function"===n)return"";if(e instanceof Error)return e.toString();try{return Object.keys(e).length?t?e:s.getPIISafeObject(e):""}catch(e){return"invalid"}},e}();!function(e){e.LOCAL="Local",e.REMOTE="Remote"}(t.CALL_TERMINATING_END||(t.CALL_TERMINATING_END={})),function(e){e.SUCCESS="Success",e.FAILURE="Failure"}(t.RESULT_VALUE||(t.RESULT_VALUE={})),function(e){e.INCOMING="Incoming",e.OUTGOING="Outgoing"}(t.DIRECTION||(t.DIRECTION={})),function(e){e.CALLER="caller",e.CALLEE="callee",e.JOIN="join",e.SUBSCRIBE="SUBSCRIBE"}(t.SELF_PARTICIPANT_ROLE||(t.SELF_PARTICIPANT_ROLE={}));var d=function(){function e(e,t){this.logger=e,this.callStartTime=t,this.recordedEvents=[],this.inCallMode=!1,this.ongoingOperations={},this.getHostName=function(){try{return location.host}catch(e){return"unknown"}},this.tsCallingVersion=c.getTsCallingVersion(),this.logger=e.createChild("CallTelemetry")}return e.prototype.setCallId=function(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e},e.prototype.setConsultativeCallId=function(e){this.consultativeCallId=e},e.prototype.setEndpointId=function(e){this.endpointId=e},e.prototype.setParticipantId=function(e){this.participantId=e},e.prototype.setPreheatFlags=function(e){this.preheatFlags=e},e.prototype.setCallOrigin=function(e){this.origin=e},e.prototype.setThreadId=function(e){this.threadId=e},e.prototype.setMesageId=function(e){this.messageId=e},e.prototype.setTenantId=function(e){this.tenantId=e},e.prototype.setFailureType=function(e){this.failureType=e},e.prototype.setIsCast=function(e){this.isCast=e?"True":"False"},e.prototype.setRole=function(e){this.isAnonymous="admin"===e?"False":"True"},e.prototype.setCallType=function(e){this.callType=e},e.prototype.setDirection=function(e){this.direction=e},e.prototype.setSelfParticipantRole=function(e){this.selfParticipantRole=e},e.prototype.setTerminationState=function(e){this.terminationState=e},e.prototype.setTerminationReason=function(e){this.terminationReason=e},e.prototype.setCallEndDiagnosticInfo=function(e){this.callEndDiagnosticInfo=e},e.prototype.recordEvent=function(e,t,n){void 0===n&&(n=a.default()),this.logger.debug("Event:",e,o.pii.Omit(t));var r=new u(e,this.getEventStartTime(),i.Event,n,t);return this.pushToRecordedEvents(r),r},e.prototype.recordOperationSuccess=function(e,t,n,r){void 0===t&&(t=null),this.logger.info("Event success:",r,e,o.pii.Omit(n),o.pii.Omit(t)),this.recordOperationResult(e,t,!0,n,r)},e.prototype.recordOperationFailure=function(e,t,n,r){this.logger.info("Event failure:",e,o.pii.Omit(n),t),this.recordOperationResult(e,t,!1,n,r)},e.prototype.recordOperationResult=function(e,t,n,r,i){this.hasOngoingEvent(e,r)||this.recordOperation(e,i,r);var o=this.ongoingOperations[e];r&&(o=o[r]),n?o.recordSuccess(t,i):o.recordFailure(t,i),r?delete this.ongoingOperations[e][r]:delete this.ongoingOperations[e]},e.prototype.recordOperation=function(e,t,n){var r;this.logger.debug("Event create:",e,o.pii.Omit(n));var a=new u(e,this.getEventStartTime(),i.Operation,t);return this.ongoingOperations[e]||(this.ongoingOperations[e]={}),this.ongoingOperations[e]=n?((r={})[n]=a,r):a,this.pushToRecordedEvents(a),a},e.prototype.updateOperationData=function(e,t,n,r){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t,n);r?this.ongoingOperations[e][r]&&this.ongoingOperations[e][r].addData(t):this.ongoingOperations[e].addData(t)}catch(t){return void this.logger.info("Unable to update operation: "+e+" data")}},e.prototype.setStackConfig=function(e){this.stackConfig=e},e.prototype.getEvent=function(){var e=function(e){return void 0===e?"":e};return{CorrelationId:e(this.currentCallId),PreviousCorrelationId:e(this.previousCallId),ConsultativeCallId:e(this.consultativeCallId),EndpointId:e(this.endpointId),ParticipantId:e(this.participantId),PreheatFlags:e(this.preheatFlags),CallType:e(this.callType),Direction:e(this.direction),Origin:e(this.origin),SelfParticipantRole:e(this.selfParticipantRole),IsAnonymous:e(this.isAnonymous),ThreadId:e(this.threadId),MessageId:e(this.messageId),TenantId:e(this.tenantId),FailureType:e(this.failureType),IsCast:e(this.isCast),TsCallingVersion:e(this.tsCallingVersion),TerminationState:e(this.terminationState),TerminationReason:e(this.terminationReason),StackConfig:e(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo}},e.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter(function(e){return e.isPending()}),this.inCallMode=!0},e.prototype.pushToRecordedEvents=function(e){this.inCallMode&&this.recordedEvents.length>150&&this.recordedEvents.shift(),this.recordedEvents.push(e)},e.prototype.hasOngoingEvent=function(e,t){return this.ongoingOperations[e]?!(t&&!this.ongoingOperations[e][t])||(this.logger.warn("Unable to find event for name\\id "+e+"\\"+o.pii.Omit(t)),!1):(this.logger.warn("Unable to find event for name "+e),!1)},e.prototype.getEventStartTime=function(){return(new Date).getTime()-this.callStartTime},e.prototype.getEventTimestampBag=function(){var e=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents.map(function(e){return e.getEvent()})});return this.logger.info("Call eventTimestampBag "+o.pii.Omit(e)),e},e}();t.default=d,t.getEndpointInformationForTelemetry=function(e){return Array.isArray(e)?e.map(function(e){return{endpointId:e.endpointId,participantId:e.participantId}}):null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2);!function(e){e.CHAINED="Chained",e.SYNC="Sync",e.ASYNC="Async"}(r=t.OPERATION_TYPE||(t.OPERATION_TYPE={}));var o;!function(e){e[e.CALL=0]="CALL",e[e.PARTICIPANT=1]="PARTICIPANT"}(o||(o={})),t.callOperation=function(e,t){return a(o.CALL,e,t)},t.participantOperation=function(e,t){return a(o.PARTICIPANT,e,t)},t.operationId=function(e,t,n){if(e[t]._operationIdValue_)throw new Error("can not specify more than one operation id");e[t]._operationIdValue_=n},t.causeId=function(e,t,n){if(e[t]._causeIdValue_)throw new Error("can not specify more than one cause id");e[t]._causeIdValue_=n};var a=function(e,t,n){return function(o,a,l){var c=l.value,u=o[a]&&o[a]._operationIdValue_,d=o[a]&&o[a]._causeIdValue_,p=n&&n.type||r.ASYNC;return l.value=function(){for(var o=this,a=[],l=0;l<arguments.length;l++)a[l]=arguments[l];var h=void 0!==u?a[u]:void 0,f=i.default();void 0!==d&&(a[d]?f=a[d]:a[d]=f);var g=s(this,e);if(g.logOperation(f,t),n&&n.singular&&g.hasPendingOperation(t))return g.logOperation(f,t,"Not allowed, pending operation exists"),Promise.reject(60);var _=function(){return p===r.CHAINED?g.executeChained(c.bind.apply(c,[o].concat(a)),t,h,f):p===r.SYNC?g.executeSync(c.bind.apply(c,[o].concat(a)),t,h,f):g.execute(c.bind.apply(c,[o].concat(a)),t,h,f)};if(n&&n.type!==r.SYNC){var m=n&&n.waitFor;if(m&&g.hasPendingOperation(m))return g.waitForOperation(m,void 0,f).then(_,_)}return _()},l}},s=function(e,t){if(t===o.CALL)return e._callOperationHandler;if(t===o.PARTICIPANT)return e._participantOperationHandler;throw new Error("Unsupported operation handler type!")}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),l=n(22),c=n(2),u=n(14),d=n(40),p=function(e){function t(t,n){var r=e.call(this,t)||this;return r.callTelemetry=n,r.logSuccess=function(e,t,n){r._logger.info(e+" execution succeeded, result="+(t?r.stringifyForLogging(t):"void")+", time="+n.duration())},r.logFailure=function(e,t,n){r._logger.info(e+" execution failed, reason="+r.stringifyForLogging(t)+", time="+n.duration())},r.stringifyForLogging=function(e){var t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},r._logger=t.createChild("[Operation]"),r._chainedPromise=new u.default(r._logger.createChild("[Chained]")),r}return i(t,e),t.prototype.resetOperationChain=function(e){this._chainedPromise.reset(e)},t.prototype.executeSync=function(e,t,n,r){void 0===r&&(r=c.default());var i=this.getOperationInfoForLogging(r,t,n),o=d.build();this._logger.info(i+"API calledSync");var a,s=this.callTelemetry.recordOperation(t,r,n);try{a=e(),s.recordSuccess(a,r),this.logSuccess(i,a,o)}catch(e){s.recordFailure(e,r),this.logFailure(i,e,o)}return a},t.prototype.executeChained=function(e,t,n,r){return void 0===r&&(r=c.default()),o(this,void 0,void 0,function(){return a(this,function(i){return[2,this.checkPendingOperationAndExecute(e,!0,t,n,r)]})})},t.prototype.execute=function(e,t,n,r){return void 0===r&&(r=c.default()),o(this,void 0,void 0,function(){return a(this,function(i){return[2,this.checkPendingOperationAndExecute(e,!1,t,n,r)]})})},t.prototype.logOperation=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=r.length&&r.map(function(e){return n.stringifyForLogging(s.scrubMriOrOmit(e))});this._logger.info("["+e+"]["+t+"]API called, "+(o?"with args="+o:""))},t.prototype.checkPendingOperationAndExecute=function(e,t,n,r,i){var o=this;void 0===i&&(i=c.default());var a=this.getOperationInfoForLogging(i,n,r),s=null,l=null;return this.hasPendingOperation(n,r)?(this._logger.info(a+"already pending, returning existing operation"),s=this.waitForOperation(n,r,i)):l=this.createPendingOperation(n,r,i),t?(this._logger.info(a+"chained"),this._chainedPromise.chainPromise(function(){return s||o.executeInternal(l,i,e,n,r)},n,i)):s||this.executeInternal(l,i,e,n,r)},t.prototype.executeInternal=function(e,t,n,r,i){return o(this,void 0,void 0,function(){var o,s,l,c,u;return a(this,function(a){switch(a.label){case 0:o=this.getOperationInfoForLogging(t,r,i),this._logger.info(o+" executing operation..."),s=d.build(),l=this.callTelemetry.recordOperation(r,t,i),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n()];case 2:return c=a.sent(),l.recordSuccess(c,t),this.logSuccess(o,c,s),this.maybeResolveOperation(r,c,i,t),[3,4];case 3:return u=a.sent(),l.recordFailure(u,t),this.logFailure(o,u,s),this.maybeRejectOperation(r,u,i,t),[3,4];case 4:return[2,e]}})})},t}(l.default);t.default=p},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=n(1),l=n(11),c=n(12),u=n(15),d=n(5),p=n(0),h=n(10),f=SlimCore.Enums,g=n(9),_=n(23),m=n(2),v=n(42),y=((i={})[0]=[1,2,3,4,6,7,5],i[1]=[2,3,4,6,7,0],i[2]=[0,1,3,4,6,7],i[3]=[2,1,4,5,0,7],i[4]=[0],i[5]=[3,4,0],i[6]=[3,4,0],i[7]=[3,4,0],i);t.participantStrProps={displayName:{propKey:f.Property.ParticipantDisplayName},role:{propKey:f.Property.ParticipantRole},tenantId:{propKey:f.Property.ParticipantTenantId},acceptedBy:{propKey:f.Property.ParticipantAcceptedBy},endpointDetails:{propKey:f.Property.ParticipantEndpointDetails},meetingRole:{propKey:f.Property.ParticipantMeetingRole}},t.participantIntProps={isServerMuted:{propKey:f.Property.ParticipantIsServerMuted},capabilities:{propKey:f.Property.ParticipantCapabilities,fallback:SlimCore.Enums.Capability.All},contentRole:{propKey:f.Property.ParticipantContentRole,fallback:f.ContentSharingRole.None},status:{propKey:f.Property.ParticipantStatus},failure:{propKey:f.Property.ParticipantFailureReason}};var C=function(e){function n(t,r,i,o,a,s,l,c,u,h){var f;void 0===l&&(l=0),void 0===u&&(u=!1);var g=e.call(this,t.createChild(function(){return"ICallParticipant["+d.scrubMriOrOmit(g.id)+"]["+g.state+"]["+g.slimcoreObjectId+"]"}),r,i)||this;return g._callHandler=a,g._streamContextMap=s,g._callTelemetry=c,g.streams=((f={})[0]=[],f[1]=[],f),g.voiceLevel=0,g.isServerMuted=!1,g.dominantSpeakerRank=0,g.state=0,g.id=null,g.role=null,g.tenantId=null,g.balanceUpdates={},g.enableParticipantLegToSourceIdMapping=!0,g._logger.info("created"),g.id=p.stripMriAliases(o),g.participantCapabilities=n.convertCapabilities(SlimCore.Enums.Capability.All),l&&0!==l&&g.attachSlimcoreObjectId(l,"ctor",u,h),g._slimcoreInstance.ecsGetSettingAsBool&&(g.enableParticipantLegToSourceIdMapping=g._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","enableParticipantLegToSourceIdMapping",!0)),g._logger.info("enableParticipantLegToSourceIdMapping = "+g.enableParticipantLegToSourceIdMapping),g}return o(n,e),n.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,slimcoreObjectId:this.slimcoreObjectId,state:this.state,isServerMuted:this.isServerMuted})},n.prototype.attachSlimcoreObjectId=function(e,r,i,o){var a=this;if(void 0===i&&(i=!1),this.slimcoreObjectId&&0!==this.slimcoreObjectId)return this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS.ELECTRON_ATTACH_SLIMCORE_PARTICIPANT_FAILED,{attachParticipantId:e,reason:"Participant already attached to a SlimCore object"},r),void this._logger.debug("Attach called on existing participant");this.slimcoreObjectId=e;var s=o&&o.props||this._getProperties(this._callHandler,this.slimcoreObjectId,t.participantStrProps,t.participantIntProps);this.displayName=s.displayName,this.role=s.role,this.tenantId=s.tenantId,this.participantCapabilities=n.convertCapabilities(s.capabilities),this.acceptedBy=s.acceptedBy,this.isServerMuted=!!s.isServerMuted,this.meetingRole=s.meetingRole,this._slimCoreElectronRemoteStreamManager=new u.default(this._logger,this._settings,this._slimcoreInstance,this._callHandler,this.slimcoreObjectId,this.streams,this._streamContextMap,i),this._slimCoreElectronRemoteStreamManager.changed(function(){return a.raiseChanged()}),this._updateEndpointDetails(s.endpointDetails),this._onParticipantPropertyChanged(f.Property.ParticipantStatus,function(e){return a._onStatusChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantIsServerMuted,function(e){return a._onIsServerMuted(!!e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantFailureReason,function(e){return a._onFailureReasonChange(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantAdmitFailureReason,function(e){return a._onAdmitFailureReasonChange(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantRemoveFailureReason,function(e){return a._onRemoveFailureReasonChange(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantIsActiveSpeaker,function(e){return a.setVoiceLevel(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantDominantSpeakerRank,function(e){return a._onDominantSpeakerRankChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantEndpointDetails,function(e){return a._updateEndpointDetails(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantCapabilities,function(e){return a._onCapabilitiesChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantAcceptedBy,function(e){return a._onAcceptedByChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantRole,function(e){return a._onRoleChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantTenantId,function(e){return a._onTenantIdChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantContentRole,function(e){return a._onParticipantContentSharingRoleChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantBalanceUpdate,function(e){return a._onBalanceUpdateChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantDiagnosticsCode,function(e){return a._onParticipantDiagnosticsCodeChanged(e.value)}),this._onParticipantPropertyChanged(f.Property.ParticipantMeetingRole,function(e){return a._onMeetingRoleChanged(e.value)}),this._onStatusChanged(s.status,!1,s.failure),this._onParticipantContentSharingRoleChanged(s.contentRole)},n.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._callHandler,this.slimcoreObjectId,e,t)},n.prototype.getIntProperty=function(e,t){return this._getIntProperty(this._callHandler,this.slimcoreObjectId,e,t)},n.prototype._onParticipantPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreObjectId,e,t)},n.prototype._onCapabilitiesChanged=function(e){var t=n.convertCapabilities(e);t!==this.participantCapabilities&&(this._logger.info("Computed capabilities: "+JSON.stringify(t)),this.participantCapabilities=t,this.raiseChangedDeferred())},n.prototype._onAcceptedByChanged=function(e){e!==this.acceptedBy&&(this._logger.info("Accepted by is set to "+d.scrubMriOrOmit(e)),this.acceptedBy=e,this.raiseChanged())},n.prototype._onRoleChanged=function(e){e!==this.role&&(this._logger.info("Role is set to "+e),this.role=e,this.raiseChanged())},n.prototype._onTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId is set to "+e),this.tenantId=e,this.raiseChanged())},n.prototype._onMeetingRoleChanged=function(e){e!==this.meetingRole&&(this._logger.info("_onMeetingRoleChanged meetingRole: "+e),this.meetingRole=e,this.raiseChanged())},n.prototype.raiseChangedDeferred=function(){var e=this;this._raiseChangedDefer||(this._raiseChangedDefer=a.defer(function(){delete e._raiseChangedDefer,e.raiseChanged()}))},n.prototype._getParticipantIdForSourceId=function(e,t){try{if(null!=this.endpoints)for(var n=0,r=this.endpoints.endpointDetails;n<r.length;n++){var i=r[n];if(null!=i&&null!=i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(t===s.sourceId&&p.mapMediaTypeStringToMediaType(s.type)===e)return null!=i.participantId?i.participantId:null}}}catch(e){this._logger.error("getSourceIdForMediaType caught exception error="+e)}},n.prototype.getParticipantIdForSourceId=function(e,t){var n=this._getParticipantIdForSourceId(e,t);return n||this._logger.warn("participantId is "+n+" for mediaType: "+e+", sourceId: "+t),n},n.prototype.hasSourceId=function(e,t){return this.enableParticipantLegToSourceIdMapping?void 0!==this._getParticipantIdForSourceId(e,t):this.getSourceIdForMediaType(e)===t},n.prototype.getSourceIdForMediaType=function(e){var t=-1;try{if(this.endpoints)e:for(var n=0,r=this.endpoints.endpointDetails;n<r.length;n++){var i=r[n];if(null!==i&&void 0!==i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(p.mapMediaTypeStringToMediaType(s.type)===e){t=s.sourceId;break e}}else t=c.DATA_SOURCE_ID_ANY}}catch(e){this._logger.error("getSourceIdForMediaType caught exception error="+e)}return t},n.prototype.getSourceId=function(e,t){if(!this.enableParticipantLegToSourceIdMapping)return this.getSourceIdForMediaType(t);if(!this.endpoints)return this._logger.warn("endpoints is invalid"),-1;try{var n=a.find(this.endpoints.endpointDetails,function(t){return null!=t&&t.participantId===e});if(!n)return this._logger.warn("participantId not found: "+e),this.getSourceIdForMediaType(t);if(!n.mediaStreams)return this._logger.warn("participantLeg "+e+" does not have valid mediaStreams"),this.getSourceIdForMediaType(t);var r=a.find(n.mediaStreams,function(e){return p.mapMediaTypeStringToMediaType(e.type)===t});return r?r.sourceId:(this._logger.warn("participantLeg "+e+" has no channel of type "+t),-1)}catch(e){this._logger.error("getSourceId caught exception error="+e)}return-1},n.prototype._isScreenSharerStream=function(e){return"sendonly"===e.direction&&"applicationsharing-video"===e.label},n.prototype.getSharingParticipantLeg=function(){var e=this;if(this.endpoints&&this.endpoints.endpointDetails){if(1===this.endpoints.endpointDetails.length)return this.endpoints.endpointDetails[0].participantId;var t=a.find(this.endpoints.endpointDetails,function(t){return null!=t&&null!=t.mediaStreams&&a.some(t.mediaStreams,function(t){return e._isScreenSharerStream(t)})});if(t){if(t.participantId)return t.participantId;this._logger.warn("invalid participantId")}else this._logger.warn("could not find sharer")}else this._logger.warn("endpoints are not defined")},n.getEndpointDetailsLogString=function(e){if(!e||!e.endpointDetails)return"";var t=[];return e.endpointDetails.forEach(function(e){t.push({participantId:e.participantId,endpointId:e.endpointId,clientVersion:e.clientVersion,mediaStreams:e.mediaStreams})}),JSON.stringify(t)},n.prototype._updateEndpointDetails=function(e){var t=m.default();if(this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this._logger.info("Updating endpointDetails: "+n.getEndpointDetailsLogString(this.endpoints)),this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS.UPDATE_PARTICIPANT_STREAM,v.getStreamInformationFromEndpoints(this.endpoints),t)}catch(t){return void this._logger.warn("Failed to parse call member endpointDetails - "+t+" -"+e)}this.raiseChanged()}},n.prototype._onStatusChanged=function(e,t,r){void 0===t&&(t=!0);var i=m.default();this._logger.info("["+i+"]Status changed "+e+" ("+f.CallStatus[e]+")");var o=void 0!==r?r:this.getIntProperty(f.Property.ParticipantFailureReason),a=n.convertParticipantStatus(e);void 0!==a?(this.setState(a,i,h.convertStatusAndFailureReasonToParticipantReason(e,o),t),this._admitParticipantDeffered&&n.isParticipantActive(this.state)&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null),this._removeParticipantDeffered&&!n.isParticipantActive(this.state)&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null)):this._logger.warn("Unrecognized "+a)},n.prototype._onParticipantContentSharingRoleChanged=function(e){this._logger.info("Content sharing role changed "+e+" ("+f.ContentSharingRole[e]+")"),this.setContentSharingRole(n.convertContentSharingRole(e))},n.prototype._onFailureReasonChange=function(e){var t=m.default();this._logger.info("["+t+"]Failure reason changed "+e+" ("+f.ParticipantFailureReason[e]+")");var r=this.getIntProperty(f.Property.ParticipantStatus);this.setState(n.convertParticipantStatus(r),t,h.convertFailureReasonToParticipantReason(e))},n.prototype._onAdmitFailureReasonChange=function(e){this._logger.info("Admit failure reason changed "+e+" ("+f.ParticipantFailureReason[e]+")");var t=h.convertFailureReasonToParticipantReason(e);this.rejectAdmitParticipantDeferred(t)},n.prototype._onRemoveFailureReasonChange=function(e){this._logger.info("Remove failure reason changed "+e+" ("+f.ParticipantFailureReason[e]+")");var t=h.convertFailureReasonToParticipantReason(e);this.rejectRemoveParticipantDeferred(t)},n.prototype.setVoiceLevel=function(e){this.voiceLevel!==e&&(this.voiceLevel=e,this.raiseChanged())},n.prototype._onIsServerMuted=function(e){e!==this.isServerMuted&&(this.isServerMuted=e,this.raiseChanged())},n.prototype._onDominantSpeakerRankChanged=function(e){this.dominantSpeakerRank!==e&&(this._logger.info("DominantSpeakerRank changing from "+this.dominantSpeakerRank+" to "+e),this.dominantSpeakerRank=e,this.raiseChanged())},n.prototype._onBalanceUpdateChanged=function(e){if(a.isEmpty(e))a.isEmpty(this.balanceUpdates)||(this.balanceUpdates={},this.raiseChanged());else{try{var t=JSON.parse(e);if(a.isEqual(this.balanceUpdates[t.sender.endpointId],t))return;this.balanceUpdates[t.sender.endpointId]=t}catch(t){return void this._logger.warn("Failed to parse call member balanceUpdate - "+t+" -"+e)}this.raiseChanged()}},n.prototype._onParticipantDiagnosticsCodeChanged=function(e){this._logger.info("_onParticipantDiagnosticsCodeChanged diagnosticsCode: "+e),this._updateDiagnosticsCode(e)},n.prototype._updateDiagnosticsCode=function(e){if(this._rawCallEndDiagnosticsInfo!==e&&e)try{this.callEndDiagnosticsInfo=JSON.parse(e),this._rawCallEndDiagnosticsInfo=e,this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}},n.prototype.setContentSharingRole=function(e){this.contentSharingRole!==e&&(this.contentSharingRole=e,this.raiseChanged())},n.prototype.setState=function(e,t,n,r){if(void 0===r&&(r=!0),this.state!==e){var i=this._logger.createFnLogger("setState",t),o=y[this.state].indexOf(e)>=0,a={state:this.state,reason:this.stateReason,endpoints:[]};if(this.endpoints&&this.endpoints.endpointDetails&&this.endpoints.endpointDetails.length&&(a.endpoints=_.getEndpointInformationForTelemetry(this.endpoints.endpointDetails)),!o)return i.logFailure("Invalid state transition "+this.state+"->"+e+" attempted"),void this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS.SET_PARTICIPANT_STATE_INVALID,a,t);if(i.info("state="+this.state+"->"+e+" reason="+this.stateReason+"->"+n),this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS.SET_PARTICIPANT_STATE,a,t),this.state=e,this.stateReason=n,3===this.state&&r){var s=this.getStrProperty(f.Property.ParticipantEndpointDetails);this._updateEndpointDetails(s)}else if(4===this.state){var l=this.getStrProperty(f.Property.ParticipantDiagnosticsCode);this._updateDiagnosticsCode(l)}this.raiseChangedDeferred()}},n.convertParticipantStatus=function(e){return l.default.isCallRinging(e)?2:l.default.isCallTerminated(e)?4:l.default.isCallConnected(e)?3:l.default.isCallConnecting(e)?1:l.default.isCallEarlyMedia(e)?6:l.default.isCallInLobby(e)?7:e===f.CallStatus.LocalHold||e===f.CallStatus.RemoteHold?5:void 0},n.isParticipantActive=function(e){switch(e){case 3:case 6:case 5:return!0;default:return!1}},n.convertContentSharingRole=function(e){switch(e){case f.ContentSharingRole.Attendee:return 1;case f.ContentSharingRole.Presenter:return 2;default:return 0}},n.convertCapabilities=function(e){return{canConference:!!(e&f.Capability.Conference),canShareScreen:!!(e&f.Capability.ShareScreen),canMerge:!!(e&f.Capability.Merge)}},n.prototype.addAdmitParticipantDeferred=function(e){this._admitParticipantDeffered=e},n.prototype.rejectAdmitParticipantDeferred=function(e){this._admitParticipantDeffered&&(this._admitParticipantDeffered.reject(e),this._admitParticipantDeffered=null)},n.prototype.addRemoveParticipantDeferred=function(e){this._removeParticipantDeffered=e},n.prototype.rejectRemoveParticipantDeferred=function(e){this._removeParticipantDeffered&&(this._removeParticipantDeffered.reject(e),this._removeParticipantDeffered=null)},n.prototype.stopVideos=function(){return this._slimCoreElectronRemoteStreamManager.stopVideos()},n.prototype.dispose=function(){this._slimCoreElectronRemoteStreamManager&&this._slimCoreElectronRemoteStreamManager.dispose(),this.streams[0]=[],this.streams[1]=[],this._admitParticipantDeffered&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null),this._removeParticipantDeffered&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null),this.slimcoreObjectId=0,e.prototype.dispose.call(this)},n}(s.default);t.default=C},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(28),a=SlimCore.Enums,s=0,l=function(e){function t(t,n,r,i,o,l,c,u){var d=e.call(this,t.createChild(function(){return"RemoteVideoRenderer["+d._id+"]"}),n,r)||this;d._renderTarget=i,d._videoType=o,d._options=c,d._rendererTracker=u,d._id=s++,d._logger.info("constructor");var p=o===a.VideoType.ScreenShare;return d._videoBinding=l,d._options=c||{scalingMode:p?2:1,transparent:p,ignoreMirroring:!1},d._createVideoRenderer(d._renderTarget,d._options,!1),d._rendererTracker.registerRenderer(d),d}return i(t,e),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!0,configurable:!0}),t.prototype.clone=function(e){return this._logger.info("clone"),new t(this._logger,this._settings,this._slimcoreInstance,e,this._videoType,this._videoBinding,this._options,this._rendererTracker)},t.prototype.dispose=function(){this._logger.info("dispose");try{e.prototype.dispose.call(this)}finally{this._renderTarget=null,this._rendererTracker&&(this._rendererTracker.unregisterRenderer(this),this._rendererTracker=null)}},t}(o.default);t.default=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(4),s=n(1),l=n(2),c=n(0),u=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.isRendering=!1,i._paused=!1,i._isFrameSinkSet=!1,i._videoElementSizeChangeIntervalHandle=0,i._isStartedLogged=!1,i._frameTypeChanged=function(e){i._logger.info("frame-type-changed: "+e.type),i.event("frameTypeChanged").raise(h(e.type))},i._frameSizeChanged=function(e){i._logger.info("frame-size-changed: "+e.width+" x "+e.height)},i._firstFrameRendered=function(e){i._logger.info("first-frame-rendered"),i.event("firstFrameRendered").raise()},i._fullFrameRenderRequired=function(e){i._logger.info("full-frame-render-required: "+e.fullFrameRenderRequired),i.event("fullFrameRenderRequired").raise(e.fullFrameRenderRequired)},i._videoUriChangedUwp=function(e){i._videoElement&&(i._videoElement.src=e.uri||"")},i._videoResizedUwp=function(){i._videoSizeChanged(i._videoElement.videoWidth,i._videoElement.videoHeight)},i._videoPausedUwp=function(){i._videoElement&&(i._videoElement.src=i._videoBindingRT.uri||"",i._videoElement.play())},i}return i(t,e),t.prototype.dispose=function(t){void 0===t&&(t=l.default()),this._disposeVideoRenderer(t),e.prototype.dispose.call(this,t)},Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){return this._frameSink&&this._frameSink.getFrameType?h(this._frameSink.getFrameType()):-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){if(this._settings.platform!==c.PlatformType.Electron)throw new Error("Only implemented for Electron renderer");e!==this._paused&&(this._frameSink&&this._controlFrameSink(!e),this._paused=e)},enumerable:!0,configurable:!0}),t.prototype.captureFrame=function(e){return this._videoBinding?this._videoBinding.captureFrame({timeout:e}).then(function(e){return new d(c.convertImageData(e.image),e.mirror)}):Promise.resolve()},t.prototype.getStats=function(){var e=this;return a.asap(function(){return e._getStats()})},t.prototype.setScalingMode=function(e){var t=this;return this._renderer?this._renderer.setScalingMode(f(e)):this._videoElement?new Promise(function(){t._videoElement.msZoom=1===e}):Promise.reject("No video renderer")},t.prototype.setVideoEffects=function(e,t){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.getVideoEffectsCapability=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.dumpVideoSourceImages=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype._createVideoRenderer=function(e,t,n){switch(this._settings.platform){case c.PlatformType.Electron:return this._createVideoRendererElectron(e,t);case c.PlatformType.Uwp:return this._createVideoRendererUwp(e,t,n);default:throw new Error("Unsupported platform: "+this._settings.platform)}},t.prototype._createVideoRendererElectron=function(e,t){var n=this;!function(e){return void 0!==e.renderer}(e)?this._renderer=this._createVideoRendererImpl(e,t):this._renderer=e.renderer,this._renderer.on("video-size-changed",function(e){return n._videoSizeChanged(e.width,e.height)}),this._frameSink&&(this._frameSink.on("frame-type-changed",this._frameTypeChanged),this._frameSink.on("frame-size-changed",this._frameSizeChanged),this._frameSink.on("first-frame-rendered",this._firstFrameRendered),this._frameSink.on("full-frame-render-required",this._fullFrameRenderRequired),!o.isUndefined(t.ignoreMirroring)&&this._frameSink.setIgnoreMirroring&&this._frameSink.setIgnoreMirroring(t.ignoreMirroring),this._controlFrameSink(!0))},t.prototype._createVideoRendererUwp=function(e,t,n){var r=this;this._logger.info("Creating uwp video renderer with uri "+this._videoBindingRT.uri),this._videoBindingRT.on("video-uri-changed",this._videoUriChangedUwp);var i=e;if(this._videoElement=i.ownerDocument.createElement("video"),i.appendChild(this._videoElement),this._videoElement.autoplay=!0,this._videoElement.msHorizontalMirror=!t.ignoreMirroring&&n,this._videoElement.msZoom=1===t.scalingMode,this._videoElement.style.backgroundColor=t.transparent?"":"black",this._videoElement.addEventListener("resize",this._videoResizedUwp),this._videoElement.src=this._videoBindingRT.uri||"",this._videoElement.addEventListener("pause",this._videoPausedUwp),!n&&this._videoBindingRT.setVideoPreference){var a={width:0,height:0};this._videoElementSizeChangeIntervalHandle=setInterval(function(){var e={width:r._videoElement.offsetWidth,height:r._videoElement.offsetHeight};o.isEqual(a,e)||(a=e,r._videoBindingRT.setVideoPreference(e.width,e.height))},2e3)}},t.prototype._disposeVideoRenderer=function(e){this._frameSink&&(this._frameSink.removeListener("frame-type-changed",this._frameTypeChanged),this._frameSink.removeListener("frame-size-changed",this._frameSizeChanged),this._frameSink.removeListener("first-frame-rendered",this._firstFrameRendered),this._frameSink.removeListener("full-frame-render-required",this._fullFrameRenderRequired),this._controlFrameSink(!1)),this._renderer&&(this._renderer.removeAllListeners(),this._renderer.dispose(),this._renderer=null),this._videoBindingRT&&this._videoBindingRT.removeListener("video-uri-changed",this._videoUriChangedUwp),this._videoElementSizeChangeIntervalHandle&&(clearInterval(this._videoElementSizeChangeIntervalHandle),this._videoElementSizeChangeIntervalHandle=0),this._videoElement&&(this._videoElement.removeEventListener("resize",this._videoResizedUwp),this._videoElement.removeEventListener("pause",this._videoPausedUwp),this._videoElement.remove(),this._videoElement=null)},Object.defineProperty(t.prototype,"_frameSink",{get:function(){return this._renderer?this._renderer.getFrameSink():null},enumerable:!0,configurable:!0}),t.prototype._videoSizeChanged=function(e,t){this._logger.info("video-size-changed: "+e+" x "+t),this.streamSize={width:e,height:t},this.isRendering=e>0&&t>0,!this._isStartedLogged&&this.isRendering&&(this._logger.info("renderStarted"),this.event("renderStarted").raise(),this._isStartedLogged=!0),this.event("videoSizeChanged").raise(e,t),this.raiseChanged()},t.prototype._getStats=function(){if(!this._frameSink)throw new Error("Renderer is not initialized");if(this._frameSink.getStats)return this._frameSink.getStats();throw new Error("Renderer does not support stats")},Object.defineProperty(t.prototype,"frameSinkMetadata",{get:function(){return this._frameSink&&this._frameSink.getMetadata?this._frameSink.getMetadata():null},enumerable:!0,configurable:!0}),t.prototype._createVideoRendererImpl=function(e,t){var n={container:e,transparent:t.transparent,scalingMode:f(t.scalingMode),useBufferSharing:!!this._settings.enableBufferSharing,logger:this._logger};try{var r=SlimCore.createChromiumFrameSink?SlimCore.createChromiumFrameSink():SlimCore.createPepperFrameSink();return VideoRenderer.createChromiumVideoRenderer(r,n)}catch(e){throw this._logger.error("createChromiumVideoRenderer failed: "+e),new p(e,function(e){switch(e.reason){case 1:return 2;case 2:return 3;default:return 1}}(e))}},Object.defineProperty(t.prototype,"_videoBindingRT",{get:function(){return this._videoBinding},enumerable:!0,configurable:!0}),t.prototype._controlFrameSink=function(e){this._videoBinding&&this._isFrameSinkSet!==e&&(this._isFrameSinkSet=e,e?this._videoBinding.addFrameSink(this._frameSink):this._videoBinding.removeFrameSink(this._frameSink))},t}(s.default);t.default=u;var d=function(){function e(e,t){this._imageData=e,this._mirrored=t}return e.prototype.getSize=function(){return{width:this._imageData.width,height:this._imageData.height}},e.prototype.isMirrored=function(){return this._mirrored},e.prototype.getImageData=function(){return this._imageData},e}(),p=function(){function e(e,t){void 0===t&&(t=-1),this.reason=e,this.errorType=t}return e.prototype.toString=function(){return"Reason="+this.reason+", errorType="+this.errorType},e}();function h(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return-1}}function f(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=n(0),c=n(1),u=n(30),d=SlimCore.Enums,p=n(2),h=function(e){function t(t,n,r,i,o,a,s,l){var c=e.call(this,t.createChild(function(){return"LocalScreenShare["+c._localVideoObjectId+"]"}),n,r)||this;c._callObjectId=i,c._callHandler=o,c._deviceManager=a,c._appHooks=s,c._screenSharingControl=l,c.isStreaming=!1,c.isAvailable=!0,c._localVideoObjectId=0,c._previewVideoObjectId=0,c._editViewPPTWindowId=0,c._logger.info("constructor");try{c._screenScraper=new u.default(c._slimcoreInstance)}catch(e){c._logger.warn(""+e)}return c._registerDisposable(c._appHooks.onDisplaysChanged(function(){return c.handleDisplaysChanged()})),c}return i(t,e),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype._showSharingIndicator=function(e){var t=this;this._appHooks.showSharingIndicator(e);var n=this._appHooks.getControlInjector();n&&n.setInjectionRect&&n.setInjectionRect(e).catch(function(n){var r=JSON.stringify({errorMsg:n,region:e});t._screenSharingControl.enableScreenSharingControl(!1,0,r),t._logger.error("Set control Injector failure, disable screen sharing control. Error: "+n)})},t.prototype._videoObjectChanged=function(e){var t=p.default();this.isAvailable=l.isVideoAvailable(e),this.isStreaming=!1,l.isVideoInState(e,[d.VideoStatus.Starting,d.VideoStatus.Running])&&(this._selectedMonitor||this._selectedWindow||this._selectedCamera?(this.isStreaming=!0,this._selectedCamera||this._appHooks.showSharingIndicator(this._selectedRegion||this._selectedMonitor&&this._selectedMonitor.region||this._selectedWindow&&this._selectedWindow.windowId)):l.forgetAndLog(this.stop(t),this._logger,"stopping screen sharing due to no monitor/camera being selected")),l.isVideoInState(e,[d.VideoStatus.Paused])&&this._appHooks.hideSharingIndicator(),this.raiseChanged()},t.prototype._setCaptureRegionAndWindow=function(e,t){if(this._slimcoreInstance.setScreenCaptureRectangle)this._slimcoreInstance.setScreenCaptureRectangle(this._localVideoObjectId,e,void 0,t);else{if(!this._videoBindingScreenShare)throw new Error("Failed to set capture region / window");this._videoBindingScreenShare.setCaptureRegionAndWindow(e,t)}},t.prototype._handleScraperEvent=function(e){this._logger.info("Handle Scraper event, event = "+e.event+" data = "+e.data);var t=e.data;switch(e.event){case d.ScraperEvent.PPTPresenterView_Enter:this._editViewPPTWindowId=this._selectedWindow.windowId,this._selectedWindow.windowId=t,this._appHooks.showSharingIndicator(t),this._setCaptureRegionAndWindow(void 0,t),this._logger.info("shared PPT entered presenter mode");break;case d.ScraperEvent.PPTPresenterView_Exit:this._selectedWindow.windowId=this._editViewPPTWindowId,this._appHooks.showSharingIndicator(this._selectedWindow.windowId),this._setCaptureRegionAndWindow(void 0,this._selectedWindow.windowId),this._logger.info("shared PPT exited presenter mode");break;case d.ScraperEvent.WindowClosed:if(this._selectedWindow.windowId!==t)return;this._logger.info("Application window closed. Stopping the screenshare"),this.event("windowClosed").raise();break;default:this.event("scraperEvent").raise(e)}},t.prototype._startPreviewVideoObject=function(){var e=this;return this._shouldUseVideoBindingScreenShare()?this._deviceManager.getPreviewVideo(d.VideoType.ScreenShare).then(function(t){return e._deviceManager.getScreenShareBindingManager().acquire(e,t).then(function(n){e._previewVideoObjectId=t,e._videoBindingScreenShare=n,e._videoBindingScreenShare.on("scraper-event",function(t){return e._handleScraperEvent(t)})})}):Promise.resolve()},t.prototype._stopPreviewVideoObject=function(){var e=this;if(this._shouldUseVideoBindingScreenShare()){if(this._previewVideoObjectId&&this._videoBindingScreenShare){this._logger.info("calling slimcore video release binding"),this._videoBindingScreenShare.removeAllListeners("scraper-event");var t=this._deviceManager.getScreenShareBindingManager().release(this,this._previewVideoObjectId).catch(function(t){return e._logger.error("Failed on releasing screen sharing binding. Error: "+t)});return this._previewVideoObjectId=0,this._videoBindingScreenShare=null,t}return Promise.resolve()}return Promise.resolve()},t.prototype._shouldUseVideoBindingScreenShare=function(){return!this._slimcoreInstance.setScreenCaptureRectangle&&this._deviceManager.hasVideoBindingScreenShare()},t.prototype.start=function(e,t,n,r){var i=this,s=this._logger.createFnLogger("Start",e);if(s.info("local screen share start"),this._currentStartPromise)return s.info("Start requested but pending start exists. Returning previous promise"),this._currentStartPromise;var c=this.sourceToInfo(t);return this._currentStartPromise=Promise.resolve().then(function(){return o(i,void 0,void 0,function(){var e,i,o=this;return a(this,function(a){switch(a.label){case 0:return this._currentStopPromise?(s.info("Start requested but pending stop exists. Waiting for previous stop promise"),[4,this._currentStopPromise]):[3,2];case 1:a.sent(),a.label=2;case 2:if(!c)throw new Error("Unable to start sharing, source could not be found");return s.info("calling slimcore create local video"),c.cameraFacing?(e=c,this._localVideoObjectId=this._slimcoreInstance.createLocalVideo(d.VideoType.ScreenShare,e.label,e.id)):this._localVideoObjectId=this._slimcoreInstance.createLocalVideo(d.VideoType.ScreenShare,"",""),this._videoStatusChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._localVideoObjectId,propKey:d.Property.VideoStatus},function(e){return o._videoObjectChanged(e.value)}),i=this._getIntProperty(this._callHandler,this._localVideoObjectId,d.Property.VideoStatus),this._videoObjectChanged(i),this._callHandler.callAttachSendVideo(this._callObjectId,this._localVideoObjectId),s.info("waiting for video object to be available"),[4,l.waitForVideoObjectToBeAvailable(this._slimcoreInstance,this._callHandler,this._localVideoObjectId,this._logger,500)];case 3:return a.sent(),c.cameraFacing?[3,5]:(this._logger.info("start preview video object"),[4,this._startPreviewVideoObject()]);case 4:a.sent(),a.label=5;case 5:return s.info("calling slimcore video start"),this.selectSource(t,c,n),this.negotiationTag=r,this._slimcoreInstance.videoStart(this._localVideoObjectId,r),this.isStreaming=!0,this.raiseChanged(),[2]}})})}).catch(function(t){throw s.logFailure("Failed to start LocalScreenShare. Error: "+t),i._currentStartPromise=null,i.stop(void 0,e),t}),this._currentStartPromise.then(function(){i._currentStartPromise=null}),this._currentStartPromise},t.prototype.changeCropRegion=function(e){var t=this.sourceToInfo(null);this.selectMonitorWithOptionalCrop(t,e)},t.prototype.stop=function(e,t){var n=this,r=this._logger.createFnLogger("Stop",e);if(this._currentStopPromise)return r.info("Stop requested but pending stop exists. Returning previous promise"),this._currentStopPromise;var i=function(){n._localVideoObjectId=0,n.isStreaming=!1,n._selectedMonitor=null,n._selectedRegion=null,n._selectedWindow=null,n._selectedCamera=null,n._editViewPPTWindowId=0,n._currentStopPromise=null,n._currentStartPromise=null,n._appHooks.hideSharingIndicator(),n._videoStatusChangedHandler&&(n._videoStatusChangedHandler.dispose(),n._videoStatusChangedHandler=null),n.raiseChanged()};return this._currentStopPromise=this._currentStartPromise||Promise.resolve().then(function(){return n._stopPreviewVideoObject()}).then(function(){0!==n._localVideoObjectId&&(r.info("calling slimcore video stop"),n.negotiationTag=t,n._slimcoreInstance.videoStop(n._localVideoObjectId,n.negotiationTag))}).then(i,function(e){throw r.logFailure("Failed to stop LocalScreenShare. Error: "+e),i(),e}),this._currentStopPromise},t.prototype.dispose=function(t){this._logger.info("Disposing of LocalScreenShare"),0===this._localVideoObjectId&&0===this._previewVideoObjectId||this.stop(t),this._videoStatusChangedHandler&&(this._videoStatusChangedHandler.dispose(),this._videoStatusChangedHandler=null),e.prototype.dispose.call(this)},t.prototype.selectSource=function(e,t,n){e&&2===e.getType()?this.selectWindow(t):e&&3===e.getType()?this._selectedCamera=t:this.selectMonitorWithOptionalCrop(t,n)},t.prototype.selectMonitorWithOptionalCrop=function(e,t){var n=t||e.region;this._logger.info("Selected region with optional crop, x = "+n.x+", y = "+n.y+", width = "+n.width+" height = "+n.height),this._showSharingIndicator(n),this._setCaptureRegionAndWindow(n),this._selectedMonitor=e,this._selectedRegion=t},t.prototype.selectWindow=function(e){this._appHooks.showSharingIndicator(e.windowId),this._setCaptureRegionAndWindow(void 0,e.windowId),this._selectedWindow=e},t.prototype.handleDisplaysChanged=function(){var e=p.default(),t=this._logger.createFnLogger("HandleDisplaysChanged",e);if(this._selectedMonitor)if(this._screenScraper){t.info("On display change, currenlty selected monitor: "+g(this._selectedMonitor));for(var n=this._screenScraper.getMonitorList()||[],r=0,i=n;r<i.length;r++){var o=i[r];t.info("On display change, new listed monitor: "+g(o))}var a=this.handleDuplicateToExtend(n)||this.handleExtendToDuplicate(n)||this.pickSameMonitor(n);a&&!this._selectedRegion?(t.info("On display change, re-selected monitor: "+g(a)),this.selectMonitorWithOptionalCrop(a)):(t.info("stopping screen share because displays changed and could not resolve monitor info"),l.forgetAndLog(this.stop(e),t,"stopping screen share because sharing source lost"),this.event("sharingSourceLost").raise())}else t.logFailure("On display change, screen scraper not initialized");else t.logFailure("On display change, monitor not seleted yet")},t.prototype.pickSameMonitor=function(e){var t=this,n=this._selectedMonitor?this._selectedMonitor.monitorId:null;return null!==n?s.find(e,function(e){return e.monitorId===n||s.isEqual(e.region,t._selectedMonitor.region)}):null},t.prototype.handleDuplicateToExtend=function(e){return this._selectedMonitor.isDuplicated&&this.isExtendConfiguration(e)?s.find(e,function(e){return!e.isInternal}):null},t.prototype.handleExtendToDuplicate=function(e){return!this._selectedMonitor.isDuplicated&&this.isDuplicateConfiguration(e)?s.find(e,function(e){return e.isPrimary}):null},t.prototype.isExtendConfiguration=function(e){var t=f(e,function(e){return e.isDuplicated}),n=f(e,function(e){return e.isPrimary});return 0===t&&1===n&&e.length>1},t.prototype.isDuplicateConfiguration=function(e){var t=f(e,function(e){return e.isDuplicated}),n=f(e,function(e){return e.isPrimary});return 1===t&&1===n},t.prototype.sourceToInfo=function(e){if(!e){if(this._screenScraper){var t=this._screenScraper.getMonitorList()||[];return s.find(t,function(e){return e.isPrimary})}return this._logger.error("ScreenShare has no way to recover primary monitor"),null}if(!this._screenScraper&&3!==e.getType())return{monitorId:0,name:e.getDescription(),region:e.getBounds(),isPrimary:!0,isInternal:!0,isDuplicated:!1};switch(e.getType()){case 2:t=this._screenScraper.getWindowList()||[];return s.find(t,function(t){return t.windowId===e.getId()});case 1:t=this._screenScraper.getMonitorList()||[];return s.find(t,function(t){return t.monitorId===e.getId()||s.isEqual(t.region,e.getBounds())});case 3:t=this._slimcoreInstance.getCameraList&&this._slimcoreInstance.getCameraList()||[];return s.find(t,function(t){return t.id===e.getDeviceId()});default:throw new Error("Invalid source type: "+e.getType())}},t}(c.default);function f(e,t){return s.reduce(e,function(e,n){return t(n)?e+1:e},0)}function g(e){try{return JSON.stringify(e)}catch(e){return"unable to stringify"}}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e){if(this._slimcoreInstance=e,!this._slimcoreInstance.getMonitorList||!this._slimcoreInstance.getWindowList){var t=r.isSlimCoreRTModuleAvailable()?SlimCoreRT.SlimCore:SlimCore;if(!t.ScreenScraper)throw new Error("ScreenScraper not supported");this._screenScraper=new t.ScreenScraper}}return e.prototype.getMonitorList=function(){if(this._slimcoreInstance.getMonitorList)return this._slimcoreInstance.getMonitorList();if(this._screenScraper)return this._screenScraper.getMonitorList();throw new Error("not supported")},e.prototype.getMonitorPreview=function(e,t,n,i,o){return this._slimcoreInstance.getMonitorSnapshot?this._slimcoreInstance.getMonitorSnapshot(e,{width:t,height:n,asImage:i},o).then(r.convertImageData):this._screenScraper?this._screenScraper.getMonitorPreview(e,t,n,i):Promise.reject(new Error("not supported"))},e.prototype.getWindowList=function(){if(this._slimcoreInstance.getWindowList)return this._slimcoreInstance.getWindowList();if(this._screenScraper)return this._screenScraper.getWindowList();throw new Error("not supported")},e.prototype.getWindowPreview=function(e,t,n,i){return this._slimcoreInstance.getWindowSnapshot?this._slimcoreInstance.getWindowSnapshot(e,{width:t,height:n,asImage:i}).then(r.convertImageData):this._screenScraper?this._screenScraper.getWindowPreview(e,t,n,i):Promise.reject(new Error("not supported"))},e.prototype.getWindowIcon=function(e,t,n,i){return this._slimcoreInstance.getWindowIcon?this._slimcoreInstance.getWindowIcon(e,{width:t,height:n,asImage:i}).then(r.convertImageData):this._screenScraper?this._screenScraper.getWindowIcon(e,t,n,i):Promise.reject(new Error("not supported"))},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(0),s=n(1),l=SlimCore.Enums,c=n(2),u=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t.createChild(function(){return"LocalVideo["+l._videoObjectId+"]"}),n,r)||this;return l._call=i,l._callObjectId=o,l._callHandler=a,l._deviceManager=s,l.isStreaming=!1,l.isAvailable=!0,l.isStoppingOrNotStarted=!1,l.isRendering=!1,l.isPaused=!1,l._videoObjectId=0,l._logger.info("constructor"),l._registerDisposable(l._deviceManager.on("devicesChanged",function(){return l._devicesChanged()})),l}return i(t,e),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype._devicesChanged=function(){var e=this,t=c.default(),n=this._logger.createFnLogger("devicesChanged",t);n.info("Devices changed - checking if video needs to be restarted");var r=this._deviceManager.getSelectedDevices();this._currentCamera&&r.camera&&r.camera!==this._currentCamera.id&&(n.info("Changing video device to "+r.camera),this.stop(void 0,t).then(function(){return e.start(t,e.negotiationTag)}).catch(function(e){n.logFailure("Caught error while trying to stopstart local video after device change. Error: "+e)}))},t.prototype._videoObjectChanged=function(e){this._logger.info("Video state changed -> "+e+" ("+l.VideoStatus[e]+")");var t=a.isVideoAvailable(e),n=e===l.VideoStatus.Running;this.isPaused=e===l.VideoStatus.Paused,this.isStoppingOrNotStarted=e===l.VideoStatus.Stopping||e===l.VideoStatus.NotStarted,this.isAvailable=t,this.isStreaming=n,this.isRendering=n,this.raiseChanged()},t.prototype._executeOperationAndExpectVideoStateTransition=function(e,t,n,r){var i=this,a=this._logger.createFnLogger("LocalVideoOperation",r);return new Promise(function(r,s){var c=!1,u=null;setTimeout(function(){if(!c){u&&(u.dispose(),u=null);var e=i._getIntProperty(i._callHandler,t,l.Property.VideoStatus);if(a.info("_executeOperationAndExpectVideoStateTransition["+t+"] time out. Current State = "+e+"."),-1!==o.indexOf(n,e))r();else{var d="_executeOperationAndExpectVideoStateTransition["+t+"] time out. Video not in expected final state";a.info(d),s(d)}}},500),u=i._slimcoreInstance.handle("object-property-changed",{objectId:t,propKey:l.Property.VideoStatus},function(e){return i=e.value,a.info("Video state changed for monitored video ID["+t+"] -> "+i+" ("+l.VideoStatus[i]+")"),void(c||-1===o.indexOf(n,i)||(c=!0,u&&(u.dispose(),u=null),r()));var i}),e()})},t.prototype._startInternalVideo=function(e,t){var n=this;if(this._internalVideoStartPromise)return this._internalVideoStartPromise;var r=this._logger.createFnLogger("startInternalVideo",t);return this._internalVideoStartPromise=Promise.resolve(void 0).then(function(){var e=n._deviceManager.getSelectedCamera();if(!e)throw new Error("No camera selected to start video on");if(r.info("Starting local video using camera: "+JSON.stringify(e)),n._currentCamera=e,n._videoObjectId=n._slimcoreInstance.createLocalVideo(l.VideoType.Video,e.label,e.id),0===n._videoObjectId)throw r.logFailure("SlimCore returned invalid video object ID 0"),new Error("SlimCore returned invalid video object ID 0");n._callHandler.callAttachSendVideo(n._callObjectId,n._videoObjectId)}).then(function(){return a.waitForVideoObjectToBeAvailable(n._slimcoreInstance,n._callHandler,n._videoObjectId,n._logger)}).then(function(){r.info("Local Video is AVAILABLE. Starting Video"),n._videoStatusChangedHandler=n._slimcoreInstance.handle("object-property-changed",{objectId:n._videoObjectId,propKey:l.Property.VideoStatus},function(e){return n._videoObjectChanged(e.value)});var i=n._getIntProperty(n._callHandler,n._videoObjectId,l.Property.VideoStatus);return n._videoObjectChanged(i),n._executeOperationAndExpectVideoStateTransition(function(){e&&(n.negotiationTag=e),n._slimcoreInstance.videoStart(n._videoObjectId,n.negotiationTag)},n._videoObjectId,[l.VideoStatus.Running,l.VideoStatus.Starting],t)}),this._internalVideoStartPromise},t.prototype.start=function(e,t){var n,r=this,i=this._logger.createFnLogger("start",e);return i.info("Local video START requested"),this._call.callStateCanToggleVideo()?this._currentStartPromise?(i.logSuccess("Start requested but pending start exists. Returning previous promise"),this._currentStartPromise):(this._currentStopPromise?(i.info("Start requested but pending stop exists. Waiting for previous stop promise"),n=this._currentStopPromise):n=Promise.resolve(),this._currentStartPromise=n.then(function(){return r._startInternalVideo(t,e)}).then(function(){r._currentStartPromise=null}).catch(function(t){throw i.logFailure(t),r._currentStartPromise=null,r.stop(void 0,e),t}),this._currentStartPromise):(i.logFailure("Local video start requested but call is not connected, skipping operation"),Promise.resolve(null))},t.prototype.stop=function(e,t){var n=this,r=this._logger.createFnLogger("stop",e);r.info("Local video STOP requested");var i,o=function(){n._videoStatusChangedHandler&&(n._videoStatusChangedHandler.dispose(),n._videoStatusChangedHandler=null),n._videoObjectId=0,n._currentCamera=null,n._currentStopPromise=null,n._currentStartPromise=null,n._internalVideoStartPromise=null};return this._currentStopPromise?(r.info("Stop requested but pending stop exists. Returning previous promise"),this._currentStopPromise):(this._currentStartPromise?(r.info("Waiting for start promise to finish."),i=this._currentStartPromise):i=Promise.resolve(),this._currentStopPromise=i.then(function(){n._logger.info("Stopping SlimCore video objects"),0!==n._videoObjectId&&(n.negotiationTag=t,n._slimcoreInstance.videoStop(n._videoObjectId,n.negotiationTag))}).then(function(){return n._call.callStateCanToggleVideo()?a.waitForVideoObjectToBeAvailable(n._slimcoreInstance,n._callHandler,n._videoObjectId,n._logger):Promise.resolve()}).then(function(){r.info("VideoBinding was released")}).then(o,function(e){throw r.logFailure(e),o(),e}),this._currentStopPromise)},t.prototype.setVideoEffects=function(e){var t=this;return 0===this._videoObjectId?(this._logger.warn("setVideoEffects called with _videoObjectId === 0. Setting the default cached effect value instead."),Promise.resolve().then(function(){t._slimcoreInstance.setDefaultStartingVideoEffects?t._slimcoreInstance.setDefaultStartingVideoEffects(e):t._logger.warn("setDefaultStartingVideoEffects is not available")}).catch(function(e){throw t._logger.error("Failed to set Video Effects, Error = "+e),e})):Promise.resolve().then(function(){return t._slimcoreInstance.setVideoEffects(e,t._videoObjectId)}).catch(function(e){throw t._logger.error("Failed to set Video Effects, Error = "+e),e})},t.prototype.getVideoEffectsCapability=function(){var e=this;return 0===this._videoObjectId?Promise.reject(new Error("Cannot query effects when video is not created")):Promise.resolve().then(function(){var t=e._slimcoreInstance.getVideoEffectsCapability(e._videoObjectId);return Promise.resolve(t)}).catch(function(t){throw e._logger.error("Failed to query Video Effects, Error = "+t),t})},t.prototype.dumpVideoSourceImages=function(){return 0===this._videoObjectId?Promise.reject(new Error("Cannot dump video effects debug images when video is not created")):this._slimcoreInstance.dumpVideoSourceImages(this._videoObjectId)},t.prototype.dispose=function(t){var n=this,r=function(){return e.prototype.dispose.call(n)};Promise.resolve(function(){return 0===n._videoObjectId||n.stop(void 0,t)}).then(r).catch(r)},t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=n(4),c=n(6),u=n(32),d=n(5),p=n(0),h=n(1),f=n(11),g=n(19),_=n(20),m=SlimCore.Enums,v=n(2),y=n(17),C=function(e){function t(t,n,r,i,o,a){var s=e.call(this,new y.default(t).createChild("CallRegistry"),n,r)||this;return s._deviceManager=i,s._appHooks=o,s._telemetryService=a,s.calls=[],s._loginPromiseDefered=l.defer(),s._logoutPromiseDefered=l.defer(),s._startSlimcorePromiseDefered=l.defer(),s.isdisposing=!1,s._disposedPromise=l.defer(),s.slimcoreInstanceStartCalled=!1,s._logger.info("constructor"),s._slimcoreInstance.setMaxListeners(0),s._ecsProvider=new g.default(s._slimcoreInstance),s}return i(t,e),t.prototype.dispose=function(t){return void 0===t&&(t=v.default()),o(this,void 0,void 0,function(){var n,r,i,o=this;return a(this,function(a){return this.isdisposing=!0,n=function(){var n=o._logger.createFnLogger("dispose",t);n.info("dispose"),o.calls=[],o._slimcoreCallHandler.dispose(),o._slimcoreCallHandler=void 0,o._account&&o._account.dispose(),o._account=void 0,n.info("callhandler is disposed"),o.event("disposed").raise(),e.prototype.dispose.call(o),o._disposedPromise.resolve()},r=this.calls.map(function(e){return e.stop()}),i=function(){return o.logout(t)},[2,Promise.all(r).then(i,i).then(n,n)]})})},Object.defineProperty(t.prototype,"loginPromise",{get:function(){return this._loginPromiseDefered.promise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disposePromise",{get:function(){return this._disposedPromise.promise},enumerable:!0,configurable:!0}),t.prototype._initCall=function(e,t,n){var r=this._logger.createFnLogger("initCall[callId="+e.callId+"][participantId="+e.participantId+"]",n);if(r.info("callObjectId="+t),e.callerMri=p.stripMriAliases(this._getStrProperty(this._slimcoreCallHandler,t,m.Property.CallerMriIdentity)),e.callerMri){var i=this._getProperties(this._slimcoreCallHandler,t,{callQueueInfo:{propKey:m.Property.CallQueueInfo},transferorMri:{propKey:m.Property.CallTransferorMri},transferorDisplayName:{propKey:m.Property.CallTransferorDisplayName},transferorType:{propKey:m.Property.CallTransferorType},onBehalfOfMri:{propKey:m.Property.CallOnBehalfOfMri},incomingCallType:{propKey:m.Property.CallIncomingType},consultativeCallId:{propKey:m.Property.CallConsultativeTransferCallId},messageId:{propKey:m.Property.CallMessageId}},{status:{propKey:m.Property.CallStatus},isIncomingOneOnOneVideoCall:{propKey:m.Property.CallIsIncomingOneOnOneVideoCall}});e.transferorMri=p.stripMriAliases(i.transferorMri),e.transferorDisplayName=i.transferorDisplayName,e.transferorType=i.transferorType,e.onBehalfOfMri=p.stripMriAliases(i.onBehalfOfMri),e.callQueueInfo=i.callQueueInfo&&JSON.parse(i.callQueueInfo).callQueueInfo,e.incomingCallType=i.incomingCallType,e.consultativeCallId=i.consultativeCallId,e.isIncomingOneOnOneVideoCall=!!i.isIncomingOneOnOneVideoCall,e.messageId=i.messageId,e.attachSlimCoreCallObject(t,n),i.status===m.CallStatus.RingingIn&&e.setCallStateNotified(n)}else r.logFailure("Unable to get callerMRI from call object. Ignoring incoming call")},t.prototype._incomingCallMonitor=function(e,t){var n=this._logger.createFnLogger("incomingCallMonitor",t);n.info("_incomingCallMonitor for objectPropertyChange objectId="+e.objectId);var r=this._getStrProperty(this._slimcoreCallHandler,e.objectId,m.Property.CallName);if(p.hasFeature(m.Feature.MultiUserSupport)){var i=this._getStrProperty(this._slimcoreCallHandler,e.objectId,m.Property.CallAccountIdentity);if(i!==this.identity)return void n.info("incoming call("+r+") for user("+d.mriOrId(i)+") but current user is "+d.mriOrId(this.identity))}var o=this._getStrProperty(this._slimcoreCallHandler,e.objectId,m.Property.CallLegId);this._getCall(r,o,t)||n.logFailure("getCall failed to find the call(callId: "+r+", localParticipantId: "+o+")")},t.prototype.init=function(e,t,n){var r=this;void 0===t&&(t={block:!0}),void 0===n&&(n=v.default());var i=this._logger.createFnLogger("init",n);i.info("init"),t.block||p.hasFeature(m.Feature.AsyncStart)||(t.block=!0);var o=null;return this.slimcoreInstanceStartCalled?i.info("skipping slimcoreInstance start, because it was already started"):(t.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},function(e){return r._onLibStatusChanged(e)})),this._slimcoreInstance.setupSetStr("*Lib/SCT/Telemetry/DiagnosticLevel",t.telemetryDiagnosticLevel||""),this._slimcoreInstance.start(t.block),i.info("starting slimcoreInstance block="+t.block),this.slimcoreInstanceStartCalled=!0,t.block&&(this.libStatus=m.LibStatus.Running,this._startSlimcorePromiseDefered.resolve())),this._skypeIdentity=e,this.identity=e.id,this._skypeIdentity.tokenProvider().then(function(e){i.info("setting up stack callbacks"),o=r._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedIn},function(){var e=r._slimcoreInstance.createCallInterface();r._slimcoreCallHandler=p.wrap(e,r._settings),i.info("createCallInterface returned"),r._loginPromiseDefered.resolve(r._slimcoreCallHandler),o&&(o.dispose(),o=null),r._hookCallRegistryEvents()}),r._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.CallStatus,value:m.CallStatus.RingingIn},function(e){return r._incomingCallMonitor(e,n)}),r._initializeSlimCore(e),r._logger.info("initialize returned")}).catch(function(e){i.logFailure(e),r._loginPromiseDefered.reject(e)}),this.loginPromise.then(c.noop)},t.prototype.uninit=function(){var e=this;this.slimcoreInstanceStartCalled?this.libStatus!==m.LibStatus.Running&&(this._startSlimcorePromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state")),this._logoutPromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state"))):this._logoutPromiseDefered.reject(new Error("CallRegistry uninit called without slimcore::start()"));var t=null;try{this._logger.info("uninit: setting up stack callbacks"),t=this._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedOut},function(){e._logoutPromiseDefered.resolve(),t&&(t.dispose(),t=null)}),this._logger.info("uninit(): calling slimcore.logout()"),this._slimcoreInstance.logout()}catch(e){this._logger.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this.slimcoreInstanceStartCalled=!1,this._logoutPromiseDefered.promise.then(c.noop)},t.prototype.login=function(e,t){var n=this;void 0===t&&(t=v.default());var r=this._logger.createFnLogger("login",t);r.info("login");var i=null;return this._skypeIdentity=e,this.identity=e.id,this._setup=new _.default(this._slimcoreInstance,this.identity),this._skypeIdentity.tokenProvider().then(function(o){r.info("setting up stack callbacks"),i=n._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedIn},function(e){if(p.hasFeature(m.Feature.MultiUserSupport)&&n._account.getObjectId()!==e.objectId)r.error("accountObjectId: "+n._account.getObjectId+" does not match with "+e.objectId);else{var t=n._createCallHandler();n._slimcoreCallHandler=p.wrap(t,n._settings),r.info("createCallInterface returned"),n._loginPromiseDefered.resolve(n._slimcoreCallHandler),i&&(i.dispose(),i=null),n._hookCallRegistryEvents()}}),n._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.CallStatus,value:m.CallStatus.RingingIn},function(e){return n._incomingCallMonitor(e,t)}),n._login(o,e.displayName,r)}).catch(function(e){r.logFailure(e),n._loginPromiseDefered.reject(e)}),this.loginPromise.then(function(){return n.setAdditionalIdentities()})},t.prototype._login=function(e,t,n){if(p.hasFeature(m.Feature.MultiUserSupport)){if(this._account)return n.info("already logged in. updating displayname and skypetoken!"),this._account.updateDisplayName(t),void this._account.updateSkypeToken(e);var r=this._slimcoreInstance.getAccount(this.identity);this._account=p.wrap(r,this._settings),this._account.login(e,t)}else this._slimcoreInstance.login(this.identity,e,t)},t.prototype._createCallHandler=function(){return p.hasFeature(m.Feature.MultiUserSupport)?this._slimcoreInstance.getCallHandler(this._account.getObjectId()):this._slimcoreInstance.createCallInterface()},t.prototype.logout=function(e){var t=this;void 0===e&&(e=v.default());var n=this._logger.createFnLogger("logout",e);n.info("logout");var r=null;try{n.info("setting up stack callbacks"),r=this._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedOut},function(e){p.hasFeature(m.Feature.MultiUserSupport)&&t._account.getObjectId()!==e.objectId||(t._logoutPromiseDefered.resolve(),r&&(r.dispose(),r=null))}),n.info("calling slimcore.logout()"),this._logout()}catch(e){n.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this._logoutPromiseDefered.promise.then(c.noop)},t.prototype._logout=function(){p.hasFeature(m.Feature.MultiUserSupport)?this._account.logout():this._slimcoreInstance.logout()},t.prototype.setRing=function(e){var t=this;return Promise.resolve().then(function(){return p.hasFeature(m.Feature.MultiUserSupport)&&t._account?t._account.setRing(e):t._setup.setString("*Lib/Call/NG/Ring",e)})},t.prototype.setTenantId=function(e){var t=this;return Promise.resolve().then(function(){return p.hasFeature(m.Feature.MultiUserSupport)&&t._account?t._account.setTenantId(e):t._setup.setString("*Lib/Call/NG/TenantId",e)})},t.prototype.updateDisplayName=function(e){var t=this;return Promise.resolve().then(function(){return p.hasFeature(m.Feature.MultiUserSupport)&&t._account?t._account.updateDisplayName(e):t._skypeIdentity.tokenProvider().then(function(n){return t._login(n,e,t._logger)})})},t.prototype.updateSkypeToken=function(e){p.hasFeature(m.Feature.MultiUserSupport)&&this._account?this._account.updateSkypeToken(e):this._slimcoreInstance.updateSkypeToken(e)},t.prototype.fireIntent=function(e,t){var n=this;return Promise.resolve().then(function(){p.hasFeature(m.Feature.MultiUserSupport)&&n._slimcoreInstance.fireIntent(m.Intent.CallPush,t,void 0,n.identity)})},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.createCall=function(e,t,n,r,i){var o=this;void 0===i&&(i=v.default());var a=this._logger.createFnLogger("createCall",i);if(a.info("threadId:"+e+", callId:"+t+", localParticipantId: "+n+", messageId:"+r),null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw a.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");this._skypeIdentity.tokenProvider().then(function(e){e&&(a.info("Updating Skype Token..."),o.updateSkypeToken(e),a.info("Token update complete"))});var l=null;if(e&&(l=s.find(this.calls,function(t){return t.threadId===e}))){if(t&&l.callId===t)return a.logFailure("Call Registry already has an entry for callId: "+l.callId+", threadId: "+l.threadId),l;if(r&&l.messageId===r)return a.logFailure("Call Registry already has an entry for threadId: "+l.threadId+", messageId: "+l.messageId),l}return(l=this._getCall(t,n,i))?l:(l=new f.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._deviceManager,this._appHooks,e,t||u.default(),this._skypeIdentity,n,this._telemetryService,r),this.calls.push(l),this.event("callAdded").raise(l),this.raiseChanged(),l)},t.prototype.getCall=function(e,t,n){return void 0===n&&(n=v.default()),this._getCall(e,t,n)},t.prototype._getCall=function(e,t,n){var r=this,i=this._logger.createFnLogger("getCall[callId="+e+"][participantId="+t+"]",n);if(!e&&!t)return i.logFailure("callId & participantId is undefined"),null;if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw i.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");var o=s.find(this.calls,function(t){return t.callId===e});if(o)return 8===o.state?(this._initCall(o,o.slimcoreCallId,n),o):(i.info("Call Registry already has an entry for this call"),o);var a=s.find(this._slimcoreCallHandler.getActiveCalls(),function(n){return r._slimcoreCallHandler.getStrProperty(n,m.Property.CallName)===e&&r._slimcoreCallHandler.getStrProperty(n,m.Property.CallLegId)===t});if(!a)return i.logFailure("slimCoreCallObjectId not found"),null;var l=this._slimcoreCallHandler.getStrProperty(a,m.Property.CallThreadId),c=this._slimcoreCallHandler.getStrProperty(a,m.Property.CallMessageId);return o=new f.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._deviceManager,this._appHooks,l,e,this._skypeIdentity,t,this._telemetryService,c),this._initCall(o,a,n),this.calls.push(o),this.event("callAdded").raise(o),this.raiseChanged(),o},t.prototype.deleteCall=function(e,t,n){var r=this;void 0===t&&(t=!0),void 0===n&&(n=v.default()),this._logger.info("deleteCall "+e.callId);var i=!1;return s.each(s.remove(this.calls,function(t){return t===e}),function(o){i=!0,t&&(r.event("callRemoved").raise(e),o.dispose(n))}),!!i&&(this.raiseChanged(),!0)},t.prototype.debugInformation=function(e){var t=this._slimcoreCallHandler.getDebugInformation("/callinfo");return!e||t&&!s.isEmpty(t)||(t="CallInformation\n * CallId="+e.callId),Promise.resolve(t)},t.prototype.setAdditionalIdentities=function(){var e=this;return Promise.resolve().then(function(){if(e._skypeIdentity.sipUri){var t="2:"+e._skypeIdentity.sipUri;p.hasFeature(m.Feature.MultiUserSupport)&&e._account?e._account.setAdditionalIdentities(t):e._slimcoreInstance.setAdditionalIdentities(t)}})},t.prototype._initializeSlimCore=function(e){var t=this;try{this._startSlimcorePromiseDefered.promise.then(function(){t._logger.info("logging in to slimcore libStatus="+t.libStatus),t._slimcoreInstance.login(t._skypeIdentity.id,e,t._skypeIdentity.displayName)})}catch(e){this._logger.error("initialization failed.",e)}},t.prototype._onSkypeTokenRequired=function(e){this.event("skypeTokenRequired").raise(e.invalidToken)},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this.libStatus+" => "+e.libStatus),e.libStatus===m.LibStatus.Running?this._startSlimcorePromiseDefered.resolve():e.libStatus===m.LibStatus.FatalError&&this.libStatus===m.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this.libStatus=e.libStatus},t.prototype._onProxiedPushNotification=function(e){var t={eventId:e.eventId,payload:e.payload};this.event("proxiedPushNotification").raise(t)},t.prototype._hookCallRegistryEvents=function(){var e=this;p.hasFeature(m.Feature.MultiUserSupport)&&this._account?(this._registerDisposable(this._account.handle("skype-token-required",void 0,function(t){return e._onSkypeTokenRequired(t)})),this._registerDisposable(this._slimcoreCallHandler.handle("proxied-push-notification",void 0,function(t){return e._onProxiedPushNotification(t)}))):(this._registerDisposable(this._slimcoreInstance.handle("skype-token-required",void 0,function(t){return e._onSkypeTokenRequired(t)})),this._registerDisposable(this._slimcoreInstance.handle("proxied-push-notification",void 0,function(t){return e._onProxiedPushNotification(t)})))},t}(h.default);t.default=C},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(0),s=n(1),l=n(48),c=n(10),u=n(18),d=SlimCore.Enums,p=n(2),h=function(){function e(e,t){this._kind=e,this._logger=t,this._list=[],this._logger.info("constructor")}return e.prototype.update=function(e){this._list=e,this._logger.info("update: "+JSON.stringify(this._list))},e.prototype.isAvailable=function(e){return!(!e||!o.find(this._list,function(t){return t.id===e}))},e.prototype.getBestDevice=function(){return this._getDeviceId(o.first(this._list))},e.prototype.getSelectedDevice=function(){if(this.isAvailable(this._selectedDevice))return this._logger.debug("getSelectedDevice: "+this._selectedDevice),this._selectedDevice;var e=this.getBestDevice();return this._logger.debug("getSelectedDevice - unknown device selected, returning preferred device: "+e),e},e.prototype.selectDevice=function(e){this.isAvailable(e)?(this._logger.info("selectDevice: "+e),this._selectedDevice=e):(this._logger.info("selectDevice - unknown device selected, selecting preferred device"),this._selectedDevice=null)},e.prototype._getDeviceId=function(e){return e?e.id:null},e}(),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getBestDevice=function(){var t=this._findCamera(d.CameraFacing.External),n=this._findCamera(d.CameraFacing.Front),r=this._findCamera(d.CameraFacing.LeftFront),i=this._findCamera(d.CameraFacing.RightFront),o=this._findCamera(),a=e.prototype.getBestDevice.call(this);return t||n||r||i||o||a},t.prototype.enumerate=function(){var e=this;return o.map(this._list,function(t){return{id:t.id,browserId:t.browserId,label:t.label,kind:e._kind,position:e._getCameraPosition(t.cameraFacing)}})},t.prototype._findCamera=function(e){var t=o.find(this._list,function(t){return t.deviceType!==d.DeviceType.Virtual&&(!e||t.cameraFacing===e)});return this._getDeviceId(t)},t.prototype._getCameraPosition=function(e){switch(e){case d.CameraFacing.Front:return 1;case d.CameraFacing.LeftFront:return 4;case d.CameraFacing.RightFront:return 5;case d.CameraFacing.Back:return 2;case d.CameraFacing.External:return 3;default:return 0}},t}(h),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.enumerate=function(){var e=this,t=o.find(this._list,function(e){return e.isSystemDefault})||o.first(this._list);return o.map(this._list,function(n){return{id:n.id,browserId:n.browserId,label:n.label,kind:e._kind,productId:""+(n.productId||""),vendorId:""+(n.vendorId||""),isSystemDefault:n===t}})},t}(h),_=function(){function e(e){this._logger=e,this._list=[],this._logger.info("constructor")}return e.prototype.update=function(e){this._list=e,this._logger.info("update: "+JSON.stringify(this._list))},e.prototype.enumerate=function(){var e=this;return o.map(this._list,function(t){return{id:null,browserId:null,label:t.label,kind:4,microphoneId:t.microphoneId,speakerId:t.speakerId,formFactor:e._getCompositeDeviceFormFactor(t.deviceType),isPcInternalDevice:t.isPcInternalDevice}})},e.prototype._getCompositeDeviceFormFactor=function(e){switch(e){case d.CompositeAudioDeviceType.Speakers:return 1;case d.CompositeAudioDeviceType.Headphones:return 2;case d.CompositeAudioDeviceType.Headset:return 3;case d.CompositeAudioDeviceType.Handset:return 4;case d.CompositeAudioDeviceType.Speakerphone:return 5;default:return 0}},e}();var m=function(e){function t(t,n,r,i,o){var s=e.call(this,t.createChild("DeviceManager"),n,r)||this;return s._mediaReadyPromise=i,s._appHooks=o,s._browserDevices=[],s._haveStartedMedia=!1,s._startPreviewVideo=function(e){return s._mediaReadyPromise.then(function(t){return s._logger.info("Wait AVAILABLE for preview video "+e),a.waitForVideoObjectState({slimcoreInstance:s._slimcoreInstance,slimcoreObject:t,videoObjectId:e,logger:s._logger,resolveStates:[d.VideoStatus.Available],rejectStates:[d.VideoStatus.NotAvailable],timeout:a.videoObjectTimeout(s._settings)}).then(function(){s._logger.info("Starting preview video "+e),s._slimcoreInstance.videoStart(e)}).then(function(){return a.waitForVideoObjectState({slimcoreInstance:s._slimcoreInstance,slimcoreObject:t,videoObjectId:e,logger:s._logger,resolveStates:[d.VideoStatus.Starting,d.VideoStatus.Running],rejectStates:[d.VideoStatus.NotAvailable],timeout:a.videoObjectTimeout(s._settings)})}).then(function(){return s._logger.info("Now can use preview video "+e)})})},s._stopPreviewVideo=function(e){return Promise.resolve().then(function(){s._logger.info("Stopping preview video "+e),s._slimcoreInstance.videoStop(e)})},s._createRendererBinding=function(e){var t;return s._previewVideoManager.acquire(s._rendererBindingManager,e).then(function(){return t=s._slimcoreInstance.createVideoBindingRenderer?s._slimcoreInstance.createVideoBindingRenderer({enableDXVA:s._settings.enableDXVA,isLocalPreview:!0}):SlimCore.createVideoBindingRenderer(),s._logger.info("Create rendering binding for preview video "+e),s._slimcoreInstance.videoCreateBinding(e,t)}).then(function(){return s._logger.info("Created rendering binding for preview video "+e),t})},s._releaseRendererBinding=function(e,t){return Promise.resolve().then(function(){return s._logger.info("Release rendering binding for preview video "+e),s._slimcoreInstance.videoReleaseBinding(e,t)}).then(function(){return s._logger.info("Released rendering binding for preview video "+e),s._previewVideoManager.release(s._rendererBindingManager,e)})},s._createScreenShareBinding=function(e){var t;return s._previewVideoManager.acquire(s._screenShareBindingManager,e).then(function(){return t=s._createVideoBindingScreenShare(),s._logger.info("Create screenshare binding for preview video "+e),s._slimcoreInstance.videoCreateBinding(e,t)}).then(function(){return s._logger.info("Created screenshare binding for preview video "+e),t})},s._releaseScreenShareBinding=function(e,t){return Promise.resolve().then(function(){return s._logger.info("Release screenshare binding for preview video "+e),s._slimcoreInstance.videoReleaseBinding(e,t)}).then(function(){return s._logger.info("Released screenshare binding for preview video "+e),s._previewVideoManager.release(s._screenShareBindingManager,e)})},s._logger.info("constructor"),s._cameras=new f(1,s._logger.createChild("cameras")),s._microphones=new g(2,s._logger.createChild("microphones")),s._speakers=new g(3,s._logger.createChild("speakers")),s._compositeDevices=new _(s._logger.createChild("compositeaudiodevices")),s._devicesEnumeratedPromise=s._mediaReadyPromise.then(function(){return s._updateBrowserDevices()}).then(function(){s._updateAudioDevices(),s._updateVideoDevices(),s._handleDisplaysChanged()}),s._previewVideoManager=new l.SlimCoreElectronBindingManager(s._startPreviewVideo,s._stopPreviewVideo,s._logger),s._rendererBindingManager=new l.SlimCoreElectronBindingManager(s._createRendererBinding,s._releaseRendererBinding,s._logger),s._screenShareBindingManager=new l.SlimCoreElectronBindingManager(s._createScreenShareBinding,s._releaseScreenShareBinding,s._logger),s._registerDisposable(s._slimcoreInstance.handle("device-list-changed",void 0,function(e){return s._slimCoreDevicesChangedHander(e)})),s._registerDisposable(s._appHooks.onDisplaysChanged(function(){return s._handleDisplaysChanged()})),s}return i(t,e),t.prototype.getRendererBindingManager=function(){return this._rendererBindingManager},t.prototype.getScreenShareBindingManager=function(){return this._screenShareBindingManager},t.prototype.getPreviewVideo=function(e,t,n){var r=this,i=0;return this._mediaReadyPromise.then(function(o){if(0===(i=r._slimcoreInstance.createPreviewVideo(e,t,n)))throw new Error("SlimCore returned invalid video object ID 0");return r._logger.info("Got preview video. Waiting for video to become AVAILABLE|STARTING|RUNNING"),a.waitForVideoObjectToBeAvailable(r._slimcoreInstance,o,i,r._logger,a.videoObjectTimeout(r._settings))}).then(function(){return i})},Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._handleDisplaysChanged=function(){try{this._slimcoreInstance.setDeviceRotation(SlimCore.queryDeviceRotation())}catch(e){this._logger.warn("Displays Changed handling error: "+e)}},t.prototype._updateVideoDevices=function(){this._cameras.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getCameraList(),"videoinput"))},t.prototype._updateAudioDevices=function(){this._microphones.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getMicrophoneList(),"audioinput")),this._speakers.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getSpeakerList(),"audiooutput")),this._slimcoreInstance.getCompositeAudioDevices&&this._compositeDevices.update(this._slimcoreInstance.getCompositeAudioDevices()),this._selectAudioDevices()},t.prototype._updateBrowserDevices=function(){var e=this;return"object"!=typeof navigator?(this._logger.warn("Browser-backed device list won't be fetched as navigator is not available"),Promise.resolve()):this._browserDevicesPromise?this._browserDevicesPromise:this._browserDevicesPromise=navigator.mediaDevices.enumerateDevices().then(function(t){e._browserDevices=t,e._browserDevicesPromise=void 0})},t.prototype._fillBrowserDeviceIds=function(e,t){if(!e)return e;for(var n=function(e){var n=r._browserDevices.find(function(n){if(n.kind!==t)return!1;if(n.label===e.label)return!0;if(0===n.label.indexOf(e.label)){var r=function(e,t){var n=e.split(t)[1].trim().match(/\((.+):(.+)\)/);if(n){var r=n.slice(1);return"vid_"+r[0]+"&pid_"+r[1]}}(n.label,e.label);return e.id.indexOf(r)>-1}return!1});n?e.browserId=n.deviceId:r._browserDevices.length>0&&r._logger.warn("No browser device found for device "+e.label)},r=this,i=0,o=e;i<o.length;i++){n(o[i])}return e},t.prototype._selectAudioDevices=function(){var e=this._microphones.getSelectedDevice(),t=this._speakers.getSelectedDevice();this._logger.info("SlimCore - selectAudioDevices: "+e+", "+t),this._slimcoreInstance.selectAudioDevices(e,t)},t.prototype._slimCoreDevicesChangedHander=function(e){var t=this;this._logger.info("SlimCore Devices changed: "+JSON.stringify(e)),this._updateBrowserDevices().then(function(){e.video?t._updateVideoDevices():t._updateAudioDevices(),t._raiseDevicesChanged()})},t.prototype._raiseDevicesChanged=function(){this.raiseChanged(),this.event("devicesChanged").raise(this._enumerateDevices())},t.prototype._enumerateDevices=function(){var e=this._cameras.enumerate(),t=this._microphones.enumerate(),n=this._speakers.enumerate(),r=this._compositeDevices.enumerate();return[].concat(e,t,n,r)},t.prototype.askDevicePermission=function(e){return Promise.resolve().then(function(){return{audio:!0,video:!0}})},t.prototype._triggerMediaInitOnce=function(){a.hasFeature(d.Feature.LazyMediaInit)&&!this._haveStartedMedia&&(this._slimcoreInstance.fireIntent(d.Intent.MediaInit),this._haveStartedMedia=!0)},t.prototype.enumerateDevicesAsync=function(){var e=this;return new Promise(function(t,n){e._triggerMediaInitOnce(),e._devicesEnumeratedPromise.then(function(){return e._enumerateDevices()}).then(t,n)})},t.prototype.selectDevices=function(e){var t=this;this._devicesEnumeratedPromise.then(function(){t._selectDevices(e)})},t.prototype._selectDevices=function(e){this._logger.debug("selectDevices - "+JSON.stringify(e)),void 0!==e.camera&&this._cameras.selectDevice(e.camera),void 0!==e.microphone&&this._microphones.selectDevice(e.microphone),void 0!==e.speaker&&this._speakers.selectDevice(e.speaker),this._selectAudioDevices(),this._raiseDevicesChanged()},t.prototype.setDeviceEffects=function(e,t){this._slimcoreInstance.setDeviceEffects?this._slimcoreInstance.setDeviceEffects(e,c.convertVideoEffectType(t)):this._logger.warn("setDeviceEffects is not available")},t.prototype.setDeviceEffectsAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){n._slimcoreInstance.setDeviceEffects?n._slimcoreInstance.setDeviceEffects(e,c.convertVideoEffectType(t)):n._logger.warn("setDeviceEffects is not available")}).catch(function(e){throw n._logger.error("Failed to set Video Effects, Error = "+e),e})},t.prototype.getDeviceEffectsCapability=function(e,t){return this._slimcoreInstance.getDeviceEffectsCapability?this._slimcoreInstance.getDeviceEffectsCapability(e,t):(this._logger.warn("getDeviceEffectsCapability is not available"),0)},t.prototype.getDeviceEffectsCapabilityAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){return n._slimcoreInstance.getDeviceEffectsCapability?n._slimcoreInstance.getDeviceEffectsCapability(e,t):(n._logger.warn("getDeviceEffectsCapability is not available"),0)}).catch(function(e){throw n._logger.error("Error in getDeviceEffectsCapabilityAsync, error = "+e),e})},t.prototype.setVideoEffects=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){return n._slimcoreInstance.setVideoEffects(e,t)}).catch(function(e){throw n._logger.error("Failed to set Video Effects, Error = "+e),e})},t.prototype.getVideoEffectsCapability=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.getVideoEffectsCapability(e)}).catch(function(e){throw t._logger.error("Failed to query Video Effects, Error = "+e),e})},t.prototype.enableTtySupport=function(e){var t=this;return Promise.resolve().then(function(){if(t._slimcoreInstance.createMediaConfig){var n=t._slimcoreInstance.createMediaConfig();if(n.enableTtySupport)return n.enableTtySupport(e)}return t._slimcoreInstance.enableTtySupport(e)}).catch(function(e){t._logger.error("Error in enableTtySupport(), error = "+e)})},t.prototype.getSelectedDevices=function(){var e={camera:this._cameras.getSelectedDevice(),microphone:this._microphones.getSelectedDevice(),speaker:this._speakers.getSelectedDevice()};return this._logger.debug("getSelectedDevices - "+JSON.stringify(e)),e},t.prototype.getSelectedCamera=function(){var e=this._cameras.getSelectedDevice(),t=o.find(this._cameras.enumerate(),function(t){return t.id===e});return this._logger.debug("getSelectedCamera - "+JSON.stringify(t)),t},t.prototype.createPreviewRenderer=function(e,t,n){void 0===n&&(n=p.default());var r=new u.default(this._logger,this._settings,this._slimcoreInstance,e,this,d.VideoType.Video,t);return Promise.resolve().then(function(){return r.startVideoAsync(n)}).then(function(){return r})},t.prototype.createScreenSharingPreviewRenderer=function(e,t,n){void 0===n&&(n=p.default());var r=new u.default(this._logger,this._settings,this._slimcoreInstance,e,this,d.VideoType.ScreenShare,t);return Promise.resolve().then(function(){return r.startVideoAsync(n)}).then(function(){return r})},t.prototype.getDeviceNameAsync=function(e){var t=this;return Promise.resolve().then(function(){var n=o.find(t._enumerateDevices(),function(t){return t.id===e});if(!n)throw new Error("Device with id: "+e+" not found");return n.label})},t.prototype.getSpeakerVolume=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.getSpeakerVolume()})},t.prototype.getSpeakerSystemVolume=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.getSpeakerSystemVolume()})},t.prototype.setSpeakerVolume=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.setSpeakerVolume(e)})},t.prototype.setSpeakerSystemVolume=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.setSpeakerSystemVolume(e)})},t.prototype.unmuteMicrophone=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.unmuteMicrophone()})},t.prototype.unmuteSpeaker=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.unmuteSpeaker()})},t.prototype.getNrgLevelsForDeviceTuner=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.getNrgLevelsForDeviceTuner(e)})},t.prototype.getMicrophoneVolume=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.getMicrophoneVolume()})},t.prototype.setMicrophoneVolume=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.setMicrophoneVolume(e)})},t.prototype.hasVideoBindingScreenShare=function(){return!(!this._slimcoreInstance.createVideoBindingScreenShare&&!SlimCore.createVideoBindingScreenShare)},t.prototype._createVideoBindingScreenShare=function(){return this._slimcoreInstance.createVideoBindingScreenShare?this._slimcoreInstance.createVideoBindingScreenShare():SlimCore.createVideoBindingScreenShare()},t}(s.default);t.default=m},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(4),s=n(1),l=n(30),c=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild("ScreenSharingManager"),n,r)||this;a._appHooks=i,a._deviceManager=o,a._logger.info("constructor");try{a._screenScraper=new l.default(a._slimcoreInstance)}catch(e){a._logger.warn(""+e)}return a._registerDisposable(a._appHooks.onDisplaysChanged(function(){return a._raiseScreensChanged()})),a}return i(t,e),t.prototype.enumerateScreensAsync=function(){var e=this;return a.asap(function(){return e._enumerateScreens()})},t.prototype.enumerateWindowsAsync=function(){var e=this;return a.asap(function(){return e._enumerateWindows()})},t.prototype.enumerateCamerasAsync=function(){var e=this;try{return this._deviceManager?this._deviceManager.enumerateDevicesAsync().then(function(t){var n=t.filter(function(e){return 1===e.kind});return e._logger.debug("enumerateCameras() result: "+JSON.stringify(n)),o.map(n,function(e){return new p(e)})}):Promise.resolve([])}catch(e){return this._logger.error("enumerateCameras() failed: "+e),Promise.reject("enumerateCameras() failed: "+e)}},t.prototype._enumerateScreens=function(){var e=this;try{var t=this._screenScraper&&this._screenScraper.getMonitorList()||[];return this._logger.debug("ScreenScraper.getMonitorList() result: "+JSON.stringify(t)),o.map(t,function(t){return new u(t,e._logger,e._screenScraper)})}catch(e){throw this._logger.error("ScreenScraper.getMonitorList() failed: "+e),e}},t.prototype._enumerateWindows=function(){var e=this;try{var t=this._screenScraper&&this._screenScraper.getWindowList()||[];return this._logger.debug("ScreenScraper.getWindowList() result: "+JSON.stringify(t)),o.map(t,function(t){return new d(t,e._logger,e._screenScraper)})}catch(e){throw this._logger.error("ScreenScraper.getWindowList() failed: "+e),e}},t.prototype._raiseScreensChanged=function(){this._logger.debug("raising onScreensChanged"),this.event("screensChanged").raise()},t}(s.default);t.default=c;var u=function(){function e(e,t,n){this._monitorInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._monitorInfo.monitorId},e.prototype.getDeviceId=function(){return String(this._monitorInfo.monitorId)},e.prototype.getType=function(){return 1},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){var r=this;return new Promise(function(i){i(r._screenScraper.getMonitorPreview(r.getId(),e,t,n,r._monitorInfo.region))}).then(function(e){return r._logger.debug("ScreenScraper.getMonitorPreview("+r.getId()+") result: "+e.width+"x"+e.height),e},function(e){throw r._logger.error("ScreenScraper.getMonitorPreview("+r.getId()+") failed: "+e),e})},e.prototype.getDescription=function(){return this._monitorInfo.name},e.prototype.getIcon=function(e,t){return Promise.resolve(null)},e.prototype.getBounds=function(){return{x:this._monitorInfo.region.x,y:this._monitorInfo.region.y,width:this._monitorInfo.region.width,height:this._monitorInfo.region.height}},e}(),d=function(){function e(e,t,n){this._windowInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._windowInfo.windowId},e.prototype.getDeviceId=function(){return String(this._windowInfo.windowId)},e.prototype.getType=function(){return 2},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){var r=this;return new Promise(function(i){i(r._screenScraper.getWindowPreview(r.getId(),e,t,n))}).then(function(e){return r._logger.debug("ScreenScraper.getWindowPreview("+r.getId()+") result: "+e.width+"x"+e.height),e},function(e){throw r._logger.error("ScreenScraper.getWindowPreview("+r.getId()+") failed: "+e),e})},e.prototype.getDescription=function(){return this._windowInfo.title},e.prototype.getAppName=function(){return this._windowInfo.applicationName},e.prototype.getIcon=function(e,t,n){var r=this;return new Promise(function(i){i(r._screenScraper.getWindowIcon(r.getId(),e,t,n))}).then(function(e){return r._logger.debug("ScreenScraper.getWindowIcon("+r.getId()+") result: "+e.width+"x"+e.height),e},function(e){throw r._logger.error("ScreenScraper.getWindowIcon("+r.getId()+") failed: "+e),e})},e.prototype.getBounds=function(){},e}(),p=function(){function e(e){this._cameraDescription=e}return e.prototype.getId=function(){return null},e.prototype.getDeviceId=function(){return this._cameraDescription.id},e.prototype.getType=function(){return 3},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getDescription=function(){return this._cameraDescription.label},e.prototype.getIcon=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getBounds=function(){},e}()},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=n(4),c=n(5),u=n(13),d=n(49),p=n(0),h=n(1),f=n(33),g=n(34),_=n(19),m=n(35),v=n(20),y=n(56),C=SlimCore.Enums,S=n(2),I=n(6),P=n(17),T=7,b=function(e){function t(t,n){void 0===n&&(n=1);var r=e.call(this,t)||this;return r.callSupport=n,r}return i(t,e),t}(Error),O=function(e){function t(t){var n=e.call(this,new P.default(t.logger).createChild("CallingStack"),s.assign(t.settings,{platform:p.PlatformType.Electron}),p.wrap(t.slimCoreInstance,t.settings))||this;if(n.callRegistries=[],n._startSlimcorePromiseDefered=l.defer(),n._stackLoginPromise=l.defer(),n._mediaStartDeferredPromise=l.defer(),!SlimCore||!SlimCore.getVersion)throw new b("slimcore module is not available",1);if(R()<T)throw new b("slimcore module API version "+R()+" incompatible with required "+T,2);t.settings.enableTsCallingULLogging&&d.initLogging(n._slimcoreInstance,t),n._appHooks=t.appHooks,n._telemetryService=t.telemetryService,n._setup=new v.default(n._slimcoreInstance),n._ecsProvider=new _.default(n._slimcoreInstance),n._stackLoginPromise.promise.then(function(){return n._startSlimcorePromiseDefered.resolve(n._slimcoreInstance)});var r=new P.default(t.logger),i=p.hasFeature(C.Feature.MultiUserSupport)?n._startSlimcorePromiseDefered.promise:n._stackLoginPromise.promise,o=p.hasFeature(C.Feature.LazyMediaInit)?i.then(function(){return n._mediaStartDeferredPromise.promise}):i;return n._deviceManager=new g.default(r,n._settings,n._slimcoreInstance,o,t.appHooks),n._screenSharingManager=new m.default(r,n._settings,n._slimcoreInstance,t.appHooks,n._deviceManager),n._registerDisposable(n._slimcoreInstance.handle("e911-info-changed",void 0,function(e){return n._onE911Info(e)})),n._registerDisposable(n._slimcoreInstance.handle("media-status-changed",void 0,function(e){return n._onMediaStatus(e)})),n}return i(t,e),t.prototype.dispose=function(t){void 0===t&&(t=S.default());var n=this._logger.createFnLogger("dispose",t);n.info("dispose"),this._libStatus!==C.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized")),this.callRegistries.forEach(function(e){return e.dispose(t)}),this.callRegistries=[],n.info("call registries are disposed"),this._screenSharingManager.dispose(t),this._screenSharingManager=void 0,n.info("screensharing manager is disposed"),this._deviceManager.dispose(t),this._deviceManager=void 0,n.info("device manager is disposed"),this._slimcoreInstance.dispose(),this._slimcoreInstance=void 0,n.info("slimcore instance is disposed"),e.prototype.dispose.call(this)},t.prototype.init=function(e,t){return void 0===e&&(e={block:!0}),void 0===t&&(t=S.default()),o(this,void 0,void 0,function(){var n,r=this;return a(this,function(i){switch(i.label){case 0:return(n=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(p.hasFeature(C.Feature.AsyncStart)||(e.block=!0),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},function(e){return r._onLibStatusChanged(e)})),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",p.hasFeature(C.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return i.sent(),this._slimcoreInstance.start(e.block),n.info("starting slimcoreInstance block="+e.block),e.block&&(this._libStatus=C.LibStatus.Running,this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance)),[2,this._startSlimcorePromiseDefered.promise.then(I.noop)]}})})},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this._libStatus+" => "+e.libStatus),e.libStatus===C.LibStatus.Running?this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance):e.libStatus===C.LibStatus.FatalError&&this._libStatus===C.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this._libStatus=e.libStatus},t.prototype.getCallRegistry=function(e,t){var n=this;void 0===t&&(t=S.default());var r=e?c.mriOrId(e.id):void 0,i=this._logger.createFnLogger("getCallRegistry[identity="+r+"]",t);if(!e)return i.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this.createCallRegistry();var s=this.callRegistries.find(function(t){return t.identity===e.id});if(s&&!s.isdisposing)return i.info("callRegistry already exists for "+c.mriOrId(e.id)),Promise.resolve(s);var l=s&&s.isdisposing?s.disposePromise:Promise.resolve().then(I.noop);return this._startSlimcorePromiseDefered.promise.then(function(){return o(n,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return[4,l];case 1:return n.sent(),[4,(s=this.createCallRegistry()).login(e,t).catch(function(){return s.dispose(t)})];case 2:return n.sent(),[2,s]}})})})},t.prototype.createCallRegistry=function(){var e=this,t=new f.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryService);return t.on("disposed",function(){e.callRegistries.splice(e.callRegistries.indexOf(t),1)}),t.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),this.callRegistries.push(t),t},t.prototype.getDeviceManager=function(){return this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.fireIntent=function(e,n){if(this._slimcoreInstance){var r=t._callingIntentToSlimcoreIntent(e);r&&this._slimcoreInstance.fireIntent(r,n)}},t.prototype.getVersion=function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}},t._callingIntentToSlimcoreIntent=function(e){switch(e){case 0:return C.Intent.CallPush;case 1:return C.Intent.CallUser;case 2:return C.Intent.CallPreheat;case 3:return C.Intent.MediaInit;default:return}},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case C.MediaStatus.Initialized:return 1;case C.MediaStatus.NotAvailable:return 0;case C.MediaStatus.Failed:return 2;case C.MediaStatus.Uninitialized:return 3;default:return}},t.prototype.getMediaStatus=function(){return this._slimcoreMediaStatusToCallingMediaStatus(this._slimcoreInstance.getMediaStatus())},t.prototype.setMediaConfig=function(e){var t=this;return new Promise(function(n){t._setMediaConfig(e,t._startSlimcorePromiseDefered.promise),n()})},t.prototype._setMediaConfig=function(e,t){var n=this;if(!!this._slimcoreInstance.setMediaConfig)this._logger.info("Set Media Configuration, using setMediaConfig"),this._slimcoreInstance.setMediaConfig(e);else{var r=!!this._slimcoreInstance.setMediaPortRanges,i=!!this._slimcoreInstance.enableMediaQoS,o=!!this._slimcoreInstance.createMediaConfig,a=!!this._slimcoreInstance.setOpenCameraInMaxResolution,s=!!this._slimcoreInstance.enableTtySupport,l=!!this._slimcoreInstance.enableAGC,c=e.hasOwnProperty("mediaPortRanges"),u=e.hasOwnProperty("enableMediaQoS"),d=e.hasOwnProperty("openCameraInMaxResolution"),p=e.hasOwnProperty("enableTtySupport"),h=e.hasOwnProperty("enableAGC");if(a&&d&&(this._logger.info("Set Media Configuration, using OpenCameraInMaxResolution"),this._slimcoreInstance.setOpenCameraInMaxResolution(e.openCameraInMaxResolution)),u||c)if(i&&r)u&&(this._logger.info("Set Media Configuration, using set enableMediaQos"),this._slimcoreInstance.enableMediaQoS(e.enableMediaQoS)),c&&(this._logger.info("Set Media Configuration, using set Media port ranges"),this._slimcoreInstance.setMediaPortRanges(e.mediaPortRanges));else if(o){this._logger.info("Set Media Configuration, using CreateMediaConfig");var f=this._slimcoreInstance.createMediaConfig();u&&f.enableMediaQoS(e.enableMediaQoS),c&&f.setMediaPortRanges(e.mediaPortRanges)}else this._logger.error("Set Media Configuration, failed no suitable methods found for qos or port ranges");(p||h)&&(this._logger.info("Set Media Configuration, queuing operation to run when media is ready"),t.then(function(){if(p)if(s)n._logger.info("Set Media Configuration, using enableTtySupport"),n._slimcoreInstance.enableTtySupport(e.enableTtySupport);else if(o){var t=n._slimcoreInstance.createMediaConfig();t.enableTtySupport?(n._logger.info("Set Media Configuration, using CreateMediaConfig.enableTtySupport"),t.enableTtySupport(e.enableTtySupport)):n._logger.error("Set Media Configuration, failed no suitable methods found for enableTtySupport on CreateMediaConfig")}else n._logger.error("Set Media Configuration, failed no suitable methods found for enableTtySupport");h&&l&&(n._logger.info("Set Media Configuration, using enableAGC"),n._slimcoreInstance.enableAGC(e.enableAGC))}))}},t.prototype.getE911Info=function(){var e=this;return this._slimcoreInstance?this._slimcoreInstance.getE911Info?this._startSlimcorePromiseDefered.promise.then(function(){return e._slimcoreInstance.getE911Info()}):Promise.reject(new Error("getE911Info is not available")):Promise.reject(new Error("slimcore instance is already disposed"))},t.prototype._onE911Info=function(e){this.event("e911InfoChanged").raise(e.info)},t.prototype._onMediaStatus=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve(this._slimcoreInstance):2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t}(h.default);t.SlimCoreElectronStack=O;var E=function(e){function t(t){var n=e.call(this,new P.default(t.logger).createChild("CallingStack",!0),s.assign(t.settings,{platform:p.PlatformType.Uwp}),p.wrap(new y.UwpEngineWrapped(t.slimCoreInstance).objectAsWrapped,t.settings))||this;if(n.callRegistries=[],n._startSlimcorePromiseDefered=l.defer(),n._stackLoginPromise=l.defer(),n._mediaStartDeferredPromise=l.defer(),!p.isSlimCoreRTModuleAvailable())throw new b("slimcore module is not available",1);n._appHooks=t.appHooks,n._telemetryService=t.telemetryService,n._setup=new v.default(n._slimcoreInstance),n._stackLoginPromise.promise.then(function(){return n._startSlimcorePromiseDefered.resolve(n._slimcoreInstance)});var r=p.hasFeature(C.Feature.MultiUserSupport)?n._startSlimcorePromiseDefered.promise:n._stackLoginPromise.promise,i=p.hasFeature(C.Feature.LazyMediaInit)?r.then(function(){return n._mediaStartDeferredPromise.promise}):r;return n._deviceManager=new g.default(n._logger,n._settings,n._slimcoreInstance,i,t.appHooks),n._screenSharingManager=new m.default(n._logger,n._settings,n._slimcoreInstance,t.appHooks,n._deviceManager),n._registerDisposable(n._slimcoreInstance.handle("media-status-changed",void 0,function(e){return n._onMediaStatus(e)})),n}return i(t,e),t.prototype.dispose=function(t){void 0===t&&(t=S.default());var n=this._logger.createFnLogger("dispose",t);n.info("dispose"),this._libStatus!==C.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized")),this.callRegistries.forEach(function(e){return e.dispose(t)}),this.callRegistries=[],n.info("call registry is disposed"),this._screenSharingManager.dispose(t),this._screenSharingManager=void 0,n.info("screensharing manager is disposed"),this._deviceManager.dispose(t),this._deviceManager=void 0,n.info("device manager is disposed"),this._slimcoreInstance.dispose(),this._slimcoreInstance=void 0,n.info("slimcore instance is disposed"),e.prototype.dispose.call(this)},t.prototype.init=function(e,t){return void 0===e&&(e={block:!0}),void 0===t&&(t=S.default()),o(this,void 0,void 0,function(){var n,r=this;return a(this,function(i){switch(i.label){case 0:return(n=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(p.hasFeature(C.Feature.AsyncStart)||(e.block=!0),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},function(e){return r._onLibStatusChanged(e)})),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",p.hasFeature(C.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return i.sent(),this._slimcoreInstance.start(e.block),n.info("starting slimcoreInstance block="+e.block),e.block&&(this._libStatus=C.LibStatus.Running,this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance)),[2,this._startSlimcorePromiseDefered.promise.then(I.noop)]}})})},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this._libStatus+" => "+e.libStatus),e.libStatus===C.LibStatus.Running?this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance):e.libStatus===C.LibStatus.FatalError&&this._libStatus===C.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this._libStatus=e.libStatus},t.prototype.getCallRegistry=function(e,t){var n=this;void 0===t&&(t=S.default());var r=e?c.mriOrId(e.id):void 0,i=this._logger.createFnLogger("getCallRegistry[identity="+r+"]",t);if(!e)return i.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this.createCallRegistry();var s=this.callRegistries.find(function(t){return t.identity===e.id});if(s&&!s.isdisposing)return i.info("callRegistry already exists for "+c.mriOrId(e.id)),Promise.resolve(s);var l=s&&s.isdisposing?s.disposePromise:Promise.resolve().then(I.noop);return this._startSlimcorePromiseDefered.promise.then(function(){return o(n,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return[4,l];case 1:return n.sent(),[4,(s=this.createCallRegistry()).login(e,t).catch(function(){return s.dispose(t)})];case 2:return n.sent(),[2,s]}})})})},t.prototype.createCallRegistry=function(){var e=this,t=new f.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryService);return t.on("disposed",function(){e.callRegistries.splice(e.callRegistries.indexOf(t),1)}),t.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),this.callRegistries.push(t),t},t.prototype.getDeviceManager=function(){return this._logger.info("retrieving device manager"),this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return null},t.prototype.fireIntent=function(e,t){},t.prototype.getVersion=function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}},t.prototype.getMediaStatus=function(){return null},t.prototype.setMediaConfig=function(e){var t=this;return new Promise(function(n){t._logger.info("Set Media Configuration, using new default method"),t._slimcoreInstance.setMediaConfig(e),n()})},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case C.MediaStatus.Initialized:return 1;case C.MediaStatus.NotAvailable:return 0;case C.MediaStatus.Failed:return 2;case C.MediaStatus.Uninitialized:return 3;default:return}},t.prototype._onMediaStatus=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve(this._slimcoreInstance):2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t}(h.default);function R(){return SlimCore.getApiVersion&&SlimCore.getApiVersion()}t.SlimCoreUwpStack=E,t.slimCoreElectronStackFactory={build:function(e){return Promise.resolve().then(function(){return new O(e)}).catch(function(e){throw e instanceof b?e:new b(""+e)})},getVersion:function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}}},t.slimCoreUwpStackFactory={build:function(e){return Promise.resolve().then(function(){return new E(e)}).catch(function(e){throw e instanceof b?e:new b(""+e)})},getVersion:function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}}}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){n(0),n(1),n(11),n(26),n(33),n(34),n(19),n(29),n(31),n(18),n(16),n(15),n(27),n(35),n(20),n(36),e.exports=n(57)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var r,i=this;return r=this.on(e,this._fromEventCallback(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r.dispose(n),i._toEventCallback(t).apply(void 0,e)}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,[String(e)].concat(n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){var r;return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t)})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(21).EventSourceImpl);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e._startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e._startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e._startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),e}();t.Stopwatch=r,t.build=function(){return new r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONSTANTS={CODE:{CLIENT_ERROR_CODE:499},SUB_CODE:{ACTION_NOT_ALLOWED:3548}}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.getStreamInformationFromEndpoints=function(e){var t=[];if(!e||!e.endpointDetails.length)return null;try{e.endpointDetails.filter(function(e){return!!e.mediaStreams&&e.mediaStreams.length}).forEach(function(e){var n=e.mediaStreams.reduce(function(e,t){return e[t.type]=t.direction,e},{});t.push(r({endpointId:e.endpointId,participantId:e.participantId},n))})}catch(e){return[]}return t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0});var l=n(4),c=n(9),u=n(44),d=n(1),p=SlimCore.Enums,h=n(2),f=n(24),g=n(25),_=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t.createChild(function(){return"ContentSharing["+l.slimCoreContentSharingObjectId+"]"}),n,r)||this;return l._slimcoreCallHandler=i,l.slimCoreContentSharingObjectId=o,l._nativeContentSharing=a,l.callTelemetry=s,l.noFailureReason=SlimCore.Enums.ContentSharingFailureReason.NoFailure,l._getCallEndOperation=function(){return l._callOperationHandler.hasPendingOperation(c.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)?l._callOperationHandler.waitForOperation(c.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING):Promise.resolve()},l._logger.info("constructor"),l._session=new u.ContentSharingSession(l,l._logger),l._callOperationHandler=new g.default(l._logger,l.callTelemetry),l._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingStatus,function(e){return l._onContentSharingStatusChanged(e.value)}),l._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingState,function(e){return l._onContentSharingStateChanged(e.value)}),l._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingFailureReason,function(e){return l._onContentSharingResultCodeChanged(e.value)}),l.contentSharingStatus=l.convertContentSharingStatus(l.getIntProperty(SlimCore.Enums.Property.ContentSharingStatus)),l.contentSharingGuid=l.getStrProperty(SlimCore.Enums.Property.ContentSharingId),l.contentSharingState=l.getStrProperty(SlimCore.Enums.Property.ContentSharingState),l.contentSharingIdentity=l.getStrProperty(SlimCore.Enums.Property.ContentSharingIdentity),l._logger.info("Session created with status "+l.contentSharingStatus+", guid "+l.contentSharingGuid),l._registerDisposable(l._nativeContentSharing.handle("update-session-state-result",void 0,function(e){return l._onSessionStateResult(e)})),l._registerDisposable(l._nativeContentSharing.handle("take-control-result",void 0,function(e){return l._onTakeControlResult(e)})),l._registerDisposable(l._nativeContentSharing.handle("update-participant-state-result",void 0,function(e){return l._onUpdateParticipantStateResult(e)})),l._registerDisposable(l._nativeContentSharing.handle("join-result",void 0,function(e){return l._onJoinResult(e)})),l}return i(t,e),t.prototype._onContentSharingPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimCoreContentSharingObjectId,e,t)},t.prototype.setContentSharingStatus=function(e){if(this._logger.info("setContentSharingStatus. currentStatus: "+this.contentSharingStatus+" newStatus: "+e),this.contentSharingStatus!==e&&7!==this.contentSharingStatus&&8!==this.contentSharingStatus){if(this._logger.info("Changing content sharing status to: "+e),this.contentSharingStatus=e,7===e||8===e){if(this.contentSharingTerminationReason&&0!==this.contentSharingTerminationReason.terminatedReason)return;var t=this.getIntProperty(p.Property.ContentSharingFailureReason),n=this.getIntProperty(p.Property.ContentSharingFailureCode),r=this.getIntProperty(p.Property.ContentSharingFailureSubCode),i=this.convertFailureReason(t);this._logger.info("setting failure reason for content sharing session. reason: "+i),this.contentSharingTerminationReason={terminatedReason:i,terminatedReasonCode:n,terminatedReasonSubCode:r,errorMessage:"Session is terminated"}}this._session.statusChanged(e),this.raiseChanged()}},t.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._slimcoreCallHandler,this.slimCoreContentSharingObjectId,e,t)},t.prototype.getIntProperty=function(e,t){return this._getIntProperty(this._slimcoreCallHandler,this.slimCoreContentSharingObjectId,e,t)},t.prototype._onContentSharingStatusChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.setContentSharingStatus(this.convertContentSharingStatus(e))},t.prototype._onContentSharingStateChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.contentSharingState=e,this.raiseChanged()},t.prototype._onContentSharingResultCodeChanged=function(e){if(this._logger.info("_onContentSharingResultCodeChanged called"),!this.contentSharingTerminationReason||0===this.contentSharingTerminationReason.terminatedReason){var t=this.getIntProperty(p.Property.ContentSharingFailureCode),n=this.getIntProperty(p.Property.ContentSharingFailureSubCode),r=this.convertFailureReason(e);this._logger.info("setting failure reason for content sharing session. reason: "+r),this.contentSharingTerminationReason={terminatedReason:r,terminatedReasonCode:t,terminatedReasonSubCode:n,errorMessage:"Session is terminated"}}},t.prototype.convertContentSharingStatus=function(e){switch(e){case p.ContentSharingStatus.Routing:return 1;case p.ContentSharingStatus.Ringing:return 2;case p.ContentSharingStatus.Connected:return 4;case p.ContentSharingStatus.Presenting:return 3;case p.ContentSharingStatus.Viewing:return 5;case p.ContentSharingStatus.Finishing:return 6;case p.ContentSharingStatus.Done:case p.ContentSharingStatus.Failed:case p.ContentSharingStatus.TimedOut:return 7;default:return 0}},t.prototype.startContentSharing=function(e){return void 0===e&&(e=h.default()),this._session.startContentSharing(e)},t.prototype.joinContentSharing=function(e){return void 0===e&&(e=h.default()),this._session.joinContentSharing(e)},t.prototype.updateContentSharingParticipantStateToViewer=function(e){return void 0===e&&(e=h.default()),this._session.updateContentSharingParticipantStateToViewer(e)},t.prototype.updateContentSharingSessionState=function(e,t,n){return void 0===n&&(n=h.default()),this._session.updateContentSharingSessionState(e,t,n)},t.prototype.takeContentSharingControl=function(e){return void 0===e&&(e=h.default()),this._session.takeContentSharingControl(e)},t.prototype.stopContentSharing=function(e){return void 0===e&&(e=h.default()),this._session.stopContentSharing(e)},t.prototype._onJoinResult=function(e){this._session.onJoinResultEvent(e)},t.prototype._onUpdateParticipantStateResult=function(e){this._session.onUpdateParticipantStateResultEvent(e)},t.prototype._onSessionStateResult=function(e){this._session.onSessionStateResultEvent(e)},t.prototype._onTakeControlResult=function(e){this._session.onTakeControlResultEvent(e)},t.prototype.callStartContentSharing=function(){var e=this;return l.asap(function(){return e._nativeContentSharing.startContentSharing()})},t.prototype.callStopContentSharing=function(){var e=this;return l.asap(function(){return e._nativeContentSharing.stopContentSharing()})},t.prototype.callUpdateContentSharingSessionState=function(e,t){var n=this;return l.asap(function(){return n._nativeContentSharing.updateContentSharingSessionState(e,t)})},t.prototype.callTakeContentSharingControl=function(){var e=this;return l.asap(function(){return e._nativeContentSharing.takeContentSharingControl()})},t.prototype.callUpdateContentSharingParticipantState=function(){var e=this;return l.asap(function(){return e._nativeContentSharing.updateContentSharingParticipantState()})},t.prototype.convertFailureReason=function(e){switch(e){case p.ContentSharingFailureReason.NoFailure:return 1;case p.ContentSharingFailureReason.SessionNotFound:return 34;case p.ContentSharingFailureReason.SessionTimedOut:return 35;case p.ContentSharingFailureReason.NetworkError:return 3;case p.ContentSharingFailureReason.NetworkCannotConnectError:return 52;case p.ContentSharingFailureReason.ServiceFailure:return 48;case p.ContentSharingFailureReason.RequestTimedOut:return 45;case p.ContentSharingFailureReason.AuthFailure:return 29;case p.ContentSharingFailureReason.ActionNotAllowed:return 60;case p.ContentSharingFailureReason.Forbidden:return 8;case p.ContentSharingFailureReason.Failure:default:return 32}},t.prototype.dispose=function(t){var n=this;void 0===t&&(t=h.default());var r=this.contentSharingTerminationReason?this.contentSharingTerminationReason:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"};this.slimCoreContentSharingObjectId=0,this._getCallEndOperation().then(function(){n._callOperationHandler.rejectPendingOperations(r,t),e.prototype.dispose.call(n,t)})},o([f.callOperation(c.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"startContentSharing",null),o([f.callOperation(c.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"joinContentSharing",null),o([f.callOperation(c.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"updateContentSharingParticipantStateToViewer",null),o([f.callOperation(c.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,{type:f.OPERATION_TYPE.CHAINED}),s(2,f.causeId),a("design:type",Function),a("design:paramtypes",[String,String,Object]),a("design:returntype",Promise)],t.prototype,"updateContentSharingSessionState",null),o([f.callOperation(c.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"takeContentSharingControl",null),o([f.callOperation(c.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:c.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"stopContentSharing",null),t}(d.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(4),o=n(17),a={CANCELED_TERMINATION_REASON:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing is disconnected"},ACTION_NOT_ALLOWED:function(e){return{terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:e}}},s=function(){function e(e,t){var n=this;this._platformImpl=e,this._pendingDeferreds=[],this._updateContentSharingSessionStateDeferredPromises={},this.onJoinResultEvent=function(e){if(n._joinContenSharingDeferredPromise)if(n._logger.info("JoinContentSharing completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._joinContenSharingDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Join failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._joinContenSharingDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for join. Event data: "+e)},this.onUpdateParticipantStateResultEvent=function(e){if(n._updateParticipantStateDeferredPromise)if(n._logger.info("UpdateContentSharingParticipantStateToViewer completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._updateParticipantStateDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update participant state failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._updateParticipantStateDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for update participant state. Event data: "+e)},this.onSessionStateResultEvent=function(e){if(n._logger.info("UpdateContentSharingSessionState completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),n._updateContentSharingSessionStateDeferredPromises.hasOwnProperty(e.id))if(e.failureReason===n._platformImpl.noFailureReason)n._updateContentSharingSessionStateDeferredPromises[e.id].resolve();else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update SessionState failed with reason "+i;n._logger.error(o),n._updateContentSharingSessionStateDeferredPromises[e.id].reject({terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}},this.onTakeControlResultEvent=function(e){if(n._takeControlDeferredPromise)if(n._logger.info("TakeContentSharingControl completed for: "+n._platformImpl.contentSharingGuid+", "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._takeControlDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Take content sharing control failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._takeControlDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for take control. Event data: "+e)},this._logger=new o.default(t)}return e.prototype.statusChanged=function(e){if(7===e||8===e){if(this._stopContentSharingDeferredPromise&&this._invokeDeferred(this._stopContentSharingDeferredPromise),this._startContentSharingDeferredPromise){var t=this._platformImpl.contentSharingTerminationReason&&0!==this._platformImpl.contentSharingTerminationReason.terminatedReason?this._platformImpl.contentSharingTerminationReason:a.CANCELED_TERMINATION_REASON;this._rejectDeferred(this._startContentSharingDeferredPromise,t)}this._logger.info("Content sharing is disconnected"),this._rejectPendingPromises(a.CANCELED_TERMINATION_REASON)}else if(2===e||5===e||4===e){if(this._stopContentSharingDeferredPromise){var n="Content sharing cannot be ended when not presenting";t=a.ACTION_NOT_ALLOWED(n);this._logger.error(n),this._rejectDeferred(this._stopContentSharingDeferredPromise,t)}}else 3===e&&(this._startContentSharingDeferredPromise&&this._invokeDeferred(this._startContentSharingDeferredPromise),this._takeControlDeferredPromise&&this._invokeDeferred(this._takeControlDeferredPromise))},e.prototype.startContentSharing=function(e){var t=this,n=this._logger.createFnLogger("startContentSharing",e);if(this._startContentSharingDeferredPromise)return this._startContentSharingDeferredPromise.promise;if(0!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be started as it is not in the initial state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Start content sharing for : "+this._platformImpl.contentSharingGuid),this._startContentSharingDeferredPromise=i.defer();var s=function(){t._startContentSharingDeferredPromise=null};return this._startContentSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callStartContentSharing()}).then(function(){return t._pendingDeferreds.push(t._startContentSharingDeferredPromise)}).then(function(){return t._startContentSharingDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"startContentSharing",n)})},e.prototype.joinContentSharing=function(e){var t=this,n=this._logger.createFnLogger("joinContentSharing",e);if(this._joinContenSharingDeferredPromise)return this._joinContenSharingDeferredPromise.promise;if(2!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be joined as it is not in ringing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Join content sharing for : "+this._platformImpl.contentSharingGuid),this._joinContenSharingDeferredPromise=i.defer();var s=function(){t._joinContenSharingDeferredPromise=null};return this._joinContenSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callStartContentSharing()}).then(function(){return t._pendingDeferreds.push(t._joinContenSharingDeferredPromise)}).then(function(){return t._joinContenSharingDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)})},e.prototype.updateContentSharingParticipantStateToViewer=function(e){var t=this,n=this._logger.createFnLogger("updateContentSharingParticipantStateToViewer",e);if(this._updateParticipantStateDeferredPromise)return this._updateParticipantStateDeferredPromise.promise;if(4!==this._platformImpl.contentSharingStatus){var r="Cannot update participant state as content sharing is not in connected state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Update content sharing participant state for : "+this._platformImpl.contentSharingGuid),this._updateParticipantStateDeferredPromise=i.defer();var s=function(){t._updateParticipantStateDeferredPromise=null};return this._updateParticipantStateDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callUpdateContentSharingParticipantState()}).then(function(){return t._pendingDeferreds.push(t._updateParticipantStateDeferredPromise)}).then(function(){return t._updateParticipantStateDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)})},e.prototype.updateContentSharingSessionState=function(e,t,n){var r=this,o=this._logger.createFnLogger("updateContentSharingSessionState",n);if(this._updateContentSharingSessionStateDeferredPromises[e])return this._updateContentSharingSessionStateDeferredPromises[e].promise;if(3!==this._platformImpl.contentSharingStatus){var s="Cannot update session state as content sharing is not in presenting state",l=a.ACTION_NOT_ALLOWED(s);return o.logFailure(s),Promise.reject(l)}var c=i.defer();this._updateContentSharingSessionStateDeferredPromises[e]=c;var u=function(){delete r._updateContentSharingSessionStateDeferredPromises[e]};return this._updateContentSharingSessionStateDeferredPromises[e].promise.then(u,u),o.info("Update content sharing session state for : "+this._platformImpl.contentSharingGuid),Promise.resolve(void 0).then(function(){return r._platformImpl.callUpdateContentSharingSessionState(e,t)}).then(function(){return r._updateContentSharingSessionStateDeferredPromises[e].promise}).catch(function(e){r.handleContentSharingOperationError(e,"updateContentSharingSessionState",o)})},e.prototype.takeContentSharingControl=function(e){var t=this,n=this._logger.createFnLogger("takeContentSharingControl",e);if(this._takeControlDeferredPromise)return this._takeControlDeferredPromise.promise;if(5!==this._platformImpl.contentSharingStatus){var r="Cannot take control of content sharing as it is not in viewing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Taking control of content sharing for : "+this._platformImpl.contentSharingGuid),this._takeControlDeferredPromise=i.defer();var s=function(){t._takeControlDeferredPromise=null};return this._takeControlDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callTakeContentSharingControl()}).then(function(){return t._pendingDeferreds.push(t._takeControlDeferredPromise)}).then(function(){return t._takeControlDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"takeContentSharingControl",n)})},e.prototype.stopContentSharing=function(e){var t=this,n=this._logger.createFnLogger("stopContentSharing",e);if(this._stopContentSharingDeferredPromise)return this._stopContentSharingDeferredPromise.promise;if(2===this._platformImpl.contentSharingStatus||4===this._platformImpl.contentSharingStatus||5===this._platformImpl.contentSharingStatus){var r="Incoming content sharing cannot be stopped",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}this._stopContentSharingDeferredPromise=i.defer();var s=function(){t._stopContentSharingDeferredPromise=null};return this._stopContentSharingDeferredPromise.promise.then(s,s),n.info("Stop content sharing for : "+this._platformImpl.contentSharingGuid),Promise.resolve(void 0).then(function(){return t._platformImpl.callStopContentSharing()}).then(function(){return t._pendingDeferreds.push(t._stopContentSharingDeferredPromise)}).then(function(){return t._stopContentSharingDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"stopContentSharing",n)})},e.prototype.handleContentSharingOperationError=function(e,t,n){var r=e instanceof Error?e.toString():JSON.stringify(e);throw n.logFailure("Error in "+t+"(), contentSharingGuid = "+this._platformImpl.contentSharingGuid+", error = "+r),e&&e.hasOwnProperty("terminatedReason")?e:a.ACTION_NOT_ALLOWED(r)},e.prototype._rejectPendingPromises=function(e){this._logger.info("rejectPendingPromises"),this._pendingDeferreds.forEach(function(t){t.reject(e)}),this._pendingDeferreds=[],r.forEach(this._updateContentSharingSessionStateDeferredPromises,function(t){t.reject(e)}),this._updateContentSharingSessionStateDeferredPromises={}},e.prototype._invokeDeferred=function(e){this._logger.info("_invokeDeferred"),e&&(r.pull(this._pendingDeferreds,e),e.resolve())},e.prototype._rejectDeferred=function(e,t){this._logger.info("_rejectDeferred"),e&&(r.pull(this._pendingDeferreds,e),e.reject(t))},e}();t.ContentSharingSession=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){return function(e,t,n){this.dataId=e,this.handler=t,this.sourceSinkInternallyCreated=n,this.isAttached=!1}}(),o=function(){function e(e,t){this.logger=e,this._slimcoreInstance=t,this._dataChannel=null,this._dataChannelStatus=SlimCore.Enums.DataChannelStatus.Unknown,this._handlers={},this._availableHandlers=0,this._dataChannelStartCalled=!1,this.setInternalSourceSink=this.setInternalSourceSink.bind(this)}return e.prototype.addHandler=function(e,t,n,r){if(void 0===n&&(n=!1),e<0||e>=64)return Promise.reject(new Error("Data Id "+e+" is outside the valid range of 0-63"));if(this._handlers.hasOwnProperty(e)&&this._handlers[e].handler)return Promise.reject(new Error("Data Id "+e+" is already registered to a non-null handler"));this.logger.info("Adding handler to dataId: "+e+", "+(n?"skipping source sink creation":"making source sink"));var o=null,a=!1;return e in this._handlers?((o=this._handlers[e]).handler=t,a=!0):(o=new i(e,t,n),this._handlers[e]=o,n||(a=!0)),a&&(this._availableHandlers++,this._isDataChannelAvailable&&(this._negotiationTag=r,this.start()),this._isDataChannelActive)?this._attachHandler(o):Promise.resolve()},e.prototype.removeHandler=function(e){var t=this._handlers[e];return t?(this._detachHandler(t),delete this._handlers[e],this._availableHandlers--,Promise.resolve()):Promise.reject(new Error("Handler associated with Data Id "+e+" wasn't attached in the first place"))},e.prototype.updateNegotiationTag=function(e){return this._negotiationTag=e,Promise.resolve()},e.prototype.dispose=function(){this._detachAllHandlers(),this._dataChannel&&(this._dataChannel=null)},e.prototype.setDataChannel=function(e){if(this._dataChannel)throw new Error("Unexpected setting of data channel when we already have one");return this._dataChannel=e,Promise.resolve()},e.prototype.onDataChannelStatusChanged=function(e){var t=this;return e!==SlimCore.Enums.DataChannelStatus.Active||this._isDataChannelActive?e===SlimCore.Enums.DataChannelStatus.Available&&(this._isDataChannelActive||this._isDataChannelStopping?(this._dataChannelStartCalled=!1,this._detachAllHandlers()):this._availableHandlers>0&&this.start()):this._attachAllHandlers().catch(function(e){t.logger.error("Failed to attach all handlers error: "+e)}),this._dataChannelStatus=e,Promise.resolve()},e.prototype.setProtocolDataSource=function(e){return Promise.resolve()},e.prototype.processProtocolMessage=function(e,t,n,r){return Promise.resolve()},Object.defineProperty(e.prototype,"_isDataChannelAvailable",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Available},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelActive",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelStopping",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Stopping},enumerable:!0,configurable:!0}),e.prototype._attachAllHandlers=function(){var e=this;return Promise.all(Object.keys(this._handlers).map(function(t){var n=e._handlers[t];return n&&(n.handler&&n.dataSource&&n.dataSink||!n.sourceSinkInternallyCreated)?e._attachHandler(n):Promise.resolve(null)}))},e.prototype.setInternalSourceSink=function(e,t,n){if(e<0||e>=64)throw new Error("Data Id "+e+" is outside the valid range of 0-63");if(this._handlers.hasOwnProperty(e)&&(this._handlers[e].dataSource||this._handlers[e].dataSink))this.logger.info("Data Id "+e+" for internal source sink is already registered");else if(this.logger.info("Setting internal source sink for dataId: "+e),e in this._handlers)this._handlers[e].dataSource=t,this._handlers[e].dataSink=n,this.logger.info("Completed adapter details for dataId: "+e),this._availableHandlers++;else{var r=new i(e,null,!0);r.dataSource=t,r.dataSink=n,this._handlers[e]=r}},e.prototype._attachHandler=function(e){var t=this;if(e.isAttached)return Promise.resolve();try{if(this.logger.info("Attaching handler for dataId: "+e.dataId+", "+(e.sourceSinkInternallyCreated?"skipping source sink creation":"making source sink")),e.sourceSinkInternallyCreated){if(!e.dataSource||!e.dataSink)return this.logger.error("Attaching handler with null datasource or datasink"),Promise.reject(new Error("Attaching handler with null datasource or datasink"))}else e.dataSource=r.createDataSource(this._slimcoreInstance,e.dataId),this._dataChannel.registerDataSource(e.dataSource),e.dataSink=r.createDataSink(this._slimcoreInstance,e.dataId),this._dataChannel.registerDataSink(e.dataSink);e.listener=function(n){try{e.handler.onDataReceived(e.dataId,n.data,n.sourceID)}catch(n){t.logger.error("Exception thrown from onDataReceived for data id "+e.dataId+", error: "+n)}},e.dataSink.on("data",e.listener);return e.isAttached=!0,e.handler.onStarted(e.dataId,function(t,n){try{return e.dataSource.sendData(t,n),Promise.resolve()}catch(e){return Promise.reject(e)}}),Promise.resolve()}catch(t){return this.logger.error("Attaching handler for data id "+e.dataId+" threw exception: "+t),Promise.reject(t)}},e.prototype._detachAllHandlers=function(){var e=this;Object.keys(this._handlers).forEach(function(t){e._detachHandler(e._handlers[t])})},e.prototype._detachHandler=function(e){var t=this;if(e.isAttached)try{if(this.logger.info("Detaching data handler dataid: "+e.dataId),e.handler&&e.handler.onStopped(e.dataId).catch(function(e){t.logger.warn("Error in handler onStopped :"+e)}),e.sourceSinkInternallyCreated){if(e.dataSink)try{e.dataSink.removeListener("data",e.listener)}catch(e){this.logger.warn("Error removing internal listener, call probably ended: "+e)}}else e.dataSource&&this._dataChannel.unregisterDataSource(e.dataSource).catch(function(e){t.logger.warn("Failed to unregister data source, call probably ended: "+e)}).then(function(){e.dataSource.dispose(),e.dataSource=null}),e.dataSink&&(e.dataSink.removeAllListeners("data"),this._dataChannel.unregisterDataSink(e.dataSink).catch(function(e){t.logger.warn("Failed to unregister data sink, call probably ended: "+e)}).then(function(){e.dataSink.dispose(),e.dataSink=null}));e.isAttached=!1}catch(t){this.logger.error("Exception thrown while detaching handler for data id "+e.dataId+", error: "+t)}},e.prototype.start=function(){return this.logger.info("Data channel start called from adapter"),this._dataChannel?this._dataChannelStartCalled?(this.logger.warn("Data channel start called more than once"),Promise.resolve()):(this._dataChannelStartCalled=!0,this._dataChannel.start(this._negotiationTag)):Promise.reject(new Error("Attempted to call start without a data channel"))},e}();t.default=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(47),l=n(12),c=n(3),u=n(4),d=n(32),p=n(5),h=n(0),f=n(1),g=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild(function(){return"SlimCoreElectronScreenSharingControl"}),n,r)||this;return a.callId=i,a._controlInjector=o,a.controlState=0,a.role=0,a.controlDataChannelStatus={id:null,readyForControl:!1,state:0},a._enabled=!1,a._availableAckEnabled=!0,a._dataChannelActive=!1,a._dataChannelAvailableSent=!1,a._protocolDataSource=null,a._controlDataSource=null,a._controlDataSink=null,a._controlRequest=null,a._controlRequestSubscription=null,a._controllerParticipant=null,a._controllerParticipantSubscription=null,a._screenSharingVideoRenderer=null,a._sharerParticipant=null,a._controlCapturer=null,a._captureEventSubscription=null,a._controlEventSubscription=null,a._requestControlTimer=null,a._grantControlTimer=null,a._acceptControlTimer=null,a._terminateControlTimer=null,a._availableAckTimer=null,a._retryAttempt=0,a._injectRawInputErrorTimer=null,a._lastInjectRawInputErrorCount=0,a._raiseRenderedAtViewer=null,a._participantSubscriptions={},a._logger.info("constructor"),a}return i(t,e),t.prototype.enableScreenSharingControl=function(e,t,n,r){if(this._availableAckEnabled!==e||this._allowControlForUser!==r){if(this._allowControlForUser=r,e)this._raiseScreenSharingControlCapableEvent(!0,"");else{if(0===t){var i={reason:2,detail:n};this.event("sharingControlError").raise(i)}this._raiseScreenSharingControlCapableEvent(!1,"")}this._availableAckEnabled=e}},t.prototype.setRaiseRenderedAtViewer=function(e){this._raiseRenderedAtViewer=e},t.prototype.setScreenSharingControlFeatureFlag=function(e){this._enabled=e,this._availableAckEnabled=e},t.prototype.isScreenSharingControlEnabled=function(){return this._enabled},t.prototype.setRenderer=function(e,t){var n=this,r=e,i=t||r.renderTarget;return u.asap(function(){return n._setViewingRenderer(r,i)})},t.prototype.setDataChannel=function(e){var t=this;return u.asap(function(){return t._setDataChannel(e)})},t.prototype._setDataChannel=function(e){this._logger.info("Setting DataChannel "+(e&&e.id)),this._dataChannel&&!e&&this._detachAndDeleteControlDevices(),this._dataChannel=e,e&&(this.controlDataChannelStatus={id:e.id,readyForControl:!1,state:l.default._mapDataChannelStatus(e._lastDataChannelState)},this.event("controlDataChannelStateChanged").raise(this.controlDataChannelStatus))},t.prototype.setProtocolDataSource=function(e){var t=this;return u.asap(function(){return t._setProtocolDataSource(e)})},t.prototype._setProtocolDataSource=function(e){this._protocolDataSource=e},t.prototype._raiseScreenSharingControlCapableEvent=function(e,t,n){if(this._enabled){this._logger.info("_raiseScreenSharingControlCapableEvent() enabled is true, raising control capability, capable="+e);var r={capable:e,id:t,disabledBySharer:n};this.event("sharingControlCapable").raise(r)}else{this._logger.info("_raiseScreenSharingControlCapableEvent() enabled is false, disabling control capability");r={capable:!1,id:t};this.event("sharingControlCapable").raise(r)}},t.prototype.initControlForSharer=function(){this._logger.info("initControlForSharer()"),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this.role=1,this._dataChannelAvailableSent=!1,this._setInjectorMode(0),this._raiseScreenSharingControlCapableEvent(!0,"")},t.prototype.shutdownControlForSharer=function(){if(this._logger.info("shutdownControlForSharer()"),this._controlRequest){this._logger.warn("Rejecting pending control requests");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest),t=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(t),this._sendRequest({action:4,terminatedReason:5},e)}if(this.role=0,this._controllerParticipant){var n={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this.event("sharingControlChanged").raise(n)}this._teardownSharerRemoteControl(),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled},t.prototype._resetParticipantSubscriptions=function(){this._logger.info("resetParticipantSubscriptions(): Stopping tracking all participant state changes"),c.each(this._participantSubscriptions,function(e){e.dispose()}),this._participantSubscriptions={}},t.prototype.initControlForViewer=function(e){this._logger.info("initControlForViewer()"),this.role=2,this._sharerParticipant?this._sharerParticipant.id!==e.id&&(this._logger.info("initControlForViewer() sharer switched, new sharer id="+p.scrubMriOrOmit(e.id)),this._dataChannelAvailableSent=!1,4===this.controlState&&this._terminateControl(!1)):(this._logger.info("initControlForViewer() setting sharer to id="+p.scrubMriOrOmit(e.id)),this._sharerParticipant=e,this._dataChannelAvailableSent=!1),this._dataChannel&&this._dataChannelActive&&!this._dataChannelAvailableSent&&(this._resetControlState(),this.role=2,this._sharerParticipant=e,this._logger.info("initControlForViewer() sending Available message to sharer"),this._startAvailableHandshake())},t.prototype.shutdownControlForViewer=function(e){this._logger.info("shutdownControlForViewer()");var t=!1;if((!e||this._sharerParticipant&&e.id===this._sharerParticipant.id)&&(this._logger.info("shutdownControlForViewer: setting shouldShutdownControlForViewer to true"),t=!0),t&&this._isViewing()){if(1===this.controlState){if(this._sharerParticipant){var n=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:6},n)}else this._logger.warn("shutdownControlForViewer: sharer participant is null");var r={inControl:!1,id:"",terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:r,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action =shutdownControlForViewer")}else if(4===this.controlState){r={inControl:!1,id:"",terminatedReason:6};this.event("sharingControlChanged").raise(r)}this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._dataChannelAvailableSent=!1,this._raiseScreenSharingControlCapableEvent(!1,"")}},t.prototype._resetControlRequest=function(e){this._clearControlRequest(),this._controlRequest=e,this._registerParticipantListener(e),3===e.participantState&&this.event("sharingIncomingControlRequest").raise(e.participant.id)},t.prototype._clearControlRequest=function(){this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null},t.prototype._stopListeningToParticipantChanges=function(e){this._controlRequestSubscription&&(this._logger.info("_stopListeningToParticipantChanges: stopping tracking changes for "+e.participant.id),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)},t.prototype._registerParticipantListener=function(e){var t=this;this._logger.info("_registerParticipantListener: tracking changes for "+e.participant.id),this._controlRequestSubscription=e.participant.changed(function(){if(e.participant.state!==e.participantState)switch(e.participantState=e.participant.state,e.participantState){case 3:t.event("sharingIncomingControlRequest").raise(e.participant.id);break;case 0:case 5:case 4:t.denyControlRequest().catch(function(e){t._logger.info("it is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err is "+e)}),t._logger.info("_registerParticipantListener: participant "+e.participant.id+" is no longer connected. resetting"),t._clearControlRequest(),t._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:break;default:t._logger.error("unexpected participantState {request.participantState} unhandled")}})},t.prototype._resetControllerParticipant=function(e){var t=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for "+this._controllerParticipant.participant.id),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._logger.info("_resetControllerParticipant: tracking changes for "+e.participant.id),this._controllerParticipantSubscription=e.participant.changed(function(){3!==e.participant.state&&t.handleParticipantRemoved(e.participant.id)})),this._controllerParticipant=e},t.prototype.handleParticipantRemoved=function(e){if(this._participantSubscriptions[e]&&(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for "+e),this._participantSubscriptions[e].dispose(),delete this._participantSubscriptions[e]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._teardownSharerRemoteControl(),this.controlState=0,this._resetControllerParticipant();var t={inControl:!1,id:e,terminatedReason:5};this.event("sharingControlChanged").raise(t)}this._raiseScreenSharingControlCapableEvent(!1,e)}else if(this._sharerParticipant&&this._sharerParticipant.id===e&&4===this.controlState){this._logger.info("handleParticipantRemoved: sharer left call, tearing down control session"),this._teardownViewerRemoteControl(),this.controlState=0;t={inControl:!1,id:"",terminatedReason:6};this.event("sharingControlChanged").raise(t)}},t.prototype.handleCallDisconnected=function(){this._logger.info("handleCallDisconnected()"),this._isSharing()?this.shutdownControlForSharer():this.shutdownControlForViewer()},t.prototype._videoSizeChanged=function(e,t){null!=this._controlCapturer&&this._controlCapturer.updateVideoSize(e,t)},t.prototype._onRenderStarted=function(){if(this._sharerParticipant){var e=this._getSharerDataSourceId();this._sendRequest({action:11,terminatedReason:0},e)}else this._logger.error("Attempted to send sharing rendered message to null sharerParticipant")},t.prototype._setViewingRenderer=function(e,t){var n=this;try{this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),e?(this._screenSharingVideoRenderer=e,this._screenSharingVideoRenderer.on("videoSizeChanged",function(e,t){return n._videoSizeChanged(e,t)}),this._screenSharingVideoRenderer.on("renderStarted",function(){return n._onRenderStarted()}),this._controlCapturer=new s.default(this._logger,this._settings,this._slimcoreInstance,t),4===this.controlState?(this._logger.info("_setViewingRenderer: detected local state is controlling"),this._setupViewerRemoteControl()):this._setCapturerMode(0)):this._logger.error("_setViewingRenderer: screenSharingRenderer is null")}catch(e){this._logger.error("_setViewingRenderer: unable to set _screenSharingVideoRenderer error = "+e)}},t.prototype._isSharing=function(){return 1===this.role},t.prototype._isViewing=function(){return 2===this.role},t.prototype._createAndAttachControlDevices=function(){var e=this;if(this._logger.info("_createAndAttachControlDevices()"),h.hasCreateDataSource(this._slimcoreInstance)&&h.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){var t=Promise.resolve(),n=Promise.resolve();this._controlDataSource||(this._controlDataSource=h.createDataSource(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.Control),this._logger.info("created Control DataSource"),t=this._dataChannel.registerDataSource(this._controlDataSource).then(function(){return e._logger.info("registered Control DataSource")}).catch(function(t){return e._logger.error("registerDataSource threw exception: "+t)})),this._controlDataSink||(this._controlDataSink=h.createDataSink(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.Control),this._logger.info("created Control DataSink"),n=this._dataChannel.registerDataSink(this._controlDataSink).then(function(){return e._logger.info("registered Control DataSink")}).catch(function(t){return e._logger.error("registerDataSink threw exception: "+t)})),Promise.all([t,n]).then(function(){e.controlDataChannelStatus.readyForControl=!0,e.event("controlDataChannelStateChanged").raise(e.controlDataChannelStatus)}),this._controlDataSink.on("data",function(t){e._controlInjector.injectRawInput(t.data,t.sourceID).catch(function(n){e._lastInjectRawInputErrorCount++,null===e._injectRawInputErrorTimer&&(e._injectRawInputErrorTimer=setTimeout(function(){var r={reason:1,detail:JSON.stringify({dataChannelId:e._dataChannel.id,sourceId:t&&t.sourceID,count:e._lastInjectRawInputErrorCount,errorMsg:n})};e.event("sharingControlError").raise(r),e._lastInjectRawInputErrorCount=0,e._injectRawInputErrorTimer=null},1e4))})})}else this._logger.warn("_createAndAttachControlDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._detachAndDeleteControlDevices=function(){var e=this;this._logger.info("_detachAndDeleteControlDevices()"),this._controlDataSink&&this._controlDataSink.removeAllListeners("data"),this._dataChannel?(this._controlDataSource&&(this._dataChannel.unregisterDataSource(this._controlDataSource).then(function(){return e._logger.info("Control DataSource unregistered")}).catch(function(t){return e._logger.warn("unregisterDataSource threw exception: "+t)}),this._controlDataSource=null,this._logger.info("deleted Control data source")),this._controlDataSink&&(this._dataChannel.unregisterDataSink(this._controlDataSink).then(function(){return e._logger.info("Control DataSink unregistered")}).catch(function(t){return e._logger.warn("unregisterDataSink threw exception: "+t)}),this._controlDataSink=null,this._logger.info("deleted Control data sink"))):this._logger.warn("_detachAndDeleteControlDevices() null dataChannel")},t.prototype.onDataChannelStatusChanged=function(e){var t=this;return u.asap(function(){return t._onDataChannelStatusChanged(e)})},t.prototype._onDataChannelStatusChanged=function(e){this._logger.info("Data channel status = "+e),this.controlDataChannelStatus.readyForControl=this.controlDataChannelStatus.readyForControl&&e===SlimCore.Enums.DataChannelStatus.Active,this.controlDataChannelStatus.state=l.default._mapDataChannelStatus(e),this.event("controlDataChannelStateChanged").raise(this.controlDataChannelStatus),e===SlimCore.Enums.DataChannelStatus.Active?this._enabled&&this._dataChannel&&!this._dataChannelActive&&(this._dataChannelActive=!0,this._createAndAttachControlDevices(),this._isViewing()?this._dataChannelAvailableSent||(this._sharerParticipant?(this._logger.info("_onDataChannelStatusChanged() sending Available message to sharer"),this._startAvailableHandshake()):this._logger.error("Unexpected null _sharerParticipant trying to send Available to sharer")):this._isSharing()&&this._raiseScreenSharingControlCapableEvent(!0,"")):this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._dataChannelAvailableSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this._detachAndDeleteControlDevices(),this._raiseScreenSharingControlCapableEvent(!1,""))},t.prototype._handleAvailableRequest=function(e,t,n){var r=this,i=!1,o=0;if(!1===this._enabled)this._logger.info("feature flag is off. no need to answer the available ack"),i=!0,o=9;else if(!1===this._availableAckEnabled)this._logger.info("available ack is off. no need to answer the available ack"),i=!0,o=9;else if(t&&t.id){if(this._allowControlForUser&&typeof this._allowControlForUser==typeof Function)return void this._allowControlForUser(t).then(function(a){a||(i=!0,o=1),r._sendResponseToAvailableRequest(e,t,n,i,o)})}else i=!0,o=10;this._sendResponseToAvailableRequest(e,t,n,i,o)},t.prototype._sendResponseToAvailableRequest=function(e,t,n,r,i){var o=this;r?(this._logger.info("Rejecting Available for handShake:"+n+":"+e.handshakeId),this.event("controlAvailableHandshake").raise(e.handshakeId,n,7,this._getAvailableHandshakeTerminatedFromControlTerminated(i)),this._sendRequest({action:10,terminatedReason:i,handshakeId:e.handshakeId},n)):(this._raiseScreenSharingControlCapableEvent(!0,t.id),this._participantSubscriptions[t.id]||(this._logger.info("Tracking participant status for "+t.id),this._participantSubscriptions[t.id]=t.changed(function(){3!==t.state&&(o._logger.info("Participant "+t.id+" is not connected. removing"),o.handleParticipantRemoved(t.id))})),this._logger.info("Acking Available for handShake:"+n+":"+e.handshakeId),this.event("controlAvailableHandshake").raise(e.handshakeId,n,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:e.handshakeId},n))},t.prototype.processProtocolMessage=function(e,t,n,r){var i=this;return u.asap(function(){return i._processProtocolMessage(e,t,n,r)})},t.prototype._raiseControlRequestCanceled=function(e){this.event("sharingIncomingControlRequestCancelled").raise(e.participant.id)},t.prototype._processProtocolMessage=function(e,t,n,r){var i;try{i=JSON.parse(e)}catch(e){return void this._logger.error("Error parsing controlMessage")}if(this._logger.info("_processProtocolMessage action="+i.action+" sender="+r),0===i.action)this._handleAvailableRequest(i,t,r);else if(1===i.action)!1===this._enabled?(this._logger.warn("Sharer control is disabled - rejecting request"),this._sendRequest({action:4,terminatedReason:9},r)):this._controlRequest?(this._logger.warn("Sharer is already processing a control request...rejecting new requests"),this._sendRequest({action:4,terminatedReason:3},r)):this._controllerParticipant&&this._controllerParticipant.participant===t?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==n?(this._logger.warn("rejecting control request from second endpoint. participantId: "+n),this._sendRequest({action:4,terminatedReason:3},r)):(this._logger.warn("Got control request for someone already in control"),this._sendRequest({action:3,terminatedReason:0},r)):t?this._resetControlRequest({participant:t,participantState:t.state,participantId:n}):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring");else if(3===i.action){if(1===this.controlState)this._sendRequest({action:5,terminatedReason:0},r)?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action ="+i.action)):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but fail to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - state ="+this.controlState+" action ="+i.action),this._cancelRequestControlTimer();else this._logger.warn("AcceptRequest message received in controlState="+this.controlState)}else if(4===i.action)if(1===this.controlState){this.controlState=0;var o={inControl:!1,id:"",terminatedReason:i.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:o,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action ="+i.action),this._cancelRequestControlTimer()}else this._logger.warn("RejectRequest message received in controlState="+this.controlState+" reason="+i.terminatedReason);else if(2===i.action){if(this._controlRequest){var a=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(a)}}else if(6===i.action){if(this._sendRequest({action:5,terminatedReason:0},r)){this._setupViewerRemoteControl(),this.controlState=4;o={inControl:!0,id:"",terminatedReason:i.terminatedReason};this.event("sharingControlChanged").raise(o)}}else if(5===i.action)if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant===t){var s=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);r!==s&&this._logger.warn("acknowledging source id: "+r+" does not match requesting source id: "+s),this._logger.info("Setting up remote control for controller source id="+s),this._setupSharerRemoteControl(s),this.controlState=3;o={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:i.terminatedReason};this.event("sharingControlChanged").raise(o),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer()):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.WaitingForControlAck action ="+i.action)}else t?this._logger.warn("Ignoring ack from participant that does not match controller id = "+p.scrubMriOrOmit(t.id)):this._logger.warn("Ignoring ack from null participant source id = "+r);else 5===this.controlState?(this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.WaitingForTerminateAck action ="+i.action)):this._logger.warn("Unexpected ack in control state = "+this.controlState);else if(7===i.action||8===i.action){var l=void 0;this._isViewing()?(this._teardownViewerRemoteControl(),l=""):(this._teardownSharerRemoteControl(),t?l=t.id:this._logger.error("Got terminate message but could not find a sender participant!")),this.controlState=0,this._resetControllerParticipant();o={inControl:!1,id:l,terminatedReason:i.terminatedReason};this.event("sharingControlChanged").raise(o),8===i.action&&this._sendRequest({action:5,terminatedReason:0},r)}else if(9===i.action)this._terminateAvailableHandshake&&this._terminateAvailableHandshake(1,i.handshakeId),this._raiseScreenSharingControlCapableEvent(!0,"");else if(10===i.action){if(10===i.terminatedReason)return;this._terminateAvailableHandshake&&this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(i.terminatedReason),i.handshakeId),1===i.terminatedReason?this._raiseScreenSharingControlCapableEvent(!0,"",!0):this._raiseScreenSharingControlCapableEvent(!1,"")}else 11===i.action?this._raiseRenderedAtViewer&&(t?this._raiseRenderedAtViewer(t.id):this._logger.error("Got RenderedAtViewer message but could not find a sender participant!")):this._logger.error("Unknown request action received on control protocol data sink, action="+i.action)},t.prototype._getAvailableHandshakeTerminatedFromControlTerminated=function(e){switch(e){case 10:return 6;case 1:return 7;case 9:default:return 0}},t.prototype._sendRequest=function(e,t){var n=!1,r=this._protocolDataSource;if(t<0)return this._logger.error("Unexpected: invalid sourceID="+t),n;if(r){this._logger.info("sending control message action="+e.action+" to sourceID="+t);var i={type:0,message:JSON.stringify(e)};try{var o=[t];r.sendData(h.stringToBuffer(JSON.stringify(i)),o),n=!0}catch(e){this._logger.error("Unexpected: failure in call to sendData. Error="+e);var a={reason:5,detail:JSON.stringify({sourceId:t,errorMsg:e})};this.event("sharingControlError").raise(a)}}else this._logger.error("Unexpected: null dataSource in _sendRequest");return n},t.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()},t.prototype._setupSharerRemoteControl=function(e){var t=this;this._logger.info("_setupSharerRemoteControl() sourceId="+e),this._setInjectorMode(1),this._controlInjector.allowSingleController(e).catch(function(n){var r={reason:3,detail:JSON.stringify({sourceId:e,errorMsg:n})};t.event("sharingControlError").raise(r)})},t.prototype._teardownSharerRemoteControl=function(){var e=this;this._logger.info("_teardownSharerRemoteControl()"),this._controlInjector.allowSingleController(0).catch(function(t){var n={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:t})};e.event("sharingControlError").raise(n)}),this._setInjectorMode(0)},t.prototype._setupViewerRemoteControl=function(){this._logger.info("_setupViewerRemoteControl()"),this._setCapturerMode(3)},t.prototype._teardownViewerRemoteControl=function(){this._logger.info("_teardownViewerRemoteControl()"),this._setCapturerMode(0)},t.prototype._setInjectorMode=function(e){var t=this;this._logger.info("_setInjectorMode() mode="+e);var n={mode:e,noMotionTimeoutMs:0,noMotionSharerTimeoutMs:0};this._controlInjector.setInjectorConfig(n).catch(function(n){var r={reason:0,detail:JSON.stringify({mode:e,errorMsg:n})};t.event("sharingControlError").raise(r)})},t.prototype._clearCapturerEventSubscriptions=function(){this._logger.info("_clearCapturerEventSubscriptions()"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._controlEventSubscription&&(this._controlEventSubscription.dispose(),this._controlEventSubscription=null)},t.prototype._setCapturerMode=function(e){var t=this;this._logger.info("_setCapturerMode() capturerMode="+e),this._controlCapturer?(this._controlCapturer.setCaptureMode(e),this._clearCapturerEventSubscriptions(),1===e?this._captureEventSubscription=this._controlCapturer.on("captureEvent",function(e){0===e&&t.event("sharingRendererClicked").raise()}):2===e?this._captureEventSubscription=this._controlCapturer.on("captureEvent",function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()}):3===e&&(this._controlEventSubscription=this._controlCapturer.on("controlEvent",function(e){if(t._controlDataSource&&t._sharerParticipant){var n=[t._getSharerDataSourceId()];t._controlDataSource.sendData(e,n)}}),this._captureEventSubscription=this._controlCapturer.on("captureEvent",function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()}))):this._logger.warn("_controlCapturer not found when trying to setup viewer capture mode")},t.prototype.setPointerImage=function(e,t){return this._logger.warn("setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage"),e?this.setRemotePointerImage(e,t):this.setLocalPointerImage(t)},t.prototype.setLocalPointerImage=function(e){return 0===e.length?Promise.reject(new Error("setLocalPointerImage invalid image length")):this._setPointerImage(0,e)},t.prototype.setRemotePointerImage=function(e,t){return o(this,void 0,void 0,function(){var n,r,i,o;return a(this,function(a){switch(a.label){case 0:if(!e)throw new Error("setRemotePointerImage participant is null");if(0===t.length)throw new Error("setRemotePointerImage invalid image length");if(e.enableParticipantLegToSourceIdMapping)return[3,2];if((o=this._mapParticipantToSourceId(e))<0)throw new Error("setRemotePointerImage unable to map participant to sourceId");return[4,this._setPointerImage(o,t)];case 1:return a.sent(),[2];case 2:if(0===(n=this._getParticipantsDataSourceIds(e)).length)throw new Error("setRemotePointerImage unable to map participant to sourceIds");this._logger.info("set pointer image for "+n.length+" sources"),r=0,i=n,a.label=3;case 3:return r<i.length?(o=i[r],[4,this._setPointerImage(o,t)]):[3,6];case 4:a.sent(),a.label=5;case 5:return r++,[3,3];case 6:return[2]}})})},t.prototype._setPointerImage=function(e,t){return this._isSharing()||this._logger.warn("_setPointerImage called when not sharing"),this._controlInjector.setAvatar(h.stringToBuffer(t),e)},t.prototype.startPointerMode=function(){var e=this;return this._dataChannelActive?0!==this.controlState?Promise.reject(new Error("startPointerMode called in bad control state="+this.controlState)):this._isViewing()?u.asap(function(){return e._setCapturerMode(2)}):Promise.reject(new Error("startPointerMode when not viewing")):Promise.reject(new Error("startPointerMode when data channel not active"))},t.prototype.stopPointerMode=function(){var e=this;return 0!==this.controlState?Promise.reject(new Error("stopPointerMode called in bad control state="+this.controlState)):this._isViewing()?u.asap(function(){return e._setCapturerMode(1)}):Promise.reject(new Error("stopPointerMode when not viewing"))},t.prototype._startAvailableHandshake=function(){var e=this,t=this._getSharerDataSourceId();t<0&&this._logger.warn("sharer: "+this._sharerParticipant+" has no data channel");var n=d.default();this._logger.info("_startAvailableHandshake() - handshakeId: "+t+":"+n),this.event("controlAvailableHandshake").raise(n,t,1),this._terminateAvailableHandshake&&(this._logger.warn("Replacing existing availble handshake"),this._terminateAvailableHandshake(4)),this._sendRequest({action:0,terminatedReason:0,handshakeId:n},t)||this._logger.error("Failed to send Available message to sharer, will retry after backoff"),this._dataChannelAvailableSent=!0,this._waitForAvailableAck(n),this._terminateAvailableHandshake=function(r,i){void 0===r&&(r=0),e._logger.info("_terminateAvailableHandshake() - handshakeId: "+t+":"+n+", status: "+r),e._terminateAvailableHandshake=null,e.event("controlAvailableHandshake").raise(n,t,1===r?5:6,r),i&&i!==n&&e._logger.warn("AvailableSeries: Got handshake from another series - expected: "+n+", received: "+i),e._availableAckTimer&&(clearTimeout(e._availableAckTimer),e._availableAckTimer=null),e._retryAttempt=0}},t.prototype._waitForAvailableAck=function(e){var t=this;this._logger.info("_waitForAvailableAck()"),this._availableAckTimer=setTimeout(function(){t._logger.warn("No Ack received for Available message from attempt="+t._retryAttempt),t._availableAckTimer=null;var n=t._getSharerDataSourceId();if(t._retryAttempt<=6)t._logger.info("Re-sending Available message handshakeId: "+n+":"+e),t.event("controlAvailableHandshake").raise(e,n,2),t._sendRequest({action:0,terminatedReason:0,handshakeId:e},n),t._waitForAvailableAck(e);else if(t._logger.error("Reached Available retry limit! Control capability will be false"),t._terminateAvailableHandshake)t._terminateAvailableHandshake(5);else{var r={reason:4,detail:JSON.stringify({sourceId:n,errorMsg:"Timed out after "+t._retryAttempt+" tries"})};t.event("sharingControlError").raise(r)}},2e3*++this._retryAttempt)},t.prototype.requestControl=function(){return this._dataChannelActive?0!==this.controlState?Promise.reject(new Error("requestControl called in bad state="+this.controlState)):this._isViewing()?this._sharerParticipant?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestControl():Promise.reject(new Error("requestControl unexpected null sharer")):Promise.reject(new Error("requestControl when not viewing")):Promise.reject(new Error("requestControl when data channel not active"))},t.prototype._requestControl=function(){var e=this;this._logger.info("_requestControl()"),this._requestControlPromise=u.defer();var t=function(){e._requestControlPromise=null};this._requestControlPromise.promise.then(t,t);var n=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0},n)){var r={inControl:!1,id:"",terminatedReason:7};return this._requestControlPromise.reject(new Error),Promise.reject(new Error(JSON.stringify({controlInfo:r,details:""})))}return this.controlState=1,this._requestControlTimer=setTimeout(function(){if(1===e.controlState){e.controlState=0,e._logger.warn("No response to control request - canceling"),e._sendRequest({action:2,terminatedReason:2},n)||e._logger.error("fail to send the cancel control request");var t={inControl:!1,id:"",terminatedReason:2};e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:"we did not get any response to the control - terminating control"}))):e._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.RequestSent")}else e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):e._logger.error("Unexpected, no promise could be resolved - controlState = "+e.controlState);e._requestControlTimer=null},3e4),this._requestControlPromise.promise},t.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},t.prototype.cancelControl=function(){return this._dataChannelActive?1!==this.controlState?Promise.reject(new Error("cancelControl called in bad state="+this.controlState)):this._isViewing()?this._sharerParticipant?this._requestControlPromise?this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while cancelling control")):this._cancelControl():Promise.reject(new Error("request control promise has been resolved while cancelling control")):Promise.reject(new Error("cancelControl unexpected null sharer")):Promise.reject(new Error("cancelControl when not viewing")):Promise.reject(new Error("cancelControl when data channel not active"))},t.prototype._cancelControl=function(){this._logger.info("_cancelControl()");var e=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(new Error("cancel control - in bad state - do nothing"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info("Viewer cancel the control"),!this._sendRequest({action:2,terminatedReason:8},e))return Promise.reject(new Error("fail to send cancel control request"));var t={inControl:!1,id:"",terminatedReason:8};return this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:""}))),new Promise(function(e,t){e()})},t.prototype.acceptControlRequest=function(){return this._dataChannelActive?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while accepting control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while accepting control")):this._acceptControlRequest():Promise.reject(new Error("acceptControlRequest when not sharing")):Promise.reject(new Error("acceptControlRequest while no control request pending")):Promise.reject(new Error("acceptControlRequest when data channel not active"))},t.prototype._acceptControlRequest=function(){var e=this;this._logger.info("_acceptControlRequest()"),this._acceptControlPromise=u.defer();var t=function(){e._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(t,t),this._controllerParticipant){this._logger.warn("_acceptControlRequest called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},n)||this._logger.error("fail to send the terminateNoAck request"),this._resetControllerParticipant()}var r=this._getDataSourceIdForParticipantLeg(this._controlRequest),i=this._controlRequest.participant.id;return this._sendRequest({action:3,terminatedReason:0},r)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=setTimeout(function(){if(2===e.controlState){e.controlState=0,e._resetControllerParticipant(),e._logger.error("No ack received when accepting control request - terminating control"),e._sendRequest({action:7,terminatedReason:4},r)||e._logger.error("fail to send the TerminateNoAck request");var t={inControl:!1,id:i,terminatedReason:4};e.event("sharingControlChanged").raise(t),e._acceptControlPromise?e._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):e._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForControlAck")}else e._acceptControlPromise?e._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):e._logger.error("Unexpected, no promise could be resolved - controlState = "+e.controlState);e._acceptControlTimer=null},1e4),this._acceptControlPromise.promise):(this._logger.error("fail to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("fail to send the accept control request!")))},t.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},t.prototype.denyControlRequest=function(){return this._dataChannelActive?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while denying control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while denying control")):this._denyControlRequest():Promise.reject(new Error("denyControlRequest when not sharing")):Promise.reject(new Error("denyControlRequest while no control request pending")):Promise.reject(new Error("denyControlRequest when data channel not active"))},t.prototype._denyControlRequest=function(){this._logger.info("_denyControlRequest()");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest);return this._clearControlRequest(),this._sendRequest({action:4,terminatedReason:1},e)?new Promise(function(e,t){e()}):Promise.reject(new Error("fail to send the deny control requst"))},t.prototype.grantControl=function(e){return this._dataChannelActive?this._controlRequest?Promise.reject(new Error("grantControl called while control request pending")):this._isSharing()?e?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while granting control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while granting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while granting control")):this._grantControl(e):Promise.reject(new Error("grantControl null participant")):Promise.reject(new Error("grantControl when not sharing")):Promise.reject(new Error("grantControl when data channel not active"))},t.prototype._grantControl=function(e){var t=this;this._logger.info("_grantControl()"),this._grantControlPromise=u.defer();var n=function(){t._grantControlPromise=null};if(this._grantControlPromise.promise.then(n,n),3===this.controlState){if(this._controllerParticipant.participant===e)return this._logger.warn("grantControl called for participant who already has control"),this._grantControlPromise.resolve(),new Promise(function(e,t){e()});this._logger.warn("_grantControl called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},r)||this._logger.error("fail to send the terminateNoAck request")}var i=this._mapParticipantToSourceId(e);if(!this._sendRequest({action:6,terminatedReason:0},i))return this._logger.error("fail to send the grant control request"),this._grantControlPromise.reject(new Error),Promise.reject(new Error("fail to send the grant control request!"));var o=this._getParticipantIdForDataSourceId(e,i);return this._resetControllerParticipant({participant:e,participantState:e.state,participantId:o}),this.controlState=2,this._grantControlTimer=setTimeout(function(){2===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when granting control - terminating control"),t._sendRequest({action:7,terminatedReason:4},i)||t._logger.error("fail to send the terminateNoAck request"),t._grantControlPromise?t._grantControlPromise.reject(new Error("No ack received when granting control - terminating control")):t._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForControlAck")):t._grantControlPromise?t._grantControlPromise.reject(new Error("grant control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState = "+t.controlState);t._grantControlTimer=null},1e4),this._grantControlPromise.promise},t.prototype._cancelGrantControlTimer=function(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(new Error("cancelled by _cancelGrantControlTimer")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)},t.prototype._mapParticipantToSourceId=function(e){return this._dataChannel?e.getSourceIdForMediaType(4):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getParticipantsDataSourceIds=function(e){var t=[];try{if(e&&e.endpoints&&e.endpoints.endpointDetails){if(1===e.endpoints.endpointDetails.length)if(!(i=e.endpoints.endpointDetails[0])||!i.mediaStreams)return t.push(l.DATA_SOURCE_ID_ANY),t;for(var n=0,r=e.endpoints.endpointDetails;n<r.length;n++){var i;if((i=r[n])&&i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(4===h.mapMediaTypeStringToMediaType(s.type)){if(t.push(s.sourceId),t.length>=8)return this._logger.error("excessive amount of data streams"),t;break}}}}}catch(e){this._logger.error("_getParticipantsDataSourceIds caught exception error="+e)}return t},t.prototype._getParticipantIdForDataSourceId=function(e,t){return e.getParticipantIdForSourceId(4,t)},t.prototype._getDataSourceIdForParticipantId=function(e,t){return this._dataChannel?e.getSourceId(t,4):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getDataSourceIdForParticipantLeg=function(e){return this._getDataSourceIdForParticipantId(e.participant,e.participantId)},t.prototype._getSharerDataSourceId=function(){var e=this._sharerParticipant.getSharingParticipantLeg();return e?this._getDataSourceIdForParticipantId(this._sharerParticipant,e):(this._logger.warn("unable to identify the sharer participantId, falling back to first data channel"),this._mapParticipantToSourceId(this._sharerParticipant))},t.prototype.terminateControl=function(){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._sharerParticipant)return Promise.reject(new Error("terminateControl called but _sharerParticipant is null"))}else{if(!this._isSharing())return Promise.reject(new Error("terminateControl called but not sharing nor viewing"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while terminating control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while terminating control")):this._terminateControl()},t.prototype._terminateControl=function(e){var t=this;void 0===e&&(e=!0),this._logger.info("_terminateControl()"),this._terminateControlPromise=u.defer();var n=function(){t._terminateControlPromise=null};this._terminateControlPromise.promise.then(n,n);var r,i,o=0,a=e?8:7;if(this._isViewing()){if(4!==this.controlState)return this._logger.error("Local viewer called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local viewer called terminateControl when not controlling"));this._teardownViewerRemoteControl(),o=6,r=this._getSharerDataSourceId(),i=""}else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error("Local sherer called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local sherer called terminateControl when no one is in control"));this._teardownSharerRemoteControl(),o=5,r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),i=this._controllerParticipant.participant.id}if(!this._sendRequest({action:a,terminatedReason:o},r)){if(e)return this._logger.error("fail to send the terminate control request"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("fail to send the grant control request!"));this._logger.error("fail to send the terminateNoAck request")}this.controlState=e?5:0;var s={inControl:!1,id:i,terminatedReason:o};return this.event("sharingControlChanged").raise(s),e?(this._terminateControlTimer=setTimeout(function(){5===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when terminating control - resending terminate request"),t._sendRequest({action:7,terminatedReason:4},r)||t._logger.error("fail to send the terminateNoAck request"),t._terminateControlPromise?t._terminateControlPromise.reject(new Error("No ack received when terminating control - resending terminate request")):t._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForTerminateAck")):t._terminateControlPromise?t._terminateControlPromise.reject(new Error("terminate control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState = "+t.controlState);t._terminateControlTimer=null},1e4),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise(function(e,t){e()}))},t.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null)},t.prototype._disposeControlCapturer=function(){this._logger.info("_disposeControlCapturer"),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(),this._controlCapturer=null)},t.prototype.dispose=function(){this._logger.info("SlimCoreElectronScreenSharingControl.dispose()"),this._detachAndDeleteControlDevices(),this._resetControlState(),this._dataChannel&&(this._dataChannel=null),this._disposeControlCapturer(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._resetParticipantSubscriptions(),e.prototype.dispose.call(this)},t}(f.default);t.default=g},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(1),s=250;!function(e){e[e.ScanCode=0]="ScanCode",e[e.VirtualKey=1]="VirtualKey",e[e.NonKbdInput=2]="NonKbdInput",e[e.Invalid=3]="Invalid"}(o||(o={}));var l=function(e){function t(t,n,r,i,a){void 0===a&&(a=!0);var l=e.call(this,t,n,r)||this;return l._element=i,l._captureRegionPreserveAspectRatio=a,l._mouseMoveCount=0,l._isMouseOnRenderer=!1,l._captureMode=0,l._handleResizeEvents=function(){clearTimeout(l._resizeTimerID),l._resizeTimerID=window.setTimeout(function(){return l.updateCaptureRegion()},s)},l._handleMouseLeave=function(e){!l._isOnScreenContent(e)&&l._isMouseOnRenderer&&(l._raiseCaptureEvent(2),l._logger.info("Mouse leaving render region")),l._isMouseOnRenderer=!1},l._handleMouseEnter=function(e){l._isOnScreenContent(e)&&(l._isMouseOnRenderer=!0,l._raiseCaptureEvent(1),l._logger.info("Mouse entering render region"))},l._handleLosingFocus=function(e){l._syncKeyStates(!0)},l._handleClick=function(e){l._isOnScreenContent(e)&&(l._raiseCaptureEvent(0),l._logger.info("Mouse clicked"))},l._handleMouseMove=function(e){if(!l._isOnScreenContent(e)&&l._isMouseOnRenderer)return l._raiseCaptureEvent(2),l._isMouseOnRenderer=!1,void l._logger.info("Mouse leaving render region");if(l._isOnScreenContent(e)&&!l._isMouseOnRenderer&&(l._raiseCaptureEvent(1),l._isMouseOnRenderer=!0,l._logger.info("Mouse entering render region")),(2===l._captureMode||3===l._captureMode)&&(l._mouseMoveCount++,l._isOnScreenContent(e)&&l._mouseMoveCount%2!=0)){var t={type:0};l._normalizeMousePosition(e,t),l._raiseMouseEvent(t)}},l._handleMouseDown=function(e){if((2===l._captureMode||3===l._captureMode)&&l._isOnScreenContent(e)){var t={type:2,buttonType:c(e.button),buttonDown:!0};l._normalizeMousePosition(e,t),l._raiseMouseEvent(t)}},l._handleMouseUp=function(e){if((2===l._captureMode||3===l._captureMode)&&l._isOnScreenContent(e)){var t={type:2,buttonType:c(e.button),buttonDown:!1};l._normalizeMousePosition(e,t),l._raiseMouseEvent(t)}},l._handleKeyDown=function(e){l._raiseKeyboardEvent({codeType:o.VirtualKey,code:e.keyCode,repeat:e.repeat,keyUp:!1}),e.stopPropagation(),e.preventDefault()},l._handleKeyUp=function(e){l._raiseKeyboardEvent({codeType:o.VirtualKey,code:e.keyCode,repeat:e.repeat,keyUp:!0}),e.stopPropagation(),e.preventDefault()},l._handleWheel=function(e){l._raiseMouseEvent({type:1,wheelRotation:e.deltaY>0?-120:120})},l._handleContextMenu=function(e){e.preventDefault()},l._initialize(),l}return i(t,e),Object.defineProperty(t.prototype,"captureMode",{get:function(){return this._captureMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRegion",{get:function(){return this._captureRegion},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._logger.info("Disposing of Control Capturer"),window.clearTimeout(this._pollTimerID),this._element.ownerDocument.defaultView.removeEventListener("resize",this._handleResizeEvents,!1),e.prototype.dispose.call(this)},t.prototype.updateVideoSize=function(e,t){this._videoSize.width=e,this._videoSize.height=t,this.updateCaptureRegion()},t.prototype.updateCaptureRegion=function(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)},t.prototype.setCaptureMode=function(e){3===this._captureMode&&3!==e&&this._syncKeyStates(!0),this._captureMode=e,0!==e?(this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===e?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))},t.prototype._initialize=function(){this._ensureCanReceiveKeyboardInput(),this._element.ownerDocument.defaultView.addEventListener("resize",this._handleResizeEvents,!1),this._captureRegion={left:0,top:0,width:this._element.clientWidth,height:this._element.clientHeight},this._videoSize={width:640,height:360},this._origElementSize={width:0,height:0},this._checkElementSize()},t.prototype._ensureCanReceiveKeyboardInput=function(){this._element.tabIndex=this._element.tabIndex},t.prototype._checkElementSize=function(){var e=this;this._origElementSize.width===this._element.clientWidth&&this._origElementSize.height===this._element.clientHeight||(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout(function(){return e._checkElementSize()},3e3)},t.prototype._raiseMouseEvent=function(e){var t=new ArrayBuffer(7),n=new DataView(t),r=(3&e.type)<<0,i=(7&e.buttonType)<<2,o=(e.buttonDown?1:0)<<5,a=(e.wheelButtonDown?1:0)<<6;n.setUint8(0,1),n.setUint8(1,r|i|o|a|0),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),this._raiseCtrlEvent(t)},t.prototype._raiseKeyboardEvent=function(e){var t=new ArrayBuffer(3),n=new DataView(t),r=(3&e.codeType)<<0,i=(e.keyUp?1:0)<<4,o=(e.repeat?1:0)<<5;n.setUint8(0,0),n.setUint8(1,0|(0|r|i|o)),n.setUint8(2,e.code),this._raiseCtrlEvent(t)},t.prototype._raiseCtrlEvent=function(e){this.event("controlEvent").raise(new Uint8Array(e))},t.prototype._raiseCaptureEvent=function(e){this.event("captureEvent").raise(e)},t.prototype._normalizeMousePosition=function(e,t){t.xPos=(e.offsetX-this._captureRegion.left)/this._captureRegion.width*65535,t.yPos=(e.offsetY-this._captureRegion.top)/this._captureRegion.height*65535},t.prototype._isOnScreenContent=function(e){var t=this._captureRegion.left,n=this._captureRegion.left+this._captureRegion.width,r=this._captureRegion.top,i=this._captureRegion.top+this._captureRegion.height;return t<=e.offsetX&&e.offsetX<n&&r<=e.offsetY&&e.offsetY<i},t.prototype._syncKeyStates=function(e){this._raiseKeyboardEvent({codeType:o.VirtualKey,code:17,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:o.VirtualKey,code:16,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:o.VirtualKey,code:18,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:o.VirtualKey,code:91,repeat:!1,keyUp:e}),this._logger.info("Synced Key states.")},t}(a.default);function c(e){switch(e){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}t.default=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,n){this._create=e,this._release=t,this._logger=n,this._bindingMap={},this._logger.info("BindingManager created")}return e.prototype.acquire=function(e,t){var n=this;if(!this._bindingMap[t]||this._bindingMap[t].releasePromise){var r=!1,i=void 0;this._bindingMap[t]?(i=this._bindingMap[t].releasePromise.catch(function(e){return n._logger.info("Release binding error: "+e)}),r=!0):i=Promise.resolve();var o=i.then(function(){return n._create(t)}).then(function(e){return e}).catch(function(e){throw delete n._bindingMap[t],e});this._bindingMap[t]={createPromise:o,owners:[],chained:r}}return this._bindingMap[t].owners.push(e),this._bindingMap[t].createPromise},e.prototype.release=function(e,t){return r(this,void 0,void 0,function(){var n,r,o=this;return i(this,function(i){switch(i.label){case 0:return this._bindingMap[t]?[4,this._bindingMap[t].createPromise]:[3,2];case 1:if(n=i.sent(),(r=this._bindingMap[t].owners.indexOf(e))>-1&&this._bindingMap[t].owners.splice(r,1),0===this._bindingMap[t].owners.length)return this._bindingMap[t].releasePromise=this._release(t,n).then(function(){o._bindingMap[t].chained||delete o._bindingMap[t]}),[2,this._bindingMap[t].releasePromise];i.label=2;case 2:return[2]}})})},e}();t.SlimCoreElectronBindingManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(50),o=n(51);t.initLogging=function(e,t){if(!r.RootToolsManager.isDelegateSet()){var n=new o.RootToolsManagerDelegate(e,t.logger);if(r.RootToolsManager.setDelegate(n),t.logger){var a=new i.RedirectingLogAppender(t.logger);r.LogFactory.instance().addAppender(a)}}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=function(e){function t(t){var n=e.call(this,new o.StandardLogFormatter(o.SLF_Flags.Component))||this;return n._logger=t,n}return i(t,e),t.prototype.log=function(e,t,n,r){if(this._logger){var i=e.level<=o.LogLevel.Debug4?this._logger.debug:e.level<=o.LogLevel.Debug2?this._logger.log:e.level<=o.LogLevel.Debug1?this._logger.info:e.level<=o.LogLevel.Warning?this._logger.warn:this._logger.error;i&&i.apply(this._logger,[this.formatter().format(e,t,n,r)])}},t}(o.AbstractLogAppender);t.RedirectingLogAppender=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(52),i=function(){function e(e,t){this._slimcore=e,this._logger=t}return e.prototype.fetchEcsConfig=function(e,t){return r.Resolved(void 0)},e.prototype.sendTelemetry=function(e,t){},e.prototype.sendLoggingEventToNative=function(e,t){this._logger.debug("RootToolsManagerDelegate: handleLoggingEvent msg:"+e+" aux"+t),this._slimcore.handleLoggingEvent?this._slimcore.handleLoggingEvent(e,t):this._logger.warn("slimcore.handleLoggingEvent is not available")},e.prototype.setNativeLoggingEventCallback=function(e){var t=this;e&&"function"==typeof e?this._slimcore.handle("logging-event",void 0,function(n){t._logger.debug("RootToolsManagerDelegate: LoggingNativeEvent msg:"+n.message+" aux"+n.auxiliaryPayload),e(n.message,n.auxiliaryPayload)}):this._logger.warn("RootToolsManagerDelegate.setNativeLoggingEventCallback invalid callback provided")},e}();t.RootToolsManagerDelegate=i},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function r(e){return null!=e&&"function"==typeof e.cancel}function i(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var o,a=[],s=void 0!==e;function l(t){a.push(t),1===a.length&&(s?e(c):setTimeout(c,0))}function c(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function p(e){var t=u(),i=!1;return t.onCancel(function(t){e.forEach(function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){i||(i=!0,t.resolve(e))},function(e){i||(i=!0,t.reject(e))}):i||(i=!0,t.resolve(e))}),t.promise()}t.asyncCallback=l,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)}),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?l(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?i(function(){var i=t.successFunc(o._storedResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(i,t)})),n(i)?i.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(i)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?l(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?i(function(){var i=t.failFunc(o._storedErrResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(i,t)})),n(i)?i.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(i)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,i=u(),a=e.length,s=Array(e.length);i.onCancel(function(t){e.forEach(function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)})});var l=function(){0==--a&&(void 0!==t?i.reject(t):i.resolve(s))};return e.forEach(function(e,r){n(e)?e.then(function(e){s[r]=e,l()},function(e){void 0===t&&(t=void 0===e||e),l()}):(s[r]=e,l())}),i.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=u(),r=setTimeout(function(){n.resolve({timedOut:!0})},t);return p([e.then(function(e){return clearTimeout(r),{timedOut:!1,result:e}}),n.promise()])}}).call(t,n(53).setImmediate)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(54),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,n(37))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,a,s,l=1,c={},u=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){f(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){f(e.data)},r=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,r=function(e){var t=d.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(f,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[l]=i,r(l),l++},p.clearImmediate=h}function h(e){delete c[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(37),n(55))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var l,c=[],u=!1,d=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):d=-1,c.length&&h())}function h(){if(!u){var e=s(p);u=!0;for(var t=c.length;t;){for(l=c,c=[];++d<t;)l&&l[d].run();d=-1,t=c.length}l=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(3);!function(e){e[e.Integer=0]="Integer",e[e.String=1]="String",e[e.Binary=2]="Binary"}(o||(o={}));var s=function(e){function t(t){var n=e.call(this,t)||this;return n.eventListenerArrays={},void 0!==t.oncommonwrapperevent&&(t.oncommonwrapperevent=function(e){var t=n.argsFromCommonWrapperEventPayload(e),r=n.eventListenerArrays[e.target];r&&r.forEach(function(e){e(t)})}),n}return i(t,e),t.prototype.argsFromCommonWrapperEventPayload=function(e){if("object-property-changed"===e.target){var t=e.detail[0],n={objectType:t.objectType,objectId:t.objectId,propKey:t.propKey,value:void 0};switch(t.value.type){case o.Integer:n.value=t.value.intVal;break;case o.String:n.value=t.value.strVal;break;case o.Binary:n.value=t.value.binVal}return n}return e.detail[0]},t.prototype.addListener=function(e,t){var n=this.eventListenerArrays[e];return n||(n=this.eventListenerArrays[e]=[]),-1===n.indexOf(t)&&n.push(t),this},t.prototype.on=function(e,t){return this.addListener(e,t)},t.prototype.once=function(e,t){return this.addListener(e,t)},t.prototype.removeListener=function(e,t){var n=this.eventListenerArrays[e];if(n){var r=n.indexOf(t);r>-1&&n.splice(r,1)}return this},t.prototype.removeAllListeners=function(e){var t=this;if(e){var n=this.eventListenerArrays[e];return n&&(n=this.eventListenerArrays[e]=[]),this}return Object.keys(this.eventListenerArrays).forEach(function(e){t.eventListenerArrays[e]=[]}),this},t.prototype.getMaxListeners=function(){return 0},t.prototype.setMaxListeners=function(e){},t.prototype.listeners=function(e){return this.eventListenerArrays[e]},t.prototype.emit=function(e,t){var n=this.eventListenerArrays[e];return n&&n.forEach(function(e){e(t)}),!0},t}(function(){function e(e){var t=this;this._nativeObject=e,a.forIn(e,function(e,n,r){a.isFunction(e)?t[n]||(t[n]=function(){return e.apply(r,arguments)}):Object.defineProperty(t,n,{get:function(){return r[n]},set:function(e){r[n]=e}})})}return Object.defineProperty(e.prototype,"objectToWrap",{get:function(){return this._nativeObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectAsWrapped",{get:function(){return this},enumerable:!0,configurable:!0}),e}()),l=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t}(s),c=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.createCallInterface=function(){var e=this.objectToWrap.createCallInterface();return new s(e).objectAsWrapped},t.prototype.getContentSharing=function(e){var t=this.objectToWrap.getContentSharing(e);return new s(t).objectAsWrapped},t.prototype.createVideoBindingRenderer=function(e){var t=this.objectToWrap.createVideoBindingRenderer(e);return new l(t).objectAsWrapped},t.prototype.createVideoBindingScreenShare=function(){var e=this.objectToWrap.createVideoBindingScreenShare();return new l(e).objectAsWrapped},t.prototype.videoCreateBinding=function(e,t){var n=this;return new Promise(function(r,i){var o=t,a=o.objectToWrap;void 0!==a.onvideobindingcreatedevent&&(a.onvideobindingcreatedevent=function(){r()}),void 0!==a.onvideobindingfailedevent&&(a.onvideobindingfailedevent=function(){n.objectToWrap.videoReleaseBinding(e,o.objectToWrap),i("binding creation failed")}),n.objectToWrap.videoCreateBinding(e,o.objectToWrap)})},t.prototype.videoReleaseBinding=function(e,t){var n=this;return new Promise(function(r,i){var o=t,a=o.objectToWrap;void 0!==a.onvideobindingreleasedevent&&(a.onvideobindingreleasedevent=function(){r()}),n.objectToWrap.videoReleaseBinding(e,o.objectToWrap)})},t.prototype.setMediaConfig=function(e){this.objectToWrap.setMediaConfig(JSON.stringify(e))},t}(s);t.UwpEngineWrapped=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(36);t.slimCoreElectronStackFactory=r.slimCoreElectronStackFactory,t.slimCoreUwpStackFactory=r.slimCoreUwpStackFactory;var i=n(13);t.getOvb=i.getOvb,t.getVersion=i.getTsCallingVersion}])},e.exports=r(n(13),n(23))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";
/*!
 *  index.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(5)),r(n(7)),r(n(24)),r(n(14)),r(n(26))},function(e,t,n){"use strict";
/*!
 *  RootToolsManager.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(25),a=n(7),s=n(5),l=n(14),c=a.LogFactory.instance().component("RootToolsManager");a.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var u;!function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(u=t.BuildType||(t.BuildType={}));var d=u.InternalBuild;function p(e,t){var n=[];for(var r in e)n.push(t(r,e[r]));return n}function h(e,t,n){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}return!1}function f(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function g(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&h(e.matchers,t.matchers,f)}function _(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function m(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}t.setBuildType=function(e){var t=d;return d=e,t};var v=function(e){function t(t,n,r){var i=e.call(this)||this;return i._unmetConditions=[],i._rtMan=t,i._triggerCallback=n,i._ecsConfig=r,i.resetConditions(),i}return i(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&g(this._ecsConfig.resetCondition,e.resetCondition)&&h(this._ecsConfig.conditions,e.conditions,g)&&h(this._ecsConfig.filters,e.filters,m)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&g(this._ecsConfig.resetCondition,e.resetCondition)&&h(this._ecsConfig.conditions,e.conditions,g)&&h(this._ecsConfig.filters,e.filters,_)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var n=t[e.arg],r="string"==typeof n?e.value:parseInt(e.value,10);return"="===e.op||"=="===e.op?n===r:"!="===e.op?n!==r:"<"===e.op?n<r:"<="===e.op?n<=r:">"===e.op?n>r:">="===e.op?n>=r:"CONTAINS"===e.op.toUpperCase()&&(""+n).indexOf(e.value)>=0},t.prototype.conditionMatches=function(e,t,n){if(t!==e.logId)return!1;if(e.matchers)for(var r=0;r<e.matchers.length;r++)if(!this.matcherMatches(e.matchers[r],n))return!1;return!0},t.prototype.log=function(e,t,n,r){if(0!==this._unmetConditions.length&&e.component!==c){var i=this._ecsConfig;i.resetCondition&&this.conditionMatches(i.resetCondition,t,r)&&(c.debug4("LogTrigger %s: resetCondition met",i.name),this.resetConditions());for(var o=0;o<this._unmetConditions.length;o++){var a=this._unmetConditions[o];if(this.conditionMatches(i.conditions[a],t,r)){c.debug4("LogTrigger %s: condition %s met",i.name,i.conditions[a].name),this._unmetConditions.splice(o,1);break}}0===this._unmetConditions.length&&(c.debug1("LogTrigger %s has triggered, trying to send the log",i.name),this._triggerCallback.call(this._rtMan,i),i.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(l.AbstractLogAppender),y=function(e){function t(t,n){var r=e.call(this)||this;return r._circularBuffer=[],r._circularBufferMaxSize=0,r._circularBuffer=[],r._circularBufferMaxSize=n,r._includeUnsafe=t,r}return i(t,e),t.prototype.formatMessage=function(e){for(var t=[],n=0;n<e.length;n++)"string"==typeof e[n]||"number"==typeof e[n]?t.push(e[n]):t.push(JSON.stringify(e[n]));return t},t.prototype.log=function(e,t,n,r){if(this._includeUnsafe||e.component.safe()){var i={md:e,logId:t,messages:this.formatMessage(r)};this._circularBuffer.push(i),this._circularBuffer.length>this._circularBufferMaxSize&&this._circularBuffer.shift()}},t.prototype.visit=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t}(l.AbstractLogAppender),C=function(){function e(){this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32)+String.fromCharCode(34)+String.fromCharCode(32)}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),n=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[t>>0&63];this._data+=n,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add64=function(e){this._add32(e/4294967296|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,n,r,i){var o=this._components[e.name()];o||(o=++this._componentCount,this._components[e.name()]=o,this._add8(2),this._add16(o),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(e.safe()?1:0));var a=128;this._first&&(a|=2);var s=t-this._lastts;this._lastts=t,s>-128&&s<128&&(a|=1),this._add8(a),1&a?this._add8(s):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(o),this._add8(n),this._add32(r),this._add8(i.length);for(var l=0;l<i.length;l++)this._add8(8),this._addS(""+i[l]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e}();function S(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}var I=function(){function e(){this._maxUploadSize=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:s.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return e.prototype.setDelegate=function(e){this._glue=e,this.registerListeners()},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||s.LogLevel.Debug4,delete e.root;var n=p(e,function(e,t){return{component:e,level:t}});n.sort(function(e,t){return e.component.length-t.component.length}),n.forEach(function(e){return a.LogFactory.instance().component(e.component).setLevel(e.level)}),this._native&&this._native.log_config.setLogLevelConfig(n)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId)return null;if(e.matchers&&!(e.matchers instanceof Array))return null;var t,n={name:e.name||(t=e.logId,(4294967296+t).toString(16).substr(-8)),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var r=0,i=e.matchers;r<i.length;r++){var o=i[r],a=this.parseMatcher(o);a&&n.matchers.push(a)}return n},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:a.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,n){if(null==e)return null;if(!(e.conditions instanceof Array)||0==e.conditions.length)return null;if(!(e.filters instanceof Array)||0==e.filters.length)return null;if(e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var r={name:e.name||t+"->"+n,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:d!==u.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:S(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},i=0,o=e.conditions;i<o.length;i++){var a=o[i],s=this.parseCondition(a);s&&r.conditions.push(s)}for(var l=0,c=e.filters;l<c.length;l++){var p=c[l],h=this.parseFilter(p);h&&r.filters.push(h)}return 0===r.conditions.length?null:r},e.prototype.isExperimentListed=function(e,t,n,r){return!!e&&(!(!r||!e.some(function(e){return"*"===e.namespace}))||e.some(function(e){return e.namespace===t&&(e.experiment===n||"*"==e.experiment)}))},e.prototype.isExperimentAllowed=function(e,t,n){return!this.isExperimentListed(e.blacklist,t,n,!0)||this.isExperimentListed(e.whitelist,t,n,!1)},e.prototype.findTrigger=function(e,t){for(var n in e)if(e[n].configEquals(t))return n;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var n in e)if(e[n].nativeConfigEquals(t))return n;return null},e.prototype.OnEcsChange=function(){var e=this;return null==this._glue?o.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then(function(t){c.debug4("Reloading ULBaseline config - new config: %@",t),t||(c.warn("No ULBaseline config"),t={}),e._maxUploadSize=t.logUpload&&t.logUpload.maxSize||1024;var n=[],r=e._triggers;e._triggers={};var i=(t.logUpload&&t.logUpload.maxSize||1024)/100,u=t.circularBuffer&&t.circularBuffer.enabled,d=t.circularBuffer&&t.circularBuffer.buffers||e._defaultBuffers,h=t.circularBuffer&&t.circularBuffer.storeUnsafe;e._defaultExperimentTarget=S(t.defaultExperimentTarget)&&t.defaultExperimentTarget||"Mixed";var f=t.killswitch||e._defaultKillswitch,g=t.blacklists||e._defaultBlacklists;g.component.length>0&&a.LogFactory.instance().setComponentBlacklist(g.component);var _={};(t.componentLevels||[]).forEach(function(e){return _[e.component]=e.level}),function e(t,n,r){return n<t.length?r(t[n]).then(function(){return e(t,n+1,r)}):o.Resolved()}(t.configPaths||[],0,function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then(function(i){var o=i instanceof Array?i:[i];c.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,o);for(var a=0,s=o;a<s.length;a++){var l=s[a];if(null!=l){var d=e.parseConfig(l,t.ns,t.key);if(null!=d)if("JavaScript"===d.experimentTarget||"Mixed"===d.experimentTarget)if(c.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,d),e.isExperimentAllowed(f,t.ns,d.name)){c.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,d.name),u=!0;var p=e.findTrigger(r,d);null!=p?(c.debug2("Triggers updated, keeping trigger %s",d.name),e._triggers[p]=r[p],delete r[p]):n.push(d),d.filters&&d.filters.forEach(function(e){return _[e.component]=Math.min(_[e.component]||255,e.parsedLevel)}),d.includeUnsafe&&(h=!0)}else c.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key);else c.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,d);else c.error("Failed to parse ECS config for %s->%s",t.ns,t.key)}}})}).always(function(){for(var t in e.applyLogLevels(),r)c.debug2("Triggers updated, removing trigger %s",r[t].config().name),a.LogFactory.instance().removeAppender(+t);if(n.forEach(function(t){c.debug2("Triggers updated, adding trigger %s",t.name);var n=new v(e,e._triggered,t),r=a.LogFactory.instance().addAppender(n);e._triggers[String(r)]=n}),_[""]=_.root||s.LogLevel.Debug4,delete _.root,!e._circularBuffer||u&&!e._circularBuffer.needReset(h,i)?e._circularBuffer&&(Object.keys(r).length>0||n.length>0?(c.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):c.debug2("Buffer updated, no change")):(c.debug2("Buffer updated, removing existing buffer"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null),u&&(e._circularBuffer||(c.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",h,i),e._circularBuffer=new y(h,i)),null==e._circularBufferHandle&&(c.debug2("Creating log level wrapper"),e._circularBufferHandle=a.LogFactory.instance().addAppender(l.wrapAppenderWithLogLevels(e._circularBuffer,_),s.AppenderFlags.InsertFront))),e._native){var o=p(_,function(e,t){return{component:e,level:t}});o.sort(function(e,t){return e.component.length-t.component.length}),e._native.log_config.setLogBufferConfig(u,{storeUnsafe:h,buffers:d},o);var f=[];for(var g in e._triggers){var m=e._triggers[g].config();f.push({name:m.name,ecsNs:m.ecsNs,conditions:m.conditions,resetCondition:m.resetCondition,includeUnsafe:m.includeUnsafe,reenableAfterTriggering:m.reenableAfterTriggering,filters:m.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(f,{})}})})},e.prototype.filterMatches=function(e,t,n,r){for(var i=0;i<r.length;i++)if((""===r[i].component||e.component.name()===r[i].component||e.component.name().substr(0,r[i].component.length)===r[i].component&&"."===e.component.name().charAt(r[i].component.length))&&e.level>=r[i].parsedLevel)return!0;return!1},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry("638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104",{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),c.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,n,r,i){var o=this.findTriggerByNativeConfig(this._triggers,e);if(o){var s={level:t.level,component:a.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[o].log(s,n,r,i)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){var n=this;if(this._circularBuffer){var r=new C,i=e.filter.map(function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}}),a={matchedLines:0,totalLines:0};this._circularBuffer.visit(function(e,t,o){return a.totalLines++,n.filterMatches(e,t,o,i)&&(a.matchedLines++,r.log(e.component,e.timestamp,e.level,t,o)),r._data.length<n._maxUploadSize}),r.close();var s=r.data();if(c.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",a.matchedLines,a.totalLines,null!=s?s.length:0),this._native){var l=o.Defer();return this._native.log_config.mergeAndDumpLogBuffer(s,e,t,function(e){return l.resolve(e)}),l.promise()}return o.Resolved(s)}return c.warn("dumpLogBuffer: no log buffer enabled"),o.Rejected()},e.prototype._triggered=function(e){var t=this,n={compression:s.LogFileCompression.Compress,encoding:s.LogFileEncoding.Base64,encryption:s.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},r={includeUnsafe:e.includeUnsafe,filter:e.filters.map(function(e){return{component:e.component,level:e.parsedLevel}}),reverse:!0};this.dumpLogBuffer(r,n).then(function(n){return t._send(e,n)})},e.prototype.sendBRBEvent=function(e){try{if(c.debug2("sendBRBEvent %@",e),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var t={eventType:"uploadBRB",mutualSubmissionType:"call",payload:e};this._glue.sendLoggingEventToNative(JSON.stringify(t),"")}}catch(e){c.error("sendBRBEvent %s: %s",e.name,e.message)}},e.prototype.setBRBCallback=function(e){c.debug2("setBRBCallback"),null!=this._glue?"function"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=e:c.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):c.warn("setBRBCallback: RootToolsManagerDelegate is not set")},e.prototype.registerListeners=function(){var e=this;null!=this._glue&&"function"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback(function(t,n){return e.handleNativeLoggingEvent(t,n)}):c.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method")},e.prototype.handleNativeLoggingEvent=function(e,t){try{c.debug2("Native Log event message: %s aux: %s",e,t);var n=JSON.parse(e);if(n.eventType&&"uploadBRB"===n.eventType){if("function"!=typeof this._BRBCallback)return void c.warn("BRBCallback not set, ignoring native event");c.debug4("Sending BRB callback: %@",n.payload),this._BRBCallback(n.payload)}}catch(e){c.error("handleNativeLoggingEvent %s: %s",e.name,e.message)}},e.prototype.logExternalForDDL=function(e,t){try{if(c.debug2("logExternalForDDL %s %s",e,t),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var n={eventType:"logInSClog",payload:{message:e,parameters:t}};this._glue.sendLoggingEventToNative(JSON.stringify(n),"")}else c.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(e){c.error("logExternalForDDL %s: %s",e.name,e.message)}},e}();t.RootToolsManager=new I},function(e,t,n){"use strict";function r(e){return null!=e&&"function"==typeof e.then}function i(e){return null!=e&&"function"==typeof e.cancel}function o(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=d();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var a,s=[],l="undefined"!=typeof setImmediate;function c(e){s.push(e),1===s.length&&(l?setImmediate(u):setTimeout(u,0))}function u(){var e=s;s=[];for(var t=0;t<e.length;t++)e[t]()}function d(){return new a.SyncTask}function p(e){return(new a.SyncTask).resolve(e).promise()}function h(e){var t=d(),n=!1;return t.onCancel(function(t){e.forEach(function(e){i(e)&&a.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){r(e)?e.then(function(e){n||(n=!0,t.resolve(e))},function(e){n||(n=!0,t.reject(e))}):n||(n=!0,t.resolve(e))}),t.promise()}t.asyncCallback=c,function(e){var n=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)}),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var n=this;t.successFunc?o(function(){var o=t.successFunc(n._storedResolution);i(o)&&(t.wasCanceled?e.cancelOtherInternal(o,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(o,t)})),r(o)?o.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(o)},function(e){n._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?c(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var n=this;t.failFunc?o(function(){var o=t.failFunc(n._storedErrResolution);i(o)&&(t.wasCanceled?e.cancelOtherInternal(o,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(o,t)})),r(o)?o.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(o)},function(e){n._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=n}(a||(a={})),t.all=function(e){if(0===e.length)return p([]);var t,n=d(),o=e.length,s=Array(e.length);n.onCancel(function(t){e.forEach(function(e){i(e)&&a.SyncTask.cancelOtherInternal(e,t)})});var l=function(){0==--o&&(void 0!==t?n.reject(t):n.resolve(s))};return e.forEach(function(e,n){r(e)?e.then(function(e){s[n]=e,l()},function(e){void 0===t&&(t=void 0===e||e),l()}):(s[n]=e,l())}),n.promise()},t.Defer=d,t.Resolved=p,t.Rejected=function(e){return(new a.SyncTask).reject(e).promise()},t.race=h,t.raceTimer=function(e,t){var n=d(),r=setTimeout(function(){n.resolve({timedOut:!0})},t);return h([e.then(function(e){return clearTimeout(r),{timedOut:!1,result:e}}),n.promise()])}},function(e,t,n){"use strict";
/*!
 *  pii.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2017-01-16
 *  Copyright 2017 Microsoft. All rights reserved.
 *
 */Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e},i=!0,o=r,a={},s=0;var l,c=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(l||(l={}));var u=[l.Thread,l.InternalSkype,l.Bot];t.enableAnonymization=function(e){i=e},t.useTagger=function(e){o=e||r},function(e){function t(e){return i?e?a[e]||function(e){return a[e]="u"+ ++s}(e):null:e}e.UserName=function(e){var n=t(e);return o(n)},e.Mri=function(e){var n,r=e.match(c);if(r){var i=Number(r[1]),a=r[2];n=-1!=u.indexOf(i)?e:i+":"+t(a)}else n=t(e);return o(n)},e.Omit=function(e){var t;return t=i?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,o(t)}}(t.pii||(t.pii={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(28),o=n(29),a=n(32),s=n(33);t.PLATFORMS={"win32-ia32":922,"win32-x64":923,"linux-x64":924,"darwin-x64":925},t.getVSLSTokenFromAuthService=function(e){return r(this,void 0,void 0,function*(){const e={hostname:"authsvc-server.teams.microsoft.com",port:443,path:"/v1.0/authz/visitor",method:"POST",headers:{"Content-Type":"application/json","x-ms-request-id":o(),"x-ms-client-type":s.name}},t=JSON.stringify({tenantId:"72f988bf-86f1-41af-91ab-2d7cd011db47"});let n;const r=new a.DeferredPromise,l=i.request(e,e=>{200===e.statusCode?(e.setEncoding("utf8"),e.on("data",e=>{const t=JSON.parse(e);n=t.tokens,r.resolve()})):r.reject(`Expected 200 status code to get SkypeToken. status code: ${e.statusCode}`)});if(l.on("error",e=>{r.reject(`HTTPS request failed for SkypeToken: ${e.message}`)}),l.write(t),l.end(),yield r.promise.catch(e=>{throw new Error(e)}),!n)throw new Error("Error retrieving SkypeToken");return n.skypeId=function(e){try{const t=e.split(".")[1],n=t.replace(/-/g,"+").replace(/_/g,"/"),r=JSON.parse(Buffer.from(n,"base64").toString("ascii"));if(!r.skypeid)throw new Error("skypeid claim not found");return r.skypeid}catch(e){throw new Error(`Cannot retrieve skypeid from token: ${e.message}`)}}(n.skypeToken),n})},t.getNormalizedVersion=function(){let e=s.version;return-1!==e.indexOf("-")?`${e=e.substr(0,e.indexOf("-"))}.999`:`${e}.0`}},function(e,t){e.exports=require("https")},function(e,t,n){var r=n(30),i=n(31),o=i;o.v1=r,o.v4=i,e.exports=o},function(e,t,n){var r,i,o=n(15),a=n(16),s=0,l=0;e.exports=function(e,t,n){var c=t&&n||0,u=t||[],d=(e=e||{}).node||r,p=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==p){var h=o();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=i=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:l+1,_=f-s+(g-l)/1e4;if(_<0&&void 0===e.clockseq&&(p=p+1&16383),(_<0||f>s)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=f,l=g,i=p;var m=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;u[c++]=m>>>24&255,u[c++]=m>>>16&255,u[c++]=m>>>8&255,u[c++]=255&m;var v=f/4294967296*1e4&268435455;u[c++]=v>>>8&255,u[c++]=255&v,u[c++]=v>>>24&15|16,u[c++]=v>>>16&255,u[c++]=p>>>8|128,u[c++]=255&p;for(var y=0;y<6;++y)u[c+y]=d[y];return t||a(u)}},function(e,t,n){var r=n(15),i=n(16);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DeferredPromise=class{constructor(){let e,t;this.promise=new Promise((n,r)=>{e=n,t=r}),this.deferredReject=t,this.deferredResolve=e}resolve(e){this.deferredResolve(e)}reject(e){this.deferredReject(e)}}},function(e){e.exports={name:"vsliveshare-audio",displayName:"Live Share Audio",description:"Adds audio calling capabilities to Visual Studio Live Share",version:"0.1.49-598708e700",publisher:"ms-vsliveshare",preview:!0,license:"SEE LICENSE IN LICENSE.txt",icon:"images/icon.png",homepage:"https://aka.ms/vsls-audio",bugs:{url:"https://aka.ms/vsls-issues",email:"vsls-feedback@microsoft.com"},engines:{vscode:"^1.21.0"},keywords:["Collaboration","Voice","Sharing","Audio","Call"],categories:["Other"],aiKey:"AIF-d9b70cd4-b9f9-4d70-929b-a071c400b217",activationEvents:["onFileSystemAccess:vsls","*"],repository:{url:"https://github.com/MicrosoftDocs/live-share"},main:"./out/extension",contributes:{commands:[{command:"liveshare.audio.startOrJoinAudio",title:"Start or Join Audio Call",category:"Live Share","vsls-label":"$(unmute) Start or Join Audio Call","vsls-detail":"Enable audio for the Live Share session."},{command:"liveshare.audio",title:"Call Settings",category:"Live Share","vsls-label":"$(unmute) Manage Call Settings","vsls-detail":"Mute/unmute, select audio devices, or disconnect from the call.",icon:{dark:"images/dark/gear.svg",light:"images/light/gear.svg"}},{command:"liveshare.audio.muteSelf",title:"Mute Yourself",category:"Live Share",icon:{dark:"images/dark/speaker-mute.svg",light:"images/light/speaker-mute.svg"}},{command:"liveshare.audio.unmuteSelf",title:"Unmute Yourself",category:"Live Share",icon:{dark:"images/dark/speaker.svg",light:"images/light/speaker.svg"}},{command:"liveshare.audio.leaveAudio",title:"Disconnect Audio Call",category:"Live Share",icon:{dark:"images/stop.svg",light:"images/stop.svg"}}],configuration:{type:"object",title:"Live Share Audio",properties:{"liveshare.audio.joinCallBehavior":{type:"string",default:"prompt",description:"Controls how to respond when an audio call is started.",enum:["accept","prompt"]},"liveshare.audio.startCallOnShare":{type:"boolean",default:!1,description:"Controls whether to automatically start an audio call whenever you share."}}},menus:{commandPalette:[{command:"liveshare.audio.startOrJoinAudio",when:"liveshare.audio:state == LiveShareWithoutAudio"},{command:"liveshare.audio",when:"liveshare.audio:state == LiveShareWithAudio"}],"view/item/context":[{command:"liveshare.audio",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.participants",group:"inline"},{command:"liveshare.audio.leaveAudio",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.participants",group:"inline"},{command:"liveshare.audio.muteSelf",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.self",group:"inline"},{command:"liveshare.audio.unmuteSelf",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.self.muted",group:"inline"},{command:"liveshare.audio",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.participants",group:"navigation"},{command:"liveshare.audio.leaveAudio",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.participants",group:"navigation"},{command:"liveshare.audio.muteSelf",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.self",group:"navigation"},{command:"liveshare.audio.unmuteSelf",when:"view =~ /^liveshare\\.session(\\.explorer)?$/ && viewItem == audio.self.muted",group:"navigation"}]}},scripts:{"vscode:prepublish":"npm run compile",compile:"tsc -p ./ && cpx ./src/calling/externalApp/{package.json,LiveShare.png,styles.css} ./out/calling/externalApp/dist",watch:"tsc -watch -p ./",webpack:"node ./node_modules/webpack/bin/webpack.js --config ./webpack.config.js",package:"node ./node_modules/vsce/out/vsce package",postinstall:"node ./node_modules/vscode/bin/install"},devDependencies:{"@types/lodash":"^4.14.109","@types/mocha":"^2.2.42","copy-webpack-plugin":"^4.5.2",cpx:"^1.5.0",gulp:"^3.9.1","gulp-decompress":"^2.0.2","gulp-prompt":"^1.0.1","gulp-tslint":"^8.1.3",keytar:"^4.2.1",minimist:"^1.2.0","nerdbank-gitversioning":"^2.1.7",request:"^2.87.0",tslint:"^5.10.0","ts-loader":"^4.4.2",typescript:"^2.6.1",unzip:"^0.1.11",vsce:"^1.42.0",vscode:"^1.1.18",webpack:"^4.26.0","webpack-cli":"^3.1.2",yargs:"^12.0.1"},dependencies:{electron:"file:external/electron",dynamicloader:"file:external/dynamicloader","extract-zip":"1.6.7",dateformat:"^3.0.3",download:"^7.1.0","fs-extra":"^6.0.1",glob:"^7.1.2",lockfile:"^1.0.4",lodash:"^4.17.10",semver:"^5.5.0",tar:"^4.4.4",tmp:"0.0.33",uuid:"^3.2.1","vscode-extension-telemetry":"0.1.0",vsls:"^0.3.967","vscode-jsonrpc":"^3.3.1","skype-calling-electron-embedded":"file:external/skype-calling-electron-embedded","@skype/skype-calling-electron":"^2019.16.0-0.95-98258","@skype/skype-calling-interface":"^2019.16.0-0.95-98258","@skype/rt-js-bindings":"^2019.16.0-0.95-98258","@types/node":"^11.13.7"},extensionDependencies:["ms-vsliveshare.vsliveshare"],runtimeDependencies:[{code:"electron-4.2.7",description:"electron-win-ia32-skype-4.2.7",url:"https://callingcdndev.blob.core.windows.net/electron/electron-win-ia32-signed/skype-4.2.7/3168415/electron.zip",platforms:["win32"],architectures:["ia32"],vscodeVersion:">=1.24.0",installPath:"./electron-4.2.7/dist",unpackPath:"../../temp",packageRootPath:"",installTestPath:"./electron-4.2.7/dist/electron.exe",checksum:"c26692fef51f3a3d0d3c743b85de9c90b9727167"},{code:"electron-4.2.7",description:"electron-win-x64-skype-4.2.7",url:"https://callingcdndev.blob.core.windows.net/electron/electron-win-x64-signed/skype-4.2.7/3168415/electron.zip",platforms:["win32"],architectures:["x64"],vscodeVersion:">=1.24.0",installPath:"./electron-4.2.7/dist",unpackPath:"../../temp",packageRootPath:"",installTestPath:"./electron-4.2.7/dist/electron.exe",checksum:"e92d87e69cb4eb1931bbf1a4a0dcb999979635cb"},{code:"electron-4.2.7",description:"electron-lin-x64-skype-4.2.7",url:"https://callingcdndev.blob.core.windows.net/electron/electron-lin-x64/skype-4.2.7/3168415/electron.zip",platforms:["linux"],architectures:["x64"],vscodeVersion:">=1.24.0",installPath:"./electron-4.2.7/dist",unpackPath:"../../temp",packageRootPath:"",installTestPath:"./electron-4.2.7/dist/electron",chmod:"755",chmodPaths:["electron"],checksum:"d236d1a5f3bf626e6e65ac184a5070b261e5aa10"},{code:"electron-4.2.7",description:"electron-mac-x64-skype-4.2.7",url:"https://callingcdndev.blob.core.windows.net/electron/electron-mac-x64-signed/skype-4.2.7/3168415/electron.zip",platforms:["darwin"],architectures:["x64"],vscodeVersion:">=1.24.0",installPath:"./electron-4.2.7/dist",unpackPath:"../../temp",packageRootPath:"",installTestPath:"./electron-4.2.7/dist/Electron.app/Contents/MacOS/Electron",checksum:"62a4f358bd10db08634983101bb4ddc24ed5ed02"},{code:"slimcore-4.0",description:"slimcore-electron-signed-2019.23.01.1.tgz",url:"https://go.microsoft.com/fwlink/?linkid=2095315&clcid=0x409",platforms:["linux"],architectures:["x64"],vscodeVersion:">=1.24.0",installPath:"./slimcore-4.0",unpackPath:"../temp",packageRootPath:"package",installTestPath:"./slimcore-4.0/package.json",checksum:"9e9bf7810427af0aafb741c8a99d566d20c30b6d"},{code:"slimcore-4.0",description:"slimcore-electron-signed-2019.23.01.1.tgz",url:"https://go.microsoft.com/fwlink/?linkid=2095409&clcid=0x409",platforms:["darwin"],architectures:["x64"],vscodeVersion:">=1.24.0",installPath:"./slimcore-4.0",unpackPath:"../temp",packageRootPath:"package",installTestPath:"./slimcore-4.0/package.json",checksum:"73cf920184918b2abe6e85d6db5b46ec596e9e06"},{code:"slimcore-4.0",description:"slimcore-electron-signed-2019.23.01.1.tgz",url:"https://go.microsoft.com/fwlink/?linkid=2095408&clcid=0x409",platforms:["win32"],architectures:["x64"],vscodeVersion:">=1.24.0",installPath:"./slimcore-4.0",unpackPath:"../temp",packageRootPath:"package",installTestPath:"./slimcore-4.0/package.json",checksum:"aada86658b16d695acce1ba9f10e85649d5393cd"},{code:"slimcore-4.0",description:"slimcore-electron-signed-2019.23.01.1.tgz",url:"https://go.microsoft.com/fwlink/?linkid=2095314&clcid=0x409",platforms:["win32"],architectures:["ia32"],vscodeVersion:">=1.24.0",installPath:"./slimcore-4.0",unpackPath:"../temp",packageRootPath:"package",installTestPath:"./slimcore-4.0/package.json",checksum:"683fa78b2aec7e0b90e6a90cad07e20f1de3cde2"}]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);t.default=class{constructor(e){this.call=e}stop(){this.isActiveCall()&&this.call.stop().then(()=>r.proxyTraceSource.info(`[Call] Call finished, state: ${this.call.state}, reason:${this.call.terminatedReason} `)).catch(e=>r.proxyTraceSource.error(`[Call] stop failed: ${e}`))}isMuted(){return!this.call||this.call.isMuted||this.call.isServerMuted}mute(){this.isActiveCall()&&this.call.mute().catch(e=>r.proxyTraceSource.error(`[Call] mute failed: ${e}`))}unmute(){this.isActiveCall()&&this.call.unmute().catch(e=>r.proxyTraceSource.error(`[Call] unmute failed: ${e}`))}muteAll(){this.isActiveCall()&&this.call.muteParticipants(0,[]).catch(e=>r.proxyTraceSource.error(`[Call] muteAll failed: ${e}`))}muteSpeaker(){this.isActiveCall()&&this.call.muteSpeaker().catch(e=>r.proxyTraceSource.error(`[Call] muteSpeaker failed: ${e}`))}unmuteSpeaker(){this.isActiveCall()&&this.call.unmuteSpeaker().catch(e=>r.proxyTraceSource.error(`[Call] unmuteSpeaker failed: ${e}`))}hold(){this.isActiveCall()&&this.call.hold().catch(e=>r.proxyTraceSource.error(`[Call] hold failed: ${e}`))}unhold(){this.isActiveCall()&&this.call.unhold().catch(e=>r.proxyTraceSource.error(`[Call] unhold failed: ${e}`))}reconnect(){this.call&&this.call.reconnect().catch(e=>r.proxyTraceSource.error(`[Call] reconnect failed: ${e}`))}getCall(){return this.call}getCallInfo(){return this.call?{callId:this.call.callId,state:this.call.state,threadId:this.call.threadId}:null}isActiveCall(){return this.call&&7!==this.call.state&&6!==this.call.state}dispose(){this.call=null}}},function(e,t){e.exports=require("events")}]);
//# sourceMappingURL=app-bundle.js.map